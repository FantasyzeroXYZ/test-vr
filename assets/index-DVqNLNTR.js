(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();var sm={exports:{}},Ru={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var nS;function pL(){if(nS)return Ru;nS=1;var i=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(n,s,r){var a=null;if(r!==void 0&&(a=""+r),s.key!==void 0&&(a=""+s.key),"key"in s){r={};for(var u in s)u!=="key"&&(r[u]=s[u])}else r=s;return s=r.ref,{$$typeof:i,type:n,key:a,ref:s!==void 0?s:null,props:r}}return Ru.Fragment=e,Ru.jsx=t,Ru.jsxs=t,Ru}var iS;function mL(){return iS||(iS=1,sm.exports=pL()),sm.exports}var z=mL(),rm={exports:{}},bu={},om={exports:{}},am={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sS;function gL(){return sS||(sS=1,(function(i){function e(V,W){var q=V.length;V.push(W);e:for(;0<q;){var oe=q-1>>>1,he=V[oe];if(0<s(he,W))V[oe]=W,V[q]=he,q=oe;else break e}}function t(V){return V.length===0?null:V[0]}function n(V){if(V.length===0)return null;var W=V[0],q=V.pop();if(q!==W){V[0]=q;e:for(var oe=0,he=V.length,G=he>>>1;oe<G;){var K=2*(oe+1)-1,fe=V[K],Q=K+1,ue=V[Q];if(0>s(fe,q))Q<he&&0>s(ue,fe)?(V[oe]=ue,V[Q]=q,oe=Q):(V[oe]=fe,V[K]=q,oe=K);else if(Q<he&&0>s(ue,q))V[oe]=ue,V[Q]=q,oe=Q;else break e}}return W}function s(V,W){var q=V.sortIndex-W.sortIndex;return q!==0?q:V.id-W.id}if(i.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var r=performance;i.unstable_now=function(){return r.now()}}else{var a=Date,u=a.now();i.unstable_now=function(){return a.now()-u}}var f=[],c=[],d=1,p=null,m=3,y=!1,E=!1,A=!1,S=!1,x=typeof setTimeout=="function"?setTimeout:null,M=typeof clearTimeout=="function"?clearTimeout:null,b=typeof setImmediate<"u"?setImmediate:null;function C(V){for(var W=t(c);W!==null;){if(W.callback===null)n(c);else if(W.startTime<=V)n(c),W.sortIndex=W.expirationTime,e(f,W);else break;W=t(c)}}function N(V){if(A=!1,C(V),!E)if(t(f)!==null)E=!0,U||(U=!0,X());else{var W=t(c);W!==null&&ne(N,W.startTime-V)}}var U=!1,w=-1,O=5,L=-1;function I(){return S?!0:!(i.unstable_now()-L<O)}function F(){if(S=!1,U){var V=i.unstable_now();L=V;var W=!0;try{e:{E=!1,A&&(A=!1,M(w),w=-1),y=!0;var q=m;try{t:{for(C(V),p=t(f);p!==null&&!(p.expirationTime>V&&I());){var oe=p.callback;if(typeof oe=="function"){p.callback=null,m=p.priorityLevel;var he=oe(p.expirationTime<=V);if(V=i.unstable_now(),typeof he=="function"){p.callback=he,C(V),W=!0;break t}p===t(f)&&n(f),C(V)}else n(f);p=t(f)}if(p!==null)W=!0;else{var G=t(c);G!==null&&ne(N,G.startTime-V),W=!1}}break e}finally{p=null,m=q,y=!1}W=void 0}}finally{W?X():U=!1}}}var X;if(typeof b=="function")X=function(){b(F)};else if(typeof MessageChannel<"u"){var Y=new MessageChannel,ee=Y.port2;Y.port1.onmessage=F,X=function(){ee.postMessage(null)}}else X=function(){x(F,0)};function ne(V,W){w=x(function(){V(i.unstable_now())},W)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(V){V.callback=null},i.unstable_forceFrameRate=function(V){0>V||125<V?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):O=0<V?Math.floor(1e3/V):5},i.unstable_getCurrentPriorityLevel=function(){return m},i.unstable_next=function(V){switch(m){case 1:case 2:case 3:var W=3;break;default:W=m}var q=m;m=W;try{return V()}finally{m=q}},i.unstable_requestPaint=function(){S=!0},i.unstable_runWithPriority=function(V,W){switch(V){case 1:case 2:case 3:case 4:case 5:break;default:V=3}var q=m;m=V;try{return W()}finally{m=q}},i.unstable_scheduleCallback=function(V,W,q){var oe=i.unstable_now();switch(typeof q=="object"&&q!==null?(q=q.delay,q=typeof q=="number"&&0<q?oe+q:oe):q=oe,V){case 1:var he=-1;break;case 2:he=250;break;case 5:he=1073741823;break;case 4:he=1e4;break;default:he=5e3}return he=q+he,V={id:d++,callback:W,priorityLevel:V,startTime:q,expirationTime:he,sortIndex:-1},q>oe?(V.sortIndex=q,e(c,V),t(f)===null&&V===t(c)&&(A?(M(w),w=-1):A=!0,ne(N,q-oe))):(V.sortIndex=he,e(f,V),E||y||(E=!0,U||(U=!0,X()))),V},i.unstable_shouldYield=I,i.unstable_wrapCallback=function(V){var W=m;return function(){var q=m;m=W;try{return V.apply(this,arguments)}finally{m=q}}}})(am)),am}var rS;function vL(){return rS||(rS=1,om.exports=gL()),om.exports}var lm={exports:{}},Rt={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var oS;function yL(){if(oS)return Rt;oS=1;var i=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),r=Symbol.for("react.consumer"),a=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),c=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),p=Symbol.for("react.activity"),m=Symbol.iterator;function y(G){return G===null||typeof G!="object"?null:(G=m&&G[m]||G["@@iterator"],typeof G=="function"?G:null)}var E={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},A=Object.assign,S={};function x(G,K,fe){this.props=G,this.context=K,this.refs=S,this.updater=fe||E}x.prototype.isReactComponent={},x.prototype.setState=function(G,K){if(typeof G!="object"&&typeof G!="function"&&G!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,G,K,"setState")},x.prototype.forceUpdate=function(G){this.updater.enqueueForceUpdate(this,G,"forceUpdate")};function M(){}M.prototype=x.prototype;function b(G,K,fe){this.props=G,this.context=K,this.refs=S,this.updater=fe||E}var C=b.prototype=new M;C.constructor=b,A(C,x.prototype),C.isPureReactComponent=!0;var N=Array.isArray;function U(){}var w={H:null,A:null,T:null,S:null},O=Object.prototype.hasOwnProperty;function L(G,K,fe){var Q=fe.ref;return{$$typeof:i,type:G,key:K,ref:Q!==void 0?Q:null,props:fe}}function I(G,K){return L(G.type,K,G.props)}function F(G){return typeof G=="object"&&G!==null&&G.$$typeof===i}function X(G){var K={"=":"=0",":":"=2"};return"$"+G.replace(/[=:]/g,function(fe){return K[fe]})}var Y=/\/+/g;function ee(G,K){return typeof G=="object"&&G!==null&&G.key!=null?X(""+G.key):K.toString(36)}function ne(G){switch(G.status){case"fulfilled":return G.value;case"rejected":throw G.reason;default:switch(typeof G.status=="string"?G.then(U,U):(G.status="pending",G.then(function(K){G.status==="pending"&&(G.status="fulfilled",G.value=K)},function(K){G.status==="pending"&&(G.status="rejected",G.reason=K)})),G.status){case"fulfilled":return G.value;case"rejected":throw G.reason}}throw G}function V(G,K,fe,Q,ue){var ae=typeof G;(ae==="undefined"||ae==="boolean")&&(G=null);var Ee=!1;if(G===null)Ee=!0;else switch(ae){case"bigint":case"string":case"number":Ee=!0;break;case"object":switch(G.$$typeof){case i:case e:Ee=!0;break;case d:return Ee=G._init,V(Ee(G._payload),K,fe,Q,ue)}}if(Ee)return ue=ue(G),Ee=Q===""?"."+ee(G,0):Q,N(ue)?(fe="",Ee!=null&&(fe=Ee.replace(Y,"$&/")+"/"),V(ue,K,fe,"",function(Ne){return Ne})):ue!=null&&(F(ue)&&(ue=I(ue,fe+(ue.key==null||G&&G.key===ue.key?"":(""+ue.key).replace(Y,"$&/")+"/")+Ee)),K.push(ue)),1;Ee=0;var pe=Q===""?".":Q+":";if(N(G))for(var Ae=0;Ae<G.length;Ae++)Q=G[Ae],ae=pe+ee(Q,Ae),Ee+=V(Q,K,fe,ae,ue);else if(Ae=y(G),typeof Ae=="function")for(G=Ae.call(G),Ae=0;!(Q=G.next()).done;)Q=Q.value,ae=pe+ee(Q,Ae++),Ee+=V(Q,K,fe,ae,ue);else if(ae==="object"){if(typeof G.then=="function")return V(ne(G),K,fe,Q,ue);throw K=String(G),Error("Objects are not valid as a React child (found: "+(K==="[object Object]"?"object with keys {"+Object.keys(G).join(", ")+"}":K)+"). If you meant to render a collection of children, use an array instead.")}return Ee}function W(G,K,fe){if(G==null)return G;var Q=[],ue=0;return V(G,Q,"","",function(ae){return K.call(fe,ae,ue++)}),Q}function q(G){if(G._status===-1){var K=G._result;K=K(),K.then(function(fe){(G._status===0||G._status===-1)&&(G._status=1,G._result=fe)},function(fe){(G._status===0||G._status===-1)&&(G._status=2,G._result=fe)}),G._status===-1&&(G._status=0,G._result=K)}if(G._status===1)return G._result.default;throw G._result}var oe=typeof reportError=="function"?reportError:function(G){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var K=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof G=="object"&&G!==null&&typeof G.message=="string"?String(G.message):String(G),error:G});if(!window.dispatchEvent(K))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",G);return}console.error(G)},he={map:W,forEach:function(G,K,fe){W(G,function(){K.apply(this,arguments)},fe)},count:function(G){var K=0;return W(G,function(){K++}),K},toArray:function(G){return W(G,function(K){return K})||[]},only:function(G){if(!F(G))throw Error("React.Children.only expected to receive a single React element child.");return G}};return Rt.Activity=p,Rt.Children=he,Rt.Component=x,Rt.Fragment=t,Rt.Profiler=s,Rt.PureComponent=b,Rt.StrictMode=n,Rt.Suspense=f,Rt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=w,Rt.__COMPILER_RUNTIME={__proto__:null,c:function(G){return w.H.useMemoCache(G)}},Rt.cache=function(G){return function(){return G.apply(null,arguments)}},Rt.cacheSignal=function(){return null},Rt.cloneElement=function(G,K,fe){if(G==null)throw Error("The argument must be a React element, but you passed "+G+".");var Q=A({},G.props),ue=G.key;if(K!=null)for(ae in K.key!==void 0&&(ue=""+K.key),K)!O.call(K,ae)||ae==="key"||ae==="__self"||ae==="__source"||ae==="ref"&&K.ref===void 0||(Q[ae]=K[ae]);var ae=arguments.length-2;if(ae===1)Q.children=fe;else if(1<ae){for(var Ee=Array(ae),pe=0;pe<ae;pe++)Ee[pe]=arguments[pe+2];Q.children=Ee}return L(G.type,ue,Q)},Rt.createContext=function(G){return G={$$typeof:a,_currentValue:G,_currentValue2:G,_threadCount:0,Provider:null,Consumer:null},G.Provider=G,G.Consumer={$$typeof:r,_context:G},G},Rt.createElement=function(G,K,fe){var Q,ue={},ae=null;if(K!=null)for(Q in K.key!==void 0&&(ae=""+K.key),K)O.call(K,Q)&&Q!=="key"&&Q!=="__self"&&Q!=="__source"&&(ue[Q]=K[Q]);var Ee=arguments.length-2;if(Ee===1)ue.children=fe;else if(1<Ee){for(var pe=Array(Ee),Ae=0;Ae<Ee;Ae++)pe[Ae]=arguments[Ae+2];ue.children=pe}if(G&&G.defaultProps)for(Q in Ee=G.defaultProps,Ee)ue[Q]===void 0&&(ue[Q]=Ee[Q]);return L(G,ae,ue)},Rt.createRef=function(){return{current:null}},Rt.forwardRef=function(G){return{$$typeof:u,render:G}},Rt.isValidElement=F,Rt.lazy=function(G){return{$$typeof:d,_payload:{_status:-1,_result:G},_init:q}},Rt.memo=function(G,K){return{$$typeof:c,type:G,compare:K===void 0?null:K}},Rt.startTransition=function(G){var K=w.T,fe={};w.T=fe;try{var Q=G(),ue=w.S;ue!==null&&ue(fe,Q),typeof Q=="object"&&Q!==null&&typeof Q.then=="function"&&Q.then(U,oe)}catch(ae){oe(ae)}finally{K!==null&&fe.types!==null&&(K.types=fe.types),w.T=K}},Rt.unstable_useCacheRefresh=function(){return w.H.useCacheRefresh()},Rt.use=function(G){return w.H.use(G)},Rt.useActionState=function(G,K,fe){return w.H.useActionState(G,K,fe)},Rt.useCallback=function(G,K){return w.H.useCallback(G,K)},Rt.useContext=function(G){return w.H.useContext(G)},Rt.useDebugValue=function(){},Rt.useDeferredValue=function(G,K){return w.H.useDeferredValue(G,K)},Rt.useEffect=function(G,K){return w.H.useEffect(G,K)},Rt.useEffectEvent=function(G){return w.H.useEffectEvent(G)},Rt.useId=function(){return w.H.useId()},Rt.useImperativeHandle=function(G,K,fe){return w.H.useImperativeHandle(G,K,fe)},Rt.useInsertionEffect=function(G,K){return w.H.useInsertionEffect(G,K)},Rt.useLayoutEffect=function(G,K){return w.H.useLayoutEffect(G,K)},Rt.useMemo=function(G,K){return w.H.useMemo(G,K)},Rt.useOptimistic=function(G,K){return w.H.useOptimistic(G,K)},Rt.useReducer=function(G,K,fe){return w.H.useReducer(G,K,fe)},Rt.useRef=function(G){return w.H.useRef(G)},Rt.useState=function(G){return w.H.useState(G)},Rt.useSyncExternalStore=function(G,K,fe){return w.H.useSyncExternalStore(G,K,fe)},Rt.useTransition=function(){return w.H.useTransition()},Rt.version="19.2.3",Rt}var aS;function L0(){return aS||(aS=1,lm.exports=yL()),lm.exports}var um={exports:{}},di={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lS;function _L(){if(lS)return di;lS=1;var i=L0();function e(f){var c="https://react.dev/errors/"+f;if(1<arguments.length){c+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)c+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+f+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var n={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},s=Symbol.for("react.portal");function r(f,c,d){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:s,key:p==null?null:""+p,children:f,containerInfo:c,implementation:d}}var a=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(f,c){if(f==="font")return"";if(typeof c=="string")return c==="use-credentials"?c:""}return di.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,di.createPortal=function(f,c){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!c||c.nodeType!==1&&c.nodeType!==9&&c.nodeType!==11)throw Error(e(299));return r(f,c,null,d)},di.flushSync=function(f){var c=a.T,d=n.p;try{if(a.T=null,n.p=2,f)return f()}finally{a.T=c,n.p=d,n.d.f()}},di.preconnect=function(f,c){typeof f=="string"&&(c?(c=c.crossOrigin,c=typeof c=="string"?c==="use-credentials"?c:"":void 0):c=null,n.d.C(f,c))},di.prefetchDNS=function(f){typeof f=="string"&&n.d.D(f)},di.preinit=function(f,c){if(typeof f=="string"&&c&&typeof c.as=="string"){var d=c.as,p=u(d,c.crossOrigin),m=typeof c.integrity=="string"?c.integrity:void 0,y=typeof c.fetchPriority=="string"?c.fetchPriority:void 0;d==="style"?n.d.S(f,typeof c.precedence=="string"?c.precedence:void 0,{crossOrigin:p,integrity:m,fetchPriority:y}):d==="script"&&n.d.X(f,{crossOrigin:p,integrity:m,fetchPriority:y,nonce:typeof c.nonce=="string"?c.nonce:void 0})}},di.preinitModule=function(f,c){if(typeof f=="string")if(typeof c=="object"&&c!==null){if(c.as==null||c.as==="script"){var d=u(c.as,c.crossOrigin);n.d.M(f,{crossOrigin:d,integrity:typeof c.integrity=="string"?c.integrity:void 0,nonce:typeof c.nonce=="string"?c.nonce:void 0})}}else c==null&&n.d.M(f)},di.preload=function(f,c){if(typeof f=="string"&&typeof c=="object"&&c!==null&&typeof c.as=="string"){var d=c.as,p=u(d,c.crossOrigin);n.d.L(f,d,{crossOrigin:p,integrity:typeof c.integrity=="string"?c.integrity:void 0,nonce:typeof c.nonce=="string"?c.nonce:void 0,type:typeof c.type=="string"?c.type:void 0,fetchPriority:typeof c.fetchPriority=="string"?c.fetchPriority:void 0,referrerPolicy:typeof c.referrerPolicy=="string"?c.referrerPolicy:void 0,imageSrcSet:typeof c.imageSrcSet=="string"?c.imageSrcSet:void 0,imageSizes:typeof c.imageSizes=="string"?c.imageSizes:void 0,media:typeof c.media=="string"?c.media:void 0})}},di.preloadModule=function(f,c){if(typeof f=="string")if(c){var d=u(c.as,c.crossOrigin);n.d.m(f,{as:typeof c.as=="string"&&c.as!=="script"?c.as:void 0,crossOrigin:d,integrity:typeof c.integrity=="string"?c.integrity:void 0})}else n.d.m(f)},di.requestFormReset=function(f){n.d.r(f)},di.unstable_batchedUpdates=function(f,c){return f(c)},di.useFormState=function(f,c,d){return a.H.useFormState(f,c,d)},di.useFormStatus=function(){return a.H.useHostTransitionStatus()},di.version="19.2.3",di}var uS;function EL(){if(uS)return um.exports;uS=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),um.exports=_L(),um.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cS;function SL(){if(cS)return bu;cS=1;var i=vL(),e=L0(),t=EL();function n(o){var l="https://react.dev/errors/"+o;if(1<arguments.length){l+="?args[]="+encodeURIComponent(arguments[1]);for(var h=2;h<arguments.length;h++)l+="&args[]="+encodeURIComponent(arguments[h])}return"Minified React error #"+o+"; visit "+l+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11)}function r(o){var l=o,h=o;if(o.alternate)for(;l.return;)l=l.return;else{o=l;do l=o,(l.flags&4098)!==0&&(h=l.return),o=l.return;while(o)}return l.tag===3?h:null}function a(o){if(o.tag===13){var l=o.memoizedState;if(l===null&&(o=o.alternate,o!==null&&(l=o.memoizedState)),l!==null)return l.dehydrated}return null}function u(o){if(o.tag===31){var l=o.memoizedState;if(l===null&&(o=o.alternate,o!==null&&(l=o.memoizedState)),l!==null)return l.dehydrated}return null}function f(o){if(r(o)!==o)throw Error(n(188))}function c(o){var l=o.alternate;if(!l){if(l=r(o),l===null)throw Error(n(188));return l!==o?null:o}for(var h=o,g=l;;){var T=h.return;if(T===null)break;var R=T.alternate;if(R===null){if(g=T.return,g!==null){h=g;continue}break}if(T.child===R.child){for(R=T.child;R;){if(R===h)return f(T),o;if(R===g)return f(T),l;R=R.sibling}throw Error(n(188))}if(h.return!==g.return)h=T,g=R;else{for(var D=!1,B=T.child;B;){if(B===h){D=!0,h=T,g=R;break}if(B===g){D=!0,g=T,h=R;break}B=B.sibling}if(!D){for(B=R.child;B;){if(B===h){D=!0,h=R,g=T;break}if(B===g){D=!0,g=R,h=T;break}B=B.sibling}if(!D)throw Error(n(189))}}if(h.alternate!==g)throw Error(n(190))}if(h.tag!==3)throw Error(n(188));return h.stateNode.current===h?o:l}function d(o){var l=o.tag;if(l===5||l===26||l===27||l===6)return o;for(o=o.child;o!==null;){if(l=d(o),l!==null)return l;o=o.sibling}return null}var p=Object.assign,m=Symbol.for("react.element"),y=Symbol.for("react.transitional.element"),E=Symbol.for("react.portal"),A=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),x=Symbol.for("react.profiler"),M=Symbol.for("react.consumer"),b=Symbol.for("react.context"),C=Symbol.for("react.forward_ref"),N=Symbol.for("react.suspense"),U=Symbol.for("react.suspense_list"),w=Symbol.for("react.memo"),O=Symbol.for("react.lazy"),L=Symbol.for("react.activity"),I=Symbol.for("react.memo_cache_sentinel"),F=Symbol.iterator;function X(o){return o===null||typeof o!="object"?null:(o=F&&o[F]||o["@@iterator"],typeof o=="function"?o:null)}var Y=Symbol.for("react.client.reference");function ee(o){if(o==null)return null;if(typeof o=="function")return o.$$typeof===Y?null:o.displayName||o.name||null;if(typeof o=="string")return o;switch(o){case A:return"Fragment";case x:return"Profiler";case S:return"StrictMode";case N:return"Suspense";case U:return"SuspenseList";case L:return"Activity"}if(typeof o=="object")switch(o.$$typeof){case E:return"Portal";case b:return o.displayName||"Context";case M:return(o._context.displayName||"Context")+".Consumer";case C:var l=o.render;return o=o.displayName,o||(o=l.displayName||l.name||"",o=o!==""?"ForwardRef("+o+")":"ForwardRef"),o;case w:return l=o.displayName||null,l!==null?l:ee(o.type)||"Memo";case O:l=o._payload,o=o._init;try{return ee(o(l))}catch{}}return null}var ne=Array.isArray,V=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,W=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,q={pending:!1,data:null,method:null,action:null},oe=[],he=-1;function G(o){return{current:o}}function K(o){0>he||(o.current=oe[he],oe[he]=null,he--)}function fe(o,l){he++,oe[he]=o.current,o.current=l}var Q=G(null),ue=G(null),ae=G(null),Ee=G(null);function pe(o,l){switch(fe(ae,l),fe(ue,o),fe(Q,null),l.nodeType){case 9:case 11:o=(o=l.documentElement)&&(o=o.namespaceURI)?RE(o):0;break;default:if(o=l.tagName,l=l.namespaceURI)l=RE(l),o=bE(l,o);else switch(o){case"svg":o=1;break;case"math":o=2;break;default:o=0}}K(Q),fe(Q,o)}function Ae(){K(Q),K(ue),K(ae)}function Ne(o){o.memoizedState!==null&&fe(Ee,o);var l=Q.current,h=bE(l,o.type);l!==h&&(fe(ue,o),fe(Q,h))}function je(o){ue.current===o&&(K(Q),K(ue)),Ee.current===o&&(K(Ee),Su._currentValue=q)}var Mt,rt;function J(o){if(Mt===void 0)try{throw Error()}catch(h){var l=h.stack.trim().match(/\n( *(at )?)/);Mt=l&&l[1]||"",rt=-1<h.stack.indexOf(`
    at`)?" (<anonymous>)":-1<h.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Mt+o+rt}var On=!1;function He(o,l){if(!o||On)return"";On=!0;var h=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var g={DetermineComponentFrameRoot:function(){try{if(l){var De=function(){throw Error()};if(Object.defineProperty(De.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(De,[])}catch(Se){var ve=Se}Reflect.construct(o,[],De)}else{try{De.call()}catch(Se){ve=Se}o.call(De.prototype)}}else{try{throw Error()}catch(Se){ve=Se}(De=o())&&typeof De.catch=="function"&&De.catch(function(){})}}catch(Se){if(Se&&ve&&typeof Se.stack=="string")return[Se.stack,ve.stack]}return[null,null]}};g.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var T=Object.getOwnPropertyDescriptor(g.DetermineComponentFrameRoot,"name");T&&T.configurable&&Object.defineProperty(g.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var R=g.DetermineComponentFrameRoot(),D=R[0],B=R[1];if(D&&B){var Z=D.split(`
`),ge=B.split(`
`);for(T=g=0;g<Z.length&&!Z[g].includes("DetermineComponentFrameRoot");)g++;for(;T<ge.length&&!ge[T].includes("DetermineComponentFrameRoot");)T++;if(g===Z.length||T===ge.length)for(g=Z.length-1,T=ge.length-1;1<=g&&0<=T&&Z[g]!==ge[T];)T--;for(;1<=g&&0<=T;g--,T--)if(Z[g]!==ge[T]){if(g!==1||T!==1)do if(g--,T--,0>T||Z[g]!==ge[T]){var Me=`
`+Z[g].replace(" at new "," at ");return o.displayName&&Me.includes("<anonymous>")&&(Me=Me.replace("<anonymous>",o.displayName)),Me}while(1<=g&&0<=T);break}}}finally{On=!1,Error.prepareStackTrace=h}return(h=o?o.displayName||o.name:"")?J(h):""}function ut(o,l){switch(o.tag){case 26:case 27:case 5:return J(o.type);case 16:return J("Lazy");case 13:return o.child!==l&&l!==null?J("Suspense Fallback"):J("Suspense");case 19:return J("SuspenseList");case 0:case 15:return He(o.type,!1);case 11:return He(o.type.render,!1);case 1:return He(o.type,!0);case 31:return J("Activity");default:return""}}function Qe(o){try{var l="",h=null;do l+=ut(o,h),h=o,o=o.return;while(o);return l}catch(g){return`
Error generating stack: `+g.message+`
`+g.stack}}var Dt=Object.prototype.hasOwnProperty,$e=i.unstable_scheduleCallback,$=i.unstable_cancelCallback,k=i.unstable_shouldYield,me=i.unstable_requestPaint,Re=i.unstable_now,Pe=i.unstable_getCurrentPriorityLevel,be=i.unstable_ImmediatePriority,nt=i.unstable_UserBlockingPriority,Be=i.unstable_NormalPriority,Fe=i.unstable_LowPriority,Ct=i.unstable_IdlePriority,Ue=i.log,tt=i.unstable_setDisableYieldValue,st=null,ot=null;function Ke(o){if(typeof Ue=="function"&&tt(o),ot&&typeof ot.setStrictMode=="function")try{ot.setStrictMode(st,o)}catch{}}var ht=Math.clz32?Math.clz32:ie,At=Math.log,jt=Math.LN2;function ie(o){return o>>>=0,o===0?32:31-(At(o)/jt|0)|0}var Ge=256,Te=262144,Le=4194304;function ze(o){var l=o&42;if(l!==0)return l;switch(o&-o){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return o&261888;case 262144:case 524288:case 1048576:case 2097152:return o&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return o&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return o}}function Ve(o,l,h){var g=o.pendingLanes;if(g===0)return 0;var T=0,R=o.suspendedLanes,D=o.pingedLanes;o=o.warmLanes;var B=g&134217727;return B!==0?(g=B&~R,g!==0?T=ze(g):(D&=B,D!==0?T=ze(D):h||(h=B&~o,h!==0&&(T=ze(h))))):(B=g&~R,B!==0?T=ze(B):D!==0?T=ze(D):h||(h=g&~o,h!==0&&(T=ze(h)))),T===0?0:l!==0&&l!==T&&(l&R)===0&&(R=T&-T,h=l&-l,R>=h||R===32&&(h&4194048)!==0)?l:T}function pt(o,l){return(o.pendingLanes&~(o.suspendedLanes&~o.pingedLanes)&l)===0}function En(o,l){switch(o){case 1:case 2:case 4:case 8:case 64:return l+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Dn(){var o=Le;return Le<<=1,(Le&62914560)===0&&(Le=4194304),o}function Ht(o){for(var l=[],h=0;31>h;h++)l.push(o);return l}function zn(o,l){o.pendingLanes|=l,l!==268435456&&(o.suspendedLanes=0,o.pingedLanes=0,o.warmLanes=0)}function ki(o,l,h,g,T,R){var D=o.pendingLanes;o.pendingLanes=h,o.suspendedLanes=0,o.pingedLanes=0,o.warmLanes=0,o.expiredLanes&=h,o.entangledLanes&=h,o.errorRecoveryDisabledLanes&=h,o.shellSuspendCounter=0;var B=o.entanglements,Z=o.expirationTimes,ge=o.hiddenUpdates;for(h=D&~h;0<h;){var Me=31-ht(h),De=1<<Me;B[Me]=0,Z[Me]=-1;var ve=ge[Me];if(ve!==null)for(ge[Me]=null,Me=0;Me<ve.length;Me++){var Se=ve[Me];Se!==null&&(Se.lane&=-536870913)}h&=~De}g!==0&&Dr(o,g,0),R!==0&&T===0&&o.tag!==0&&(o.suspendedLanes|=R&~(D&~l))}function Dr(o,l,h){o.pendingLanes|=l,o.suspendedLanes&=~l;var g=31-ht(l);o.entangledLanes|=l,o.entanglements[g]=o.entanglements[g]|1073741824|h&261930}function To(o,l){var h=o.entangledLanes|=l;for(o=o.entanglements;h;){var g=31-ht(h),T=1<<g;T&l|o[g]&l&&(o[g]|=l),h&=~T}}function Ri(o,l){var h=l&-l;return h=(h&42)!==0?1:Ks(h),(h&(o.suspendedLanes|l))!==0?0:h}function Ks(o){switch(o){case 2:o=1;break;case 8:o=4;break;case 32:o=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:o=128;break;case 268435456:o=134217728;break;default:o=0}return o}function we(o){return o&=-o,2<o?8<o?(o&134217727)!==0?32:268435456:8:2}function vt(){var o=W.p;return o!==0?o:(o=window.event,o===void 0?32:XE(o.type))}function gt(o,l){var h=W.p;try{return W.p=o,l()}finally{W.p=h}}var Ut=Math.random().toString(36).slice(2),kt="__reactFiber$"+Ut,nn="__reactProps$"+Ut,Kt="__reactContainer$"+Ut,mn="__reactEvents$"+Ut,$n="__reactListeners$"+Ut,aa="__reactHandles$"+Ut,ic="__reactResources$"+Ut,xo="__reactMarker$"+Ut;function Fl(o){delete o[kt],delete o[nn],delete o[mn],delete o[$n],delete o[aa]}function H(o){var l=o[kt];if(l)return l;for(var h=o.parentNode;h;){if(l=h[Kt]||h[kt]){if(h=l.alternate,l.child!==null||h!==null&&h.child!==null)for(o=PE(o);o!==null;){if(h=o[kt])return h;o=PE(o)}return l}o=h,h=o.parentNode}return null}function se(o){if(o=o[kt]||o[Kt]){var l=o.tag;if(l===5||l===6||l===13||l===31||l===26||l===27||l===3)return o}return null}function ye(o){var l=o.tag;if(l===5||l===26||l===27||l===6)return o.stateNode;throw Error(n(33))}function _e(o){var l=o[ic];return l||(l=o[ic]={hoistableStyles:new Map,hoistableScripts:new Map}),l}function te(o){o[xo]=!0}var Oe=new Set,qe={};function Xe(o,l){Ze(o,l),Ze(o+"Capture",l)}function Ze(o,l){for(qe[o]=l,o=0;o<l.length;o++)Oe.add(l[o])}var yt=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),_t={},ct={};function zt(o){return Dt.call(ct,o)?!0:Dt.call(_t,o)?!1:yt.test(o)?ct[o]=!0:(_t[o]=!0,!1)}function $t(o,l,h){if(zt(l))if(h===null)o.removeAttribute(l);else{switch(typeof h){case"undefined":case"function":case"symbol":o.removeAttribute(l);return;case"boolean":var g=l.toLowerCase().slice(0,5);if(g!=="data-"&&g!=="aria-"){o.removeAttribute(l);return}}o.setAttribute(l,""+h)}}function Sn(o,l,h){if(h===null)o.removeAttribute(l);else{switch(typeof h){case"undefined":case"function":case"symbol":case"boolean":o.removeAttribute(l);return}o.setAttribute(l,""+h)}}function Yt(o,l,h,g){if(g===null)o.removeAttribute(h);else{switch(typeof g){case"undefined":case"function":case"symbol":case"boolean":o.removeAttribute(h);return}o.setAttributeNS(l,h,""+g)}}function St(o){switch(typeof o){case"bigint":case"boolean":case"number":case"string":case"undefined":return o;case"object":return o;default:return""}}function dt(o){var l=o.type;return(o=o.nodeName)&&o.toLowerCase()==="input"&&(l==="checkbox"||l==="radio")}function qn(o,l,h){var g=Object.getOwnPropertyDescriptor(o.constructor.prototype,l);if(!o.hasOwnProperty(l)&&typeof g<"u"&&typeof g.get=="function"&&typeof g.set=="function"){var T=g.get,R=g.set;return Object.defineProperty(o,l,{configurable:!0,get:function(){return T.call(this)},set:function(D){h=""+D,R.call(this,D)}}),Object.defineProperty(o,l,{enumerable:g.enumerable}),{getValue:function(){return h},setValue:function(D){h=""+D},stopTracking:function(){o._valueTracker=null,delete o[l]}}}}function Wt(o){if(!o._valueTracker){var l=dt(o)?"checked":"value";o._valueTracker=qn(o,l,""+o[l])}}function bi(o){if(!o)return!1;var l=o._valueTracker;if(!l)return!0;var h=l.getValue(),g="";return o&&(g=dt(o)?o.checked?"true":"false":o.value),o=g,o!==h?(l.setValue(o),!0):!1}function gs(o){if(o=o||(typeof document<"u"?document:void 0),typeof o>"u")return null;try{return o.activeElement||o.body}catch{return o.body}}var gi=/[\n"\\]/g;function Zn(o){return o.replace(gi,function(l){return"\\"+l.charCodeAt(0).toString(16)+" "})}function ln(o,l,h,g,T,R,D,B){o.name="",D!=null&&typeof D!="function"&&typeof D!="symbol"&&typeof D!="boolean"?o.type=D:o.removeAttribute("type"),l!=null?D==="number"?(l===0&&o.value===""||o.value!=l)&&(o.value=""+St(l)):o.value!==""+St(l)&&(o.value=""+St(l)):D!=="submit"&&D!=="reset"||o.removeAttribute("value"),l!=null?fi(o,D,St(l)):h!=null?fi(o,D,St(h)):g!=null&&o.removeAttribute("value"),T==null&&R!=null&&(o.defaultChecked=!!R),T!=null&&(o.checked=T&&typeof T!="function"&&typeof T!="symbol"),B!=null&&typeof B!="function"&&typeof B!="symbol"&&typeof B!="boolean"?o.name=""+St(B):o.removeAttribute("name")}function vi(o,l,h,g,T,R,D,B){if(R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"&&(o.type=R),l!=null||h!=null){if(!(R!=="submit"&&R!=="reset"||l!=null)){Wt(o);return}h=h!=null?""+St(h):"",l=l!=null?""+St(l):h,B||l===o.value||(o.value=l),o.defaultValue=l}g=g??T,g=typeof g!="function"&&typeof g!="symbol"&&!!g,o.checked=B?o.checked:!!g,o.defaultChecked=!!g,D!=null&&typeof D!="function"&&typeof D!="symbol"&&typeof D!="boolean"&&(o.name=D),Wt(o)}function fi(o,l,h){l==="number"&&gs(o.ownerDocument)===o||o.defaultValue===""+h||(o.defaultValue=""+h)}function Mn(o,l,h,g){if(o=o.options,l){l={};for(var T=0;T<h.length;T++)l["$"+h[T]]=!0;for(h=0;h<o.length;h++)T=l.hasOwnProperty("$"+o[h].value),o[h].selected!==T&&(o[h].selected=T),T&&g&&(o[h].defaultSelected=!0)}else{for(h=""+St(h),l=null,T=0;T<o.length;T++){if(o[T].value===h){o[T].selected=!0,g&&(o[T].defaultSelected=!0);return}l!==null||o[T].disabled||(l=o[T])}l!==null&&(l.selected=!0)}}function ii(o,l,h){if(l!=null&&(l=""+St(l),l!==o.value&&(o.value=l),h==null)){o.defaultValue!==l&&(o.defaultValue=l);return}o.defaultValue=h!=null?""+St(h):""}function la(o,l,h,g){if(l==null){if(g!=null){if(h!=null)throw Error(n(92));if(ne(g)){if(1<g.length)throw Error(n(93));g=g[0]}h=g}h==null&&(h=""),l=h}h=St(l),o.defaultValue=h,g=o.textContent,g===h&&g!==""&&g!==null&&(o.value=g),Wt(o)}function Mi(o,l){if(l){var h=o.firstChild;if(h&&h===o.lastChild&&h.nodeType===3){h.nodeValue=l;return}}o.textContent=l}var uC=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Tv(o,l,h){var g=l.indexOf("--")===0;h==null||typeof h=="boolean"||h===""?g?o.setProperty(l,""):l==="float"?o.cssFloat="":o[l]="":g?o.setProperty(l,h):typeof h!="number"||h===0||uC.has(l)?l==="float"?o.cssFloat=h:o[l]=(""+h).trim():o[l]=h+"px"}function xv(o,l,h){if(l!=null&&typeof l!="object")throw Error(n(62));if(o=o.style,h!=null){for(var g in h)!h.hasOwnProperty(g)||l!=null&&l.hasOwnProperty(g)||(g.indexOf("--")===0?o.setProperty(g,""):g==="float"?o.cssFloat="":o[g]="");for(var T in l)g=l[T],l.hasOwnProperty(T)&&h[T]!==g&&Tv(o,T,g)}else for(var R in l)l.hasOwnProperty(R)&&Tv(o,R,l[R])}function eh(o){if(o.indexOf("-")===-1)return!1;switch(o){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var cC=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),fC=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function sc(o){return fC.test(""+o)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":o}function Ys(){}var th=null;function nh(o){return o=o.target||o.srcElement||window,o.correspondingUseElement&&(o=o.correspondingUseElement),o.nodeType===3?o.parentNode:o}var ua=null,ca=null;function Av(o){var l=se(o);if(l&&(o=l.stateNode)){var h=o[nn]||null;e:switch(o=l.stateNode,l.type){case"input":if(ln(o,h.value,h.defaultValue,h.defaultValue,h.checked,h.defaultChecked,h.type,h.name),l=h.name,h.type==="radio"&&l!=null){for(h=o;h.parentNode;)h=h.parentNode;for(h=h.querySelectorAll('input[name="'+Zn(""+l)+'"][type="radio"]'),l=0;l<h.length;l++){var g=h[l];if(g!==o&&g.form===o.form){var T=g[nn]||null;if(!T)throw Error(n(90));ln(g,T.value,T.defaultValue,T.defaultValue,T.checked,T.defaultChecked,T.type,T.name)}}for(l=0;l<h.length;l++)g=h[l],g.form===o.form&&bi(g)}break e;case"textarea":ii(o,h.value,h.defaultValue);break e;case"select":l=h.value,l!=null&&Mn(o,!!h.multiple,l,!1)}}}var ih=!1;function Rv(o,l,h){if(ih)return o(l,h);ih=!0;try{var g=o(l);return g}finally{if(ih=!1,(ua!==null||ca!==null)&&(qc(),ua&&(l=ua,o=ca,ca=ua=null,Av(l),o)))for(l=0;l<o.length;l++)Av(o[l])}}function kl(o,l){var h=o.stateNode;if(h===null)return null;var g=h[nn]||null;if(g===null)return null;h=g[l];e:switch(l){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(g=!g.disabled)||(o=o.type,g=!(o==="button"||o==="input"||o==="select"||o==="textarea")),o=!g;break e;default:o=!1}if(o)return null;if(h&&typeof h!="function")throw Error(n(231,l,typeof h));return h}var Xs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),sh=!1;if(Xs)try{var Bl={};Object.defineProperty(Bl,"passive",{get:function(){sh=!0}}),window.addEventListener("test",Bl,Bl),window.removeEventListener("test",Bl,Bl)}catch{sh=!1}var wr=null,rh=null,rc=null;function bv(){if(rc)return rc;var o,l=rh,h=l.length,g,T="value"in wr?wr.value:wr.textContent,R=T.length;for(o=0;o<h&&l[o]===T[o];o++);var D=h-o;for(g=1;g<=D&&l[h-g]===T[R-g];g++);return rc=T.slice(o,1<g?1-g:void 0)}function oc(o){var l=o.keyCode;return"charCode"in o?(o=o.charCode,o===0&&l===13&&(o=13)):o=l,o===10&&(o=13),32<=o||o===13?o:0}function ac(){return!0}function Mv(){return!1}function Ci(o){function l(h,g,T,R,D){this._reactName=h,this._targetInst=T,this.type=g,this.nativeEvent=R,this.target=D,this.currentTarget=null;for(var B in o)o.hasOwnProperty(B)&&(h=o[B],this[B]=h?h(R):R[B]);return this.isDefaultPrevented=(R.defaultPrevented!=null?R.defaultPrevented:R.returnValue===!1)?ac:Mv,this.isPropagationStopped=Mv,this}return p(l.prototype,{preventDefault:function(){this.defaultPrevented=!0;var h=this.nativeEvent;h&&(h.preventDefault?h.preventDefault():typeof h.returnValue!="unknown"&&(h.returnValue=!1),this.isDefaultPrevented=ac)},stopPropagation:function(){var h=this.nativeEvent;h&&(h.stopPropagation?h.stopPropagation():typeof h.cancelBubble!="unknown"&&(h.cancelBubble=!0),this.isPropagationStopped=ac)},persist:function(){},isPersistent:ac}),l}var Ao={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(o){return o.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},lc=Ci(Ao),Gl=p({},Ao,{view:0,detail:0}),dC=Ci(Gl),oh,ah,Vl,uc=p({},Gl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:uh,button:0,buttons:0,relatedTarget:function(o){return o.relatedTarget===void 0?o.fromElement===o.srcElement?o.toElement:o.fromElement:o.relatedTarget},movementX:function(o){return"movementX"in o?o.movementX:(o!==Vl&&(Vl&&o.type==="mousemove"?(oh=o.screenX-Vl.screenX,ah=o.screenY-Vl.screenY):ah=oh=0,Vl=o),oh)},movementY:function(o){return"movementY"in o?o.movementY:ah}}),Cv=Ci(uc),hC=p({},uc,{dataTransfer:0}),pC=Ci(hC),mC=p({},Gl,{relatedTarget:0}),lh=Ci(mC),gC=p({},Ao,{animationName:0,elapsedTime:0,pseudoElement:0}),vC=Ci(gC),yC=p({},Ao,{clipboardData:function(o){return"clipboardData"in o?o.clipboardData:window.clipboardData}}),_C=Ci(yC),EC=p({},Ao,{data:0}),Iv=Ci(EC),SC={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},TC={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},xC={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function AC(o){var l=this.nativeEvent;return l.getModifierState?l.getModifierState(o):(o=xC[o])?!!l[o]:!1}function uh(){return AC}var RC=p({},Gl,{key:function(o){if(o.key){var l=SC[o.key]||o.key;if(l!=="Unidentified")return l}return o.type==="keypress"?(o=oc(o),o===13?"Enter":String.fromCharCode(o)):o.type==="keydown"||o.type==="keyup"?TC[o.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:uh,charCode:function(o){return o.type==="keypress"?oc(o):0},keyCode:function(o){return o.type==="keydown"||o.type==="keyup"?o.keyCode:0},which:function(o){return o.type==="keypress"?oc(o):o.type==="keydown"||o.type==="keyup"?o.keyCode:0}}),bC=Ci(RC),MC=p({},uc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Lv=Ci(MC),CC=p({},Gl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:uh}),IC=Ci(CC),LC=p({},Ao,{propertyName:0,elapsedTime:0,pseudoElement:0}),DC=Ci(LC),wC=p({},uc,{deltaX:function(o){return"deltaX"in o?o.deltaX:"wheelDeltaX"in o?-o.wheelDeltaX:0},deltaY:function(o){return"deltaY"in o?o.deltaY:"wheelDeltaY"in o?-o.wheelDeltaY:"wheelDelta"in o?-o.wheelDelta:0},deltaZ:0,deltaMode:0}),PC=Ci(wC),NC=p({},Ao,{newState:0,oldState:0}),UC=Ci(NC),OC=[9,13,27,32],ch=Xs&&"CompositionEvent"in window,Hl=null;Xs&&"documentMode"in document&&(Hl=document.documentMode);var FC=Xs&&"TextEvent"in window&&!Hl,Dv=Xs&&(!ch||Hl&&8<Hl&&11>=Hl),wv=" ",Pv=!1;function Nv(o,l){switch(o){case"keyup":return OC.indexOf(l.keyCode)!==-1;case"keydown":return l.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Uv(o){return o=o.detail,typeof o=="object"&&"data"in o?o.data:null}var fa=!1;function kC(o,l){switch(o){case"compositionend":return Uv(l);case"keypress":return l.which!==32?null:(Pv=!0,wv);case"textInput":return o=l.data,o===wv&&Pv?null:o;default:return null}}function BC(o,l){if(fa)return o==="compositionend"||!ch&&Nv(o,l)?(o=bv(),rc=rh=wr=null,fa=!1,o):null;switch(o){case"paste":return null;case"keypress":if(!(l.ctrlKey||l.altKey||l.metaKey)||l.ctrlKey&&l.altKey){if(l.char&&1<l.char.length)return l.char;if(l.which)return String.fromCharCode(l.which)}return null;case"compositionend":return Dv&&l.locale!=="ko"?null:l.data;default:return null}}var GC={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ov(o){var l=o&&o.nodeName&&o.nodeName.toLowerCase();return l==="input"?!!GC[o.type]:l==="textarea"}function Fv(o,l,h,g){ua?ca?ca.push(g):ca=[g]:ua=g,l=Zc(l,"onChange"),0<l.length&&(h=new lc("onChange","change",null,h,g),o.push({event:h,listeners:l}))}var zl=null,$l=null;function VC(o){_E(o,0)}function cc(o){var l=ye(o);if(bi(l))return o}function kv(o,l){if(o==="change")return l}var Bv=!1;if(Xs){var fh;if(Xs){var dh="oninput"in document;if(!dh){var Gv=document.createElement("div");Gv.setAttribute("oninput","return;"),dh=typeof Gv.oninput=="function"}fh=dh}else fh=!1;Bv=fh&&(!document.documentMode||9<document.documentMode)}function Vv(){zl&&(zl.detachEvent("onpropertychange",Hv),$l=zl=null)}function Hv(o){if(o.propertyName==="value"&&cc($l)){var l=[];Fv(l,$l,o,nh(o)),Rv(VC,l)}}function HC(o,l,h){o==="focusin"?(Vv(),zl=l,$l=h,zl.attachEvent("onpropertychange",Hv)):o==="focusout"&&Vv()}function zC(o){if(o==="selectionchange"||o==="keyup"||o==="keydown")return cc($l)}function $C(o,l){if(o==="click")return cc(l)}function qC(o,l){if(o==="input"||o==="change")return cc(l)}function WC(o,l){return o===l&&(o!==0||1/o===1/l)||o!==o&&l!==l}var Bi=typeof Object.is=="function"?Object.is:WC;function ql(o,l){if(Bi(o,l))return!0;if(typeof o!="object"||o===null||typeof l!="object"||l===null)return!1;var h=Object.keys(o),g=Object.keys(l);if(h.length!==g.length)return!1;for(g=0;g<h.length;g++){var T=h[g];if(!Dt.call(l,T)||!Bi(o[T],l[T]))return!1}return!0}function zv(o){for(;o&&o.firstChild;)o=o.firstChild;return o}function $v(o,l){var h=zv(o);o=0;for(var g;h;){if(h.nodeType===3){if(g=o+h.textContent.length,o<=l&&g>=l)return{node:h,offset:l-o};o=g}e:{for(;h;){if(h.nextSibling){h=h.nextSibling;break e}h=h.parentNode}h=void 0}h=zv(h)}}function qv(o,l){return o&&l?o===l?!0:o&&o.nodeType===3?!1:l&&l.nodeType===3?qv(o,l.parentNode):"contains"in o?o.contains(l):o.compareDocumentPosition?!!(o.compareDocumentPosition(l)&16):!1:!1}function Wv(o){o=o!=null&&o.ownerDocument!=null&&o.ownerDocument.defaultView!=null?o.ownerDocument.defaultView:window;for(var l=gs(o.document);l instanceof o.HTMLIFrameElement;){try{var h=typeof l.contentWindow.location.href=="string"}catch{h=!1}if(h)o=l.contentWindow;else break;l=gs(o.document)}return l}function hh(o){var l=o&&o.nodeName&&o.nodeName.toLowerCase();return l&&(l==="input"&&(o.type==="text"||o.type==="search"||o.type==="tel"||o.type==="url"||o.type==="password")||l==="textarea"||o.contentEditable==="true")}var KC=Xs&&"documentMode"in document&&11>=document.documentMode,da=null,ph=null,Wl=null,mh=!1;function Kv(o,l,h){var g=h.window===h?h.document:h.nodeType===9?h:h.ownerDocument;mh||da==null||da!==gs(g)||(g=da,"selectionStart"in g&&hh(g)?g={start:g.selectionStart,end:g.selectionEnd}:(g=(g.ownerDocument&&g.ownerDocument.defaultView||window).getSelection(),g={anchorNode:g.anchorNode,anchorOffset:g.anchorOffset,focusNode:g.focusNode,focusOffset:g.focusOffset}),Wl&&ql(Wl,g)||(Wl=g,g=Zc(ph,"onSelect"),0<g.length&&(l=new lc("onSelect","select",null,l,h),o.push({event:l,listeners:g}),l.target=da)))}function Ro(o,l){var h={};return h[o.toLowerCase()]=l.toLowerCase(),h["Webkit"+o]="webkit"+l,h["Moz"+o]="moz"+l,h}var ha={animationend:Ro("Animation","AnimationEnd"),animationiteration:Ro("Animation","AnimationIteration"),animationstart:Ro("Animation","AnimationStart"),transitionrun:Ro("Transition","TransitionRun"),transitionstart:Ro("Transition","TransitionStart"),transitioncancel:Ro("Transition","TransitionCancel"),transitionend:Ro("Transition","TransitionEnd")},gh={},Yv={};Xs&&(Yv=document.createElement("div").style,"AnimationEvent"in window||(delete ha.animationend.animation,delete ha.animationiteration.animation,delete ha.animationstart.animation),"TransitionEvent"in window||delete ha.transitionend.transition);function bo(o){if(gh[o])return gh[o];if(!ha[o])return o;var l=ha[o],h;for(h in l)if(l.hasOwnProperty(h)&&h in Yv)return gh[o]=l[h];return o}var Xv=bo("animationend"),Jv=bo("animationiteration"),Qv=bo("animationstart"),YC=bo("transitionrun"),XC=bo("transitionstart"),JC=bo("transitioncancel"),Zv=bo("transitionend"),jv=new Map,vh="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");vh.push("scrollEnd");function vs(o,l){jv.set(o,l),Xe(l,[o])}var fc=typeof reportError=="function"?reportError:function(o){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var l=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof o=="object"&&o!==null&&typeof o.message=="string"?String(o.message):String(o),error:o});if(!window.dispatchEvent(l))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",o);return}console.error(o)},ns=[],pa=0,yh=0;function dc(){for(var o=pa,l=yh=pa=0;l<o;){var h=ns[l];ns[l++]=null;var g=ns[l];ns[l++]=null;var T=ns[l];ns[l++]=null;var R=ns[l];if(ns[l++]=null,g!==null&&T!==null){var D=g.pending;D===null?T.next=T:(T.next=D.next,D.next=T),g.pending=T}R!==0&&ey(h,T,R)}}function hc(o,l,h,g){ns[pa++]=o,ns[pa++]=l,ns[pa++]=h,ns[pa++]=g,yh|=g,o.lanes|=g,o=o.alternate,o!==null&&(o.lanes|=g)}function _h(o,l,h,g){return hc(o,l,h,g),pc(o)}function Mo(o,l){return hc(o,null,null,l),pc(o)}function ey(o,l,h){o.lanes|=h;var g=o.alternate;g!==null&&(g.lanes|=h);for(var T=!1,R=o.return;R!==null;)R.childLanes|=h,g=R.alternate,g!==null&&(g.childLanes|=h),R.tag===22&&(o=R.stateNode,o===null||o._visibility&1||(T=!0)),o=R,R=R.return;return o.tag===3?(R=o.stateNode,T&&l!==null&&(T=31-ht(h),o=R.hiddenUpdates,g=o[T],g===null?o[T]=[l]:g.push(l),l.lane=h|536870912),R):null}function pc(o){if(50<pu)throw pu=0,Cp=null,Error(n(185));for(var l=o.return;l!==null;)o=l,l=o.return;return o.tag===3?o.stateNode:null}var ma={};function QC(o,l,h,g){this.tag=o,this.key=h,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=l,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=g,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Gi(o,l,h,g){return new QC(o,l,h,g)}function Eh(o){return o=o.prototype,!(!o||!o.isReactComponent)}function Js(o,l){var h=o.alternate;return h===null?(h=Gi(o.tag,l,o.key,o.mode),h.elementType=o.elementType,h.type=o.type,h.stateNode=o.stateNode,h.alternate=o,o.alternate=h):(h.pendingProps=l,h.type=o.type,h.flags=0,h.subtreeFlags=0,h.deletions=null),h.flags=o.flags&65011712,h.childLanes=o.childLanes,h.lanes=o.lanes,h.child=o.child,h.memoizedProps=o.memoizedProps,h.memoizedState=o.memoizedState,h.updateQueue=o.updateQueue,l=o.dependencies,h.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext},h.sibling=o.sibling,h.index=o.index,h.ref=o.ref,h.refCleanup=o.refCleanup,h}function ty(o,l){o.flags&=65011714;var h=o.alternate;return h===null?(o.childLanes=0,o.lanes=l,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=h.childLanes,o.lanes=h.lanes,o.child=h.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=h.memoizedProps,o.memoizedState=h.memoizedState,o.updateQueue=h.updateQueue,o.type=h.type,l=h.dependencies,o.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext}),o}function mc(o,l,h,g,T,R){var D=0;if(g=o,typeof o=="function")Eh(o)&&(D=1);else if(typeof o=="string")D=nL(o,h,Q.current)?26:o==="html"||o==="head"||o==="body"?27:5;else e:switch(o){case L:return o=Gi(31,h,l,T),o.elementType=L,o.lanes=R,o;case A:return Co(h.children,T,R,l);case S:D=8,T|=24;break;case x:return o=Gi(12,h,l,T|2),o.elementType=x,o.lanes=R,o;case N:return o=Gi(13,h,l,T),o.elementType=N,o.lanes=R,o;case U:return o=Gi(19,h,l,T),o.elementType=U,o.lanes=R,o;default:if(typeof o=="object"&&o!==null)switch(o.$$typeof){case b:D=10;break e;case M:D=9;break e;case C:D=11;break e;case w:D=14;break e;case O:D=16,g=null;break e}D=29,h=Error(n(130,o===null?"null":typeof o,"")),g=null}return l=Gi(D,h,l,T),l.elementType=o,l.type=g,l.lanes=R,l}function Co(o,l,h,g){return o=Gi(7,o,g,l),o.lanes=h,o}function Sh(o,l,h){return o=Gi(6,o,null,l),o.lanes=h,o}function ny(o){var l=Gi(18,null,null,0);return l.stateNode=o,l}function Th(o,l,h){return l=Gi(4,o.children!==null?o.children:[],o.key,l),l.lanes=h,l.stateNode={containerInfo:o.containerInfo,pendingChildren:null,implementation:o.implementation},l}var iy=new WeakMap;function is(o,l){if(typeof o=="object"&&o!==null){var h=iy.get(o);return h!==void 0?h:(l={value:o,source:l,stack:Qe(l)},iy.set(o,l),l)}return{value:o,source:l,stack:Qe(l)}}var ga=[],va=0,gc=null,Kl=0,ss=[],rs=0,Pr=null,Ds=1,ws="";function Qs(o,l){ga[va++]=Kl,ga[va++]=gc,gc=o,Kl=l}function sy(o,l,h){ss[rs++]=Ds,ss[rs++]=ws,ss[rs++]=Pr,Pr=o;var g=Ds;o=ws;var T=32-ht(g)-1;g&=~(1<<T),h+=1;var R=32-ht(l)+T;if(30<R){var D=T-T%5;R=(g&(1<<D)-1).toString(32),g>>=D,T-=D,Ds=1<<32-ht(l)+T|h<<T|g,ws=R+o}else Ds=1<<R|h<<T|g,ws=o}function xh(o){o.return!==null&&(Qs(o,1),sy(o,1,0))}function Ah(o){for(;o===gc;)gc=ga[--va],ga[va]=null,Kl=ga[--va],ga[va]=null;for(;o===Pr;)Pr=ss[--rs],ss[rs]=null,ws=ss[--rs],ss[rs]=null,Ds=ss[--rs],ss[rs]=null}function ry(o,l){ss[rs++]=Ds,ss[rs++]=ws,ss[rs++]=Pr,Ds=l.id,ws=l.overflow,Pr=o}var si=null,Tn=null,qt=!1,Nr=null,os=!1,Rh=Error(n(519));function Ur(o){var l=Error(n(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Yl(is(l,o)),Rh}function oy(o){var l=o.stateNode,h=o.type,g=o.memoizedProps;switch(l[kt]=o,l[nn]=g,h){case"dialog":Ft("cancel",l),Ft("close",l);break;case"iframe":case"object":case"embed":Ft("load",l);break;case"video":case"audio":for(h=0;h<gu.length;h++)Ft(gu[h],l);break;case"source":Ft("error",l);break;case"img":case"image":case"link":Ft("error",l),Ft("load",l);break;case"details":Ft("toggle",l);break;case"input":Ft("invalid",l),vi(l,g.value,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name,!0);break;case"select":Ft("invalid",l);break;case"textarea":Ft("invalid",l),la(l,g.value,g.defaultValue,g.children)}h=g.children,typeof h!="string"&&typeof h!="number"&&typeof h!="bigint"||l.textContent===""+h||g.suppressHydrationWarning===!0||xE(l.textContent,h)?(g.popover!=null&&(Ft("beforetoggle",l),Ft("toggle",l)),g.onScroll!=null&&Ft("scroll",l),g.onScrollEnd!=null&&Ft("scrollend",l),g.onClick!=null&&(l.onclick=Ys),l=!0):l=!1,l||Ur(o,!0)}function ay(o){for(si=o.return;si;)switch(si.tag){case 5:case 31:case 13:os=!1;return;case 27:case 3:os=!0;return;default:si=si.return}}function ya(o){if(o!==si)return!1;if(!qt)return ay(o),qt=!0,!1;var l=o.tag,h;if((h=l!==3&&l!==27)&&((h=l===5)&&(h=o.type,h=!(h!=="form"&&h!=="button")||zp(o.type,o.memoizedProps)),h=!h),h&&Tn&&Ur(o),ay(o),l===13){if(o=o.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(n(317));Tn=wE(o)}else if(l===31){if(o=o.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(n(317));Tn=wE(o)}else l===27?(l=Tn,Xr(o.type)?(o=Yp,Yp=null,Tn=o):Tn=l):Tn=si?ls(o.stateNode.nextSibling):null;return!0}function Io(){Tn=si=null,qt=!1}function bh(){var o=Nr;return o!==null&&(wi===null?wi=o:wi.push.apply(wi,o),Nr=null),o}function Yl(o){Nr===null?Nr=[o]:Nr.push(o)}var Mh=G(null),Lo=null,Zs=null;function Or(o,l,h){fe(Mh,l._currentValue),l._currentValue=h}function js(o){o._currentValue=Mh.current,K(Mh)}function Ch(o,l,h){for(;o!==null;){var g=o.alternate;if((o.childLanes&l)!==l?(o.childLanes|=l,g!==null&&(g.childLanes|=l)):g!==null&&(g.childLanes&l)!==l&&(g.childLanes|=l),o===h)break;o=o.return}}function Ih(o,l,h,g){var T=o.child;for(T!==null&&(T.return=o);T!==null;){var R=T.dependencies;if(R!==null){var D=T.child;R=R.firstContext;e:for(;R!==null;){var B=R;R=T;for(var Z=0;Z<l.length;Z++)if(B.context===l[Z]){R.lanes|=h,B=R.alternate,B!==null&&(B.lanes|=h),Ch(R.return,h,o),g||(D=null);break e}R=B.next}}else if(T.tag===18){if(D=T.return,D===null)throw Error(n(341));D.lanes|=h,R=D.alternate,R!==null&&(R.lanes|=h),Ch(D,h,o),D=null}else D=T.child;if(D!==null)D.return=T;else for(D=T;D!==null;){if(D===o){D=null;break}if(T=D.sibling,T!==null){T.return=D.return,D=T;break}D=D.return}T=D}}function _a(o,l,h,g){o=null;for(var T=l,R=!1;T!==null;){if(!R){if((T.flags&524288)!==0)R=!0;else if((T.flags&262144)!==0)break}if(T.tag===10){var D=T.alternate;if(D===null)throw Error(n(387));if(D=D.memoizedProps,D!==null){var B=T.type;Bi(T.pendingProps.value,D.value)||(o!==null?o.push(B):o=[B])}}else if(T===Ee.current){if(D=T.alternate,D===null)throw Error(n(387));D.memoizedState.memoizedState!==T.memoizedState.memoizedState&&(o!==null?o.push(Su):o=[Su])}T=T.return}o!==null&&Ih(l,o,h,g),l.flags|=262144}function vc(o){for(o=o.firstContext;o!==null;){if(!Bi(o.context._currentValue,o.memoizedValue))return!0;o=o.next}return!1}function Do(o){Lo=o,Zs=null,o=o.dependencies,o!==null&&(o.firstContext=null)}function ri(o){return ly(Lo,o)}function yc(o,l){return Lo===null&&Do(o),ly(o,l)}function ly(o,l){var h=l._currentValue;if(l={context:l,memoizedValue:h,next:null},Zs===null){if(o===null)throw Error(n(308));Zs=l,o.dependencies={lanes:0,firstContext:l},o.flags|=524288}else Zs=Zs.next=l;return h}var ZC=typeof AbortController<"u"?AbortController:function(){var o=[],l=this.signal={aborted:!1,addEventListener:function(h,g){o.push(g)}};this.abort=function(){l.aborted=!0,o.forEach(function(h){return h()})}},jC=i.unstable_scheduleCallback,eI=i.unstable_NormalPriority,Fn={$$typeof:b,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Lh(){return{controller:new ZC,data:new Map,refCount:0}}function Xl(o){o.refCount--,o.refCount===0&&jC(eI,function(){o.controller.abort()})}var Jl=null,Dh=0,Ea=0,Sa=null;function tI(o,l){if(Jl===null){var h=Jl=[];Dh=0,Ea=Np(),Sa={status:"pending",value:void 0,then:function(g){h.push(g)}}}return Dh++,l.then(uy,uy),l}function uy(){if(--Dh===0&&Jl!==null){Sa!==null&&(Sa.status="fulfilled");var o=Jl;Jl=null,Ea=0,Sa=null;for(var l=0;l<o.length;l++)(0,o[l])()}}function nI(o,l){var h=[],g={status:"pending",value:null,reason:null,then:function(T){h.push(T)}};return o.then(function(){g.status="fulfilled",g.value=l;for(var T=0;T<h.length;T++)(0,h[T])(l)},function(T){for(g.status="rejected",g.reason=T,T=0;T<h.length;T++)(0,h[T])(void 0)}),g}var cy=V.S;V.S=function(o,l){K_=Re(),typeof l=="object"&&l!==null&&typeof l.then=="function"&&tI(o,l),cy!==null&&cy(o,l)};var wo=G(null);function wh(){var o=wo.current;return o!==null?o:gn.pooledCache}function _c(o,l){l===null?fe(wo,wo.current):fe(wo,l.pool)}function fy(){var o=wh();return o===null?null:{parent:Fn._currentValue,pool:o}}var Ta=Error(n(460)),Ph=Error(n(474)),Ec=Error(n(542)),Sc={then:function(){}};function dy(o){return o=o.status,o==="fulfilled"||o==="rejected"}function hy(o,l,h){switch(h=o[h],h===void 0?o.push(l):h!==l&&(l.then(Ys,Ys),l=h),l.status){case"fulfilled":return l.value;case"rejected":throw o=l.reason,my(o),o;default:if(typeof l.status=="string")l.then(Ys,Ys);else{if(o=gn,o!==null&&100<o.shellSuspendCounter)throw Error(n(482));o=l,o.status="pending",o.then(function(g){if(l.status==="pending"){var T=l;T.status="fulfilled",T.value=g}},function(g){if(l.status==="pending"){var T=l;T.status="rejected",T.reason=g}})}switch(l.status){case"fulfilled":return l.value;case"rejected":throw o=l.reason,my(o),o}throw No=l,Ta}}function Po(o){try{var l=o._init;return l(o._payload)}catch(h){throw h!==null&&typeof h=="object"&&typeof h.then=="function"?(No=h,Ta):h}}var No=null;function py(){if(No===null)throw Error(n(459));var o=No;return No=null,o}function my(o){if(o===Ta||o===Ec)throw Error(n(483))}var xa=null,Ql=0;function Tc(o){var l=Ql;return Ql+=1,xa===null&&(xa=[]),hy(xa,o,l)}function Zl(o,l){l=l.props.ref,o.ref=l!==void 0?l:null}function xc(o,l){throw l.$$typeof===m?Error(n(525)):(o=Object.prototype.toString.call(l),Error(n(31,o==="[object Object]"?"object with keys {"+Object.keys(l).join(", ")+"}":o)))}function gy(o){function l(re,j){if(o){var de=re.deletions;de===null?(re.deletions=[j],re.flags|=16):de.push(j)}}function h(re,j){if(!o)return null;for(;j!==null;)l(re,j),j=j.sibling;return null}function g(re){for(var j=new Map;re!==null;)re.key!==null?j.set(re.key,re):j.set(re.index,re),re=re.sibling;return j}function T(re,j){return re=Js(re,j),re.index=0,re.sibling=null,re}function R(re,j,de){return re.index=de,o?(de=re.alternate,de!==null?(de=de.index,de<j?(re.flags|=67108866,j):de):(re.flags|=67108866,j)):(re.flags|=1048576,j)}function D(re){return o&&re.alternate===null&&(re.flags|=67108866),re}function B(re,j,de,Ie){return j===null||j.tag!==6?(j=Sh(de,re.mode,Ie),j.return=re,j):(j=T(j,de),j.return=re,j)}function Z(re,j,de,Ie){var ft=de.type;return ft===A?Me(re,j,de.props.children,Ie,de.key):j!==null&&(j.elementType===ft||typeof ft=="object"&&ft!==null&&ft.$$typeof===O&&Po(ft)===j.type)?(j=T(j,de.props),Zl(j,de),j.return=re,j):(j=mc(de.type,de.key,de.props,null,re.mode,Ie),Zl(j,de),j.return=re,j)}function ge(re,j,de,Ie){return j===null||j.tag!==4||j.stateNode.containerInfo!==de.containerInfo||j.stateNode.implementation!==de.implementation?(j=Th(de,re.mode,Ie),j.return=re,j):(j=T(j,de.children||[]),j.return=re,j)}function Me(re,j,de,Ie,ft){return j===null||j.tag!==7?(j=Co(de,re.mode,Ie,ft),j.return=re,j):(j=T(j,de),j.return=re,j)}function De(re,j,de){if(typeof j=="string"&&j!==""||typeof j=="number"||typeof j=="bigint")return j=Sh(""+j,re.mode,de),j.return=re,j;if(typeof j=="object"&&j!==null){switch(j.$$typeof){case y:return de=mc(j.type,j.key,j.props,null,re.mode,de),Zl(de,j),de.return=re,de;case E:return j=Th(j,re.mode,de),j.return=re,j;case O:return j=Po(j),De(re,j,de)}if(ne(j)||X(j))return j=Co(j,re.mode,de,null),j.return=re,j;if(typeof j.then=="function")return De(re,Tc(j),de);if(j.$$typeof===b)return De(re,yc(re,j),de);xc(re,j)}return null}function ve(re,j,de,Ie){var ft=j!==null?j.key:null;if(typeof de=="string"&&de!==""||typeof de=="number"||typeof de=="bigint")return ft!==null?null:B(re,j,""+de,Ie);if(typeof de=="object"&&de!==null){switch(de.$$typeof){case y:return de.key===ft?Z(re,j,de,Ie):null;case E:return de.key===ft?ge(re,j,de,Ie):null;case O:return de=Po(de),ve(re,j,de,Ie)}if(ne(de)||X(de))return ft!==null?null:Me(re,j,de,Ie,null);if(typeof de.then=="function")return ve(re,j,Tc(de),Ie);if(de.$$typeof===b)return ve(re,j,yc(re,de),Ie);xc(re,de)}return null}function Se(re,j,de,Ie,ft){if(typeof Ie=="string"&&Ie!==""||typeof Ie=="number"||typeof Ie=="bigint")return re=re.get(de)||null,B(j,re,""+Ie,ft);if(typeof Ie=="object"&&Ie!==null){switch(Ie.$$typeof){case y:return re=re.get(Ie.key===null?de:Ie.key)||null,Z(j,re,Ie,ft);case E:return re=re.get(Ie.key===null?de:Ie.key)||null,ge(j,re,Ie,ft);case O:return Ie=Po(Ie),Se(re,j,de,Ie,ft)}if(ne(Ie)||X(Ie))return re=re.get(de)||null,Me(j,re,Ie,ft,null);if(typeof Ie.then=="function")return Se(re,j,de,Tc(Ie),ft);if(Ie.$$typeof===b)return Se(re,j,de,yc(j,Ie),ft);xc(j,Ie)}return null}function it(re,j,de,Ie){for(var ft=null,Xt=null,at=j,It=j=0,Gt=null;at!==null&&It<de.length;It++){at.index>It?(Gt=at,at=null):Gt=at.sibling;var Jt=ve(re,at,de[It],Ie);if(Jt===null){at===null&&(at=Gt);break}o&&at&&Jt.alternate===null&&l(re,at),j=R(Jt,j,It),Xt===null?ft=Jt:Xt.sibling=Jt,Xt=Jt,at=Gt}if(It===de.length)return h(re,at),qt&&Qs(re,It),ft;if(at===null){for(;It<de.length;It++)at=De(re,de[It],Ie),at!==null&&(j=R(at,j,It),Xt===null?ft=at:Xt.sibling=at,Xt=at);return qt&&Qs(re,It),ft}for(at=g(at);It<de.length;It++)Gt=Se(at,re,It,de[It],Ie),Gt!==null&&(o&&Gt.alternate!==null&&at.delete(Gt.key===null?It:Gt.key),j=R(Gt,j,It),Xt===null?ft=Gt:Xt.sibling=Gt,Xt=Gt);return o&&at.forEach(function(eo){return l(re,eo)}),qt&&Qs(re,It),ft}function mt(re,j,de,Ie){if(de==null)throw Error(n(151));for(var ft=null,Xt=null,at=j,It=j=0,Gt=null,Jt=de.next();at!==null&&!Jt.done;It++,Jt=de.next()){at.index>It?(Gt=at,at=null):Gt=at.sibling;var eo=ve(re,at,Jt.value,Ie);if(eo===null){at===null&&(at=Gt);break}o&&at&&eo.alternate===null&&l(re,at),j=R(eo,j,It),Xt===null?ft=eo:Xt.sibling=eo,Xt=eo,at=Gt}if(Jt.done)return h(re,at),qt&&Qs(re,It),ft;if(at===null){for(;!Jt.done;It++,Jt=de.next())Jt=De(re,Jt.value,Ie),Jt!==null&&(j=R(Jt,j,It),Xt===null?ft=Jt:Xt.sibling=Jt,Xt=Jt);return qt&&Qs(re,It),ft}for(at=g(at);!Jt.done;It++,Jt=de.next())Jt=Se(at,re,It,Jt.value,Ie),Jt!==null&&(o&&Jt.alternate!==null&&at.delete(Jt.key===null?It:Jt.key),j=R(Jt,j,It),Xt===null?ft=Jt:Xt.sibling=Jt,Xt=Jt);return o&&at.forEach(function(hL){return l(re,hL)}),qt&&Qs(re,It),ft}function fn(re,j,de,Ie){if(typeof de=="object"&&de!==null&&de.type===A&&de.key===null&&(de=de.props.children),typeof de=="object"&&de!==null){switch(de.$$typeof){case y:e:{for(var ft=de.key;j!==null;){if(j.key===ft){if(ft=de.type,ft===A){if(j.tag===7){h(re,j.sibling),Ie=T(j,de.props.children),Ie.return=re,re=Ie;break e}}else if(j.elementType===ft||typeof ft=="object"&&ft!==null&&ft.$$typeof===O&&Po(ft)===j.type){h(re,j.sibling),Ie=T(j,de.props),Zl(Ie,de),Ie.return=re,re=Ie;break e}h(re,j);break}else l(re,j);j=j.sibling}de.type===A?(Ie=Co(de.props.children,re.mode,Ie,de.key),Ie.return=re,re=Ie):(Ie=mc(de.type,de.key,de.props,null,re.mode,Ie),Zl(Ie,de),Ie.return=re,re=Ie)}return D(re);case E:e:{for(ft=de.key;j!==null;){if(j.key===ft)if(j.tag===4&&j.stateNode.containerInfo===de.containerInfo&&j.stateNode.implementation===de.implementation){h(re,j.sibling),Ie=T(j,de.children||[]),Ie.return=re,re=Ie;break e}else{h(re,j);break}else l(re,j);j=j.sibling}Ie=Th(de,re.mode,Ie),Ie.return=re,re=Ie}return D(re);case O:return de=Po(de),fn(re,j,de,Ie)}if(ne(de))return it(re,j,de,Ie);if(X(de)){if(ft=X(de),typeof ft!="function")throw Error(n(150));return de=ft.call(de),mt(re,j,de,Ie)}if(typeof de.then=="function")return fn(re,j,Tc(de),Ie);if(de.$$typeof===b)return fn(re,j,yc(re,de),Ie);xc(re,de)}return typeof de=="string"&&de!==""||typeof de=="number"||typeof de=="bigint"?(de=""+de,j!==null&&j.tag===6?(h(re,j.sibling),Ie=T(j,de),Ie.return=re,re=Ie):(h(re,j),Ie=Sh(de,re.mode,Ie),Ie.return=re,re=Ie),D(re)):h(re,j)}return function(re,j,de,Ie){try{Ql=0;var ft=fn(re,j,de,Ie);return xa=null,ft}catch(at){if(at===Ta||at===Ec)throw at;var Xt=Gi(29,at,null,re.mode);return Xt.lanes=Ie,Xt.return=re,Xt}finally{}}}var Uo=gy(!0),vy=gy(!1),Fr=!1;function Nh(o){o.updateQueue={baseState:o.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Uh(o,l){o=o.updateQueue,l.updateQueue===o&&(l.updateQueue={baseState:o.baseState,firstBaseUpdate:o.firstBaseUpdate,lastBaseUpdate:o.lastBaseUpdate,shared:o.shared,callbacks:null})}function kr(o){return{lane:o,tag:0,payload:null,callback:null,next:null}}function Br(o,l,h){var g=o.updateQueue;if(g===null)return null;if(g=g.shared,(en&2)!==0){var T=g.pending;return T===null?l.next=l:(l.next=T.next,T.next=l),g.pending=l,l=pc(o),ey(o,null,h),l}return hc(o,g,l,h),pc(o)}function jl(o,l,h){if(l=l.updateQueue,l!==null&&(l=l.shared,(h&4194048)!==0)){var g=l.lanes;g&=o.pendingLanes,h|=g,l.lanes=h,To(o,h)}}function Oh(o,l){var h=o.updateQueue,g=o.alternate;if(g!==null&&(g=g.updateQueue,h===g)){var T=null,R=null;if(h=h.firstBaseUpdate,h!==null){do{var D={lane:h.lane,tag:h.tag,payload:h.payload,callback:null,next:null};R===null?T=R=D:R=R.next=D,h=h.next}while(h!==null);R===null?T=R=l:R=R.next=l}else T=R=l;h={baseState:g.baseState,firstBaseUpdate:T,lastBaseUpdate:R,shared:g.shared,callbacks:g.callbacks},o.updateQueue=h;return}o=h.lastBaseUpdate,o===null?h.firstBaseUpdate=l:o.next=l,h.lastBaseUpdate=l}var Fh=!1;function eu(){if(Fh){var o=Sa;if(o!==null)throw o}}function tu(o,l,h,g){Fh=!1;var T=o.updateQueue;Fr=!1;var R=T.firstBaseUpdate,D=T.lastBaseUpdate,B=T.shared.pending;if(B!==null){T.shared.pending=null;var Z=B,ge=Z.next;Z.next=null,D===null?R=ge:D.next=ge,D=Z;var Me=o.alternate;Me!==null&&(Me=Me.updateQueue,B=Me.lastBaseUpdate,B!==D&&(B===null?Me.firstBaseUpdate=ge:B.next=ge,Me.lastBaseUpdate=Z))}if(R!==null){var De=T.baseState;D=0,Me=ge=Z=null,B=R;do{var ve=B.lane&-536870913,Se=ve!==B.lane;if(Se?(Bt&ve)===ve:(g&ve)===ve){ve!==0&&ve===Ea&&(Fh=!0),Me!==null&&(Me=Me.next={lane:0,tag:B.tag,payload:B.payload,callback:null,next:null});e:{var it=o,mt=B;ve=l;var fn=h;switch(mt.tag){case 1:if(it=mt.payload,typeof it=="function"){De=it.call(fn,De,ve);break e}De=it;break e;case 3:it.flags=it.flags&-65537|128;case 0:if(it=mt.payload,ve=typeof it=="function"?it.call(fn,De,ve):it,ve==null)break e;De=p({},De,ve);break e;case 2:Fr=!0}}ve=B.callback,ve!==null&&(o.flags|=64,Se&&(o.flags|=8192),Se=T.callbacks,Se===null?T.callbacks=[ve]:Se.push(ve))}else Se={lane:ve,tag:B.tag,payload:B.payload,callback:B.callback,next:null},Me===null?(ge=Me=Se,Z=De):Me=Me.next=Se,D|=ve;if(B=B.next,B===null){if(B=T.shared.pending,B===null)break;Se=B,B=Se.next,Se.next=null,T.lastBaseUpdate=Se,T.shared.pending=null}}while(!0);Me===null&&(Z=De),T.baseState=Z,T.firstBaseUpdate=ge,T.lastBaseUpdate=Me,R===null&&(T.shared.lanes=0),$r|=D,o.lanes=D,o.memoizedState=De}}function yy(o,l){if(typeof o!="function")throw Error(n(191,o));o.call(l)}function _y(o,l){var h=o.callbacks;if(h!==null)for(o.callbacks=null,o=0;o<h.length;o++)yy(h[o],l)}var Aa=G(null),Ac=G(0);function Ey(o,l){o=lr,fe(Ac,o),fe(Aa,l),lr=o|l.baseLanes}function kh(){fe(Ac,lr),fe(Aa,Aa.current)}function Bh(){lr=Ac.current,K(Aa),K(Ac)}var Vi=G(null),as=null;function Gr(o){var l=o.alternate;fe(wn,wn.current&1),fe(Vi,o),as===null&&(l===null||Aa.current!==null||l.memoizedState!==null)&&(as=o)}function Gh(o){fe(wn,wn.current),fe(Vi,o),as===null&&(as=o)}function Sy(o){o.tag===22?(fe(wn,wn.current),fe(Vi,o),as===null&&(as=o)):Vr()}function Vr(){fe(wn,wn.current),fe(Vi,Vi.current)}function Hi(o){K(Vi),as===o&&(as=null),K(wn)}var wn=G(0);function Rc(o){for(var l=o;l!==null;){if(l.tag===13){var h=l.memoizedState;if(h!==null&&(h=h.dehydrated,h===null||Wp(h)||Kp(h)))return l}else if(l.tag===19&&(l.memoizedProps.revealOrder==="forwards"||l.memoizedProps.revealOrder==="backwards"||l.memoizedProps.revealOrder==="unstable_legacy-backwards"||l.memoizedProps.revealOrder==="together")){if((l.flags&128)!==0)return l}else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===o)break;for(;l.sibling===null;){if(l.return===null||l.return===o)return null;l=l.return}l.sibling.return=l.return,l=l.sibling}return null}var er=0,bt=null,un=null,kn=null,bc=!1,Ra=!1,Oo=!1,Mc=0,nu=0,ba=null,iI=0;function Cn(){throw Error(n(321))}function Vh(o,l){if(l===null)return!1;for(var h=0;h<l.length&&h<o.length;h++)if(!Bi(o[h],l[h]))return!1;return!0}function Hh(o,l,h,g,T,R){return er=R,bt=l,l.memoizedState=null,l.updateQueue=null,l.lanes=0,V.H=o===null||o.memoizedState===null?s_:ip,Oo=!1,R=h(g,T),Oo=!1,Ra&&(R=xy(l,h,g,T)),Ty(o),R}function Ty(o){V.H=ru;var l=un!==null&&un.next!==null;if(er=0,kn=un=bt=null,bc=!1,nu=0,ba=null,l)throw Error(n(300));o===null||Bn||(o=o.dependencies,o!==null&&vc(o)&&(Bn=!0))}function xy(o,l,h,g){bt=o;var T=0;do{if(Ra&&(ba=null),nu=0,Ra=!1,25<=T)throw Error(n(301));if(T+=1,kn=un=null,o.updateQueue!=null){var R=o.updateQueue;R.lastEffect=null,R.events=null,R.stores=null,R.memoCache!=null&&(R.memoCache.index=0)}V.H=r_,R=l(h,g)}while(Ra);return R}function sI(){var o=V.H,l=o.useState()[0];return l=typeof l.then=="function"?iu(l):l,o=o.useState()[0],(un!==null?un.memoizedState:null)!==o&&(bt.flags|=1024),l}function zh(){var o=Mc!==0;return Mc=0,o}function $h(o,l,h){l.updateQueue=o.updateQueue,l.flags&=-2053,o.lanes&=~h}function qh(o){if(bc){for(o=o.memoizedState;o!==null;){var l=o.queue;l!==null&&(l.pending=null),o=o.next}bc=!1}er=0,kn=un=bt=null,Ra=!1,nu=Mc=0,ba=null}function yi(){var o={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return kn===null?bt.memoizedState=kn=o:kn=kn.next=o,kn}function Pn(){if(un===null){var o=bt.alternate;o=o!==null?o.memoizedState:null}else o=un.next;var l=kn===null?bt.memoizedState:kn.next;if(l!==null)kn=l,un=o;else{if(o===null)throw bt.alternate===null?Error(n(467)):Error(n(310));un=o,o={memoizedState:un.memoizedState,baseState:un.baseState,baseQueue:un.baseQueue,queue:un.queue,next:null},kn===null?bt.memoizedState=kn=o:kn=kn.next=o}return kn}function Cc(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function iu(o){var l=nu;return nu+=1,ba===null&&(ba=[]),o=hy(ba,o,l),l=bt,(kn===null?l.memoizedState:kn.next)===null&&(l=l.alternate,V.H=l===null||l.memoizedState===null?s_:ip),o}function Ic(o){if(o!==null&&typeof o=="object"){if(typeof o.then=="function")return iu(o);if(o.$$typeof===b)return ri(o)}throw Error(n(438,String(o)))}function Wh(o){var l=null,h=bt.updateQueue;if(h!==null&&(l=h.memoCache),l==null){var g=bt.alternate;g!==null&&(g=g.updateQueue,g!==null&&(g=g.memoCache,g!=null&&(l={data:g.data.map(function(T){return T.slice()}),index:0})))}if(l==null&&(l={data:[],index:0}),h===null&&(h=Cc(),bt.updateQueue=h),h.memoCache=l,h=l.data[l.index],h===void 0)for(h=l.data[l.index]=Array(o),g=0;g<o;g++)h[g]=I;return l.index++,h}function tr(o,l){return typeof l=="function"?l(o):l}function Lc(o){var l=Pn();return Kh(l,un,o)}function Kh(o,l,h){var g=o.queue;if(g===null)throw Error(n(311));g.lastRenderedReducer=h;var T=o.baseQueue,R=g.pending;if(R!==null){if(T!==null){var D=T.next;T.next=R.next,R.next=D}l.baseQueue=T=R,g.pending=null}if(R=o.baseState,T===null)o.memoizedState=R;else{l=T.next;var B=D=null,Z=null,ge=l,Me=!1;do{var De=ge.lane&-536870913;if(De!==ge.lane?(Bt&De)===De:(er&De)===De){var ve=ge.revertLane;if(ve===0)Z!==null&&(Z=Z.next={lane:0,revertLane:0,gesture:null,action:ge.action,hasEagerState:ge.hasEagerState,eagerState:ge.eagerState,next:null}),De===Ea&&(Me=!0);else if((er&ve)===ve){ge=ge.next,ve===Ea&&(Me=!0);continue}else De={lane:0,revertLane:ge.revertLane,gesture:null,action:ge.action,hasEagerState:ge.hasEagerState,eagerState:ge.eagerState,next:null},Z===null?(B=Z=De,D=R):Z=Z.next=De,bt.lanes|=ve,$r|=ve;De=ge.action,Oo&&h(R,De),R=ge.hasEagerState?ge.eagerState:h(R,De)}else ve={lane:De,revertLane:ge.revertLane,gesture:ge.gesture,action:ge.action,hasEagerState:ge.hasEagerState,eagerState:ge.eagerState,next:null},Z===null?(B=Z=ve,D=R):Z=Z.next=ve,bt.lanes|=De,$r|=De;ge=ge.next}while(ge!==null&&ge!==l);if(Z===null?D=R:Z.next=B,!Bi(R,o.memoizedState)&&(Bn=!0,Me&&(h=Sa,h!==null)))throw h;o.memoizedState=R,o.baseState=D,o.baseQueue=Z,g.lastRenderedState=R}return T===null&&(g.lanes=0),[o.memoizedState,g.dispatch]}function Yh(o){var l=Pn(),h=l.queue;if(h===null)throw Error(n(311));h.lastRenderedReducer=o;var g=h.dispatch,T=h.pending,R=l.memoizedState;if(T!==null){h.pending=null;var D=T=T.next;do R=o(R,D.action),D=D.next;while(D!==T);Bi(R,l.memoizedState)||(Bn=!0),l.memoizedState=R,l.baseQueue===null&&(l.baseState=R),h.lastRenderedState=R}return[R,g]}function Ay(o,l,h){var g=bt,T=Pn(),R=qt;if(R){if(h===void 0)throw Error(n(407));h=h()}else h=l();var D=!Bi((un||T).memoizedState,h);if(D&&(T.memoizedState=h,Bn=!0),T=T.queue,Qh(My.bind(null,g,T,o),[o]),T.getSnapshot!==l||D||kn!==null&&kn.memoizedState.tag&1){if(g.flags|=2048,Ma(9,{destroy:void 0},by.bind(null,g,T,h,l),null),gn===null)throw Error(n(349));R||(er&127)!==0||Ry(g,l,h)}return h}function Ry(o,l,h){o.flags|=16384,o={getSnapshot:l,value:h},l=bt.updateQueue,l===null?(l=Cc(),bt.updateQueue=l,l.stores=[o]):(h=l.stores,h===null?l.stores=[o]:h.push(o))}function by(o,l,h,g){l.value=h,l.getSnapshot=g,Cy(l)&&Iy(o)}function My(o,l,h){return h(function(){Cy(l)&&Iy(o)})}function Cy(o){var l=o.getSnapshot;o=o.value;try{var h=l();return!Bi(o,h)}catch{return!0}}function Iy(o){var l=Mo(o,2);l!==null&&Pi(l,o,2)}function Xh(o){var l=yi();if(typeof o=="function"){var h=o;if(o=h(),Oo){Ke(!0);try{h()}finally{Ke(!1)}}}return l.memoizedState=l.baseState=o,l.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:tr,lastRenderedState:o},l}function Ly(o,l,h,g){return o.baseState=h,Kh(o,un,typeof g=="function"?g:tr)}function rI(o,l,h,g,T){if(Pc(o))throw Error(n(485));if(o=l.action,o!==null){var R={payload:T,action:o,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(D){R.listeners.push(D)}};V.T!==null?h(!0):R.isTransition=!1,g(R),h=l.pending,h===null?(R.next=l.pending=R,Dy(l,R)):(R.next=h.next,l.pending=h.next=R)}}function Dy(o,l){var h=l.action,g=l.payload,T=o.state;if(l.isTransition){var R=V.T,D={};V.T=D;try{var B=h(T,g),Z=V.S;Z!==null&&Z(D,B),wy(o,l,B)}catch(ge){Jh(o,l,ge)}finally{R!==null&&D.types!==null&&(R.types=D.types),V.T=R}}else try{R=h(T,g),wy(o,l,R)}catch(ge){Jh(o,l,ge)}}function wy(o,l,h){h!==null&&typeof h=="object"&&typeof h.then=="function"?h.then(function(g){Py(o,l,g)},function(g){return Jh(o,l,g)}):Py(o,l,h)}function Py(o,l,h){l.status="fulfilled",l.value=h,Ny(l),o.state=h,l=o.pending,l!==null&&(h=l.next,h===l?o.pending=null:(h=h.next,l.next=h,Dy(o,h)))}function Jh(o,l,h){var g=o.pending;if(o.pending=null,g!==null){g=g.next;do l.status="rejected",l.reason=h,Ny(l),l=l.next;while(l!==g)}o.action=null}function Ny(o){o=o.listeners;for(var l=0;l<o.length;l++)(0,o[l])()}function Uy(o,l){return l}function Oy(o,l){if(qt){var h=gn.formState;if(h!==null){e:{var g=bt;if(qt){if(Tn){t:{for(var T=Tn,R=os;T.nodeType!==8;){if(!R){T=null;break t}if(T=ls(T.nextSibling),T===null){T=null;break t}}R=T.data,T=R==="F!"||R==="F"?T:null}if(T){Tn=ls(T.nextSibling),g=T.data==="F!";break e}}Ur(g)}g=!1}g&&(l=h[0])}}return h=yi(),h.memoizedState=h.baseState=l,g={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Uy,lastRenderedState:l},h.queue=g,h=t_.bind(null,bt,g),g.dispatch=h,g=Xh(!1),R=np.bind(null,bt,!1,g.queue),g=yi(),T={state:l,dispatch:null,action:o,pending:null},g.queue=T,h=rI.bind(null,bt,T,R,h),T.dispatch=h,g.memoizedState=o,[l,h,!1]}function Fy(o){var l=Pn();return ky(l,un,o)}function ky(o,l,h){if(l=Kh(o,l,Uy)[0],o=Lc(tr)[0],typeof l=="object"&&l!==null&&typeof l.then=="function")try{var g=iu(l)}catch(D){throw D===Ta?Ec:D}else g=l;l=Pn();var T=l.queue,R=T.dispatch;return h!==l.memoizedState&&(bt.flags|=2048,Ma(9,{destroy:void 0},oI.bind(null,T,h),null)),[g,R,o]}function oI(o,l){o.action=l}function By(o){var l=Pn(),h=un;if(h!==null)return ky(l,h,o);Pn(),l=l.memoizedState,h=Pn();var g=h.queue.dispatch;return h.memoizedState=o,[l,g,!1]}function Ma(o,l,h,g){return o={tag:o,create:h,deps:g,inst:l,next:null},l=bt.updateQueue,l===null&&(l=Cc(),bt.updateQueue=l),h=l.lastEffect,h===null?l.lastEffect=o.next=o:(g=h.next,h.next=o,o.next=g,l.lastEffect=o),o}function Gy(){return Pn().memoizedState}function Dc(o,l,h,g){var T=yi();bt.flags|=o,T.memoizedState=Ma(1|l,{destroy:void 0},h,g===void 0?null:g)}function wc(o,l,h,g){var T=Pn();g=g===void 0?null:g;var R=T.memoizedState.inst;un!==null&&g!==null&&Vh(g,un.memoizedState.deps)?T.memoizedState=Ma(l,R,h,g):(bt.flags|=o,T.memoizedState=Ma(1|l,R,h,g))}function Vy(o,l){Dc(8390656,8,o,l)}function Qh(o,l){wc(2048,8,o,l)}function aI(o){bt.flags|=4;var l=bt.updateQueue;if(l===null)l=Cc(),bt.updateQueue=l,l.events=[o];else{var h=l.events;h===null?l.events=[o]:h.push(o)}}function Hy(o){var l=Pn().memoizedState;return aI({ref:l,nextImpl:o}),function(){if((en&2)!==0)throw Error(n(440));return l.impl.apply(void 0,arguments)}}function zy(o,l){return wc(4,2,o,l)}function $y(o,l){return wc(4,4,o,l)}function qy(o,l){if(typeof l=="function"){o=o();var h=l(o);return function(){typeof h=="function"?h():l(null)}}if(l!=null)return o=o(),l.current=o,function(){l.current=null}}function Wy(o,l,h){h=h!=null?h.concat([o]):null,wc(4,4,qy.bind(null,l,o),h)}function Zh(){}function Ky(o,l){var h=Pn();l=l===void 0?null:l;var g=h.memoizedState;return l!==null&&Vh(l,g[1])?g[0]:(h.memoizedState=[o,l],o)}function Yy(o,l){var h=Pn();l=l===void 0?null:l;var g=h.memoizedState;if(l!==null&&Vh(l,g[1]))return g[0];if(g=o(),Oo){Ke(!0);try{o()}finally{Ke(!1)}}return h.memoizedState=[g,l],g}function jh(o,l,h){return h===void 0||(er&1073741824)!==0&&(Bt&261930)===0?o.memoizedState=l:(o.memoizedState=h,o=X_(),bt.lanes|=o,$r|=o,h)}function Xy(o,l,h,g){return Bi(h,l)?h:Aa.current!==null?(o=jh(o,h,g),Bi(o,l)||(Bn=!0),o):(er&42)===0||(er&1073741824)!==0&&(Bt&261930)===0?(Bn=!0,o.memoizedState=h):(o=X_(),bt.lanes|=o,$r|=o,l)}function Jy(o,l,h,g,T){var R=W.p;W.p=R!==0&&8>R?R:8;var D=V.T,B={};V.T=B,np(o,!1,l,h);try{var Z=T(),ge=V.S;if(ge!==null&&ge(B,Z),Z!==null&&typeof Z=="object"&&typeof Z.then=="function"){var Me=nI(Z,g);su(o,l,Me,qi(o))}else su(o,l,g,qi(o))}catch(De){su(o,l,{then:function(){},status:"rejected",reason:De},qi())}finally{W.p=R,D!==null&&B.types!==null&&(D.types=B.types),V.T=D}}function lI(){}function ep(o,l,h,g){if(o.tag!==5)throw Error(n(476));var T=Qy(o).queue;Jy(o,T,l,q,h===null?lI:function(){return Zy(o),h(g)})}function Qy(o){var l=o.memoizedState;if(l!==null)return l;l={memoizedState:q,baseState:q,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:tr,lastRenderedState:q},next:null};var h={};return l.next={memoizedState:h,baseState:h,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:tr,lastRenderedState:h},next:null},o.memoizedState=l,o=o.alternate,o!==null&&(o.memoizedState=l),l}function Zy(o){var l=Qy(o);l.next===null&&(l=o.alternate.memoizedState),su(o,l.next.queue,{},qi())}function tp(){return ri(Su)}function jy(){return Pn().memoizedState}function e_(){return Pn().memoizedState}function uI(o){for(var l=o.return;l!==null;){switch(l.tag){case 24:case 3:var h=qi();o=kr(h);var g=Br(l,o,h);g!==null&&(Pi(g,l,h),jl(g,l,h)),l={cache:Lh()},o.payload=l;return}l=l.return}}function cI(o,l,h){var g=qi();h={lane:g,revertLane:0,gesture:null,action:h,hasEagerState:!1,eagerState:null,next:null},Pc(o)?n_(l,h):(h=_h(o,l,h,g),h!==null&&(Pi(h,o,g),i_(h,l,g)))}function t_(o,l,h){var g=qi();su(o,l,h,g)}function su(o,l,h,g){var T={lane:g,revertLane:0,gesture:null,action:h,hasEagerState:!1,eagerState:null,next:null};if(Pc(o))n_(l,T);else{var R=o.alternate;if(o.lanes===0&&(R===null||R.lanes===0)&&(R=l.lastRenderedReducer,R!==null))try{var D=l.lastRenderedState,B=R(D,h);if(T.hasEagerState=!0,T.eagerState=B,Bi(B,D))return hc(o,l,T,0),gn===null&&dc(),!1}catch{}finally{}if(h=_h(o,l,T,g),h!==null)return Pi(h,o,g),i_(h,l,g),!0}return!1}function np(o,l,h,g){if(g={lane:2,revertLane:Np(),gesture:null,action:g,hasEagerState:!1,eagerState:null,next:null},Pc(o)){if(l)throw Error(n(479))}else l=_h(o,h,g,2),l!==null&&Pi(l,o,2)}function Pc(o){var l=o.alternate;return o===bt||l!==null&&l===bt}function n_(o,l){Ra=bc=!0;var h=o.pending;h===null?l.next=l:(l.next=h.next,h.next=l),o.pending=l}function i_(o,l,h){if((h&4194048)!==0){var g=l.lanes;g&=o.pendingLanes,h|=g,l.lanes=h,To(o,h)}}var ru={readContext:ri,use:Ic,useCallback:Cn,useContext:Cn,useEffect:Cn,useImperativeHandle:Cn,useLayoutEffect:Cn,useInsertionEffect:Cn,useMemo:Cn,useReducer:Cn,useRef:Cn,useState:Cn,useDebugValue:Cn,useDeferredValue:Cn,useTransition:Cn,useSyncExternalStore:Cn,useId:Cn,useHostTransitionStatus:Cn,useFormState:Cn,useActionState:Cn,useOptimistic:Cn,useMemoCache:Cn,useCacheRefresh:Cn};ru.useEffectEvent=Cn;var s_={readContext:ri,use:Ic,useCallback:function(o,l){return yi().memoizedState=[o,l===void 0?null:l],o},useContext:ri,useEffect:Vy,useImperativeHandle:function(o,l,h){h=h!=null?h.concat([o]):null,Dc(4194308,4,qy.bind(null,l,o),h)},useLayoutEffect:function(o,l){return Dc(4194308,4,o,l)},useInsertionEffect:function(o,l){Dc(4,2,o,l)},useMemo:function(o,l){var h=yi();l=l===void 0?null:l;var g=o();if(Oo){Ke(!0);try{o()}finally{Ke(!1)}}return h.memoizedState=[g,l],g},useReducer:function(o,l,h){var g=yi();if(h!==void 0){var T=h(l);if(Oo){Ke(!0);try{h(l)}finally{Ke(!1)}}}else T=l;return g.memoizedState=g.baseState=T,o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:o,lastRenderedState:T},g.queue=o,o=o.dispatch=cI.bind(null,bt,o),[g.memoizedState,o]},useRef:function(o){var l=yi();return o={current:o},l.memoizedState=o},useState:function(o){o=Xh(o);var l=o.queue,h=t_.bind(null,bt,l);return l.dispatch=h,[o.memoizedState,h]},useDebugValue:Zh,useDeferredValue:function(o,l){var h=yi();return jh(h,o,l)},useTransition:function(){var o=Xh(!1);return o=Jy.bind(null,bt,o.queue,!0,!1),yi().memoizedState=o,[!1,o]},useSyncExternalStore:function(o,l,h){var g=bt,T=yi();if(qt){if(h===void 0)throw Error(n(407));h=h()}else{if(h=l(),gn===null)throw Error(n(349));(Bt&127)!==0||Ry(g,l,h)}T.memoizedState=h;var R={value:h,getSnapshot:l};return T.queue=R,Vy(My.bind(null,g,R,o),[o]),g.flags|=2048,Ma(9,{destroy:void 0},by.bind(null,g,R,h,l),null),h},useId:function(){var o=yi(),l=gn.identifierPrefix;if(qt){var h=ws,g=Ds;h=(g&~(1<<32-ht(g)-1)).toString(32)+h,l="_"+l+"R_"+h,h=Mc++,0<h&&(l+="H"+h.toString(32)),l+="_"}else h=iI++,l="_"+l+"r_"+h.toString(32)+"_";return o.memoizedState=l},useHostTransitionStatus:tp,useFormState:Oy,useActionState:Oy,useOptimistic:function(o){var l=yi();l.memoizedState=l.baseState=o;var h={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return l.queue=h,l=np.bind(null,bt,!0,h),h.dispatch=l,[o,l]},useMemoCache:Wh,useCacheRefresh:function(){return yi().memoizedState=uI.bind(null,bt)},useEffectEvent:function(o){var l=yi(),h={impl:o};return l.memoizedState=h,function(){if((en&2)!==0)throw Error(n(440));return h.impl.apply(void 0,arguments)}}},ip={readContext:ri,use:Ic,useCallback:Ky,useContext:ri,useEffect:Qh,useImperativeHandle:Wy,useInsertionEffect:zy,useLayoutEffect:$y,useMemo:Yy,useReducer:Lc,useRef:Gy,useState:function(){return Lc(tr)},useDebugValue:Zh,useDeferredValue:function(o,l){var h=Pn();return Xy(h,un.memoizedState,o,l)},useTransition:function(){var o=Lc(tr)[0],l=Pn().memoizedState;return[typeof o=="boolean"?o:iu(o),l]},useSyncExternalStore:Ay,useId:jy,useHostTransitionStatus:tp,useFormState:Fy,useActionState:Fy,useOptimistic:function(o,l){var h=Pn();return Ly(h,un,o,l)},useMemoCache:Wh,useCacheRefresh:e_};ip.useEffectEvent=Hy;var r_={readContext:ri,use:Ic,useCallback:Ky,useContext:ri,useEffect:Qh,useImperativeHandle:Wy,useInsertionEffect:zy,useLayoutEffect:$y,useMemo:Yy,useReducer:Yh,useRef:Gy,useState:function(){return Yh(tr)},useDebugValue:Zh,useDeferredValue:function(o,l){var h=Pn();return un===null?jh(h,o,l):Xy(h,un.memoizedState,o,l)},useTransition:function(){var o=Yh(tr)[0],l=Pn().memoizedState;return[typeof o=="boolean"?o:iu(o),l]},useSyncExternalStore:Ay,useId:jy,useHostTransitionStatus:tp,useFormState:By,useActionState:By,useOptimistic:function(o,l){var h=Pn();return un!==null?Ly(h,un,o,l):(h.baseState=o,[o,h.queue.dispatch])},useMemoCache:Wh,useCacheRefresh:e_};r_.useEffectEvent=Hy;function sp(o,l,h,g){l=o.memoizedState,h=h(g,l),h=h==null?l:p({},l,h),o.memoizedState=h,o.lanes===0&&(o.updateQueue.baseState=h)}var rp={enqueueSetState:function(o,l,h){o=o._reactInternals;var g=qi(),T=kr(g);T.payload=l,h!=null&&(T.callback=h),l=Br(o,T,g),l!==null&&(Pi(l,o,g),jl(l,o,g))},enqueueReplaceState:function(o,l,h){o=o._reactInternals;var g=qi(),T=kr(g);T.tag=1,T.payload=l,h!=null&&(T.callback=h),l=Br(o,T,g),l!==null&&(Pi(l,o,g),jl(l,o,g))},enqueueForceUpdate:function(o,l){o=o._reactInternals;var h=qi(),g=kr(h);g.tag=2,l!=null&&(g.callback=l),l=Br(o,g,h),l!==null&&(Pi(l,o,h),jl(l,o,h))}};function o_(o,l,h,g,T,R,D){return o=o.stateNode,typeof o.shouldComponentUpdate=="function"?o.shouldComponentUpdate(g,R,D):l.prototype&&l.prototype.isPureReactComponent?!ql(h,g)||!ql(T,R):!0}function a_(o,l,h,g){o=l.state,typeof l.componentWillReceiveProps=="function"&&l.componentWillReceiveProps(h,g),typeof l.UNSAFE_componentWillReceiveProps=="function"&&l.UNSAFE_componentWillReceiveProps(h,g),l.state!==o&&rp.enqueueReplaceState(l,l.state,null)}function Fo(o,l){var h=l;if("ref"in l){h={};for(var g in l)g!=="ref"&&(h[g]=l[g])}if(o=o.defaultProps){h===l&&(h=p({},h));for(var T in o)h[T]===void 0&&(h[T]=o[T])}return h}function l_(o){fc(o)}function u_(o){console.error(o)}function c_(o){fc(o)}function Nc(o,l){try{var h=o.onUncaughtError;h(l.value,{componentStack:l.stack})}catch(g){setTimeout(function(){throw g})}}function f_(o,l,h){try{var g=o.onCaughtError;g(h.value,{componentStack:h.stack,errorBoundary:l.tag===1?l.stateNode:null})}catch(T){setTimeout(function(){throw T})}}function op(o,l,h){return h=kr(h),h.tag=3,h.payload={element:null},h.callback=function(){Nc(o,l)},h}function d_(o){return o=kr(o),o.tag=3,o}function h_(o,l,h,g){var T=h.type.getDerivedStateFromError;if(typeof T=="function"){var R=g.value;o.payload=function(){return T(R)},o.callback=function(){f_(l,h,g)}}var D=h.stateNode;D!==null&&typeof D.componentDidCatch=="function"&&(o.callback=function(){f_(l,h,g),typeof T!="function"&&(qr===null?qr=new Set([this]):qr.add(this));var B=g.stack;this.componentDidCatch(g.value,{componentStack:B!==null?B:""})})}function fI(o,l,h,g,T){if(h.flags|=32768,g!==null&&typeof g=="object"&&typeof g.then=="function"){if(l=h.alternate,l!==null&&_a(l,h,T,!0),h=Vi.current,h!==null){switch(h.tag){case 31:case 13:return as===null?Wc():h.alternate===null&&In===0&&(In=3),h.flags&=-257,h.flags|=65536,h.lanes=T,g===Sc?h.flags|=16384:(l=h.updateQueue,l===null?h.updateQueue=new Set([g]):l.add(g),Dp(o,g,T)),!1;case 22:return h.flags|=65536,g===Sc?h.flags|=16384:(l=h.updateQueue,l===null?(l={transitions:null,markerInstances:null,retryQueue:new Set([g])},h.updateQueue=l):(h=l.retryQueue,h===null?l.retryQueue=new Set([g]):h.add(g)),Dp(o,g,T)),!1}throw Error(n(435,h.tag))}return Dp(o,g,T),Wc(),!1}if(qt)return l=Vi.current,l!==null?((l.flags&65536)===0&&(l.flags|=256),l.flags|=65536,l.lanes=T,g!==Rh&&(o=Error(n(422),{cause:g}),Yl(is(o,h)))):(g!==Rh&&(l=Error(n(423),{cause:g}),Yl(is(l,h))),o=o.current.alternate,o.flags|=65536,T&=-T,o.lanes|=T,g=is(g,h),T=op(o.stateNode,g,T),Oh(o,T),In!==4&&(In=2)),!1;var R=Error(n(520),{cause:g});if(R=is(R,h),hu===null?hu=[R]:hu.push(R),In!==4&&(In=2),l===null)return!0;g=is(g,h),h=l;do{switch(h.tag){case 3:return h.flags|=65536,o=T&-T,h.lanes|=o,o=op(h.stateNode,g,o),Oh(h,o),!1;case 1:if(l=h.type,R=h.stateNode,(h.flags&128)===0&&(typeof l.getDerivedStateFromError=="function"||R!==null&&typeof R.componentDidCatch=="function"&&(qr===null||!qr.has(R))))return h.flags|=65536,T&=-T,h.lanes|=T,T=d_(T),h_(T,o,h,g),Oh(h,T),!1}h=h.return}while(h!==null);return!1}var ap=Error(n(461)),Bn=!1;function oi(o,l,h,g){l.child=o===null?vy(l,null,h,g):Uo(l,o.child,h,g)}function p_(o,l,h,g,T){h=h.render;var R=l.ref;if("ref"in g){var D={};for(var B in g)B!=="ref"&&(D[B]=g[B])}else D=g;return Do(l),g=Hh(o,l,h,D,R,T),B=zh(),o!==null&&!Bn?($h(o,l,T),nr(o,l,T)):(qt&&B&&xh(l),l.flags|=1,oi(o,l,g,T),l.child)}function m_(o,l,h,g,T){if(o===null){var R=h.type;return typeof R=="function"&&!Eh(R)&&R.defaultProps===void 0&&h.compare===null?(l.tag=15,l.type=R,g_(o,l,R,g,T)):(o=mc(h.type,null,g,l,l.mode,T),o.ref=l.ref,o.return=l,l.child=o)}if(R=o.child,!mp(o,T)){var D=R.memoizedProps;if(h=h.compare,h=h!==null?h:ql,h(D,g)&&o.ref===l.ref)return nr(o,l,T)}return l.flags|=1,o=Js(R,g),o.ref=l.ref,o.return=l,l.child=o}function g_(o,l,h,g,T){if(o!==null){var R=o.memoizedProps;if(ql(R,g)&&o.ref===l.ref)if(Bn=!1,l.pendingProps=g=R,mp(o,T))(o.flags&131072)!==0&&(Bn=!0);else return l.lanes=o.lanes,nr(o,l,T)}return lp(o,l,h,g,T)}function v_(o,l,h,g){var T=g.children,R=o!==null?o.memoizedState:null;if(o===null&&l.stateNode===null&&(l.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),g.mode==="hidden"){if((l.flags&128)!==0){if(R=R!==null?R.baseLanes|h:h,o!==null){for(g=l.child=o.child,T=0;g!==null;)T=T|g.lanes|g.childLanes,g=g.sibling;g=T&~R}else g=0,l.child=null;return y_(o,l,R,h,g)}if((h&536870912)!==0)l.memoizedState={baseLanes:0,cachePool:null},o!==null&&_c(l,R!==null?R.cachePool:null),R!==null?Ey(l,R):kh(),Sy(l);else return g=l.lanes=536870912,y_(o,l,R!==null?R.baseLanes|h:h,h,g)}else R!==null?(_c(l,R.cachePool),Ey(l,R),Vr(),l.memoizedState=null):(o!==null&&_c(l,null),kh(),Vr());return oi(o,l,T,h),l.child}function ou(o,l){return o!==null&&o.tag===22||l.stateNode!==null||(l.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),l.sibling}function y_(o,l,h,g,T){var R=wh();return R=R===null?null:{parent:Fn._currentValue,pool:R},l.memoizedState={baseLanes:h,cachePool:R},o!==null&&_c(l,null),kh(),Sy(l),o!==null&&_a(o,l,g,!0),l.childLanes=T,null}function Uc(o,l){return l=Fc({mode:l.mode,children:l.children},o.mode),l.ref=o.ref,o.child=l,l.return=o,l}function __(o,l,h){return Uo(l,o.child,null,h),o=Uc(l,l.pendingProps),o.flags|=2,Hi(l),l.memoizedState=null,o}function dI(o,l,h){var g=l.pendingProps,T=(l.flags&128)!==0;if(l.flags&=-129,o===null){if(qt){if(g.mode==="hidden")return o=Uc(l,g),l.lanes=536870912,ou(null,o);if(Gh(l),(o=Tn)?(o=DE(o,os),o=o!==null&&o.data==="&"?o:null,o!==null&&(l.memoizedState={dehydrated:o,treeContext:Pr!==null?{id:Ds,overflow:ws}:null,retryLane:536870912,hydrationErrors:null},h=ny(o),h.return=l,l.child=h,si=l,Tn=null)):o=null,o===null)throw Ur(l);return l.lanes=536870912,null}return Uc(l,g)}var R=o.memoizedState;if(R!==null){var D=R.dehydrated;if(Gh(l),T)if(l.flags&256)l.flags&=-257,l=__(o,l,h);else if(l.memoizedState!==null)l.child=o.child,l.flags|=128,l=null;else throw Error(n(558));else if(Bn||_a(o,l,h,!1),T=(h&o.childLanes)!==0,Bn||T){if(g=gn,g!==null&&(D=Ri(g,h),D!==0&&D!==R.retryLane))throw R.retryLane=D,Mo(o,D),Pi(g,o,D),ap;Wc(),l=__(o,l,h)}else o=R.treeContext,Tn=ls(D.nextSibling),si=l,qt=!0,Nr=null,os=!1,o!==null&&ry(l,o),l=Uc(l,g),l.flags|=4096;return l}return o=Js(o.child,{mode:g.mode,children:g.children}),o.ref=l.ref,l.child=o,o.return=l,o}function Oc(o,l){var h=l.ref;if(h===null)o!==null&&o.ref!==null&&(l.flags|=4194816);else{if(typeof h!="function"&&typeof h!="object")throw Error(n(284));(o===null||o.ref!==h)&&(l.flags|=4194816)}}function lp(o,l,h,g,T){return Do(l),h=Hh(o,l,h,g,void 0,T),g=zh(),o!==null&&!Bn?($h(o,l,T),nr(o,l,T)):(qt&&g&&xh(l),l.flags|=1,oi(o,l,h,T),l.child)}function E_(o,l,h,g,T,R){return Do(l),l.updateQueue=null,h=xy(l,g,h,T),Ty(o),g=zh(),o!==null&&!Bn?($h(o,l,R),nr(o,l,R)):(qt&&g&&xh(l),l.flags|=1,oi(o,l,h,R),l.child)}function S_(o,l,h,g,T){if(Do(l),l.stateNode===null){var R=ma,D=h.contextType;typeof D=="object"&&D!==null&&(R=ri(D)),R=new h(g,R),l.memoizedState=R.state!==null&&R.state!==void 0?R.state:null,R.updater=rp,l.stateNode=R,R._reactInternals=l,R=l.stateNode,R.props=g,R.state=l.memoizedState,R.refs={},Nh(l),D=h.contextType,R.context=typeof D=="object"&&D!==null?ri(D):ma,R.state=l.memoizedState,D=h.getDerivedStateFromProps,typeof D=="function"&&(sp(l,h,D,g),R.state=l.memoizedState),typeof h.getDerivedStateFromProps=="function"||typeof R.getSnapshotBeforeUpdate=="function"||typeof R.UNSAFE_componentWillMount!="function"&&typeof R.componentWillMount!="function"||(D=R.state,typeof R.componentWillMount=="function"&&R.componentWillMount(),typeof R.UNSAFE_componentWillMount=="function"&&R.UNSAFE_componentWillMount(),D!==R.state&&rp.enqueueReplaceState(R,R.state,null),tu(l,g,R,T),eu(),R.state=l.memoizedState),typeof R.componentDidMount=="function"&&(l.flags|=4194308),g=!0}else if(o===null){R=l.stateNode;var B=l.memoizedProps,Z=Fo(h,B);R.props=Z;var ge=R.context,Me=h.contextType;D=ma,typeof Me=="object"&&Me!==null&&(D=ri(Me));var De=h.getDerivedStateFromProps;Me=typeof De=="function"||typeof R.getSnapshotBeforeUpdate=="function",B=l.pendingProps!==B,Me||typeof R.UNSAFE_componentWillReceiveProps!="function"&&typeof R.componentWillReceiveProps!="function"||(B||ge!==D)&&a_(l,R,g,D),Fr=!1;var ve=l.memoizedState;R.state=ve,tu(l,g,R,T),eu(),ge=l.memoizedState,B||ve!==ge||Fr?(typeof De=="function"&&(sp(l,h,De,g),ge=l.memoizedState),(Z=Fr||o_(l,h,Z,g,ve,ge,D))?(Me||typeof R.UNSAFE_componentWillMount!="function"&&typeof R.componentWillMount!="function"||(typeof R.componentWillMount=="function"&&R.componentWillMount(),typeof R.UNSAFE_componentWillMount=="function"&&R.UNSAFE_componentWillMount()),typeof R.componentDidMount=="function"&&(l.flags|=4194308)):(typeof R.componentDidMount=="function"&&(l.flags|=4194308),l.memoizedProps=g,l.memoizedState=ge),R.props=g,R.state=ge,R.context=D,g=Z):(typeof R.componentDidMount=="function"&&(l.flags|=4194308),g=!1)}else{R=l.stateNode,Uh(o,l),D=l.memoizedProps,Me=Fo(h,D),R.props=Me,De=l.pendingProps,ve=R.context,ge=h.contextType,Z=ma,typeof ge=="object"&&ge!==null&&(Z=ri(ge)),B=h.getDerivedStateFromProps,(ge=typeof B=="function"||typeof R.getSnapshotBeforeUpdate=="function")||typeof R.UNSAFE_componentWillReceiveProps!="function"&&typeof R.componentWillReceiveProps!="function"||(D!==De||ve!==Z)&&a_(l,R,g,Z),Fr=!1,ve=l.memoizedState,R.state=ve,tu(l,g,R,T),eu();var Se=l.memoizedState;D!==De||ve!==Se||Fr||o!==null&&o.dependencies!==null&&vc(o.dependencies)?(typeof B=="function"&&(sp(l,h,B,g),Se=l.memoizedState),(Me=Fr||o_(l,h,Me,g,ve,Se,Z)||o!==null&&o.dependencies!==null&&vc(o.dependencies))?(ge||typeof R.UNSAFE_componentWillUpdate!="function"&&typeof R.componentWillUpdate!="function"||(typeof R.componentWillUpdate=="function"&&R.componentWillUpdate(g,Se,Z),typeof R.UNSAFE_componentWillUpdate=="function"&&R.UNSAFE_componentWillUpdate(g,Se,Z)),typeof R.componentDidUpdate=="function"&&(l.flags|=4),typeof R.getSnapshotBeforeUpdate=="function"&&(l.flags|=1024)):(typeof R.componentDidUpdate!="function"||D===o.memoizedProps&&ve===o.memoizedState||(l.flags|=4),typeof R.getSnapshotBeforeUpdate!="function"||D===o.memoizedProps&&ve===o.memoizedState||(l.flags|=1024),l.memoizedProps=g,l.memoizedState=Se),R.props=g,R.state=Se,R.context=Z,g=Me):(typeof R.componentDidUpdate!="function"||D===o.memoizedProps&&ve===o.memoizedState||(l.flags|=4),typeof R.getSnapshotBeforeUpdate!="function"||D===o.memoizedProps&&ve===o.memoizedState||(l.flags|=1024),g=!1)}return R=g,Oc(o,l),g=(l.flags&128)!==0,R||g?(R=l.stateNode,h=g&&typeof h.getDerivedStateFromError!="function"?null:R.render(),l.flags|=1,o!==null&&g?(l.child=Uo(l,o.child,null,T),l.child=Uo(l,null,h,T)):oi(o,l,h,T),l.memoizedState=R.state,o=l.child):o=nr(o,l,T),o}function T_(o,l,h,g){return Io(),l.flags|=256,oi(o,l,h,g),l.child}var up={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function cp(o){return{baseLanes:o,cachePool:fy()}}function fp(o,l,h){return o=o!==null?o.childLanes&~h:0,l&&(o|=$i),o}function x_(o,l,h){var g=l.pendingProps,T=!1,R=(l.flags&128)!==0,D;if((D=R)||(D=o!==null&&o.memoizedState===null?!1:(wn.current&2)!==0),D&&(T=!0,l.flags&=-129),D=(l.flags&32)!==0,l.flags&=-33,o===null){if(qt){if(T?Gr(l):Vr(),(o=Tn)?(o=DE(o,os),o=o!==null&&o.data!=="&"?o:null,o!==null&&(l.memoizedState={dehydrated:o,treeContext:Pr!==null?{id:Ds,overflow:ws}:null,retryLane:536870912,hydrationErrors:null},h=ny(o),h.return=l,l.child=h,si=l,Tn=null)):o=null,o===null)throw Ur(l);return Kp(o)?l.lanes=32:l.lanes=536870912,null}var B=g.children;return g=g.fallback,T?(Vr(),T=l.mode,B=Fc({mode:"hidden",children:B},T),g=Co(g,T,h,null),B.return=l,g.return=l,B.sibling=g,l.child=B,g=l.child,g.memoizedState=cp(h),g.childLanes=fp(o,D,h),l.memoizedState=up,ou(null,g)):(Gr(l),dp(l,B))}var Z=o.memoizedState;if(Z!==null&&(B=Z.dehydrated,B!==null)){if(R)l.flags&256?(Gr(l),l.flags&=-257,l=hp(o,l,h)):l.memoizedState!==null?(Vr(),l.child=o.child,l.flags|=128,l=null):(Vr(),B=g.fallback,T=l.mode,g=Fc({mode:"visible",children:g.children},T),B=Co(B,T,h,null),B.flags|=2,g.return=l,B.return=l,g.sibling=B,l.child=g,Uo(l,o.child,null,h),g=l.child,g.memoizedState=cp(h),g.childLanes=fp(o,D,h),l.memoizedState=up,l=ou(null,g));else if(Gr(l),Kp(B)){if(D=B.nextSibling&&B.nextSibling.dataset,D)var ge=D.dgst;D=ge,g=Error(n(419)),g.stack="",g.digest=D,Yl({value:g,source:null,stack:null}),l=hp(o,l,h)}else if(Bn||_a(o,l,h,!1),D=(h&o.childLanes)!==0,Bn||D){if(D=gn,D!==null&&(g=Ri(D,h),g!==0&&g!==Z.retryLane))throw Z.retryLane=g,Mo(o,g),Pi(D,o,g),ap;Wp(B)||Wc(),l=hp(o,l,h)}else Wp(B)?(l.flags|=192,l.child=o.child,l=null):(o=Z.treeContext,Tn=ls(B.nextSibling),si=l,qt=!0,Nr=null,os=!1,o!==null&&ry(l,o),l=dp(l,g.children),l.flags|=4096);return l}return T?(Vr(),B=g.fallback,T=l.mode,Z=o.child,ge=Z.sibling,g=Js(Z,{mode:"hidden",children:g.children}),g.subtreeFlags=Z.subtreeFlags&65011712,ge!==null?B=Js(ge,B):(B=Co(B,T,h,null),B.flags|=2),B.return=l,g.return=l,g.sibling=B,l.child=g,ou(null,g),g=l.child,B=o.child.memoizedState,B===null?B=cp(h):(T=B.cachePool,T!==null?(Z=Fn._currentValue,T=T.parent!==Z?{parent:Z,pool:Z}:T):T=fy(),B={baseLanes:B.baseLanes|h,cachePool:T}),g.memoizedState=B,g.childLanes=fp(o,D,h),l.memoizedState=up,ou(o.child,g)):(Gr(l),h=o.child,o=h.sibling,h=Js(h,{mode:"visible",children:g.children}),h.return=l,h.sibling=null,o!==null&&(D=l.deletions,D===null?(l.deletions=[o],l.flags|=16):D.push(o)),l.child=h,l.memoizedState=null,h)}function dp(o,l){return l=Fc({mode:"visible",children:l},o.mode),l.return=o,o.child=l}function Fc(o,l){return o=Gi(22,o,null,l),o.lanes=0,o}function hp(o,l,h){return Uo(l,o.child,null,h),o=dp(l,l.pendingProps.children),o.flags|=2,l.memoizedState=null,o}function A_(o,l,h){o.lanes|=l;var g=o.alternate;g!==null&&(g.lanes|=l),Ch(o.return,l,h)}function pp(o,l,h,g,T,R){var D=o.memoizedState;D===null?o.memoizedState={isBackwards:l,rendering:null,renderingStartTime:0,last:g,tail:h,tailMode:T,treeForkCount:R}:(D.isBackwards=l,D.rendering=null,D.renderingStartTime=0,D.last=g,D.tail=h,D.tailMode=T,D.treeForkCount=R)}function R_(o,l,h){var g=l.pendingProps,T=g.revealOrder,R=g.tail;g=g.children;var D=wn.current,B=(D&2)!==0;if(B?(D=D&1|2,l.flags|=128):D&=1,fe(wn,D),oi(o,l,g,h),g=qt?Kl:0,!B&&o!==null&&(o.flags&128)!==0)e:for(o=l.child;o!==null;){if(o.tag===13)o.memoizedState!==null&&A_(o,h,l);else if(o.tag===19)A_(o,h,l);else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===l)break e;for(;o.sibling===null;){if(o.return===null||o.return===l)break e;o=o.return}o.sibling.return=o.return,o=o.sibling}switch(T){case"forwards":for(h=l.child,T=null;h!==null;)o=h.alternate,o!==null&&Rc(o)===null&&(T=h),h=h.sibling;h=T,h===null?(T=l.child,l.child=null):(T=h.sibling,h.sibling=null),pp(l,!1,T,h,R,g);break;case"backwards":case"unstable_legacy-backwards":for(h=null,T=l.child,l.child=null;T!==null;){if(o=T.alternate,o!==null&&Rc(o)===null){l.child=T;break}o=T.sibling,T.sibling=h,h=T,T=o}pp(l,!0,h,null,R,g);break;case"together":pp(l,!1,null,null,void 0,g);break;default:l.memoizedState=null}return l.child}function nr(o,l,h){if(o!==null&&(l.dependencies=o.dependencies),$r|=l.lanes,(h&l.childLanes)===0)if(o!==null){if(_a(o,l,h,!1),(h&l.childLanes)===0)return null}else return null;if(o!==null&&l.child!==o.child)throw Error(n(153));if(l.child!==null){for(o=l.child,h=Js(o,o.pendingProps),l.child=h,h.return=l;o.sibling!==null;)o=o.sibling,h=h.sibling=Js(o,o.pendingProps),h.return=l;h.sibling=null}return l.child}function mp(o,l){return(o.lanes&l)!==0?!0:(o=o.dependencies,!!(o!==null&&vc(o)))}function hI(o,l,h){switch(l.tag){case 3:pe(l,l.stateNode.containerInfo),Or(l,Fn,o.memoizedState.cache),Io();break;case 27:case 5:Ne(l);break;case 4:pe(l,l.stateNode.containerInfo);break;case 10:Or(l,l.type,l.memoizedProps.value);break;case 31:if(l.memoizedState!==null)return l.flags|=128,Gh(l),null;break;case 13:var g=l.memoizedState;if(g!==null)return g.dehydrated!==null?(Gr(l),l.flags|=128,null):(h&l.child.childLanes)!==0?x_(o,l,h):(Gr(l),o=nr(o,l,h),o!==null?o.sibling:null);Gr(l);break;case 19:var T=(o.flags&128)!==0;if(g=(h&l.childLanes)!==0,g||(_a(o,l,h,!1),g=(h&l.childLanes)!==0),T){if(g)return R_(o,l,h);l.flags|=128}if(T=l.memoizedState,T!==null&&(T.rendering=null,T.tail=null,T.lastEffect=null),fe(wn,wn.current),g)break;return null;case 22:return l.lanes=0,v_(o,l,h,l.pendingProps);case 24:Or(l,Fn,o.memoizedState.cache)}return nr(o,l,h)}function b_(o,l,h){if(o!==null)if(o.memoizedProps!==l.pendingProps)Bn=!0;else{if(!mp(o,h)&&(l.flags&128)===0)return Bn=!1,hI(o,l,h);Bn=(o.flags&131072)!==0}else Bn=!1,qt&&(l.flags&1048576)!==0&&sy(l,Kl,l.index);switch(l.lanes=0,l.tag){case 16:e:{var g=l.pendingProps;if(o=Po(l.elementType),l.type=o,typeof o=="function")Eh(o)?(g=Fo(o,g),l.tag=1,l=S_(null,l,o,g,h)):(l.tag=0,l=lp(null,l,o,g,h));else{if(o!=null){var T=o.$$typeof;if(T===C){l.tag=11,l=p_(null,l,o,g,h);break e}else if(T===w){l.tag=14,l=m_(null,l,o,g,h);break e}}throw l=ee(o)||o,Error(n(306,l,""))}}return l;case 0:return lp(o,l,l.type,l.pendingProps,h);case 1:return g=l.type,T=Fo(g,l.pendingProps),S_(o,l,g,T,h);case 3:e:{if(pe(l,l.stateNode.containerInfo),o===null)throw Error(n(387));g=l.pendingProps;var R=l.memoizedState;T=R.element,Uh(o,l),tu(l,g,null,h);var D=l.memoizedState;if(g=D.cache,Or(l,Fn,g),g!==R.cache&&Ih(l,[Fn],h,!0),eu(),g=D.element,R.isDehydrated)if(R={element:g,isDehydrated:!1,cache:D.cache},l.updateQueue.baseState=R,l.memoizedState=R,l.flags&256){l=T_(o,l,g,h);break e}else if(g!==T){T=is(Error(n(424)),l),Yl(T),l=T_(o,l,g,h);break e}else{switch(o=l.stateNode.containerInfo,o.nodeType){case 9:o=o.body;break;default:o=o.nodeName==="HTML"?o.ownerDocument.body:o}for(Tn=ls(o.firstChild),si=l,qt=!0,Nr=null,os=!0,h=vy(l,null,g,h),l.child=h;h;)h.flags=h.flags&-3|4096,h=h.sibling}else{if(Io(),g===T){l=nr(o,l,h);break e}oi(o,l,g,h)}l=l.child}return l;case 26:return Oc(o,l),o===null?(h=FE(l.type,null,l.pendingProps,null))?l.memoizedState=h:qt||(h=l.type,o=l.pendingProps,g=jc(ae.current).createElement(h),g[kt]=l,g[nn]=o,ai(g,h,o),te(g),l.stateNode=g):l.memoizedState=FE(l.type,o.memoizedProps,l.pendingProps,o.memoizedState),null;case 27:return Ne(l),o===null&&qt&&(g=l.stateNode=NE(l.type,l.pendingProps,ae.current),si=l,os=!0,T=Tn,Xr(l.type)?(Yp=T,Tn=ls(g.firstChild)):Tn=T),oi(o,l,l.pendingProps.children,h),Oc(o,l),o===null&&(l.flags|=4194304),l.child;case 5:return o===null&&qt&&((T=g=Tn)&&(g=zI(g,l.type,l.pendingProps,os),g!==null?(l.stateNode=g,si=l,Tn=ls(g.firstChild),os=!1,T=!0):T=!1),T||Ur(l)),Ne(l),T=l.type,R=l.pendingProps,D=o!==null?o.memoizedProps:null,g=R.children,zp(T,R)?g=null:D!==null&&zp(T,D)&&(l.flags|=32),l.memoizedState!==null&&(T=Hh(o,l,sI,null,null,h),Su._currentValue=T),Oc(o,l),oi(o,l,g,h),l.child;case 6:return o===null&&qt&&((o=h=Tn)&&(h=$I(h,l.pendingProps,os),h!==null?(l.stateNode=h,si=l,Tn=null,o=!0):o=!1),o||Ur(l)),null;case 13:return x_(o,l,h);case 4:return pe(l,l.stateNode.containerInfo),g=l.pendingProps,o===null?l.child=Uo(l,null,g,h):oi(o,l,g,h),l.child;case 11:return p_(o,l,l.type,l.pendingProps,h);case 7:return oi(o,l,l.pendingProps,h),l.child;case 8:return oi(o,l,l.pendingProps.children,h),l.child;case 12:return oi(o,l,l.pendingProps.children,h),l.child;case 10:return g=l.pendingProps,Or(l,l.type,g.value),oi(o,l,g.children,h),l.child;case 9:return T=l.type._context,g=l.pendingProps.children,Do(l),T=ri(T),g=g(T),l.flags|=1,oi(o,l,g,h),l.child;case 14:return m_(o,l,l.type,l.pendingProps,h);case 15:return g_(o,l,l.type,l.pendingProps,h);case 19:return R_(o,l,h);case 31:return dI(o,l,h);case 22:return v_(o,l,h,l.pendingProps);case 24:return Do(l),g=ri(Fn),o===null?(T=wh(),T===null&&(T=gn,R=Lh(),T.pooledCache=R,R.refCount++,R!==null&&(T.pooledCacheLanes|=h),T=R),l.memoizedState={parent:g,cache:T},Nh(l),Or(l,Fn,T)):((o.lanes&h)!==0&&(Uh(o,l),tu(l,null,null,h),eu()),T=o.memoizedState,R=l.memoizedState,T.parent!==g?(T={parent:g,cache:g},l.memoizedState=T,l.lanes===0&&(l.memoizedState=l.updateQueue.baseState=T),Or(l,Fn,g)):(g=R.cache,Or(l,Fn,g),g!==T.cache&&Ih(l,[Fn],h,!0))),oi(o,l,l.pendingProps.children,h),l.child;case 29:throw l.pendingProps}throw Error(n(156,l.tag))}function ir(o){o.flags|=4}function gp(o,l,h,g,T){if((l=(o.mode&32)!==0)&&(l=!1),l){if(o.flags|=16777216,(T&335544128)===T)if(o.stateNode.complete)o.flags|=8192;else if(j_())o.flags|=8192;else throw No=Sc,Ph}else o.flags&=-16777217}function M_(o,l){if(l.type!=="stylesheet"||(l.state.loading&4)!==0)o.flags&=-16777217;else if(o.flags|=16777216,!HE(l))if(j_())o.flags|=8192;else throw No=Sc,Ph}function kc(o,l){l!==null&&(o.flags|=4),o.flags&16384&&(l=o.tag!==22?Dn():536870912,o.lanes|=l,Da|=l)}function au(o,l){if(!qt)switch(o.tailMode){case"hidden":l=o.tail;for(var h=null;l!==null;)l.alternate!==null&&(h=l),l=l.sibling;h===null?o.tail=null:h.sibling=null;break;case"collapsed":h=o.tail;for(var g=null;h!==null;)h.alternate!==null&&(g=h),h=h.sibling;g===null?l||o.tail===null?o.tail=null:o.tail.sibling=null:g.sibling=null}}function xn(o){var l=o.alternate!==null&&o.alternate.child===o.child,h=0,g=0;if(l)for(var T=o.child;T!==null;)h|=T.lanes|T.childLanes,g|=T.subtreeFlags&65011712,g|=T.flags&65011712,T.return=o,T=T.sibling;else for(T=o.child;T!==null;)h|=T.lanes|T.childLanes,g|=T.subtreeFlags,g|=T.flags,T.return=o,T=T.sibling;return o.subtreeFlags|=g,o.childLanes=h,l}function pI(o,l,h){var g=l.pendingProps;switch(Ah(l),l.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return xn(l),null;case 1:return xn(l),null;case 3:return h=l.stateNode,g=null,o!==null&&(g=o.memoizedState.cache),l.memoizedState.cache!==g&&(l.flags|=2048),js(Fn),Ae(),h.pendingContext&&(h.context=h.pendingContext,h.pendingContext=null),(o===null||o.child===null)&&(ya(l)?ir(l):o===null||o.memoizedState.isDehydrated&&(l.flags&256)===0||(l.flags|=1024,bh())),xn(l),null;case 26:var T=l.type,R=l.memoizedState;return o===null?(ir(l),R!==null?(xn(l),M_(l,R)):(xn(l),gp(l,T,null,g,h))):R?R!==o.memoizedState?(ir(l),xn(l),M_(l,R)):(xn(l),l.flags&=-16777217):(o=o.memoizedProps,o!==g&&ir(l),xn(l),gp(l,T,o,g,h)),null;case 27:if(je(l),h=ae.current,T=l.type,o!==null&&l.stateNode!=null)o.memoizedProps!==g&&ir(l);else{if(!g){if(l.stateNode===null)throw Error(n(166));return xn(l),null}o=Q.current,ya(l)?oy(l):(o=NE(T,g,h),l.stateNode=o,ir(l))}return xn(l),null;case 5:if(je(l),T=l.type,o!==null&&l.stateNode!=null)o.memoizedProps!==g&&ir(l);else{if(!g){if(l.stateNode===null)throw Error(n(166));return xn(l),null}if(R=Q.current,ya(l))oy(l);else{var D=jc(ae.current);switch(R){case 1:R=D.createElementNS("http://www.w3.org/2000/svg",T);break;case 2:R=D.createElementNS("http://www.w3.org/1998/Math/MathML",T);break;default:switch(T){case"svg":R=D.createElementNS("http://www.w3.org/2000/svg",T);break;case"math":R=D.createElementNS("http://www.w3.org/1998/Math/MathML",T);break;case"script":R=D.createElement("div"),R.innerHTML="<script><\/script>",R=R.removeChild(R.firstChild);break;case"select":R=typeof g.is=="string"?D.createElement("select",{is:g.is}):D.createElement("select"),g.multiple?R.multiple=!0:g.size&&(R.size=g.size);break;default:R=typeof g.is=="string"?D.createElement(T,{is:g.is}):D.createElement(T)}}R[kt]=l,R[nn]=g;e:for(D=l.child;D!==null;){if(D.tag===5||D.tag===6)R.appendChild(D.stateNode);else if(D.tag!==4&&D.tag!==27&&D.child!==null){D.child.return=D,D=D.child;continue}if(D===l)break e;for(;D.sibling===null;){if(D.return===null||D.return===l)break e;D=D.return}D.sibling.return=D.return,D=D.sibling}l.stateNode=R;e:switch(ai(R,T,g),T){case"button":case"input":case"select":case"textarea":g=!!g.autoFocus;break e;case"img":g=!0;break e;default:g=!1}g&&ir(l)}}return xn(l),gp(l,l.type,o===null?null:o.memoizedProps,l.pendingProps,h),null;case 6:if(o&&l.stateNode!=null)o.memoizedProps!==g&&ir(l);else{if(typeof g!="string"&&l.stateNode===null)throw Error(n(166));if(o=ae.current,ya(l)){if(o=l.stateNode,h=l.memoizedProps,g=null,T=si,T!==null)switch(T.tag){case 27:case 5:g=T.memoizedProps}o[kt]=l,o=!!(o.nodeValue===h||g!==null&&g.suppressHydrationWarning===!0||xE(o.nodeValue,h)),o||Ur(l,!0)}else o=jc(o).createTextNode(g),o[kt]=l,l.stateNode=o}return xn(l),null;case 31:if(h=l.memoizedState,o===null||o.memoizedState!==null){if(g=ya(l),h!==null){if(o===null){if(!g)throw Error(n(318));if(o=l.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(n(557));o[kt]=l}else Io(),(l.flags&128)===0&&(l.memoizedState=null),l.flags|=4;xn(l),o=!1}else h=bh(),o!==null&&o.memoizedState!==null&&(o.memoizedState.hydrationErrors=h),o=!0;if(!o)return l.flags&256?(Hi(l),l):(Hi(l),null);if((l.flags&128)!==0)throw Error(n(558))}return xn(l),null;case 13:if(g=l.memoizedState,o===null||o.memoizedState!==null&&o.memoizedState.dehydrated!==null){if(T=ya(l),g!==null&&g.dehydrated!==null){if(o===null){if(!T)throw Error(n(318));if(T=l.memoizedState,T=T!==null?T.dehydrated:null,!T)throw Error(n(317));T[kt]=l}else Io(),(l.flags&128)===0&&(l.memoizedState=null),l.flags|=4;xn(l),T=!1}else T=bh(),o!==null&&o.memoizedState!==null&&(o.memoizedState.hydrationErrors=T),T=!0;if(!T)return l.flags&256?(Hi(l),l):(Hi(l),null)}return Hi(l),(l.flags&128)!==0?(l.lanes=h,l):(h=g!==null,o=o!==null&&o.memoizedState!==null,h&&(g=l.child,T=null,g.alternate!==null&&g.alternate.memoizedState!==null&&g.alternate.memoizedState.cachePool!==null&&(T=g.alternate.memoizedState.cachePool.pool),R=null,g.memoizedState!==null&&g.memoizedState.cachePool!==null&&(R=g.memoizedState.cachePool.pool),R!==T&&(g.flags|=2048)),h!==o&&h&&(l.child.flags|=8192),kc(l,l.updateQueue),xn(l),null);case 4:return Ae(),o===null&&kp(l.stateNode.containerInfo),xn(l),null;case 10:return js(l.type),xn(l),null;case 19:if(K(wn),g=l.memoizedState,g===null)return xn(l),null;if(T=(l.flags&128)!==0,R=g.rendering,R===null)if(T)au(g,!1);else{if(In!==0||o!==null&&(o.flags&128)!==0)for(o=l.child;o!==null;){if(R=Rc(o),R!==null){for(l.flags|=128,au(g,!1),o=R.updateQueue,l.updateQueue=o,kc(l,o),l.subtreeFlags=0,o=h,h=l.child;h!==null;)ty(h,o),h=h.sibling;return fe(wn,wn.current&1|2),qt&&Qs(l,g.treeForkCount),l.child}o=o.sibling}g.tail!==null&&Re()>zc&&(l.flags|=128,T=!0,au(g,!1),l.lanes=4194304)}else{if(!T)if(o=Rc(R),o!==null){if(l.flags|=128,T=!0,o=o.updateQueue,l.updateQueue=o,kc(l,o),au(g,!0),g.tail===null&&g.tailMode==="hidden"&&!R.alternate&&!qt)return xn(l),null}else 2*Re()-g.renderingStartTime>zc&&h!==536870912&&(l.flags|=128,T=!0,au(g,!1),l.lanes=4194304);g.isBackwards?(R.sibling=l.child,l.child=R):(o=g.last,o!==null?o.sibling=R:l.child=R,g.last=R)}return g.tail!==null?(o=g.tail,g.rendering=o,g.tail=o.sibling,g.renderingStartTime=Re(),o.sibling=null,h=wn.current,fe(wn,T?h&1|2:h&1),qt&&Qs(l,g.treeForkCount),o):(xn(l),null);case 22:case 23:return Hi(l),Bh(),g=l.memoizedState!==null,o!==null?o.memoizedState!==null!==g&&(l.flags|=8192):g&&(l.flags|=8192),g?(h&536870912)!==0&&(l.flags&128)===0&&(xn(l),l.subtreeFlags&6&&(l.flags|=8192)):xn(l),h=l.updateQueue,h!==null&&kc(l,h.retryQueue),h=null,o!==null&&o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(h=o.memoizedState.cachePool.pool),g=null,l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(g=l.memoizedState.cachePool.pool),g!==h&&(l.flags|=2048),o!==null&&K(wo),null;case 24:return h=null,o!==null&&(h=o.memoizedState.cache),l.memoizedState.cache!==h&&(l.flags|=2048),js(Fn),xn(l),null;case 25:return null;case 30:return null}throw Error(n(156,l.tag))}function mI(o,l){switch(Ah(l),l.tag){case 1:return o=l.flags,o&65536?(l.flags=o&-65537|128,l):null;case 3:return js(Fn),Ae(),o=l.flags,(o&65536)!==0&&(o&128)===0?(l.flags=o&-65537|128,l):null;case 26:case 27:case 5:return je(l),null;case 31:if(l.memoizedState!==null){if(Hi(l),l.alternate===null)throw Error(n(340));Io()}return o=l.flags,o&65536?(l.flags=o&-65537|128,l):null;case 13:if(Hi(l),o=l.memoizedState,o!==null&&o.dehydrated!==null){if(l.alternate===null)throw Error(n(340));Io()}return o=l.flags,o&65536?(l.flags=o&-65537|128,l):null;case 19:return K(wn),null;case 4:return Ae(),null;case 10:return js(l.type),null;case 22:case 23:return Hi(l),Bh(),o!==null&&K(wo),o=l.flags,o&65536?(l.flags=o&-65537|128,l):null;case 24:return js(Fn),null;case 25:return null;default:return null}}function C_(o,l){switch(Ah(l),l.tag){case 3:js(Fn),Ae();break;case 26:case 27:case 5:je(l);break;case 4:Ae();break;case 31:l.memoizedState!==null&&Hi(l);break;case 13:Hi(l);break;case 19:K(wn);break;case 10:js(l.type);break;case 22:case 23:Hi(l),Bh(),o!==null&&K(wo);break;case 24:js(Fn)}}function lu(o,l){try{var h=l.updateQueue,g=h!==null?h.lastEffect:null;if(g!==null){var T=g.next;h=T;do{if((h.tag&o)===o){g=void 0;var R=h.create,D=h.inst;g=R(),D.destroy=g}h=h.next}while(h!==T)}}catch(B){rn(l,l.return,B)}}function Hr(o,l,h){try{var g=l.updateQueue,T=g!==null?g.lastEffect:null;if(T!==null){var R=T.next;g=R;do{if((g.tag&o)===o){var D=g.inst,B=D.destroy;if(B!==void 0){D.destroy=void 0,T=l;var Z=h,ge=B;try{ge()}catch(Me){rn(T,Z,Me)}}}g=g.next}while(g!==R)}}catch(Me){rn(l,l.return,Me)}}function I_(o){var l=o.updateQueue;if(l!==null){var h=o.stateNode;try{_y(l,h)}catch(g){rn(o,o.return,g)}}}function L_(o,l,h){h.props=Fo(o.type,o.memoizedProps),h.state=o.memoizedState;try{h.componentWillUnmount()}catch(g){rn(o,l,g)}}function uu(o,l){try{var h=o.ref;if(h!==null){switch(o.tag){case 26:case 27:case 5:var g=o.stateNode;break;case 30:g=o.stateNode;break;default:g=o.stateNode}typeof h=="function"?o.refCleanup=h(g):h.current=g}}catch(T){rn(o,l,T)}}function Ps(o,l){var h=o.ref,g=o.refCleanup;if(h!==null)if(typeof g=="function")try{g()}catch(T){rn(o,l,T)}finally{o.refCleanup=null,o=o.alternate,o!=null&&(o.refCleanup=null)}else if(typeof h=="function")try{h(null)}catch(T){rn(o,l,T)}else h.current=null}function D_(o){var l=o.type,h=o.memoizedProps,g=o.stateNode;try{e:switch(l){case"button":case"input":case"select":case"textarea":h.autoFocus&&g.focus();break e;case"img":h.src?g.src=h.src:h.srcSet&&(g.srcset=h.srcSet)}}catch(T){rn(o,o.return,T)}}function vp(o,l,h){try{var g=o.stateNode;FI(g,o.type,h,l),g[nn]=l}catch(T){rn(o,o.return,T)}}function w_(o){return o.tag===5||o.tag===3||o.tag===26||o.tag===27&&Xr(o.type)||o.tag===4}function yp(o){e:for(;;){for(;o.sibling===null;){if(o.return===null||w_(o.return))return null;o=o.return}for(o.sibling.return=o.return,o=o.sibling;o.tag!==5&&o.tag!==6&&o.tag!==18;){if(o.tag===27&&Xr(o.type)||o.flags&2||o.child===null||o.tag===4)continue e;o.child.return=o,o=o.child}if(!(o.flags&2))return o.stateNode}}function _p(o,l,h){var g=o.tag;if(g===5||g===6)o=o.stateNode,l?(h.nodeType===9?h.body:h.nodeName==="HTML"?h.ownerDocument.body:h).insertBefore(o,l):(l=h.nodeType===9?h.body:h.nodeName==="HTML"?h.ownerDocument.body:h,l.appendChild(o),h=h._reactRootContainer,h!=null||l.onclick!==null||(l.onclick=Ys));else if(g!==4&&(g===27&&Xr(o.type)&&(h=o.stateNode,l=null),o=o.child,o!==null))for(_p(o,l,h),o=o.sibling;o!==null;)_p(o,l,h),o=o.sibling}function Bc(o,l,h){var g=o.tag;if(g===5||g===6)o=o.stateNode,l?h.insertBefore(o,l):h.appendChild(o);else if(g!==4&&(g===27&&Xr(o.type)&&(h=o.stateNode),o=o.child,o!==null))for(Bc(o,l,h),o=o.sibling;o!==null;)Bc(o,l,h),o=o.sibling}function P_(o){var l=o.stateNode,h=o.memoizedProps;try{for(var g=o.type,T=l.attributes;T.length;)l.removeAttributeNode(T[0]);ai(l,g,h),l[kt]=o,l[nn]=h}catch(R){rn(o,o.return,R)}}var sr=!1,Gn=!1,Ep=!1,N_=typeof WeakSet=="function"?WeakSet:Set,jn=null;function gI(o,l){if(o=o.containerInfo,Vp=af,o=Wv(o),hh(o)){if("selectionStart"in o)var h={start:o.selectionStart,end:o.selectionEnd};else e:{h=(h=o.ownerDocument)&&h.defaultView||window;var g=h.getSelection&&h.getSelection();if(g&&g.rangeCount!==0){h=g.anchorNode;var T=g.anchorOffset,R=g.focusNode;g=g.focusOffset;try{h.nodeType,R.nodeType}catch{h=null;break e}var D=0,B=-1,Z=-1,ge=0,Me=0,De=o,ve=null;t:for(;;){for(var Se;De!==h||T!==0&&De.nodeType!==3||(B=D+T),De!==R||g!==0&&De.nodeType!==3||(Z=D+g),De.nodeType===3&&(D+=De.nodeValue.length),(Se=De.firstChild)!==null;)ve=De,De=Se;for(;;){if(De===o)break t;if(ve===h&&++ge===T&&(B=D),ve===R&&++Me===g&&(Z=D),(Se=De.nextSibling)!==null)break;De=ve,ve=De.parentNode}De=Se}h=B===-1||Z===-1?null:{start:B,end:Z}}else h=null}h=h||{start:0,end:0}}else h=null;for(Hp={focusedElem:o,selectionRange:h},af=!1,jn=l;jn!==null;)if(l=jn,o=l.child,(l.subtreeFlags&1028)!==0&&o!==null)o.return=l,jn=o;else for(;jn!==null;){switch(l=jn,R=l.alternate,o=l.flags,l.tag){case 0:if((o&4)!==0&&(o=l.updateQueue,o=o!==null?o.events:null,o!==null))for(h=0;h<o.length;h++)T=o[h],T.ref.impl=T.nextImpl;break;case 11:case 15:break;case 1:if((o&1024)!==0&&R!==null){o=void 0,h=l,T=R.memoizedProps,R=R.memoizedState,g=h.stateNode;try{var it=Fo(h.type,T);o=g.getSnapshotBeforeUpdate(it,R),g.__reactInternalSnapshotBeforeUpdate=o}catch(mt){rn(h,h.return,mt)}}break;case 3:if((o&1024)!==0){if(o=l.stateNode.containerInfo,h=o.nodeType,h===9)qp(o);else if(h===1)switch(o.nodeName){case"HEAD":case"HTML":case"BODY":qp(o);break;default:o.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((o&1024)!==0)throw Error(n(163))}if(o=l.sibling,o!==null){o.return=l.return,jn=o;break}jn=l.return}}function U_(o,l,h){var g=h.flags;switch(h.tag){case 0:case 11:case 15:or(o,h),g&4&&lu(5,h);break;case 1:if(or(o,h),g&4)if(o=h.stateNode,l===null)try{o.componentDidMount()}catch(D){rn(h,h.return,D)}else{var T=Fo(h.type,l.memoizedProps);l=l.memoizedState;try{o.componentDidUpdate(T,l,o.__reactInternalSnapshotBeforeUpdate)}catch(D){rn(h,h.return,D)}}g&64&&I_(h),g&512&&uu(h,h.return);break;case 3:if(or(o,h),g&64&&(o=h.updateQueue,o!==null)){if(l=null,h.child!==null)switch(h.child.tag){case 27:case 5:l=h.child.stateNode;break;case 1:l=h.child.stateNode}try{_y(o,l)}catch(D){rn(h,h.return,D)}}break;case 27:l===null&&g&4&&P_(h);case 26:case 5:or(o,h),l===null&&g&4&&D_(h),g&512&&uu(h,h.return);break;case 12:or(o,h);break;case 31:or(o,h),g&4&&k_(o,h);break;case 13:or(o,h),g&4&&B_(o,h),g&64&&(o=h.memoizedState,o!==null&&(o=o.dehydrated,o!==null&&(h=RI.bind(null,h),qI(o,h))));break;case 22:if(g=h.memoizedState!==null||sr,!g){l=l!==null&&l.memoizedState!==null||Gn,T=sr;var R=Gn;sr=g,(Gn=l)&&!R?ar(o,h,(h.subtreeFlags&8772)!==0):or(o,h),sr=T,Gn=R}break;case 30:break;default:or(o,h)}}function O_(o){var l=o.alternate;l!==null&&(o.alternate=null,O_(l)),o.child=null,o.deletions=null,o.sibling=null,o.tag===5&&(l=o.stateNode,l!==null&&Fl(l)),o.stateNode=null,o.return=null,o.dependencies=null,o.memoizedProps=null,o.memoizedState=null,o.pendingProps=null,o.stateNode=null,o.updateQueue=null}var An=null,Ii=!1;function rr(o,l,h){for(h=h.child;h!==null;)F_(o,l,h),h=h.sibling}function F_(o,l,h){if(ot&&typeof ot.onCommitFiberUnmount=="function")try{ot.onCommitFiberUnmount(st,h)}catch{}switch(h.tag){case 26:Gn||Ps(h,l),rr(o,l,h),h.memoizedState?h.memoizedState.count--:h.stateNode&&(h=h.stateNode,h.parentNode.removeChild(h));break;case 27:Gn||Ps(h,l);var g=An,T=Ii;Xr(h.type)&&(An=h.stateNode,Ii=!1),rr(o,l,h),yu(h.stateNode),An=g,Ii=T;break;case 5:Gn||Ps(h,l);case 6:if(g=An,T=Ii,An=null,rr(o,l,h),An=g,Ii=T,An!==null)if(Ii)try{(An.nodeType===9?An.body:An.nodeName==="HTML"?An.ownerDocument.body:An).removeChild(h.stateNode)}catch(R){rn(h,l,R)}else try{An.removeChild(h.stateNode)}catch(R){rn(h,l,R)}break;case 18:An!==null&&(Ii?(o=An,IE(o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o,h.stateNode),Ba(o)):IE(An,h.stateNode));break;case 4:g=An,T=Ii,An=h.stateNode.containerInfo,Ii=!0,rr(o,l,h),An=g,Ii=T;break;case 0:case 11:case 14:case 15:Hr(2,h,l),Gn||Hr(4,h,l),rr(o,l,h);break;case 1:Gn||(Ps(h,l),g=h.stateNode,typeof g.componentWillUnmount=="function"&&L_(h,l,g)),rr(o,l,h);break;case 21:rr(o,l,h);break;case 22:Gn=(g=Gn)||h.memoizedState!==null,rr(o,l,h),Gn=g;break;default:rr(o,l,h)}}function k_(o,l){if(l.memoizedState===null&&(o=l.alternate,o!==null&&(o=o.memoizedState,o!==null))){o=o.dehydrated;try{Ba(o)}catch(h){rn(l,l.return,h)}}}function B_(o,l){if(l.memoizedState===null&&(o=l.alternate,o!==null&&(o=o.memoizedState,o!==null&&(o=o.dehydrated,o!==null))))try{Ba(o)}catch(h){rn(l,l.return,h)}}function vI(o){switch(o.tag){case 31:case 13:case 19:var l=o.stateNode;return l===null&&(l=o.stateNode=new N_),l;case 22:return o=o.stateNode,l=o._retryCache,l===null&&(l=o._retryCache=new N_),l;default:throw Error(n(435,o.tag))}}function Gc(o,l){var h=vI(o);l.forEach(function(g){if(!h.has(g)){h.add(g);var T=bI.bind(null,o,g);g.then(T,T)}})}function Li(o,l){var h=l.deletions;if(h!==null)for(var g=0;g<h.length;g++){var T=h[g],R=o,D=l,B=D;e:for(;B!==null;){switch(B.tag){case 27:if(Xr(B.type)){An=B.stateNode,Ii=!1;break e}break;case 5:An=B.stateNode,Ii=!1;break e;case 3:case 4:An=B.stateNode.containerInfo,Ii=!0;break e}B=B.return}if(An===null)throw Error(n(160));F_(R,D,T),An=null,Ii=!1,R=T.alternate,R!==null&&(R.return=null),T.return=null}if(l.subtreeFlags&13886)for(l=l.child;l!==null;)G_(l,o),l=l.sibling}var ys=null;function G_(o,l){var h=o.alternate,g=o.flags;switch(o.tag){case 0:case 11:case 14:case 15:Li(l,o),Di(o),g&4&&(Hr(3,o,o.return),lu(3,o),Hr(5,o,o.return));break;case 1:Li(l,o),Di(o),g&512&&(Gn||h===null||Ps(h,h.return)),g&64&&sr&&(o=o.updateQueue,o!==null&&(g=o.callbacks,g!==null&&(h=o.shared.hiddenCallbacks,o.shared.hiddenCallbacks=h===null?g:h.concat(g))));break;case 26:var T=ys;if(Li(l,o),Di(o),g&512&&(Gn||h===null||Ps(h,h.return)),g&4){var R=h!==null?h.memoizedState:null;if(g=o.memoizedState,h===null)if(g===null)if(o.stateNode===null){e:{g=o.type,h=o.memoizedProps,T=T.ownerDocument||T;t:switch(g){case"title":R=T.getElementsByTagName("title")[0],(!R||R[xo]||R[kt]||R.namespaceURI==="http://www.w3.org/2000/svg"||R.hasAttribute("itemprop"))&&(R=T.createElement(g),T.head.insertBefore(R,T.querySelector("head > title"))),ai(R,g,h),R[kt]=o,te(R),g=R;break e;case"link":var D=GE("link","href",T).get(g+(h.href||""));if(D){for(var B=0;B<D.length;B++)if(R=D[B],R.getAttribute("href")===(h.href==null||h.href===""?null:h.href)&&R.getAttribute("rel")===(h.rel==null?null:h.rel)&&R.getAttribute("title")===(h.title==null?null:h.title)&&R.getAttribute("crossorigin")===(h.crossOrigin==null?null:h.crossOrigin)){D.splice(B,1);break t}}R=T.createElement(g),ai(R,g,h),T.head.appendChild(R);break;case"meta":if(D=GE("meta","content",T).get(g+(h.content||""))){for(B=0;B<D.length;B++)if(R=D[B],R.getAttribute("content")===(h.content==null?null:""+h.content)&&R.getAttribute("name")===(h.name==null?null:h.name)&&R.getAttribute("property")===(h.property==null?null:h.property)&&R.getAttribute("http-equiv")===(h.httpEquiv==null?null:h.httpEquiv)&&R.getAttribute("charset")===(h.charSet==null?null:h.charSet)){D.splice(B,1);break t}}R=T.createElement(g),ai(R,g,h),T.head.appendChild(R);break;default:throw Error(n(468,g))}R[kt]=o,te(R),g=R}o.stateNode=g}else VE(T,o.type,o.stateNode);else o.stateNode=BE(T,g,o.memoizedProps);else R!==g?(R===null?h.stateNode!==null&&(h=h.stateNode,h.parentNode.removeChild(h)):R.count--,g===null?VE(T,o.type,o.stateNode):BE(T,g,o.memoizedProps)):g===null&&o.stateNode!==null&&vp(o,o.memoizedProps,h.memoizedProps)}break;case 27:Li(l,o),Di(o),g&512&&(Gn||h===null||Ps(h,h.return)),h!==null&&g&4&&vp(o,o.memoizedProps,h.memoizedProps);break;case 5:if(Li(l,o),Di(o),g&512&&(Gn||h===null||Ps(h,h.return)),o.flags&32){T=o.stateNode;try{Mi(T,"")}catch(it){rn(o,o.return,it)}}g&4&&o.stateNode!=null&&(T=o.memoizedProps,vp(o,T,h!==null?h.memoizedProps:T)),g&1024&&(Ep=!0);break;case 6:if(Li(l,o),Di(o),g&4){if(o.stateNode===null)throw Error(n(162));g=o.memoizedProps,h=o.stateNode;try{h.nodeValue=g}catch(it){rn(o,o.return,it)}}break;case 3:if(nf=null,T=ys,ys=ef(l.containerInfo),Li(l,o),ys=T,Di(o),g&4&&h!==null&&h.memoizedState.isDehydrated)try{Ba(l.containerInfo)}catch(it){rn(o,o.return,it)}Ep&&(Ep=!1,V_(o));break;case 4:g=ys,ys=ef(o.stateNode.containerInfo),Li(l,o),Di(o),ys=g;break;case 12:Li(l,o),Di(o);break;case 31:Li(l,o),Di(o),g&4&&(g=o.updateQueue,g!==null&&(o.updateQueue=null,Gc(o,g)));break;case 13:Li(l,o),Di(o),o.child.flags&8192&&o.memoizedState!==null!=(h!==null&&h.memoizedState!==null)&&(Hc=Re()),g&4&&(g=o.updateQueue,g!==null&&(o.updateQueue=null,Gc(o,g)));break;case 22:T=o.memoizedState!==null;var Z=h!==null&&h.memoizedState!==null,ge=sr,Me=Gn;if(sr=ge||T,Gn=Me||Z,Li(l,o),Gn=Me,sr=ge,Di(o),g&8192)e:for(l=o.stateNode,l._visibility=T?l._visibility&-2:l._visibility|1,T&&(h===null||Z||sr||Gn||ko(o)),h=null,l=o;;){if(l.tag===5||l.tag===26){if(h===null){Z=h=l;try{if(R=Z.stateNode,T)D=R.style,typeof D.setProperty=="function"?D.setProperty("display","none","important"):D.display="none";else{B=Z.stateNode;var De=Z.memoizedProps.style,ve=De!=null&&De.hasOwnProperty("display")?De.display:null;B.style.display=ve==null||typeof ve=="boolean"?"":(""+ve).trim()}}catch(it){rn(Z,Z.return,it)}}}else if(l.tag===6){if(h===null){Z=l;try{Z.stateNode.nodeValue=T?"":Z.memoizedProps}catch(it){rn(Z,Z.return,it)}}}else if(l.tag===18){if(h===null){Z=l;try{var Se=Z.stateNode;T?LE(Se,!0):LE(Z.stateNode,!1)}catch(it){rn(Z,Z.return,it)}}}else if((l.tag!==22&&l.tag!==23||l.memoizedState===null||l===o)&&l.child!==null){l.child.return=l,l=l.child;continue}if(l===o)break e;for(;l.sibling===null;){if(l.return===null||l.return===o)break e;h===l&&(h=null),l=l.return}h===l&&(h=null),l.sibling.return=l.return,l=l.sibling}g&4&&(g=o.updateQueue,g!==null&&(h=g.retryQueue,h!==null&&(g.retryQueue=null,Gc(o,h))));break;case 19:Li(l,o),Di(o),g&4&&(g=o.updateQueue,g!==null&&(o.updateQueue=null,Gc(o,g)));break;case 30:break;case 21:break;default:Li(l,o),Di(o)}}function Di(o){var l=o.flags;if(l&2){try{for(var h,g=o.return;g!==null;){if(w_(g)){h=g;break}g=g.return}if(h==null)throw Error(n(160));switch(h.tag){case 27:var T=h.stateNode,R=yp(o);Bc(o,R,T);break;case 5:var D=h.stateNode;h.flags&32&&(Mi(D,""),h.flags&=-33);var B=yp(o);Bc(o,B,D);break;case 3:case 4:var Z=h.stateNode.containerInfo,ge=yp(o);_p(o,ge,Z);break;default:throw Error(n(161))}}catch(Me){rn(o,o.return,Me)}o.flags&=-3}l&4096&&(o.flags&=-4097)}function V_(o){if(o.subtreeFlags&1024)for(o=o.child;o!==null;){var l=o;V_(l),l.tag===5&&l.flags&1024&&l.stateNode.reset(),o=o.sibling}}function or(o,l){if(l.subtreeFlags&8772)for(l=l.child;l!==null;)U_(o,l.alternate,l),l=l.sibling}function ko(o){for(o=o.child;o!==null;){var l=o;switch(l.tag){case 0:case 11:case 14:case 15:Hr(4,l,l.return),ko(l);break;case 1:Ps(l,l.return);var h=l.stateNode;typeof h.componentWillUnmount=="function"&&L_(l,l.return,h),ko(l);break;case 27:yu(l.stateNode);case 26:case 5:Ps(l,l.return),ko(l);break;case 22:l.memoizedState===null&&ko(l);break;case 30:ko(l);break;default:ko(l)}o=o.sibling}}function ar(o,l,h){for(h=h&&(l.subtreeFlags&8772)!==0,l=l.child;l!==null;){var g=l.alternate,T=o,R=l,D=R.flags;switch(R.tag){case 0:case 11:case 15:ar(T,R,h),lu(4,R);break;case 1:if(ar(T,R,h),g=R,T=g.stateNode,typeof T.componentDidMount=="function")try{T.componentDidMount()}catch(ge){rn(g,g.return,ge)}if(g=R,T=g.updateQueue,T!==null){var B=g.stateNode;try{var Z=T.shared.hiddenCallbacks;if(Z!==null)for(T.shared.hiddenCallbacks=null,T=0;T<Z.length;T++)yy(Z[T],B)}catch(ge){rn(g,g.return,ge)}}h&&D&64&&I_(R),uu(R,R.return);break;case 27:P_(R);case 26:case 5:ar(T,R,h),h&&g===null&&D&4&&D_(R),uu(R,R.return);break;case 12:ar(T,R,h);break;case 31:ar(T,R,h),h&&D&4&&k_(T,R);break;case 13:ar(T,R,h),h&&D&4&&B_(T,R);break;case 22:R.memoizedState===null&&ar(T,R,h),uu(R,R.return);break;case 30:break;default:ar(T,R,h)}l=l.sibling}}function Sp(o,l){var h=null;o!==null&&o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(h=o.memoizedState.cachePool.pool),o=null,l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(o=l.memoizedState.cachePool.pool),o!==h&&(o!=null&&o.refCount++,h!=null&&Xl(h))}function Tp(o,l){o=null,l.alternate!==null&&(o=l.alternate.memoizedState.cache),l=l.memoizedState.cache,l!==o&&(l.refCount++,o!=null&&Xl(o))}function _s(o,l,h,g){if(l.subtreeFlags&10256)for(l=l.child;l!==null;)H_(o,l,h,g),l=l.sibling}function H_(o,l,h,g){var T=l.flags;switch(l.tag){case 0:case 11:case 15:_s(o,l,h,g),T&2048&&lu(9,l);break;case 1:_s(o,l,h,g);break;case 3:_s(o,l,h,g),T&2048&&(o=null,l.alternate!==null&&(o=l.alternate.memoizedState.cache),l=l.memoizedState.cache,l!==o&&(l.refCount++,o!=null&&Xl(o)));break;case 12:if(T&2048){_s(o,l,h,g),o=l.stateNode;try{var R=l.memoizedProps,D=R.id,B=R.onPostCommit;typeof B=="function"&&B(D,l.alternate===null?"mount":"update",o.passiveEffectDuration,-0)}catch(Z){rn(l,l.return,Z)}}else _s(o,l,h,g);break;case 31:_s(o,l,h,g);break;case 13:_s(o,l,h,g);break;case 23:break;case 22:R=l.stateNode,D=l.alternate,l.memoizedState!==null?R._visibility&2?_s(o,l,h,g):cu(o,l):R._visibility&2?_s(o,l,h,g):(R._visibility|=2,Ca(o,l,h,g,(l.subtreeFlags&10256)!==0||!1)),T&2048&&Sp(D,l);break;case 24:_s(o,l,h,g),T&2048&&Tp(l.alternate,l);break;default:_s(o,l,h,g)}}function Ca(o,l,h,g,T){for(T=T&&((l.subtreeFlags&10256)!==0||!1),l=l.child;l!==null;){var R=o,D=l,B=h,Z=g,ge=D.flags;switch(D.tag){case 0:case 11:case 15:Ca(R,D,B,Z,T),lu(8,D);break;case 23:break;case 22:var Me=D.stateNode;D.memoizedState!==null?Me._visibility&2?Ca(R,D,B,Z,T):cu(R,D):(Me._visibility|=2,Ca(R,D,B,Z,T)),T&&ge&2048&&Sp(D.alternate,D);break;case 24:Ca(R,D,B,Z,T),T&&ge&2048&&Tp(D.alternate,D);break;default:Ca(R,D,B,Z,T)}l=l.sibling}}function cu(o,l){if(l.subtreeFlags&10256)for(l=l.child;l!==null;){var h=o,g=l,T=g.flags;switch(g.tag){case 22:cu(h,g),T&2048&&Sp(g.alternate,g);break;case 24:cu(h,g),T&2048&&Tp(g.alternate,g);break;default:cu(h,g)}l=l.sibling}}var fu=8192;function Ia(o,l,h){if(o.subtreeFlags&fu)for(o=o.child;o!==null;)z_(o,l,h),o=o.sibling}function z_(o,l,h){switch(o.tag){case 26:Ia(o,l,h),o.flags&fu&&o.memoizedState!==null&&iL(h,ys,o.memoizedState,o.memoizedProps);break;case 5:Ia(o,l,h);break;case 3:case 4:var g=ys;ys=ef(o.stateNode.containerInfo),Ia(o,l,h),ys=g;break;case 22:o.memoizedState===null&&(g=o.alternate,g!==null&&g.memoizedState!==null?(g=fu,fu=16777216,Ia(o,l,h),fu=g):Ia(o,l,h));break;default:Ia(o,l,h)}}function $_(o){var l=o.alternate;if(l!==null&&(o=l.child,o!==null)){l.child=null;do l=o.sibling,o.sibling=null,o=l;while(o!==null)}}function du(o){var l=o.deletions;if((o.flags&16)!==0){if(l!==null)for(var h=0;h<l.length;h++){var g=l[h];jn=g,W_(g,o)}$_(o)}if(o.subtreeFlags&10256)for(o=o.child;o!==null;)q_(o),o=o.sibling}function q_(o){switch(o.tag){case 0:case 11:case 15:du(o),o.flags&2048&&Hr(9,o,o.return);break;case 3:du(o);break;case 12:du(o);break;case 22:var l=o.stateNode;o.memoizedState!==null&&l._visibility&2&&(o.return===null||o.return.tag!==13)?(l._visibility&=-3,Vc(o)):du(o);break;default:du(o)}}function Vc(o){var l=o.deletions;if((o.flags&16)!==0){if(l!==null)for(var h=0;h<l.length;h++){var g=l[h];jn=g,W_(g,o)}$_(o)}for(o=o.child;o!==null;){switch(l=o,l.tag){case 0:case 11:case 15:Hr(8,l,l.return),Vc(l);break;case 22:h=l.stateNode,h._visibility&2&&(h._visibility&=-3,Vc(l));break;default:Vc(l)}o=o.sibling}}function W_(o,l){for(;jn!==null;){var h=jn;switch(h.tag){case 0:case 11:case 15:Hr(8,h,l);break;case 23:case 22:if(h.memoizedState!==null&&h.memoizedState.cachePool!==null){var g=h.memoizedState.cachePool.pool;g!=null&&g.refCount++}break;case 24:Xl(h.memoizedState.cache)}if(g=h.child,g!==null)g.return=h,jn=g;else e:for(h=o;jn!==null;){g=jn;var T=g.sibling,R=g.return;if(O_(g),g===h){jn=null;break e}if(T!==null){T.return=R,jn=T;break e}jn=R}}}var yI={getCacheForType:function(o){var l=ri(Fn),h=l.data.get(o);return h===void 0&&(h=o(),l.data.set(o,h)),h},cacheSignal:function(){return ri(Fn).controller.signal}},_I=typeof WeakMap=="function"?WeakMap:Map,en=0,gn=null,Ot=null,Bt=0,sn=0,zi=null,zr=!1,La=!1,xp=!1,lr=0,In=0,$r=0,Bo=0,Ap=0,$i=0,Da=0,hu=null,wi=null,Rp=!1,Hc=0,K_=0,zc=1/0,$c=null,qr=null,Wn=0,Wr=null,wa=null,ur=0,bp=0,Mp=null,Y_=null,pu=0,Cp=null;function qi(){return(en&2)!==0&&Bt!==0?Bt&-Bt:V.T!==null?Np():vt()}function X_(){if($i===0)if((Bt&536870912)===0||qt){var o=Te;Te<<=1,(Te&3932160)===0&&(Te=262144),$i=o}else $i=536870912;return o=Vi.current,o!==null&&(o.flags|=32),$i}function Pi(o,l,h){(o===gn&&(sn===2||sn===9)||o.cancelPendingCommit!==null)&&(Pa(o,0),Kr(o,Bt,$i,!1)),zn(o,h),((en&2)===0||o!==gn)&&(o===gn&&((en&2)===0&&(Bo|=h),In===4&&Kr(o,Bt,$i,!1)),Ns(o))}function J_(o,l,h){if((en&6)!==0)throw Error(n(327));var g=!h&&(l&127)===0&&(l&o.expiredLanes)===0||pt(o,l),T=g?TI(o,l):Lp(o,l,!0),R=g;do{if(T===0){La&&!g&&Kr(o,l,0,!1);break}else{if(h=o.current.alternate,R&&!EI(h)){T=Lp(o,l,!1),R=!1;continue}if(T===2){if(R=l,o.errorRecoveryDisabledLanes&R)var D=0;else D=o.pendingLanes&-536870913,D=D!==0?D:D&536870912?536870912:0;if(D!==0){l=D;e:{var B=o;T=hu;var Z=B.current.memoizedState.isDehydrated;if(Z&&(Pa(B,D).flags|=256),D=Lp(B,D,!1),D!==2){if(xp&&!Z){B.errorRecoveryDisabledLanes|=R,Bo|=R,T=4;break e}R=wi,wi=T,R!==null&&(wi===null?wi=R:wi.push.apply(wi,R))}T=D}if(R=!1,T!==2)continue}}if(T===1){Pa(o,0),Kr(o,l,0,!0);break}e:{switch(g=o,R=T,R){case 0:case 1:throw Error(n(345));case 4:if((l&4194048)!==l)break;case 6:Kr(g,l,$i,!zr);break e;case 2:wi=null;break;case 3:case 5:break;default:throw Error(n(329))}if((l&62914560)===l&&(T=Hc+300-Re(),10<T)){if(Kr(g,l,$i,!zr),Ve(g,0,!0)!==0)break e;ur=l,g.timeoutHandle=ME(Q_.bind(null,g,h,wi,$c,Rp,l,$i,Bo,Da,zr,R,"Throttled",-0,0),T);break e}Q_(g,h,wi,$c,Rp,l,$i,Bo,Da,zr,R,null,-0,0)}}break}while(!0);Ns(o)}function Q_(o,l,h,g,T,R,D,B,Z,ge,Me,De,ve,Se){if(o.timeoutHandle=-1,De=l.subtreeFlags,De&8192||(De&16785408)===16785408){De={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Ys},z_(l,R,De);var it=(R&62914560)===R?Hc-Re():(R&4194048)===R?K_-Re():0;if(it=sL(De,it),it!==null){ur=R,o.cancelPendingCommit=it(rE.bind(null,o,l,R,h,g,T,D,B,Z,Me,De,null,ve,Se)),Kr(o,R,D,!ge);return}}rE(o,l,R,h,g,T,D,B,Z)}function EI(o){for(var l=o;;){var h=l.tag;if((h===0||h===11||h===15)&&l.flags&16384&&(h=l.updateQueue,h!==null&&(h=h.stores,h!==null)))for(var g=0;g<h.length;g++){var T=h[g],R=T.getSnapshot;T=T.value;try{if(!Bi(R(),T))return!1}catch{return!1}}if(h=l.child,l.subtreeFlags&16384&&h!==null)h.return=l,l=h;else{if(l===o)break;for(;l.sibling===null;){if(l.return===null||l.return===o)return!0;l=l.return}l.sibling.return=l.return,l=l.sibling}}return!0}function Kr(o,l,h,g){l&=~Ap,l&=~Bo,o.suspendedLanes|=l,o.pingedLanes&=~l,g&&(o.warmLanes|=l),g=o.expirationTimes;for(var T=l;0<T;){var R=31-ht(T),D=1<<R;g[R]=-1,T&=~D}h!==0&&Dr(o,h,l)}function qc(){return(en&6)===0?(mu(0),!1):!0}function Ip(){if(Ot!==null){if(sn===0)var o=Ot.return;else o=Ot,Zs=Lo=null,qh(o),xa=null,Ql=0,o=Ot;for(;o!==null;)C_(o.alternate,o),o=o.return;Ot=null}}function Pa(o,l){var h=o.timeoutHandle;h!==-1&&(o.timeoutHandle=-1,GI(h)),h=o.cancelPendingCommit,h!==null&&(o.cancelPendingCommit=null,h()),ur=0,Ip(),gn=o,Ot=h=Js(o.current,null),Bt=l,sn=0,zi=null,zr=!1,La=pt(o,l),xp=!1,Da=$i=Ap=Bo=$r=In=0,wi=hu=null,Rp=!1,(l&8)!==0&&(l|=l&32);var g=o.entangledLanes;if(g!==0)for(o=o.entanglements,g&=l;0<g;){var T=31-ht(g),R=1<<T;l|=o[T],g&=~R}return lr=l,dc(),h}function Z_(o,l){bt=null,V.H=ru,l===Ta||l===Ec?(l=py(),sn=3):l===Ph?(l=py(),sn=4):sn=l===ap?8:l!==null&&typeof l=="object"&&typeof l.then=="function"?6:1,zi=l,Ot===null&&(In=1,Nc(o,is(l,o.current)))}function j_(){var o=Vi.current;return o===null?!0:(Bt&4194048)===Bt?as===null:(Bt&62914560)===Bt||(Bt&536870912)!==0?o===as:!1}function eE(){var o=V.H;return V.H=ru,o===null?ru:o}function tE(){var o=V.A;return V.A=yI,o}function Wc(){In=4,zr||(Bt&4194048)!==Bt&&Vi.current!==null||(La=!0),($r&134217727)===0&&(Bo&134217727)===0||gn===null||Kr(gn,Bt,$i,!1)}function Lp(o,l,h){var g=en;en|=2;var T=eE(),R=tE();(gn!==o||Bt!==l)&&($c=null,Pa(o,l)),l=!1;var D=In;e:do try{if(sn!==0&&Ot!==null){var B=Ot,Z=zi;switch(sn){case 8:Ip(),D=6;break e;case 3:case 2:case 9:case 6:Vi.current===null&&(l=!0);var ge=sn;if(sn=0,zi=null,Na(o,B,Z,ge),h&&La){D=0;break e}break;default:ge=sn,sn=0,zi=null,Na(o,B,Z,ge)}}SI(),D=In;break}catch(Me){Z_(o,Me)}while(!0);return l&&o.shellSuspendCounter++,Zs=Lo=null,en=g,V.H=T,V.A=R,Ot===null&&(gn=null,Bt=0,dc()),D}function SI(){for(;Ot!==null;)nE(Ot)}function TI(o,l){var h=en;en|=2;var g=eE(),T=tE();gn!==o||Bt!==l?($c=null,zc=Re()+500,Pa(o,l)):La=pt(o,l);e:do try{if(sn!==0&&Ot!==null){l=Ot;var R=zi;t:switch(sn){case 1:sn=0,zi=null,Na(o,l,R,1);break;case 2:case 9:if(dy(R)){sn=0,zi=null,iE(l);break}l=function(){sn!==2&&sn!==9||gn!==o||(sn=7),Ns(o)},R.then(l,l);break e;case 3:sn=7;break e;case 4:sn=5;break e;case 7:dy(R)?(sn=0,zi=null,iE(l)):(sn=0,zi=null,Na(o,l,R,7));break;case 5:var D=null;switch(Ot.tag){case 26:D=Ot.memoizedState;case 5:case 27:var B=Ot;if(D?HE(D):B.stateNode.complete){sn=0,zi=null;var Z=B.sibling;if(Z!==null)Ot=Z;else{var ge=B.return;ge!==null?(Ot=ge,Kc(ge)):Ot=null}break t}}sn=0,zi=null,Na(o,l,R,5);break;case 6:sn=0,zi=null,Na(o,l,R,6);break;case 8:Ip(),In=6;break e;default:throw Error(n(462))}}xI();break}catch(Me){Z_(o,Me)}while(!0);return Zs=Lo=null,V.H=g,V.A=T,en=h,Ot!==null?0:(gn=null,Bt=0,dc(),In)}function xI(){for(;Ot!==null&&!k();)nE(Ot)}function nE(o){var l=b_(o.alternate,o,lr);o.memoizedProps=o.pendingProps,l===null?Kc(o):Ot=l}function iE(o){var l=o,h=l.alternate;switch(l.tag){case 15:case 0:l=E_(h,l,l.pendingProps,l.type,void 0,Bt);break;case 11:l=E_(h,l,l.pendingProps,l.type.render,l.ref,Bt);break;case 5:qh(l);default:C_(h,l),l=Ot=ty(l,lr),l=b_(h,l,lr)}o.memoizedProps=o.pendingProps,l===null?Kc(o):Ot=l}function Na(o,l,h,g){Zs=Lo=null,qh(l),xa=null,Ql=0;var T=l.return;try{if(fI(o,T,l,h,Bt)){In=1,Nc(o,is(h,o.current)),Ot=null;return}}catch(R){if(T!==null)throw Ot=T,R;In=1,Nc(o,is(h,o.current)),Ot=null;return}l.flags&32768?(qt||g===1?o=!0:La||(Bt&536870912)!==0?o=!1:(zr=o=!0,(g===2||g===9||g===3||g===6)&&(g=Vi.current,g!==null&&g.tag===13&&(g.flags|=16384))),sE(l,o)):Kc(l)}function Kc(o){var l=o;do{if((l.flags&32768)!==0){sE(l,zr);return}o=l.return;var h=pI(l.alternate,l,lr);if(h!==null){Ot=h;return}if(l=l.sibling,l!==null){Ot=l;return}Ot=l=o}while(l!==null);In===0&&(In=5)}function sE(o,l){do{var h=mI(o.alternate,o);if(h!==null){h.flags&=32767,Ot=h;return}if(h=o.return,h!==null&&(h.flags|=32768,h.subtreeFlags=0,h.deletions=null),!l&&(o=o.sibling,o!==null)){Ot=o;return}Ot=o=h}while(o!==null);In=6,Ot=null}function rE(o,l,h,g,T,R,D,B,Z){o.cancelPendingCommit=null;do Yc();while(Wn!==0);if((en&6)!==0)throw Error(n(327));if(l!==null){if(l===o.current)throw Error(n(177));if(R=l.lanes|l.childLanes,R|=yh,ki(o,h,R,D,B,Z),o===gn&&(Ot=gn=null,Bt=0),wa=l,Wr=o,ur=h,bp=R,Mp=T,Y_=g,(l.subtreeFlags&10256)!==0||(l.flags&10256)!==0?(o.callbackNode=null,o.callbackPriority=0,MI(Be,function(){return cE(),null})):(o.callbackNode=null,o.callbackPriority=0),g=(l.flags&13878)!==0,(l.subtreeFlags&13878)!==0||g){g=V.T,V.T=null,T=W.p,W.p=2,D=en,en|=4;try{gI(o,l,h)}finally{en=D,W.p=T,V.T=g}}Wn=1,oE(),aE(),lE()}}function oE(){if(Wn===1){Wn=0;var o=Wr,l=wa,h=(l.flags&13878)!==0;if((l.subtreeFlags&13878)!==0||h){h=V.T,V.T=null;var g=W.p;W.p=2;var T=en;en|=4;try{G_(l,o);var R=Hp,D=Wv(o.containerInfo),B=R.focusedElem,Z=R.selectionRange;if(D!==B&&B&&B.ownerDocument&&qv(B.ownerDocument.documentElement,B)){if(Z!==null&&hh(B)){var ge=Z.start,Me=Z.end;if(Me===void 0&&(Me=ge),"selectionStart"in B)B.selectionStart=ge,B.selectionEnd=Math.min(Me,B.value.length);else{var De=B.ownerDocument||document,ve=De&&De.defaultView||window;if(ve.getSelection){var Se=ve.getSelection(),it=B.textContent.length,mt=Math.min(Z.start,it),fn=Z.end===void 0?mt:Math.min(Z.end,it);!Se.extend&&mt>fn&&(D=fn,fn=mt,mt=D);var re=$v(B,mt),j=$v(B,fn);if(re&&j&&(Se.rangeCount!==1||Se.anchorNode!==re.node||Se.anchorOffset!==re.offset||Se.focusNode!==j.node||Se.focusOffset!==j.offset)){var de=De.createRange();de.setStart(re.node,re.offset),Se.removeAllRanges(),mt>fn?(Se.addRange(de),Se.extend(j.node,j.offset)):(de.setEnd(j.node,j.offset),Se.addRange(de))}}}}for(De=[],Se=B;Se=Se.parentNode;)Se.nodeType===1&&De.push({element:Se,left:Se.scrollLeft,top:Se.scrollTop});for(typeof B.focus=="function"&&B.focus(),B=0;B<De.length;B++){var Ie=De[B];Ie.element.scrollLeft=Ie.left,Ie.element.scrollTop=Ie.top}}af=!!Vp,Hp=Vp=null}finally{en=T,W.p=g,V.T=h}}o.current=l,Wn=2}}function aE(){if(Wn===2){Wn=0;var o=Wr,l=wa,h=(l.flags&8772)!==0;if((l.subtreeFlags&8772)!==0||h){h=V.T,V.T=null;var g=W.p;W.p=2;var T=en;en|=4;try{U_(o,l.alternate,l)}finally{en=T,W.p=g,V.T=h}}Wn=3}}function lE(){if(Wn===4||Wn===3){Wn=0,me();var o=Wr,l=wa,h=ur,g=Y_;(l.subtreeFlags&10256)!==0||(l.flags&10256)!==0?Wn=5:(Wn=0,wa=Wr=null,uE(o,o.pendingLanes));var T=o.pendingLanes;if(T===0&&(qr=null),we(h),l=l.stateNode,ot&&typeof ot.onCommitFiberRoot=="function")try{ot.onCommitFiberRoot(st,l,void 0,(l.current.flags&128)===128)}catch{}if(g!==null){l=V.T,T=W.p,W.p=2,V.T=null;try{for(var R=o.onRecoverableError,D=0;D<g.length;D++){var B=g[D];R(B.value,{componentStack:B.stack})}}finally{V.T=l,W.p=T}}(ur&3)!==0&&Yc(),Ns(o),T=o.pendingLanes,(h&261930)!==0&&(T&42)!==0?o===Cp?pu++:(pu=0,Cp=o):pu=0,mu(0)}}function uE(o,l){(o.pooledCacheLanes&=l)===0&&(l=o.pooledCache,l!=null&&(o.pooledCache=null,Xl(l)))}function Yc(){return oE(),aE(),lE(),cE()}function cE(){if(Wn!==5)return!1;var o=Wr,l=bp;bp=0;var h=we(ur),g=V.T,T=W.p;try{W.p=32>h?32:h,V.T=null,h=Mp,Mp=null;var R=Wr,D=ur;if(Wn=0,wa=Wr=null,ur=0,(en&6)!==0)throw Error(n(331));var B=en;if(en|=4,q_(R.current),H_(R,R.current,D,h),en=B,mu(0,!1),ot&&typeof ot.onPostCommitFiberRoot=="function")try{ot.onPostCommitFiberRoot(st,R)}catch{}return!0}finally{W.p=T,V.T=g,uE(o,l)}}function fE(o,l,h){l=is(h,l),l=op(o.stateNode,l,2),o=Br(o,l,2),o!==null&&(zn(o,2),Ns(o))}function rn(o,l,h){if(o.tag===3)fE(o,o,h);else for(;l!==null;){if(l.tag===3){fE(l,o,h);break}else if(l.tag===1){var g=l.stateNode;if(typeof l.type.getDerivedStateFromError=="function"||typeof g.componentDidCatch=="function"&&(qr===null||!qr.has(g))){o=is(h,o),h=d_(2),g=Br(l,h,2),g!==null&&(h_(h,g,l,o),zn(g,2),Ns(g));break}}l=l.return}}function Dp(o,l,h){var g=o.pingCache;if(g===null){g=o.pingCache=new _I;var T=new Set;g.set(l,T)}else T=g.get(l),T===void 0&&(T=new Set,g.set(l,T));T.has(h)||(xp=!0,T.add(h),o=AI.bind(null,o,l,h),l.then(o,o))}function AI(o,l,h){var g=o.pingCache;g!==null&&g.delete(l),o.pingedLanes|=o.suspendedLanes&h,o.warmLanes&=~h,gn===o&&(Bt&h)===h&&(In===4||In===3&&(Bt&62914560)===Bt&&300>Re()-Hc?(en&2)===0&&Pa(o,0):Ap|=h,Da===Bt&&(Da=0)),Ns(o)}function dE(o,l){l===0&&(l=Dn()),o=Mo(o,l),o!==null&&(zn(o,l),Ns(o))}function RI(o){var l=o.memoizedState,h=0;l!==null&&(h=l.retryLane),dE(o,h)}function bI(o,l){var h=0;switch(o.tag){case 31:case 13:var g=o.stateNode,T=o.memoizedState;T!==null&&(h=T.retryLane);break;case 19:g=o.stateNode;break;case 22:g=o.stateNode._retryCache;break;default:throw Error(n(314))}g!==null&&g.delete(l),dE(o,h)}function MI(o,l){return $e(o,l)}var Xc=null,Ua=null,wp=!1,Jc=!1,Pp=!1,Yr=0;function Ns(o){o!==Ua&&o.next===null&&(Ua===null?Xc=Ua=o:Ua=Ua.next=o),Jc=!0,wp||(wp=!0,II())}function mu(o,l){if(!Pp&&Jc){Pp=!0;do for(var h=!1,g=Xc;g!==null;){if(o!==0){var T=g.pendingLanes;if(T===0)var R=0;else{var D=g.suspendedLanes,B=g.pingedLanes;R=(1<<31-ht(42|o)+1)-1,R&=T&~(D&~B),R=R&201326741?R&201326741|1:R?R|2:0}R!==0&&(h=!0,gE(g,R))}else R=Bt,R=Ve(g,g===gn?R:0,g.cancelPendingCommit!==null||g.timeoutHandle!==-1),(R&3)===0||pt(g,R)||(h=!0,gE(g,R));g=g.next}while(h);Pp=!1}}function CI(){hE()}function hE(){Jc=wp=!1;var o=0;Yr!==0&&BI()&&(o=Yr);for(var l=Re(),h=null,g=Xc;g!==null;){var T=g.next,R=pE(g,l);R===0?(g.next=null,h===null?Xc=T:h.next=T,T===null&&(Ua=h)):(h=g,(o!==0||(R&3)!==0)&&(Jc=!0)),g=T}Wn!==0&&Wn!==5||mu(o),Yr!==0&&(Yr=0)}function pE(o,l){for(var h=o.suspendedLanes,g=o.pingedLanes,T=o.expirationTimes,R=o.pendingLanes&-62914561;0<R;){var D=31-ht(R),B=1<<D,Z=T[D];Z===-1?((B&h)===0||(B&g)!==0)&&(T[D]=En(B,l)):Z<=l&&(o.expiredLanes|=B),R&=~B}if(l=gn,h=Bt,h=Ve(o,o===l?h:0,o.cancelPendingCommit!==null||o.timeoutHandle!==-1),g=o.callbackNode,h===0||o===l&&(sn===2||sn===9)||o.cancelPendingCommit!==null)return g!==null&&g!==null&&$(g),o.callbackNode=null,o.callbackPriority=0;if((h&3)===0||pt(o,h)){if(l=h&-h,l===o.callbackPriority)return l;switch(g!==null&&$(g),we(h)){case 2:case 8:h=nt;break;case 32:h=Be;break;case 268435456:h=Ct;break;default:h=Be}return g=mE.bind(null,o),h=$e(h,g),o.callbackPriority=l,o.callbackNode=h,l}return g!==null&&g!==null&&$(g),o.callbackPriority=2,o.callbackNode=null,2}function mE(o,l){if(Wn!==0&&Wn!==5)return o.callbackNode=null,o.callbackPriority=0,null;var h=o.callbackNode;if(Yc()&&o.callbackNode!==h)return null;var g=Bt;return g=Ve(o,o===gn?g:0,o.cancelPendingCommit!==null||o.timeoutHandle!==-1),g===0?null:(J_(o,g,l),pE(o,Re()),o.callbackNode!=null&&o.callbackNode===h?mE.bind(null,o):null)}function gE(o,l){if(Yc())return null;J_(o,l,!0)}function II(){VI(function(){(en&6)!==0?$e(be,CI):hE()})}function Np(){if(Yr===0){var o=Ea;o===0&&(o=Ge,Ge<<=1,(Ge&261888)===0&&(Ge=256)),Yr=o}return Yr}function vE(o){return o==null||typeof o=="symbol"||typeof o=="boolean"?null:typeof o=="function"?o:sc(""+o)}function yE(o,l){var h=l.ownerDocument.createElement("input");return h.name=l.name,h.value=l.value,o.id&&h.setAttribute("form",o.id),l.parentNode.insertBefore(h,l),o=new FormData(o),h.parentNode.removeChild(h),o}function LI(o,l,h,g,T){if(l==="submit"&&h&&h.stateNode===T){var R=vE((T[nn]||null).action),D=g.submitter;D&&(l=(l=D[nn]||null)?vE(l.formAction):D.getAttribute("formAction"),l!==null&&(R=l,D=null));var B=new lc("action","action",null,g,T);o.push({event:B,listeners:[{instance:null,listener:function(){if(g.defaultPrevented){if(Yr!==0){var Z=D?yE(T,D):new FormData(T);ep(h,{pending:!0,data:Z,method:T.method,action:R},null,Z)}}else typeof R=="function"&&(B.preventDefault(),Z=D?yE(T,D):new FormData(T),ep(h,{pending:!0,data:Z,method:T.method,action:R},R,Z))},currentTarget:T}]})}}for(var Up=0;Up<vh.length;Up++){var Op=vh[Up],DI=Op.toLowerCase(),wI=Op[0].toUpperCase()+Op.slice(1);vs(DI,"on"+wI)}vs(Xv,"onAnimationEnd"),vs(Jv,"onAnimationIteration"),vs(Qv,"onAnimationStart"),vs("dblclick","onDoubleClick"),vs("focusin","onFocus"),vs("focusout","onBlur"),vs(YC,"onTransitionRun"),vs(XC,"onTransitionStart"),vs(JC,"onTransitionCancel"),vs(Zv,"onTransitionEnd"),Ze("onMouseEnter",["mouseout","mouseover"]),Ze("onMouseLeave",["mouseout","mouseover"]),Ze("onPointerEnter",["pointerout","pointerover"]),Ze("onPointerLeave",["pointerout","pointerover"]),Xe("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Xe("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Xe("onBeforeInput",["compositionend","keypress","textInput","paste"]),Xe("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Xe("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Xe("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var gu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),PI=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(gu));function _E(o,l){l=(l&4)!==0;for(var h=0;h<o.length;h++){var g=o[h],T=g.event;g=g.listeners;e:{var R=void 0;if(l)for(var D=g.length-1;0<=D;D--){var B=g[D],Z=B.instance,ge=B.currentTarget;if(B=B.listener,Z!==R&&T.isPropagationStopped())break e;R=B,T.currentTarget=ge;try{R(T)}catch(Me){fc(Me)}T.currentTarget=null,R=Z}else for(D=0;D<g.length;D++){if(B=g[D],Z=B.instance,ge=B.currentTarget,B=B.listener,Z!==R&&T.isPropagationStopped())break e;R=B,T.currentTarget=ge;try{R(T)}catch(Me){fc(Me)}T.currentTarget=null,R=Z}}}}function Ft(o,l){var h=l[mn];h===void 0&&(h=l[mn]=new Set);var g=o+"__bubble";h.has(g)||(EE(l,o,2,!1),h.add(g))}function Fp(o,l,h){var g=0;l&&(g|=4),EE(h,o,g,l)}var Qc="_reactListening"+Math.random().toString(36).slice(2);function kp(o){if(!o[Qc]){o[Qc]=!0,Oe.forEach(function(h){h!=="selectionchange"&&(PI.has(h)||Fp(h,!1,o),Fp(h,!0,o))});var l=o.nodeType===9?o:o.ownerDocument;l===null||l[Qc]||(l[Qc]=!0,Fp("selectionchange",!1,l))}}function EE(o,l,h,g){switch(XE(l)){case 2:var T=aL;break;case 8:T=lL;break;default:T=jp}h=T.bind(null,l,h,o),T=void 0,!sh||l!=="touchstart"&&l!=="touchmove"&&l!=="wheel"||(T=!0),g?T!==void 0?o.addEventListener(l,h,{capture:!0,passive:T}):o.addEventListener(l,h,!0):T!==void 0?o.addEventListener(l,h,{passive:T}):o.addEventListener(l,h,!1)}function Bp(o,l,h,g,T){var R=g;if((l&1)===0&&(l&2)===0&&g!==null)e:for(;;){if(g===null)return;var D=g.tag;if(D===3||D===4){var B=g.stateNode.containerInfo;if(B===T)break;if(D===4)for(D=g.return;D!==null;){var Z=D.tag;if((Z===3||Z===4)&&D.stateNode.containerInfo===T)return;D=D.return}for(;B!==null;){if(D=H(B),D===null)return;if(Z=D.tag,Z===5||Z===6||Z===26||Z===27){g=R=D;continue e}B=B.parentNode}}g=g.return}Rv(function(){var ge=R,Me=nh(h),De=[];e:{var ve=jv.get(o);if(ve!==void 0){var Se=lc,it=o;switch(o){case"keypress":if(oc(h)===0)break e;case"keydown":case"keyup":Se=bC;break;case"focusin":it="focus",Se=lh;break;case"focusout":it="blur",Se=lh;break;case"beforeblur":case"afterblur":Se=lh;break;case"click":if(h.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Se=Cv;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Se=pC;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Se=IC;break;case Xv:case Jv:case Qv:Se=vC;break;case Zv:Se=DC;break;case"scroll":case"scrollend":Se=dC;break;case"wheel":Se=PC;break;case"copy":case"cut":case"paste":Se=_C;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Se=Lv;break;case"toggle":case"beforetoggle":Se=UC}var mt=(l&4)!==0,fn=!mt&&(o==="scroll"||o==="scrollend"),re=mt?ve!==null?ve+"Capture":null:ve;mt=[];for(var j=ge,de;j!==null;){var Ie=j;if(de=Ie.stateNode,Ie=Ie.tag,Ie!==5&&Ie!==26&&Ie!==27||de===null||re===null||(Ie=kl(j,re),Ie!=null&&mt.push(vu(j,Ie,de))),fn)break;j=j.return}0<mt.length&&(ve=new Se(ve,it,null,h,Me),De.push({event:ve,listeners:mt}))}}if((l&7)===0){e:{if(ve=o==="mouseover"||o==="pointerover",Se=o==="mouseout"||o==="pointerout",ve&&h!==th&&(it=h.relatedTarget||h.fromElement)&&(H(it)||it[Kt]))break e;if((Se||ve)&&(ve=Me.window===Me?Me:(ve=Me.ownerDocument)?ve.defaultView||ve.parentWindow:window,Se?(it=h.relatedTarget||h.toElement,Se=ge,it=it?H(it):null,it!==null&&(fn=r(it),mt=it.tag,it!==fn||mt!==5&&mt!==27&&mt!==6)&&(it=null)):(Se=null,it=ge),Se!==it)){if(mt=Cv,Ie="onMouseLeave",re="onMouseEnter",j="mouse",(o==="pointerout"||o==="pointerover")&&(mt=Lv,Ie="onPointerLeave",re="onPointerEnter",j="pointer"),fn=Se==null?ve:ye(Se),de=it==null?ve:ye(it),ve=new mt(Ie,j+"leave",Se,h,Me),ve.target=fn,ve.relatedTarget=de,Ie=null,H(Me)===ge&&(mt=new mt(re,j+"enter",it,h,Me),mt.target=de,mt.relatedTarget=fn,Ie=mt),fn=Ie,Se&&it)t:{for(mt=NI,re=Se,j=it,de=0,Ie=re;Ie;Ie=mt(Ie))de++;Ie=0;for(var ft=j;ft;ft=mt(ft))Ie++;for(;0<de-Ie;)re=mt(re),de--;for(;0<Ie-de;)j=mt(j),Ie--;for(;de--;){if(re===j||j!==null&&re===j.alternate){mt=re;break t}re=mt(re),j=mt(j)}mt=null}else mt=null;Se!==null&&SE(De,ve,Se,mt,!1),it!==null&&fn!==null&&SE(De,fn,it,mt,!0)}}e:{if(ve=ge?ye(ge):window,Se=ve.nodeName&&ve.nodeName.toLowerCase(),Se==="select"||Se==="input"&&ve.type==="file")var Xt=kv;else if(Ov(ve))if(Bv)Xt=qC;else{Xt=zC;var at=HC}else Se=ve.nodeName,!Se||Se.toLowerCase()!=="input"||ve.type!=="checkbox"&&ve.type!=="radio"?ge&&eh(ge.elementType)&&(Xt=kv):Xt=$C;if(Xt&&(Xt=Xt(o,ge))){Fv(De,Xt,h,Me);break e}at&&at(o,ve,ge),o==="focusout"&&ge&&ve.type==="number"&&ge.memoizedProps.value!=null&&fi(ve,"number",ve.value)}switch(at=ge?ye(ge):window,o){case"focusin":(Ov(at)||at.contentEditable==="true")&&(da=at,ph=ge,Wl=null);break;case"focusout":Wl=ph=da=null;break;case"mousedown":mh=!0;break;case"contextmenu":case"mouseup":case"dragend":mh=!1,Kv(De,h,Me);break;case"selectionchange":if(KC)break;case"keydown":case"keyup":Kv(De,h,Me)}var It;if(ch)e:{switch(o){case"compositionstart":var Gt="onCompositionStart";break e;case"compositionend":Gt="onCompositionEnd";break e;case"compositionupdate":Gt="onCompositionUpdate";break e}Gt=void 0}else fa?Nv(o,h)&&(Gt="onCompositionEnd"):o==="keydown"&&h.keyCode===229&&(Gt="onCompositionStart");Gt&&(Dv&&h.locale!=="ko"&&(fa||Gt!=="onCompositionStart"?Gt==="onCompositionEnd"&&fa&&(It=bv()):(wr=Me,rh="value"in wr?wr.value:wr.textContent,fa=!0)),at=Zc(ge,Gt),0<at.length&&(Gt=new Iv(Gt,o,null,h,Me),De.push({event:Gt,listeners:at}),It?Gt.data=It:(It=Uv(h),It!==null&&(Gt.data=It)))),(It=FC?kC(o,h):BC(o,h))&&(Gt=Zc(ge,"onBeforeInput"),0<Gt.length&&(at=new Iv("onBeforeInput","beforeinput",null,h,Me),De.push({event:at,listeners:Gt}),at.data=It)),LI(De,o,ge,h,Me)}_E(De,l)})}function vu(o,l,h){return{instance:o,listener:l,currentTarget:h}}function Zc(o,l){for(var h=l+"Capture",g=[];o!==null;){var T=o,R=T.stateNode;if(T=T.tag,T!==5&&T!==26&&T!==27||R===null||(T=kl(o,h),T!=null&&g.unshift(vu(o,T,R)),T=kl(o,l),T!=null&&g.push(vu(o,T,R))),o.tag===3)return g;o=o.return}return[]}function NI(o){if(o===null)return null;do o=o.return;while(o&&o.tag!==5&&o.tag!==27);return o||null}function SE(o,l,h,g,T){for(var R=l._reactName,D=[];h!==null&&h!==g;){var B=h,Z=B.alternate,ge=B.stateNode;if(B=B.tag,Z!==null&&Z===g)break;B!==5&&B!==26&&B!==27||ge===null||(Z=ge,T?(ge=kl(h,R),ge!=null&&D.unshift(vu(h,ge,Z))):T||(ge=kl(h,R),ge!=null&&D.push(vu(h,ge,Z)))),h=h.return}D.length!==0&&o.push({event:l,listeners:D})}var UI=/\r\n?/g,OI=/\u0000|\uFFFD/g;function TE(o){return(typeof o=="string"?o:""+o).replace(UI,`
`).replace(OI,"")}function xE(o,l){return l=TE(l),TE(o)===l}function cn(o,l,h,g,T,R){switch(h){case"children":typeof g=="string"?l==="body"||l==="textarea"&&g===""||Mi(o,g):(typeof g=="number"||typeof g=="bigint")&&l!=="body"&&Mi(o,""+g);break;case"className":Sn(o,"class",g);break;case"tabIndex":Sn(o,"tabindex",g);break;case"dir":case"role":case"viewBox":case"width":case"height":Sn(o,h,g);break;case"style":xv(o,g,R);break;case"data":if(l!=="object"){Sn(o,"data",g);break}case"src":case"href":if(g===""&&(l!=="a"||h!=="href")){o.removeAttribute(h);break}if(g==null||typeof g=="function"||typeof g=="symbol"||typeof g=="boolean"){o.removeAttribute(h);break}g=sc(""+g),o.setAttribute(h,g);break;case"action":case"formAction":if(typeof g=="function"){o.setAttribute(h,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof R=="function"&&(h==="formAction"?(l!=="input"&&cn(o,l,"name",T.name,T,null),cn(o,l,"formEncType",T.formEncType,T,null),cn(o,l,"formMethod",T.formMethod,T,null),cn(o,l,"formTarget",T.formTarget,T,null)):(cn(o,l,"encType",T.encType,T,null),cn(o,l,"method",T.method,T,null),cn(o,l,"target",T.target,T,null)));if(g==null||typeof g=="symbol"||typeof g=="boolean"){o.removeAttribute(h);break}g=sc(""+g),o.setAttribute(h,g);break;case"onClick":g!=null&&(o.onclick=Ys);break;case"onScroll":g!=null&&Ft("scroll",o);break;case"onScrollEnd":g!=null&&Ft("scrollend",o);break;case"dangerouslySetInnerHTML":if(g!=null){if(typeof g!="object"||!("__html"in g))throw Error(n(61));if(h=g.__html,h!=null){if(T.children!=null)throw Error(n(60));o.innerHTML=h}}break;case"multiple":o.multiple=g&&typeof g!="function"&&typeof g!="symbol";break;case"muted":o.muted=g&&typeof g!="function"&&typeof g!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(g==null||typeof g=="function"||typeof g=="boolean"||typeof g=="symbol"){o.removeAttribute("xlink:href");break}h=sc(""+g),o.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",h);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":g!=null&&typeof g!="function"&&typeof g!="symbol"?o.setAttribute(h,""+g):o.removeAttribute(h);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":g&&typeof g!="function"&&typeof g!="symbol"?o.setAttribute(h,""):o.removeAttribute(h);break;case"capture":case"download":g===!0?o.setAttribute(h,""):g!==!1&&g!=null&&typeof g!="function"&&typeof g!="symbol"?o.setAttribute(h,g):o.removeAttribute(h);break;case"cols":case"rows":case"size":case"span":g!=null&&typeof g!="function"&&typeof g!="symbol"&&!isNaN(g)&&1<=g?o.setAttribute(h,g):o.removeAttribute(h);break;case"rowSpan":case"start":g==null||typeof g=="function"||typeof g=="symbol"||isNaN(g)?o.removeAttribute(h):o.setAttribute(h,g);break;case"popover":Ft("beforetoggle",o),Ft("toggle",o),$t(o,"popover",g);break;case"xlinkActuate":Yt(o,"http://www.w3.org/1999/xlink","xlink:actuate",g);break;case"xlinkArcrole":Yt(o,"http://www.w3.org/1999/xlink","xlink:arcrole",g);break;case"xlinkRole":Yt(o,"http://www.w3.org/1999/xlink","xlink:role",g);break;case"xlinkShow":Yt(o,"http://www.w3.org/1999/xlink","xlink:show",g);break;case"xlinkTitle":Yt(o,"http://www.w3.org/1999/xlink","xlink:title",g);break;case"xlinkType":Yt(o,"http://www.w3.org/1999/xlink","xlink:type",g);break;case"xmlBase":Yt(o,"http://www.w3.org/XML/1998/namespace","xml:base",g);break;case"xmlLang":Yt(o,"http://www.w3.org/XML/1998/namespace","xml:lang",g);break;case"xmlSpace":Yt(o,"http://www.w3.org/XML/1998/namespace","xml:space",g);break;case"is":$t(o,"is",g);break;case"innerText":case"textContent":break;default:(!(2<h.length)||h[0]!=="o"&&h[0]!=="O"||h[1]!=="n"&&h[1]!=="N")&&(h=cC.get(h)||h,$t(o,h,g))}}function Gp(o,l,h,g,T,R){switch(h){case"style":xv(o,g,R);break;case"dangerouslySetInnerHTML":if(g!=null){if(typeof g!="object"||!("__html"in g))throw Error(n(61));if(h=g.__html,h!=null){if(T.children!=null)throw Error(n(60));o.innerHTML=h}}break;case"children":typeof g=="string"?Mi(o,g):(typeof g=="number"||typeof g=="bigint")&&Mi(o,""+g);break;case"onScroll":g!=null&&Ft("scroll",o);break;case"onScrollEnd":g!=null&&Ft("scrollend",o);break;case"onClick":g!=null&&(o.onclick=Ys);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!qe.hasOwnProperty(h))e:{if(h[0]==="o"&&h[1]==="n"&&(T=h.endsWith("Capture"),l=h.slice(2,T?h.length-7:void 0),R=o[nn]||null,R=R!=null?R[h]:null,typeof R=="function"&&o.removeEventListener(l,R,T),typeof g=="function")){typeof R!="function"&&R!==null&&(h in o?o[h]=null:o.hasAttribute(h)&&o.removeAttribute(h)),o.addEventListener(l,g,T);break e}h in o?o[h]=g:g===!0?o.setAttribute(h,""):$t(o,h,g)}}}function ai(o,l,h){switch(l){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ft("error",o),Ft("load",o);var g=!1,T=!1,R;for(R in h)if(h.hasOwnProperty(R)){var D=h[R];if(D!=null)switch(R){case"src":g=!0;break;case"srcSet":T=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,l));default:cn(o,l,R,D,h,null)}}T&&cn(o,l,"srcSet",h.srcSet,h,null),g&&cn(o,l,"src",h.src,h,null);return;case"input":Ft("invalid",o);var B=R=D=T=null,Z=null,ge=null;for(g in h)if(h.hasOwnProperty(g)){var Me=h[g];if(Me!=null)switch(g){case"name":T=Me;break;case"type":D=Me;break;case"checked":Z=Me;break;case"defaultChecked":ge=Me;break;case"value":R=Me;break;case"defaultValue":B=Me;break;case"children":case"dangerouslySetInnerHTML":if(Me!=null)throw Error(n(137,l));break;default:cn(o,l,g,Me,h,null)}}vi(o,R,B,Z,ge,D,T,!1);return;case"select":Ft("invalid",o),g=D=R=null;for(T in h)if(h.hasOwnProperty(T)&&(B=h[T],B!=null))switch(T){case"value":R=B;break;case"defaultValue":D=B;break;case"multiple":g=B;default:cn(o,l,T,B,h,null)}l=R,h=D,o.multiple=!!g,l!=null?Mn(o,!!g,l,!1):h!=null&&Mn(o,!!g,h,!0);return;case"textarea":Ft("invalid",o),R=T=g=null;for(D in h)if(h.hasOwnProperty(D)&&(B=h[D],B!=null))switch(D){case"value":g=B;break;case"defaultValue":T=B;break;case"children":R=B;break;case"dangerouslySetInnerHTML":if(B!=null)throw Error(n(91));break;default:cn(o,l,D,B,h,null)}la(o,g,T,R);return;case"option":for(Z in h)if(h.hasOwnProperty(Z)&&(g=h[Z],g!=null))switch(Z){case"selected":o.selected=g&&typeof g!="function"&&typeof g!="symbol";break;default:cn(o,l,Z,g,h,null)}return;case"dialog":Ft("beforetoggle",o),Ft("toggle",o),Ft("cancel",o),Ft("close",o);break;case"iframe":case"object":Ft("load",o);break;case"video":case"audio":for(g=0;g<gu.length;g++)Ft(gu[g],o);break;case"image":Ft("error",o),Ft("load",o);break;case"details":Ft("toggle",o);break;case"embed":case"source":case"link":Ft("error",o),Ft("load",o);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ge in h)if(h.hasOwnProperty(ge)&&(g=h[ge],g!=null))switch(ge){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,l));default:cn(o,l,ge,g,h,null)}return;default:if(eh(l)){for(Me in h)h.hasOwnProperty(Me)&&(g=h[Me],g!==void 0&&Gp(o,l,Me,g,h,void 0));return}}for(B in h)h.hasOwnProperty(B)&&(g=h[B],g!=null&&cn(o,l,B,g,h,null))}function FI(o,l,h,g){switch(l){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var T=null,R=null,D=null,B=null,Z=null,ge=null,Me=null;for(Se in h){var De=h[Se];if(h.hasOwnProperty(Se)&&De!=null)switch(Se){case"checked":break;case"value":break;case"defaultValue":Z=De;default:g.hasOwnProperty(Se)||cn(o,l,Se,null,g,De)}}for(var ve in g){var Se=g[ve];if(De=h[ve],g.hasOwnProperty(ve)&&(Se!=null||De!=null))switch(ve){case"type":R=Se;break;case"name":T=Se;break;case"checked":ge=Se;break;case"defaultChecked":Me=Se;break;case"value":D=Se;break;case"defaultValue":B=Se;break;case"children":case"dangerouslySetInnerHTML":if(Se!=null)throw Error(n(137,l));break;default:Se!==De&&cn(o,l,ve,Se,g,De)}}ln(o,D,B,Z,ge,Me,R,T);return;case"select":Se=D=B=ve=null;for(R in h)if(Z=h[R],h.hasOwnProperty(R)&&Z!=null)switch(R){case"value":break;case"multiple":Se=Z;default:g.hasOwnProperty(R)||cn(o,l,R,null,g,Z)}for(T in g)if(R=g[T],Z=h[T],g.hasOwnProperty(T)&&(R!=null||Z!=null))switch(T){case"value":ve=R;break;case"defaultValue":B=R;break;case"multiple":D=R;default:R!==Z&&cn(o,l,T,R,g,Z)}l=B,h=D,g=Se,ve!=null?Mn(o,!!h,ve,!1):!!g!=!!h&&(l!=null?Mn(o,!!h,l,!0):Mn(o,!!h,h?[]:"",!1));return;case"textarea":Se=ve=null;for(B in h)if(T=h[B],h.hasOwnProperty(B)&&T!=null&&!g.hasOwnProperty(B))switch(B){case"value":break;case"children":break;default:cn(o,l,B,null,g,T)}for(D in g)if(T=g[D],R=h[D],g.hasOwnProperty(D)&&(T!=null||R!=null))switch(D){case"value":ve=T;break;case"defaultValue":Se=T;break;case"children":break;case"dangerouslySetInnerHTML":if(T!=null)throw Error(n(91));break;default:T!==R&&cn(o,l,D,T,g,R)}ii(o,ve,Se);return;case"option":for(var it in h)if(ve=h[it],h.hasOwnProperty(it)&&ve!=null&&!g.hasOwnProperty(it))switch(it){case"selected":o.selected=!1;break;default:cn(o,l,it,null,g,ve)}for(Z in g)if(ve=g[Z],Se=h[Z],g.hasOwnProperty(Z)&&ve!==Se&&(ve!=null||Se!=null))switch(Z){case"selected":o.selected=ve&&typeof ve!="function"&&typeof ve!="symbol";break;default:cn(o,l,Z,ve,g,Se)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var mt in h)ve=h[mt],h.hasOwnProperty(mt)&&ve!=null&&!g.hasOwnProperty(mt)&&cn(o,l,mt,null,g,ve);for(ge in g)if(ve=g[ge],Se=h[ge],g.hasOwnProperty(ge)&&ve!==Se&&(ve!=null||Se!=null))switch(ge){case"children":case"dangerouslySetInnerHTML":if(ve!=null)throw Error(n(137,l));break;default:cn(o,l,ge,ve,g,Se)}return;default:if(eh(l)){for(var fn in h)ve=h[fn],h.hasOwnProperty(fn)&&ve!==void 0&&!g.hasOwnProperty(fn)&&Gp(o,l,fn,void 0,g,ve);for(Me in g)ve=g[Me],Se=h[Me],!g.hasOwnProperty(Me)||ve===Se||ve===void 0&&Se===void 0||Gp(o,l,Me,ve,g,Se);return}}for(var re in h)ve=h[re],h.hasOwnProperty(re)&&ve!=null&&!g.hasOwnProperty(re)&&cn(o,l,re,null,g,ve);for(De in g)ve=g[De],Se=h[De],!g.hasOwnProperty(De)||ve===Se||ve==null&&Se==null||cn(o,l,De,ve,g,Se)}function AE(o){switch(o){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function kI(){if(typeof performance.getEntriesByType=="function"){for(var o=0,l=0,h=performance.getEntriesByType("resource"),g=0;g<h.length;g++){var T=h[g],R=T.transferSize,D=T.initiatorType,B=T.duration;if(R&&B&&AE(D)){for(D=0,B=T.responseEnd,g+=1;g<h.length;g++){var Z=h[g],ge=Z.startTime;if(ge>B)break;var Me=Z.transferSize,De=Z.initiatorType;Me&&AE(De)&&(Z=Z.responseEnd,D+=Me*(Z<B?1:(B-ge)/(Z-ge)))}if(--g,l+=8*(R+D)/(T.duration/1e3),o++,10<o)break}}if(0<o)return l/o/1e6}return navigator.connection&&(o=navigator.connection.downlink,typeof o=="number")?o:5}var Vp=null,Hp=null;function jc(o){return o.nodeType===9?o:o.ownerDocument}function RE(o){switch(o){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function bE(o,l){if(o===0)switch(l){case"svg":return 1;case"math":return 2;default:return 0}return o===1&&l==="foreignObject"?0:o}function zp(o,l){return o==="textarea"||o==="noscript"||typeof l.children=="string"||typeof l.children=="number"||typeof l.children=="bigint"||typeof l.dangerouslySetInnerHTML=="object"&&l.dangerouslySetInnerHTML!==null&&l.dangerouslySetInnerHTML.__html!=null}var $p=null;function BI(){var o=window.event;return o&&o.type==="popstate"?o===$p?!1:($p=o,!0):($p=null,!1)}var ME=typeof setTimeout=="function"?setTimeout:void 0,GI=typeof clearTimeout=="function"?clearTimeout:void 0,CE=typeof Promise=="function"?Promise:void 0,VI=typeof queueMicrotask=="function"?queueMicrotask:typeof CE<"u"?function(o){return CE.resolve(null).then(o).catch(HI)}:ME;function HI(o){setTimeout(function(){throw o})}function Xr(o){return o==="head"}function IE(o,l){var h=l,g=0;do{var T=h.nextSibling;if(o.removeChild(h),T&&T.nodeType===8)if(h=T.data,h==="/$"||h==="/&"){if(g===0){o.removeChild(T),Ba(l);return}g--}else if(h==="$"||h==="$?"||h==="$~"||h==="$!"||h==="&")g++;else if(h==="html")yu(o.ownerDocument.documentElement);else if(h==="head"){h=o.ownerDocument.head,yu(h);for(var R=h.firstChild;R;){var D=R.nextSibling,B=R.nodeName;R[xo]||B==="SCRIPT"||B==="STYLE"||B==="LINK"&&R.rel.toLowerCase()==="stylesheet"||h.removeChild(R),R=D}}else h==="body"&&yu(o.ownerDocument.body);h=T}while(h);Ba(l)}function LE(o,l){var h=o;o=0;do{var g=h.nextSibling;if(h.nodeType===1?l?(h._stashedDisplay=h.style.display,h.style.display="none"):(h.style.display=h._stashedDisplay||"",h.getAttribute("style")===""&&h.removeAttribute("style")):h.nodeType===3&&(l?(h._stashedText=h.nodeValue,h.nodeValue=""):h.nodeValue=h._stashedText||""),g&&g.nodeType===8)if(h=g.data,h==="/$"){if(o===0)break;o--}else h!=="$"&&h!=="$?"&&h!=="$~"&&h!=="$!"||o++;h=g}while(h)}function qp(o){var l=o.firstChild;for(l&&l.nodeType===10&&(l=l.nextSibling);l;){var h=l;switch(l=l.nextSibling,h.nodeName){case"HTML":case"HEAD":case"BODY":qp(h),Fl(h);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(h.rel.toLowerCase()==="stylesheet")continue}o.removeChild(h)}}function zI(o,l,h,g){for(;o.nodeType===1;){var T=h;if(o.nodeName.toLowerCase()!==l.toLowerCase()){if(!g&&(o.nodeName!=="INPUT"||o.type!=="hidden"))break}else if(g){if(!o[xo])switch(l){case"meta":if(!o.hasAttribute("itemprop"))break;return o;case"link":if(R=o.getAttribute("rel"),R==="stylesheet"&&o.hasAttribute("data-precedence"))break;if(R!==T.rel||o.getAttribute("href")!==(T.href==null||T.href===""?null:T.href)||o.getAttribute("crossorigin")!==(T.crossOrigin==null?null:T.crossOrigin)||o.getAttribute("title")!==(T.title==null?null:T.title))break;return o;case"style":if(o.hasAttribute("data-precedence"))break;return o;case"script":if(R=o.getAttribute("src"),(R!==(T.src==null?null:T.src)||o.getAttribute("type")!==(T.type==null?null:T.type)||o.getAttribute("crossorigin")!==(T.crossOrigin==null?null:T.crossOrigin))&&R&&o.hasAttribute("async")&&!o.hasAttribute("itemprop"))break;return o;default:return o}}else if(l==="input"&&o.type==="hidden"){var R=T.name==null?null:""+T.name;if(T.type==="hidden"&&o.getAttribute("name")===R)return o}else return o;if(o=ls(o.nextSibling),o===null)break}return null}function $I(o,l,h){if(l==="")return null;for(;o.nodeType!==3;)if((o.nodeType!==1||o.nodeName!=="INPUT"||o.type!=="hidden")&&!h||(o=ls(o.nextSibling),o===null))return null;return o}function DE(o,l){for(;o.nodeType!==8;)if((o.nodeType!==1||o.nodeName!=="INPUT"||o.type!=="hidden")&&!l||(o=ls(o.nextSibling),o===null))return null;return o}function Wp(o){return o.data==="$?"||o.data==="$~"}function Kp(o){return o.data==="$!"||o.data==="$?"&&o.ownerDocument.readyState!=="loading"}function qI(o,l){var h=o.ownerDocument;if(o.data==="$~")o._reactRetry=l;else if(o.data!=="$?"||h.readyState!=="loading")l();else{var g=function(){l(),h.removeEventListener("DOMContentLoaded",g)};h.addEventListener("DOMContentLoaded",g),o._reactRetry=g}}function ls(o){for(;o!=null;o=o.nextSibling){var l=o.nodeType;if(l===1||l===3)break;if(l===8){if(l=o.data,l==="$"||l==="$!"||l==="$?"||l==="$~"||l==="&"||l==="F!"||l==="F")break;if(l==="/$"||l==="/&")return null}}return o}var Yp=null;function wE(o){o=o.nextSibling;for(var l=0;o;){if(o.nodeType===8){var h=o.data;if(h==="/$"||h==="/&"){if(l===0)return ls(o.nextSibling);l--}else h!=="$"&&h!=="$!"&&h!=="$?"&&h!=="$~"&&h!=="&"||l++}o=o.nextSibling}return null}function PE(o){o=o.previousSibling;for(var l=0;o;){if(o.nodeType===8){var h=o.data;if(h==="$"||h==="$!"||h==="$?"||h==="$~"||h==="&"){if(l===0)return o;l--}else h!=="/$"&&h!=="/&"||l++}o=o.previousSibling}return null}function NE(o,l,h){switch(l=jc(h),o){case"html":if(o=l.documentElement,!o)throw Error(n(452));return o;case"head":if(o=l.head,!o)throw Error(n(453));return o;case"body":if(o=l.body,!o)throw Error(n(454));return o;default:throw Error(n(451))}}function yu(o){for(var l=o.attributes;l.length;)o.removeAttributeNode(l[0]);Fl(o)}var us=new Map,UE=new Set;function ef(o){return typeof o.getRootNode=="function"?o.getRootNode():o.nodeType===9?o:o.ownerDocument}var cr=W.d;W.d={f:WI,r:KI,D:YI,C:XI,L:JI,m:QI,X:jI,S:ZI,M:eL};function WI(){var o=cr.f(),l=qc();return o||l}function KI(o){var l=se(o);l!==null&&l.tag===5&&l.type==="form"?Zy(l):cr.r(o)}var Oa=typeof document>"u"?null:document;function OE(o,l,h){var g=Oa;if(g&&typeof l=="string"&&l){var T=Zn(l);T='link[rel="'+o+'"][href="'+T+'"]',typeof h=="string"&&(T+='[crossorigin="'+h+'"]'),UE.has(T)||(UE.add(T),o={rel:o,crossOrigin:h,href:l},g.querySelector(T)===null&&(l=g.createElement("link"),ai(l,"link",o),te(l),g.head.appendChild(l)))}}function YI(o){cr.D(o),OE("dns-prefetch",o,null)}function XI(o,l){cr.C(o,l),OE("preconnect",o,l)}function JI(o,l,h){cr.L(o,l,h);var g=Oa;if(g&&o&&l){var T='link[rel="preload"][as="'+Zn(l)+'"]';l==="image"&&h&&h.imageSrcSet?(T+='[imagesrcset="'+Zn(h.imageSrcSet)+'"]',typeof h.imageSizes=="string"&&(T+='[imagesizes="'+Zn(h.imageSizes)+'"]')):T+='[href="'+Zn(o)+'"]';var R=T;switch(l){case"style":R=Fa(o);break;case"script":R=ka(o)}us.has(R)||(o=p({rel:"preload",href:l==="image"&&h&&h.imageSrcSet?void 0:o,as:l},h),us.set(R,o),g.querySelector(T)!==null||l==="style"&&g.querySelector(_u(R))||l==="script"&&g.querySelector(Eu(R))||(l=g.createElement("link"),ai(l,"link",o),te(l),g.head.appendChild(l)))}}function QI(o,l){cr.m(o,l);var h=Oa;if(h&&o){var g=l&&typeof l.as=="string"?l.as:"script",T='link[rel="modulepreload"][as="'+Zn(g)+'"][href="'+Zn(o)+'"]',R=T;switch(g){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":R=ka(o)}if(!us.has(R)&&(o=p({rel:"modulepreload",href:o},l),us.set(R,o),h.querySelector(T)===null)){switch(g){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(h.querySelector(Eu(R)))return}g=h.createElement("link"),ai(g,"link",o),te(g),h.head.appendChild(g)}}}function ZI(o,l,h){cr.S(o,l,h);var g=Oa;if(g&&o){var T=_e(g).hoistableStyles,R=Fa(o);l=l||"default";var D=T.get(R);if(!D){var B={loading:0,preload:null};if(D=g.querySelector(_u(R)))B.loading=5;else{o=p({rel:"stylesheet",href:o,"data-precedence":l},h),(h=us.get(R))&&Xp(o,h);var Z=D=g.createElement("link");te(Z),ai(Z,"link",o),Z._p=new Promise(function(ge,Me){Z.onload=ge,Z.onerror=Me}),Z.addEventListener("load",function(){B.loading|=1}),Z.addEventListener("error",function(){B.loading|=2}),B.loading|=4,tf(D,l,g)}D={type:"stylesheet",instance:D,count:1,state:B},T.set(R,D)}}}function jI(o,l){cr.X(o,l);var h=Oa;if(h&&o){var g=_e(h).hoistableScripts,T=ka(o),R=g.get(T);R||(R=h.querySelector(Eu(T)),R||(o=p({src:o,async:!0},l),(l=us.get(T))&&Jp(o,l),R=h.createElement("script"),te(R),ai(R,"link",o),h.head.appendChild(R)),R={type:"script",instance:R,count:1,state:null},g.set(T,R))}}function eL(o,l){cr.M(o,l);var h=Oa;if(h&&o){var g=_e(h).hoistableScripts,T=ka(o),R=g.get(T);R||(R=h.querySelector(Eu(T)),R||(o=p({src:o,async:!0,type:"module"},l),(l=us.get(T))&&Jp(o,l),R=h.createElement("script"),te(R),ai(R,"link",o),h.head.appendChild(R)),R={type:"script",instance:R,count:1,state:null},g.set(T,R))}}function FE(o,l,h,g){var T=(T=ae.current)?ef(T):null;if(!T)throw Error(n(446));switch(o){case"meta":case"title":return null;case"style":return typeof h.precedence=="string"&&typeof h.href=="string"?(l=Fa(h.href),h=_e(T).hoistableStyles,g=h.get(l),g||(g={type:"style",instance:null,count:0,state:null},h.set(l,g)),g):{type:"void",instance:null,count:0,state:null};case"link":if(h.rel==="stylesheet"&&typeof h.href=="string"&&typeof h.precedence=="string"){o=Fa(h.href);var R=_e(T).hoistableStyles,D=R.get(o);if(D||(T=T.ownerDocument||T,D={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},R.set(o,D),(R=T.querySelector(_u(o)))&&!R._p&&(D.instance=R,D.state.loading=5),us.has(o)||(h={rel:"preload",as:"style",href:h.href,crossOrigin:h.crossOrigin,integrity:h.integrity,media:h.media,hrefLang:h.hrefLang,referrerPolicy:h.referrerPolicy},us.set(o,h),R||tL(T,o,h,D.state))),l&&g===null)throw Error(n(528,""));return D}if(l&&g!==null)throw Error(n(529,""));return null;case"script":return l=h.async,h=h.src,typeof h=="string"&&l&&typeof l!="function"&&typeof l!="symbol"?(l=ka(h),h=_e(T).hoistableScripts,g=h.get(l),g||(g={type:"script",instance:null,count:0,state:null},h.set(l,g)),g):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,o))}}function Fa(o){return'href="'+Zn(o)+'"'}function _u(o){return'link[rel="stylesheet"]['+o+"]"}function kE(o){return p({},o,{"data-precedence":o.precedence,precedence:null})}function tL(o,l,h,g){o.querySelector('link[rel="preload"][as="style"]['+l+"]")?g.loading=1:(l=o.createElement("link"),g.preload=l,l.addEventListener("load",function(){return g.loading|=1}),l.addEventListener("error",function(){return g.loading|=2}),ai(l,"link",h),te(l),o.head.appendChild(l))}function ka(o){return'[src="'+Zn(o)+'"]'}function Eu(o){return"script[async]"+o}function BE(o,l,h){if(l.count++,l.instance===null)switch(l.type){case"style":var g=o.querySelector('style[data-href~="'+Zn(h.href)+'"]');if(g)return l.instance=g,te(g),g;var T=p({},h,{"data-href":h.href,"data-precedence":h.precedence,href:null,precedence:null});return g=(o.ownerDocument||o).createElement("style"),te(g),ai(g,"style",T),tf(g,h.precedence,o),l.instance=g;case"stylesheet":T=Fa(h.href);var R=o.querySelector(_u(T));if(R)return l.state.loading|=4,l.instance=R,te(R),R;g=kE(h),(T=us.get(T))&&Xp(g,T),R=(o.ownerDocument||o).createElement("link"),te(R);var D=R;return D._p=new Promise(function(B,Z){D.onload=B,D.onerror=Z}),ai(R,"link",g),l.state.loading|=4,tf(R,h.precedence,o),l.instance=R;case"script":return R=ka(h.src),(T=o.querySelector(Eu(R)))?(l.instance=T,te(T),T):(g=h,(T=us.get(R))&&(g=p({},h),Jp(g,T)),o=o.ownerDocument||o,T=o.createElement("script"),te(T),ai(T,"link",g),o.head.appendChild(T),l.instance=T);case"void":return null;default:throw Error(n(443,l.type))}else l.type==="stylesheet"&&(l.state.loading&4)===0&&(g=l.instance,l.state.loading|=4,tf(g,h.precedence,o));return l.instance}function tf(o,l,h){for(var g=h.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),T=g.length?g[g.length-1]:null,R=T,D=0;D<g.length;D++){var B=g[D];if(B.dataset.precedence===l)R=B;else if(R!==T)break}R?R.parentNode.insertBefore(o,R.nextSibling):(l=h.nodeType===9?h.head:h,l.insertBefore(o,l.firstChild))}function Xp(o,l){o.crossOrigin==null&&(o.crossOrigin=l.crossOrigin),o.referrerPolicy==null&&(o.referrerPolicy=l.referrerPolicy),o.title==null&&(o.title=l.title)}function Jp(o,l){o.crossOrigin==null&&(o.crossOrigin=l.crossOrigin),o.referrerPolicy==null&&(o.referrerPolicy=l.referrerPolicy),o.integrity==null&&(o.integrity=l.integrity)}var nf=null;function GE(o,l,h){if(nf===null){var g=new Map,T=nf=new Map;T.set(h,g)}else T=nf,g=T.get(h),g||(g=new Map,T.set(h,g));if(g.has(o))return g;for(g.set(o,null),h=h.getElementsByTagName(o),T=0;T<h.length;T++){var R=h[T];if(!(R[xo]||R[kt]||o==="link"&&R.getAttribute("rel")==="stylesheet")&&R.namespaceURI!=="http://www.w3.org/2000/svg"){var D=R.getAttribute(l)||"";D=o+D;var B=g.get(D);B?B.push(R):g.set(D,[R])}}return g}function VE(o,l,h){o=o.ownerDocument||o,o.head.insertBefore(h,l==="title"?o.querySelector("head > title"):null)}function nL(o,l,h){if(h===1||l.itemProp!=null)return!1;switch(o){case"meta":case"title":return!0;case"style":if(typeof l.precedence!="string"||typeof l.href!="string"||l.href==="")break;return!0;case"link":if(typeof l.rel!="string"||typeof l.href!="string"||l.href===""||l.onLoad||l.onError)break;switch(l.rel){case"stylesheet":return o=l.disabled,typeof l.precedence=="string"&&o==null;default:return!0}case"script":if(l.async&&typeof l.async!="function"&&typeof l.async!="symbol"&&!l.onLoad&&!l.onError&&l.src&&typeof l.src=="string")return!0}return!1}function HE(o){return!(o.type==="stylesheet"&&(o.state.loading&3)===0)}function iL(o,l,h,g){if(h.type==="stylesheet"&&(typeof g.media!="string"||matchMedia(g.media).matches!==!1)&&(h.state.loading&4)===0){if(h.instance===null){var T=Fa(g.href),R=l.querySelector(_u(T));if(R){l=R._p,l!==null&&typeof l=="object"&&typeof l.then=="function"&&(o.count++,o=sf.bind(o),l.then(o,o)),h.state.loading|=4,h.instance=R,te(R);return}R=l.ownerDocument||l,g=kE(g),(T=us.get(T))&&Xp(g,T),R=R.createElement("link"),te(R);var D=R;D._p=new Promise(function(B,Z){D.onload=B,D.onerror=Z}),ai(R,"link",g),h.instance=R}o.stylesheets===null&&(o.stylesheets=new Map),o.stylesheets.set(h,l),(l=h.state.preload)&&(h.state.loading&3)===0&&(o.count++,h=sf.bind(o),l.addEventListener("load",h),l.addEventListener("error",h))}}var Qp=0;function sL(o,l){return o.stylesheets&&o.count===0&&of(o,o.stylesheets),0<o.count||0<o.imgCount?function(h){var g=setTimeout(function(){if(o.stylesheets&&of(o,o.stylesheets),o.unsuspend){var R=o.unsuspend;o.unsuspend=null,R()}},6e4+l);0<o.imgBytes&&Qp===0&&(Qp=62500*kI());var T=setTimeout(function(){if(o.waitingForImages=!1,o.count===0&&(o.stylesheets&&of(o,o.stylesheets),o.unsuspend)){var R=o.unsuspend;o.unsuspend=null,R()}},(o.imgBytes>Qp?50:800)+l);return o.unsuspend=h,function(){o.unsuspend=null,clearTimeout(g),clearTimeout(T)}}:null}function sf(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)of(this,this.stylesheets);else if(this.unsuspend){var o=this.unsuspend;this.unsuspend=null,o()}}}var rf=null;function of(o,l){o.stylesheets=null,o.unsuspend!==null&&(o.count++,rf=new Map,l.forEach(rL,o),rf=null,sf.call(o))}function rL(o,l){if(!(l.state.loading&4)){var h=rf.get(o);if(h)var g=h.get(null);else{h=new Map,rf.set(o,h);for(var T=o.querySelectorAll("link[data-precedence],style[data-precedence]"),R=0;R<T.length;R++){var D=T[R];(D.nodeName==="LINK"||D.getAttribute("media")!=="not all")&&(h.set(D.dataset.precedence,D),g=D)}g&&h.set(null,g)}T=l.instance,D=T.getAttribute("data-precedence"),R=h.get(D)||g,R===g&&h.set(null,T),h.set(D,T),this.count++,g=sf.bind(this),T.addEventListener("load",g),T.addEventListener("error",g),R?R.parentNode.insertBefore(T,R.nextSibling):(o=o.nodeType===9?o.head:o,o.insertBefore(T,o.firstChild)),l.state.loading|=4}}var Su={$$typeof:b,Provider:null,Consumer:null,_currentValue:q,_currentValue2:q,_threadCount:0};function oL(o,l,h,g,T,R,D,B,Z){this.tag=1,this.containerInfo=o,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Ht(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ht(0),this.hiddenUpdates=Ht(null),this.identifierPrefix=g,this.onUncaughtError=T,this.onCaughtError=R,this.onRecoverableError=D,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Z,this.incompleteTransitions=new Map}function zE(o,l,h,g,T,R,D,B,Z,ge,Me,De){return o=new oL(o,l,h,D,Z,ge,Me,De,B),l=1,R===!0&&(l|=24),R=Gi(3,null,null,l),o.current=R,R.stateNode=o,l=Lh(),l.refCount++,o.pooledCache=l,l.refCount++,R.memoizedState={element:g,isDehydrated:h,cache:l},Nh(R),o}function $E(o){return o?(o=ma,o):ma}function qE(o,l,h,g,T,R){T=$E(T),g.context===null?g.context=T:g.pendingContext=T,g=kr(l),g.payload={element:h},R=R===void 0?null:R,R!==null&&(g.callback=R),h=Br(o,g,l),h!==null&&(Pi(h,o,l),jl(h,o,l))}function WE(o,l){if(o=o.memoizedState,o!==null&&o.dehydrated!==null){var h=o.retryLane;o.retryLane=h!==0&&h<l?h:l}}function Zp(o,l){WE(o,l),(o=o.alternate)&&WE(o,l)}function KE(o){if(o.tag===13||o.tag===31){var l=Mo(o,67108864);l!==null&&Pi(l,o,67108864),Zp(o,67108864)}}function YE(o){if(o.tag===13||o.tag===31){var l=qi();l=Ks(l);var h=Mo(o,l);h!==null&&Pi(h,o,l),Zp(o,l)}}var af=!0;function aL(o,l,h,g){var T=V.T;V.T=null;var R=W.p;try{W.p=2,jp(o,l,h,g)}finally{W.p=R,V.T=T}}function lL(o,l,h,g){var T=V.T;V.T=null;var R=W.p;try{W.p=8,jp(o,l,h,g)}finally{W.p=R,V.T=T}}function jp(o,l,h,g){if(af){var T=em(g);if(T===null)Bp(o,l,g,lf,h),JE(o,g);else if(cL(T,o,l,h,g))g.stopPropagation();else if(JE(o,g),l&4&&-1<uL.indexOf(o)){for(;T!==null;){var R=se(T);if(R!==null)switch(R.tag){case 3:if(R=R.stateNode,R.current.memoizedState.isDehydrated){var D=ze(R.pendingLanes);if(D!==0){var B=R;for(B.pendingLanes|=2,B.entangledLanes|=2;D;){var Z=1<<31-ht(D);B.entanglements[1]|=Z,D&=~Z}Ns(R),(en&6)===0&&(zc=Re()+500,mu(0))}}break;case 31:case 13:B=Mo(R,2),B!==null&&Pi(B,R,2),qc(),Zp(R,2)}if(R=em(g),R===null&&Bp(o,l,g,lf,h),R===T)break;T=R}T!==null&&g.stopPropagation()}else Bp(o,l,g,null,h)}}function em(o){return o=nh(o),tm(o)}var lf=null;function tm(o){if(lf=null,o=H(o),o!==null){var l=r(o);if(l===null)o=null;else{var h=l.tag;if(h===13){if(o=a(l),o!==null)return o;o=null}else if(h===31){if(o=u(l),o!==null)return o;o=null}else if(h===3){if(l.stateNode.current.memoizedState.isDehydrated)return l.tag===3?l.stateNode.containerInfo:null;o=null}else l!==o&&(o=null)}}return lf=o,null}function XE(o){switch(o){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Pe()){case be:return 2;case nt:return 8;case Be:case Fe:return 32;case Ct:return 268435456;default:return 32}default:return 32}}var nm=!1,Jr=null,Qr=null,Zr=null,Tu=new Map,xu=new Map,jr=[],uL="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function JE(o,l){switch(o){case"focusin":case"focusout":Jr=null;break;case"dragenter":case"dragleave":Qr=null;break;case"mouseover":case"mouseout":Zr=null;break;case"pointerover":case"pointerout":Tu.delete(l.pointerId);break;case"gotpointercapture":case"lostpointercapture":xu.delete(l.pointerId)}}function Au(o,l,h,g,T,R){return o===null||o.nativeEvent!==R?(o={blockedOn:l,domEventName:h,eventSystemFlags:g,nativeEvent:R,targetContainers:[T]},l!==null&&(l=se(l),l!==null&&KE(l)),o):(o.eventSystemFlags|=g,l=o.targetContainers,T!==null&&l.indexOf(T)===-1&&l.push(T),o)}function cL(o,l,h,g,T){switch(l){case"focusin":return Jr=Au(Jr,o,l,h,g,T),!0;case"dragenter":return Qr=Au(Qr,o,l,h,g,T),!0;case"mouseover":return Zr=Au(Zr,o,l,h,g,T),!0;case"pointerover":var R=T.pointerId;return Tu.set(R,Au(Tu.get(R)||null,o,l,h,g,T)),!0;case"gotpointercapture":return R=T.pointerId,xu.set(R,Au(xu.get(R)||null,o,l,h,g,T)),!0}return!1}function QE(o){var l=H(o.target);if(l!==null){var h=r(l);if(h!==null){if(l=h.tag,l===13){if(l=a(h),l!==null){o.blockedOn=l,gt(o.priority,function(){YE(h)});return}}else if(l===31){if(l=u(h),l!==null){o.blockedOn=l,gt(o.priority,function(){YE(h)});return}}else if(l===3&&h.stateNode.current.memoizedState.isDehydrated){o.blockedOn=h.tag===3?h.stateNode.containerInfo:null;return}}}o.blockedOn=null}function uf(o){if(o.blockedOn!==null)return!1;for(var l=o.targetContainers;0<l.length;){var h=em(o.nativeEvent);if(h===null){h=o.nativeEvent;var g=new h.constructor(h.type,h);th=g,h.target.dispatchEvent(g),th=null}else return l=se(h),l!==null&&KE(l),o.blockedOn=h,!1;l.shift()}return!0}function ZE(o,l,h){uf(o)&&h.delete(l)}function fL(){nm=!1,Jr!==null&&uf(Jr)&&(Jr=null),Qr!==null&&uf(Qr)&&(Qr=null),Zr!==null&&uf(Zr)&&(Zr=null),Tu.forEach(ZE),xu.forEach(ZE)}function cf(o,l){o.blockedOn===l&&(o.blockedOn=null,nm||(nm=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,fL)))}var ff=null;function jE(o){ff!==o&&(ff=o,i.unstable_scheduleCallback(i.unstable_NormalPriority,function(){ff===o&&(ff=null);for(var l=0;l<o.length;l+=3){var h=o[l],g=o[l+1],T=o[l+2];if(typeof g!="function"){if(tm(g||h)===null)continue;break}var R=se(h);R!==null&&(o.splice(l,3),l-=3,ep(R,{pending:!0,data:T,method:h.method,action:g},g,T))}}))}function Ba(o){function l(Z){return cf(Z,o)}Jr!==null&&cf(Jr,o),Qr!==null&&cf(Qr,o),Zr!==null&&cf(Zr,o),Tu.forEach(l),xu.forEach(l);for(var h=0;h<jr.length;h++){var g=jr[h];g.blockedOn===o&&(g.blockedOn=null)}for(;0<jr.length&&(h=jr[0],h.blockedOn===null);)QE(h),h.blockedOn===null&&jr.shift();if(h=(o.ownerDocument||o).$$reactFormReplay,h!=null)for(g=0;g<h.length;g+=3){var T=h[g],R=h[g+1],D=T[nn]||null;if(typeof R=="function")D||jE(h);else if(D){var B=null;if(R&&R.hasAttribute("formAction")){if(T=R,D=R[nn]||null)B=D.formAction;else if(tm(T)!==null)continue}else B=D.action;typeof B=="function"?h[g+1]=B:(h.splice(g,3),g-=3),jE(h)}}}function eS(){function o(R){R.canIntercept&&R.info==="react-transition"&&R.intercept({handler:function(){return new Promise(function(D){return T=D})},focusReset:"manual",scroll:"manual"})}function l(){T!==null&&(T(),T=null),g||setTimeout(h,20)}function h(){if(!g&&!navigation.transition){var R=navigation.currentEntry;R&&R.url!=null&&navigation.navigate(R.url,{state:R.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var g=!1,T=null;return navigation.addEventListener("navigate",o),navigation.addEventListener("navigatesuccess",l),navigation.addEventListener("navigateerror",l),setTimeout(h,100),function(){g=!0,navigation.removeEventListener("navigate",o),navigation.removeEventListener("navigatesuccess",l),navigation.removeEventListener("navigateerror",l),T!==null&&(T(),T=null)}}}function im(o){this._internalRoot=o}df.prototype.render=im.prototype.render=function(o){var l=this._internalRoot;if(l===null)throw Error(n(409));var h=l.current,g=qi();qE(h,g,o,l,null,null)},df.prototype.unmount=im.prototype.unmount=function(){var o=this._internalRoot;if(o!==null){this._internalRoot=null;var l=o.containerInfo;qE(o.current,2,null,o,null,null),qc(),l[Kt]=null}};function df(o){this._internalRoot=o}df.prototype.unstable_scheduleHydration=function(o){if(o){var l=vt();o={blockedOn:null,target:o,priority:l};for(var h=0;h<jr.length&&l!==0&&l<jr[h].priority;h++);jr.splice(h,0,o),h===0&&QE(o)}};var tS=e.version;if(tS!=="19.2.3")throw Error(n(527,tS,"19.2.3"));W.findDOMNode=function(o){var l=o._reactInternals;if(l===void 0)throw typeof o.render=="function"?Error(n(188)):(o=Object.keys(o).join(","),Error(n(268,o)));return o=c(l),o=o!==null?d(o):null,o=o===null?null:o.stateNode,o};var dL={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:V,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var hf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!hf.isDisabled&&hf.supportsFiber)try{st=hf.inject(dL),ot=hf}catch{}}return bu.createRoot=function(o,l){if(!s(o))throw Error(n(299));var h=!1,g="",T=l_,R=u_,D=c_;return l!=null&&(l.unstable_strictMode===!0&&(h=!0),l.identifierPrefix!==void 0&&(g=l.identifierPrefix),l.onUncaughtError!==void 0&&(T=l.onUncaughtError),l.onCaughtError!==void 0&&(R=l.onCaughtError),l.onRecoverableError!==void 0&&(D=l.onRecoverableError)),l=zE(o,1,!1,null,null,h,g,null,T,R,D,eS),o[Kt]=l.current,kp(o),new im(l)},bu.hydrateRoot=function(o,l,h){if(!s(o))throw Error(n(299));var g=!1,T="",R=l_,D=u_,B=c_,Z=null;return h!=null&&(h.unstable_strictMode===!0&&(g=!0),h.identifierPrefix!==void 0&&(T=h.identifierPrefix),h.onUncaughtError!==void 0&&(R=h.onUncaughtError),h.onCaughtError!==void 0&&(D=h.onCaughtError),h.onRecoverableError!==void 0&&(B=h.onRecoverableError),h.formState!==void 0&&(Z=h.formState)),l=zE(o,1,!0,l,h??null,g,T,Z,R,D,B,eS),l.context=$E(null),h=l.current,g=qi(),g=Ks(g),T=kr(g),T.callback=null,Br(h,T,g),h=g,l.current.lanes=h,zn(l,h),Ns(l),o[Kt]=l.current,kp(o),new df(l)},bu.version="19.2.3",bu}var fS;function TL(){if(fS)return rm.exports;fS=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),rm.exports=SL(),rm.exports}var xL=TL(),ke=L0(),AL={};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let RL,bL;function ML(){return{geminiUrl:RL,vertexUrl:bL}}function CL(i,e,t,n){var s,r;if(!(i!=null&&i.baseUrl)){const a=ML();return e?(s=a.vertexUrl)!==null&&s!==void 0?s:t:(r=a.geminiUrl)!==null&&r!==void 0?r:n}return i.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ir{}function Je(i,e){const t=/\{([^}]+)\}/g;return i.replace(t,(n,s)=>{if(Object.prototype.hasOwnProperty.call(e,s)){const r=e[s];return r!=null?String(r):""}else throw new Error(`Key '${s}' not found in valueMap.`)})}function _(i,e,t){for(let r=0;r<e.length-1;r++){const a=e[r];if(a.endsWith("[]")){const u=a.slice(0,-2);if(!(u in i))if(Array.isArray(t))i[u]=Array.from({length:t.length},()=>({}));else throw new Error(`Value must be a list given an array path ${a}`);if(Array.isArray(i[u])){const f=i[u];if(Array.isArray(t))for(let c=0;c<f.length;c++){const d=f[c];_(d,e.slice(r+1),t[c])}else for(const c of f)_(c,e.slice(r+1),t)}return}else if(a.endsWith("[0]")){const u=a.slice(0,-3);u in i||(i[u]=[{}]);const f=i[u];_(f[0],e.slice(r+1),t);return}(!i[a]||typeof i[a]!="object")&&(i[a]={}),i=i[a]}const n=e[e.length-1],s=i[n];if(s!==void 0){if(!t||typeof t=="object"&&Object.keys(t).length===0||t===s)return;if(typeof s=="object"&&typeof t=="object"&&s!==null&&t!==null)Object.assign(s,t);else throw new Error(`Cannot set value for an existing key. Key: ${n}`)}else n==="_self"&&typeof t=="object"&&t!==null&&!Array.isArray(t)?Object.assign(i,t):i[n]=t}function v(i,e,t=void 0){try{if(e.length===1&&e[0]==="_self")return i;for(let n=0;n<e.length;n++){if(typeof i!="object"||i===null)return t;const s=e[n];if(s.endsWith("[]")){const r=s.slice(0,-2);if(r in i){const a=i[r];return Array.isArray(a)?a.map(u=>v(u,e.slice(n+1),t)):t}else return t}else i=i[s]}return i}catch(n){if(n instanceof TypeError)return t;throw n}}function IL(i,e){for(const[t,n]of Object.entries(e)){const s=t.split("."),r=n.split("."),a=new Set;let u=-1;for(let f=0;f<s.length;f++)if(s[f]==="*"){u=f;break}if(u!==-1&&r.length>u)for(let f=u;f<r.length;f++){const c=r[f];c!=="*"&&!c.endsWith("[]")&&!c.endsWith("[0]")&&a.add(c)}fg(i,s,r,0,a)}}function fg(i,e,t,n,s){if(n>=e.length||typeof i!="object"||i===null)return;const r=e[n];if(r.endsWith("[]")){const a=r.slice(0,-2),u=i;if(a in u&&Array.isArray(u[a]))for(const f of u[a])fg(f,e,t,n+1,s)}else if(r==="*"){if(typeof i=="object"&&i!==null&&!Array.isArray(i)){const a=i,u=Object.keys(a).filter(c=>!c.startsWith("_")&&!s.has(c)),f={};for(const c of u)f[c]=a[c];for(const[c,d]of Object.entries(f)){const p=[];for(const m of t.slice(n))m==="*"?p.push(c):p.push(m);_(a,p,d)}for(const c of u)delete a[c]}}else{const a=i;r in a&&fg(a[r],e,t,n+1,s)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function D0(i){if(typeof i!="string")throw new Error("fromImageBytes must be a string");return i}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function LL(i){const e={},t=v(i,["operationName"]);t!=null&&_(e,["operationName"],t);const n=v(i,["resourceName"]);return n!=null&&_(e,["_url","resourceName"],n),e}function DL(i){const e={},t=v(i,["name"]);t!=null&&_(e,["name"],t);const n=v(i,["metadata"]);n!=null&&_(e,["metadata"],n);const s=v(i,["done"]);s!=null&&_(e,["done"],s);const r=v(i,["error"]);r!=null&&_(e,["error"],r);const a=v(i,["response","generateVideoResponse"]);return a!=null&&_(e,["response"],PL(a)),e}function wL(i){const e={},t=v(i,["name"]);t!=null&&_(e,["name"],t);const n=v(i,["metadata"]);n!=null&&_(e,["metadata"],n);const s=v(i,["done"]);s!=null&&_(e,["done"],s);const r=v(i,["error"]);r!=null&&_(e,["error"],r);const a=v(i,["response"]);return a!=null&&_(e,["response"],NL(a)),e}function PL(i){const e={},t=v(i,["generatedSamples"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(a=>UL(a))),_(e,["generatedVideos"],r)}const n=v(i,["raiMediaFilteredCount"]);n!=null&&_(e,["raiMediaFilteredCount"],n);const s=v(i,["raiMediaFilteredReasons"]);return s!=null&&_(e,["raiMediaFilteredReasons"],s),e}function NL(i){const e={},t=v(i,["videos"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(a=>OL(a))),_(e,["generatedVideos"],r)}const n=v(i,["raiMediaFilteredCount"]);n!=null&&_(e,["raiMediaFilteredCount"],n);const s=v(i,["raiMediaFilteredReasons"]);return s!=null&&_(e,["raiMediaFilteredReasons"],s),e}function UL(i){const e={},t=v(i,["video"]);return t!=null&&_(e,["video"],HL(t)),e}function OL(i){const e={},t=v(i,["_self"]);return t!=null&&_(e,["video"],zL(t)),e}function FL(i){const e={},t=v(i,["operationName"]);return t!=null&&_(e,["_url","operationName"],t),e}function kL(i){const e={},t=v(i,["operationName"]);return t!=null&&_(e,["_url","operationName"],t),e}function BL(i){const e={},t=v(i,["name"]);t!=null&&_(e,["name"],t);const n=v(i,["metadata"]);n!=null&&_(e,["metadata"],n);const s=v(i,["done"]);s!=null&&_(e,["done"],s);const r=v(i,["error"]);r!=null&&_(e,["error"],r);const a=v(i,["response"]);return a!=null&&_(e,["response"],GL(a)),e}function GL(i){const e={},t=v(i,["sdkHttpResponse"]);t!=null&&_(e,["sdkHttpResponse"],t);const n=v(i,["parent"]);n!=null&&_(e,["parent"],n);const s=v(i,["documentName"]);return s!=null&&_(e,["documentName"],s),e}function uR(i){const e={},t=v(i,["name"]);t!=null&&_(e,["name"],t);const n=v(i,["metadata"]);n!=null&&_(e,["metadata"],n);const s=v(i,["done"]);s!=null&&_(e,["done"],s);const r=v(i,["error"]);r!=null&&_(e,["error"],r);const a=v(i,["response"]);return a!=null&&_(e,["response"],VL(a)),e}function VL(i){const e={},t=v(i,["sdkHttpResponse"]);t!=null&&_(e,["sdkHttpResponse"],t);const n=v(i,["parent"]);n!=null&&_(e,["parent"],n);const s=v(i,["documentName"]);return s!=null&&_(e,["documentName"],s),e}function HL(i){const e={},t=v(i,["uri"]);t!=null&&_(e,["uri"],t);const n=v(i,["encodedVideo"]);n!=null&&_(e,["videoBytes"],D0(n));const s=v(i,["encoding"]);return s!=null&&_(e,["mimeType"],s),e}function zL(i){const e={},t=v(i,["gcsUri"]);t!=null&&_(e,["uri"],t);const n=v(i,["bytesBase64Encoded"]);n!=null&&_(e,["videoBytes"],D0(n));const s=v(i,["mimeType"]);return s!=null&&_(e,["mimeType"],s),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var dS;(function(i){i.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",i.OUTCOME_OK="OUTCOME_OK",i.OUTCOME_FAILED="OUTCOME_FAILED",i.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(dS||(dS={}));var hS;(function(i){i.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",i.PYTHON="PYTHON"})(hS||(hS={}));var pS;(function(i){i.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",i.SILENT="SILENT",i.WHEN_IDLE="WHEN_IDLE",i.INTERRUPT="INTERRUPT"})(pS||(pS={}));var ji;(function(i){i.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",i.STRING="STRING",i.NUMBER="NUMBER",i.INTEGER="INTEGER",i.BOOLEAN="BOOLEAN",i.ARRAY="ARRAY",i.OBJECT="OBJECT",i.NULL="NULL"})(ji||(ji={}));var mS;(function(i){i.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",i.SIMPLE_SEARCH="SIMPLE_SEARCH",i.ELASTIC_SEARCH="ELASTIC_SEARCH"})(mS||(mS={}));var gS;(function(i){i.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",i.NO_AUTH="NO_AUTH",i.API_KEY_AUTH="API_KEY_AUTH",i.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",i.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",i.OAUTH="OAUTH",i.OIDC_AUTH="OIDC_AUTH"})(gS||(gS={}));var vS;(function(i){i.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",i.HTTP_IN_QUERY="HTTP_IN_QUERY",i.HTTP_IN_HEADER="HTTP_IN_HEADER",i.HTTP_IN_PATH="HTTP_IN_PATH",i.HTTP_IN_BODY="HTTP_IN_BODY",i.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(vS||(vS={}));var yS;(function(i){i.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",i.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",i.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",i.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",i.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",i.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",i.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(yS||(yS={}));var _S;(function(i){i.UNSPECIFIED="UNSPECIFIED",i.BLOCKING="BLOCKING",i.NON_BLOCKING="NON_BLOCKING"})(_S||(_S={}));var ES;(function(i){i.MODE_UNSPECIFIED="MODE_UNSPECIFIED",i.MODE_DYNAMIC="MODE_DYNAMIC"})(ES||(ES={}));var SS;(function(i){i.MODE_UNSPECIFIED="MODE_UNSPECIFIED",i.AUTO="AUTO",i.ANY="ANY",i.NONE="NONE",i.VALIDATED="VALIDATED"})(SS||(SS={}));var TS;(function(i){i.THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",i.LOW="LOW",i.MEDIUM="MEDIUM",i.HIGH="HIGH",i.MINIMAL="MINIMAL"})(TS||(TS={}));var xS;(function(i){i.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",i.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",i.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",i.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",i.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",i.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",i.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",i.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",i.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",i.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",i.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(xS||(xS={}));var AS;(function(i){i.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",i.SEVERITY="SEVERITY",i.PROBABILITY="PROBABILITY"})(AS||(AS={}));var RS;(function(i){i.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",i.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",i.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",i.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",i.BLOCK_NONE="BLOCK_NONE",i.OFF="OFF"})(RS||(RS={}));var bS;(function(i){i.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",i.STOP="STOP",i.MAX_TOKENS="MAX_TOKENS",i.SAFETY="SAFETY",i.RECITATION="RECITATION",i.LANGUAGE="LANGUAGE",i.OTHER="OTHER",i.BLOCKLIST="BLOCKLIST",i.PROHIBITED_CONTENT="PROHIBITED_CONTENT",i.SPII="SPII",i.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",i.IMAGE_SAFETY="IMAGE_SAFETY",i.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",i.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",i.NO_IMAGE="NO_IMAGE",i.IMAGE_RECITATION="IMAGE_RECITATION",i.IMAGE_OTHER="IMAGE_OTHER"})(bS||(bS={}));var MS;(function(i){i.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",i.NEGLIGIBLE="NEGLIGIBLE",i.LOW="LOW",i.MEDIUM="MEDIUM",i.HIGH="HIGH"})(MS||(MS={}));var CS;(function(i){i.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",i.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",i.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",i.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",i.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(CS||(CS={}));var IS;(function(i){i.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",i.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",i.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",i.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",i.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(IS||(IS={}));var LS;(function(i){i.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",i.SAFETY="SAFETY",i.OTHER="OTHER",i.BLOCKLIST="BLOCKLIST",i.PROHIBITED_CONTENT="PROHIBITED_CONTENT",i.IMAGE_SAFETY="IMAGE_SAFETY",i.MODEL_ARMOR="MODEL_ARMOR",i.JAILBREAK="JAILBREAK"})(LS||(LS={}));var DS;(function(i){i.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",i.ON_DEMAND="ON_DEMAND",i.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(DS||(DS={}));var _d;(function(i){i.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",i.TEXT="TEXT",i.IMAGE="IMAGE",i.AUDIO="AUDIO"})(_d||(_d={}));var wS;(function(i){i.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",i.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",i.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",i.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(wS||(wS={}));var PS;(function(i){i.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",i.TUNING_MODE_FULL="TUNING_MODE_FULL",i.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(PS||(PS={}));var NS;(function(i){i.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",i.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",i.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",i.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",i.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",i.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",i.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(NS||(NS={}));var dg;(function(i){i.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",i.JOB_STATE_QUEUED="JOB_STATE_QUEUED",i.JOB_STATE_PENDING="JOB_STATE_PENDING",i.JOB_STATE_RUNNING="JOB_STATE_RUNNING",i.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",i.JOB_STATE_FAILED="JOB_STATE_FAILED",i.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",i.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",i.JOB_STATE_PAUSED="JOB_STATE_PAUSED",i.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",i.JOB_STATE_UPDATING="JOB_STATE_UPDATING",i.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(dg||(dg={}));var US;(function(i){i.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",i.TUNING_TASK_I2V="TUNING_TASK_I2V",i.TUNING_TASK_T2V="TUNING_TASK_T2V",i.TUNING_TASK_R2V="TUNING_TASK_R2V"})(US||(US={}));var OS;(function(i){i.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",i.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",i.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",i.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",i.MEDIA_RESOLUTION_ULTRA_HIGH="MEDIA_RESOLUTION_ULTRA_HIGH"})(OS||(OS={}));var FS;(function(i){i.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",i.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",i.BALANCED="BALANCED",i.PRIORITIZE_COST="PRIORITIZE_COST"})(FS||(FS={}));var kS;(function(i){i.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",i.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(kS||(kS={}));var BS;(function(i){i.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",i.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",i.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",i.BLOCK_NONE="BLOCK_NONE"})(BS||(BS={}));var GS;(function(i){i.DONT_ALLOW="DONT_ALLOW",i.ALLOW_ADULT="ALLOW_ADULT",i.ALLOW_ALL="ALLOW_ALL"})(GS||(GS={}));var VS;(function(i){i.auto="auto",i.en="en",i.ja="ja",i.ko="ko",i.hi="hi",i.zh="zh",i.pt="pt",i.es="es"})(VS||(VS={}));var HS;(function(i){i.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",i.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",i.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",i.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",i.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(HS||(HS={}));var zS;(function(i){i.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",i.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",i.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",i.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(zS||(zS={}));var $S;(function(i){i.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",i.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",i.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",i.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})($S||($S={}));var qS;(function(i){i.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",i.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",i.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",i.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",i.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",i.EDIT_MODE_STYLE="EDIT_MODE_STYLE",i.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",i.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(qS||(qS={}));var WS;(function(i){i.FOREGROUND="FOREGROUND",i.BACKGROUND="BACKGROUND",i.PROMPT="PROMPT",i.SEMANTIC="SEMANTIC",i.INTERACTIVE="INTERACTIVE"})(WS||(WS={}));var KS;(function(i){i.ASSET="ASSET",i.STYLE="STYLE"})(KS||(KS={}));var YS;(function(i){i.INSERT="INSERT",i.REMOVE="REMOVE",i.REMOVE_STATIC="REMOVE_STATIC",i.OUTPAINT="OUTPAINT"})(YS||(YS={}));var XS;(function(i){i.OPTIMIZED="OPTIMIZED",i.LOSSLESS="LOSSLESS"})(XS||(XS={}));var JS;(function(i){i.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",i.PREFERENCE_TUNING="PREFERENCE_TUNING"})(JS||(JS={}));var QS;(function(i){i.STATE_UNSPECIFIED="STATE_UNSPECIFIED",i.STATE_PENDING="STATE_PENDING",i.STATE_ACTIVE="STATE_ACTIVE",i.STATE_FAILED="STATE_FAILED"})(QS||(QS={}));var ZS;(function(i){i.STATE_UNSPECIFIED="STATE_UNSPECIFIED",i.PROCESSING="PROCESSING",i.ACTIVE="ACTIVE",i.FAILED="FAILED"})(ZS||(ZS={}));var jS;(function(i){i.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",i.UPLOADED="UPLOADED",i.GENERATED="GENERATED",i.REGISTERED="REGISTERED"})(jS||(jS={}));var eT;(function(i){i.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",i.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",i.RESPONSE_REJECTED="RESPONSE_REJECTED",i.NEED_MORE_INPUT="NEED_MORE_INPUT"})(eT||(eT={}));var tT;(function(i){i.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",i.TEXT="TEXT",i.IMAGE="IMAGE",i.VIDEO="VIDEO",i.AUDIO="AUDIO",i.DOCUMENT="DOCUMENT"})(tT||(tT={}));var nT;(function(i){i.VAD_SIGNAL_TYPE_UNSPECIFIED="VAD_SIGNAL_TYPE_UNSPECIFIED",i.VAD_SIGNAL_TYPE_SOS="VAD_SIGNAL_TYPE_SOS",i.VAD_SIGNAL_TYPE_EOS="VAD_SIGNAL_TYPE_EOS"})(nT||(nT={}));var iT;(function(i){i.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",i.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",i.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(iT||(iT={}));var sT;(function(i){i.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",i.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",i.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(sT||(sT={}));var rT;(function(i){i.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",i.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",i.NO_INTERRUPTION="NO_INTERRUPTION"})(rT||(rT={}));var oT;(function(i){i.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",i.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",i.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(oT||(oT={}));var aT;(function(i){i.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",i.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",i.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",i.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",i.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",i.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",i.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",i.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",i.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",i.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",i.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",i.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",i.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(aT||(aT={}));var lT;(function(i){i.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",i.QUALITY="QUALITY",i.DIVERSITY="DIVERSITY",i.VOCALIZATION="VOCALIZATION"})(lT||(lT={}));var ul;(function(i){i.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",i.PLAY="PLAY",i.PAUSE="PAUSE",i.STOP="STOP",i.RESET_CONTEXT="RESET_CONTEXT"})(ul||(ul={}));class hg{constructor(e){const t={};for(const n of e.headers.entries())t[n[0]]=n[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}}class Mu{get text(){var e,t,n,s,r,a,u,f;if(((s=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let c="",d=!1;const p=[];for(const m of(f=(u=(a=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||a===void 0?void 0:a.content)===null||u===void 0?void 0:u.parts)!==null&&f!==void 0?f:[]){for(const[y,E]of Object.entries(m))y!=="text"&&y!=="thought"&&y!=="thoughtSignature"&&(E!==null||E!==void 0)&&p.push(y);if(typeof m.text=="string"){if(typeof m.thought=="boolean"&&m.thought)continue;d=!0,c+=m.text}}return p.length>0&&console.warn(`there are non-text parts ${p} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),d?c:void 0}get data(){var e,t,n,s,r,a,u,f;if(((s=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let c="";const d=[];for(const p of(f=(u=(a=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||a===void 0?void 0:a.content)===null||u===void 0?void 0:u.parts)!==null&&f!==void 0?f:[]){for(const[m,y]of Object.entries(p))m!=="inlineData"&&(y!==null||y!==void 0)&&d.push(m);p.inlineData&&typeof p.inlineData.data=="string"&&(c+=atob(p.inlineData.data))}return d.length>0&&console.warn(`there are non-data parts ${d} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),c.length>0?btoa(c):void 0}get functionCalls(){var e,t,n,s,r,a,u,f;if(((s=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const c=(f=(u=(a=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||a===void 0?void 0:a.content)===null||u===void 0?void 0:u.parts)===null||f===void 0?void 0:f.filter(d=>d.functionCall).map(d=>d.functionCall).filter(d=>d!==void 0);if((c==null?void 0:c.length)!==0)return c}get executableCode(){var e,t,n,s,r,a,u,f,c;if(((s=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const d=(f=(u=(a=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||a===void 0?void 0:a.content)===null||u===void 0?void 0:u.parts)===null||f===void 0?void 0:f.filter(p=>p.executableCode).map(p=>p.executableCode).filter(p=>p!==void 0);if((d==null?void 0:d.length)!==0)return(c=d==null?void 0:d[0])===null||c===void 0?void 0:c.code}get codeExecutionResult(){var e,t,n,s,r,a,u,f,c;if(((s=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const d=(f=(u=(a=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||a===void 0?void 0:a.content)===null||u===void 0?void 0:u.parts)===null||f===void 0?void 0:f.filter(p=>p.codeExecutionResult).map(p=>p.codeExecutionResult).filter(p=>p!==void 0);if((d==null?void 0:d.length)!==0)return(c=d==null?void 0:d[0])===null||c===void 0?void 0:c.output}}class uT{}class cT{}class $L{}class qL{}class WL{}class KL{}class fT{}class dT{}class hT{}class YL{}class Ed{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){const n=new Ed;let s;const r=e;return t?s=wL(r):s=DL(r),Object.assign(n,s),n}}class pT{}class mT{}class gT{}class vT{}class XL{}class JL{}class QL{}class w0{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){const n=new w0,r=BL(e);return Object.assign(n,r),n}}class ZL{}class jL{}class eD{}class yT{}class tD{get text(){var e,t,n;let s="",r=!1;const a=[];for(const u of(n=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&n!==void 0?n:[]){for(const[f,c]of Object.entries(u))f!=="text"&&f!=="thought"&&c!==null&&a.push(f);if(typeof u.text=="string"){if(typeof u.thought=="boolean"&&u.thought)continue;r=!0,s+=u.text}}return a.length>0&&console.warn(`there are non-text parts ${a} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),r?s:void 0}get data(){var e,t,n;let s="";const r=[];for(const a of(n=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&n!==void 0?n:[]){for(const[u,f]of Object.entries(a))u!=="inlineData"&&f!==null&&r.push(u);a.inlineData&&typeof a.inlineData.data=="string"&&(s+=atob(a.inlineData.data))}return r.length>0&&console.warn(`there are non-data parts ${r} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),s.length>0?btoa(s):void 0}}class nD{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class P0{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){const n=new P0,r=uR(e);return Object.assign(n,r),n}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Zt(i,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(e.includes("..")||e.includes("?")||e.includes("&"))throw new Error("invalid model parameter");if(i.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const t=e.split("/",2);return`publishers/${t[0]}/models/${t[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function cR(i,e){const t=Zt(i,e);return t?t.startsWith("publishers/")&&i.isVertexAI()?`projects/${i.getProject()}/locations/${i.getLocation()}/${t}`:t.startsWith("models/")&&i.isVertexAI()?`projects/${i.getProject()}/locations/${i.getLocation()}/publishers/google/${t}`:t:""}function fR(i){return Array.isArray(i)?i.map(e=>Sd(e)):[Sd(i)]}function Sd(i){if(typeof i=="object"&&i!==null)return i;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof i}`)}function dR(i){const e=Sd(i);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function hR(i){const e=Sd(i);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function _T(i){if(i==null)throw new Error("PartUnion is required");if(typeof i=="object")return i;if(typeof i=="string")return{text:i};throw new Error(`Unsupported part type: ${typeof i}`)}function pR(i){if(i==null||Array.isArray(i)&&i.length===0)throw new Error("PartListUnion is required");return Array.isArray(i)?i.map(e=>_T(e)):[_T(i)]}function pg(i){return i!=null&&typeof i=="object"&&"parts"in i&&Array.isArray(i.parts)}function ET(i){return i!=null&&typeof i=="object"&&"functionCall"in i}function ST(i){return i!=null&&typeof i=="object"&&"functionResponse"in i}function mi(i){if(i==null)throw new Error("ContentUnion is required");return pg(i)?i:{role:"user",parts:pR(i)}}function N0(i,e){if(!e)return[];if(i.isVertexAI()&&Array.isArray(e))return e.flatMap(t=>{const n=mi(t);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]});if(i.isVertexAI()){const t=mi(e);return t.parts&&t.parts.length>0&&t.parts[0].text!==void 0?[t.parts[0].text]:[]}return Array.isArray(e)?e.map(t=>mi(t)):[mi(e)]}function ds(i){if(i==null||Array.isArray(i)&&i.length===0)throw new Error("contents are required");if(!Array.isArray(i)){if(ET(i)||ST(i))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[mi(i)]}const e=[],t=[],n=pg(i[0]);for(const s of i){const r=pg(s);if(r!=n)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(r)e.push(s);else{if(ET(s)||ST(s))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");t.push(s)}}return n||e.push({role:"user",parts:pR(t)}),e}function iD(i,e){i.includes("null")&&(e.nullable=!0);const t=i.filter(n=>n!=="null");if(t.length===1)e.type=Object.values(ji).includes(t[0].toUpperCase())?t[0].toUpperCase():ji.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const n of t)e.anyOf.push({type:Object.values(ji).includes(n.toUpperCase())?n.toUpperCase():ji.TYPE_UNSPECIFIED})}}function hl(i){const e={},t=["items"],n=["anyOf"],s=["properties"];if(i.type&&i.anyOf)throw new Error("type and anyOf cannot be both populated.");const r=i.anyOf;r!=null&&r.length==2&&(r[0].type==="null"?(e.nullable=!0,i=r[1]):r[1].type==="null"&&(e.nullable=!0,i=r[0])),i.type instanceof Array&&iD(i.type,e);for(const[a,u]of Object.entries(i))if(u!=null)if(a=="type"){if(u==="null")throw new Error("type: null can not be the only possible type for the field.");if(u instanceof Array)continue;e.type=Object.values(ji).includes(u.toUpperCase())?u.toUpperCase():ji.TYPE_UNSPECIFIED}else if(t.includes(a))e[a]=hl(u);else if(n.includes(a)){const f=[];for(const c of u){if(c.type=="null"){e.nullable=!0;continue}f.push(hl(c))}e[a]=f}else if(s.includes(a)){const f={};for(const[c,d]of Object.entries(u))f[c]=hl(d);e[a]=f}else{if(a==="additionalProperties")continue;e[a]=u}return e}function U0(i){return hl(i)}function O0(i){if(typeof i=="object")return i;if(typeof i=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:i}}};throw new Error(`Unsupported speechConfig type: ${typeof i}`)}function F0(i){if("multiSpeakerVoiceConfig"in i)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return i}function Dl(i){if(i.functionDeclarations)for(const e of i.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=hl(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=hl(e.response));return i}function wl(i){if(i==null)throw new Error("tools is required");if(!Array.isArray(i))throw new Error("tools is required and must be an array of Tools");const e=[];for(const t of i)e.push(t);return e}function sD(i,e,t,n=1){const s=!e.startsWith(`${t}/`)&&e.split("/").length===n;return i.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${i.getProject()}/${e}`:e.startsWith(`${t}/`)?`projects/${i.getProject()}/locations/${i.getLocation()}/${e}`:s?`projects/${i.getProject()}/locations/${i.getLocation()}/${t}/${e}`:e:s?`${t}/${e}`:e}function Lr(i,e){if(typeof e!="string")throw new Error("name must be a string");return sD(i,e,"cachedContents")}function mR(i){switch(i){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return i}}function Eo(i){return D0(i)}function rD(i){return i!=null&&typeof i=="object"&&"name"in i}function oD(i){return i!=null&&typeof i=="object"&&"video"in i}function aD(i){return i!=null&&typeof i=="object"&&"uri"in i}function gR(i){var e;let t;if(rD(i)&&(t=i.name),!(aD(i)&&(t=i.uri,t===void 0))&&!(oD(i)&&(t=(e=i.video)===null||e===void 0?void 0:e.uri,t===void 0))){if(typeof i=="string"&&(t=i),t===void 0)throw new Error("Could not extract file name from the provided input.");if(t.startsWith("https://")){const s=t.split("files/")[1].match(/[a-z0-9]+/);if(s===null)throw new Error(`Could not extract file name from URI ${t}`);t=s[0]}else t.startsWith("files/")&&(t=t.split("files/")[1]);return t}}function vR(i,e){let t;return i.isVertexAI()?t=e?"publishers/google/models":"models":t=e?"models":"tunedModels",t}function yR(i){for(const e of["models","tunedModels","publisherModels"])if(lD(i,e))return i[e];return[]}function lD(i,e){return i!==null&&typeof i=="object"&&e in i}function uD(i,e={}){const t=i,n={name:t.name,description:t.description,parametersJsonSchema:t.inputSchema};return t.outputSchema&&(n.responseJsonSchema=t.outputSchema),e.behavior&&(n.behavior=e.behavior),{functionDeclarations:[n]}}function cD(i,e={}){const t=[],n=new Set;for(const s of i){const r=s.name;if(n.has(r))throw new Error(`Duplicate function name ${r} found in MCP tools. Please ensure function names are unique.`);n.add(r);const a=uD(s,e);a.functionDeclarations&&t.push(...a.functionDeclarations)}return{functionDeclarations:t}}function _R(i,e){let t;if(typeof e=="string")if(i.isVertexAI())if(e.startsWith("gs://"))t={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))t={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))t={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(i.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");t={inlinedRequests:e}}else t=e;const n=[t.gcsUri,t.bigqueryUri].filter(Boolean).length,s=[t.inlinedRequests,t.fileName].filter(Boolean).length;if(i.isVertexAI()){if(s>0||n!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(n>0||s!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return t}function fD(i){if(typeof i!="string")return i;const e=i;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function ER(i){if(typeof i!="object"||i===null)return{};const e=i,t=e.inlinedResponses;if(typeof t!="object"||t===null)return i;const s=t.inlinedResponses;if(!Array.isArray(s)||s.length===0)return i;let r=!1;for(const a of s){if(typeof a!="object"||a===null)continue;const f=a.response;if(typeof f!="object"||f===null)continue;if(f.embedding!==void 0){r=!0;break}}return r&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),i}function Pl(i,e){const t=e;if(!i.isVertexAI()){if(/batches\/[^/]+$/.test(t))return t.split("/").pop();throw new Error(`Invalid batch job name: ${t}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(t))return t.split("/").pop();if(/^\d+$/.test(t))return t;throw new Error(`Invalid batch job name: ${t}.`)}function SR(i){const e=i;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function dD(i){const e={},t=v(i,["responsesFile"]);t!=null&&_(e,["fileName"],t);const n=v(i,["inlinedResponses","inlinedResponses"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(a=>WD(a))),_(e,["inlinedResponses"],r)}const s=v(i,["inlinedEmbedContentResponses","inlinedResponses"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(a=>a)),_(e,["inlinedEmbedContentResponses"],r)}return e}function hD(i){const e={},t=v(i,["predictionsFormat"]);t!=null&&_(e,["format"],t);const n=v(i,["gcsDestination","outputUriPrefix"]);n!=null&&_(e,["gcsUri"],n);const s=v(i,["bigqueryDestination","outputUri"]);return s!=null&&_(e,["bigqueryUri"],s),e}function pD(i){const e={},t=v(i,["format"]);t!=null&&_(e,["predictionsFormat"],t);const n=v(i,["gcsUri"]);n!=null&&_(e,["gcsDestination","outputUriPrefix"],n);const s=v(i,["bigqueryUri"]);if(s!=null&&_(e,["bigqueryDestination","outputUri"],s),v(i,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(v(i,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(v(i,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function id(i){const e={},t=v(i,["name"]);t!=null&&_(e,["name"],t);const n=v(i,["metadata","displayName"]);n!=null&&_(e,["displayName"],n);const s=v(i,["metadata","state"]);s!=null&&_(e,["state"],SR(s));const r=v(i,["metadata","createTime"]);r!=null&&_(e,["createTime"],r);const a=v(i,["metadata","endTime"]);a!=null&&_(e,["endTime"],a);const u=v(i,["metadata","updateTime"]);u!=null&&_(e,["updateTime"],u);const f=v(i,["metadata","model"]);f!=null&&_(e,["model"],f);const c=v(i,["metadata","output"]);return c!=null&&_(e,["dest"],dD(ER(c))),e}function mg(i){const e={},t=v(i,["name"]);t!=null&&_(e,["name"],t);const n=v(i,["displayName"]);n!=null&&_(e,["displayName"],n);const s=v(i,["state"]);s!=null&&_(e,["state"],SR(s));const r=v(i,["error"]);r!=null&&_(e,["error"],r);const a=v(i,["createTime"]);a!=null&&_(e,["createTime"],a);const u=v(i,["startTime"]);u!=null&&_(e,["startTime"],u);const f=v(i,["endTime"]);f!=null&&_(e,["endTime"],f);const c=v(i,["updateTime"]);c!=null&&_(e,["updateTime"],c);const d=v(i,["model"]);d!=null&&_(e,["model"],d);const p=v(i,["inputConfig"]);p!=null&&_(e,["src"],mD(p));const m=v(i,["outputConfig"]);m!=null&&_(e,["dest"],hD(ER(m)));const y=v(i,["completionStats"]);return y!=null&&_(e,["completionStats"],y),e}function mD(i){const e={},t=v(i,["instancesFormat"]);t!=null&&_(e,["format"],t);const n=v(i,["gcsSource","uris"]);n!=null&&_(e,["gcsUri"],n);const s=v(i,["bigquerySource","inputUri"]);return s!=null&&_(e,["bigqueryUri"],s),e}function gD(i,e){const t={};if(v(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(v(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(v(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const n=v(e,["fileName"]);n!=null&&_(t,["fileName"],n);const s=v(e,["inlinedRequests"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(a=>qD(i,a))),_(t,["requests","requests"],r)}return t}function vD(i){const e={},t=v(i,["format"]);t!=null&&_(e,["instancesFormat"],t);const n=v(i,["gcsUri"]);n!=null&&_(e,["gcsSource","uris"],n);const s=v(i,["bigqueryUri"]);if(s!=null&&_(e,["bigquerySource","inputUri"],s),v(i,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(v(i,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function yD(i){const e={},t=v(i,["data"]);if(t!=null&&_(e,["data"],t),v(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=v(i,["mimeType"]);return n!=null&&_(e,["mimeType"],n),e}function _D(i,e){const t={},n=v(e,["name"]);return n!=null&&_(t,["_url","name"],Pl(i,n)),t}function ED(i,e){const t={},n=v(e,["name"]);return n!=null&&_(t,["_url","name"],Pl(i,n)),t}function SD(i){const e={},t=v(i,["content"]);t!=null&&_(e,["content"],t);const n=v(i,["citationMetadata"]);n!=null&&_(e,["citationMetadata"],TD(n));const s=v(i,["tokenCount"]);s!=null&&_(e,["tokenCount"],s);const r=v(i,["finishReason"]);r!=null&&_(e,["finishReason"],r);const a=v(i,["avgLogprobs"]);a!=null&&_(e,["avgLogprobs"],a);const u=v(i,["groundingMetadata"]);u!=null&&_(e,["groundingMetadata"],u);const f=v(i,["index"]);f!=null&&_(e,["index"],f);const c=v(i,["logprobsResult"]);c!=null&&_(e,["logprobsResult"],c);const d=v(i,["safetyRatings"]);if(d!=null){let m=d;Array.isArray(m)&&(m=m.map(y=>y)),_(e,["safetyRatings"],m)}const p=v(i,["urlContextMetadata"]);return p!=null&&_(e,["urlContextMetadata"],p),e}function TD(i){const e={},t=v(i,["citationSources"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(s=>s)),_(e,["citations"],n)}return e}function TR(i){const e={},t=v(i,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(r=>jD(r))),_(e,["parts"],s)}const n=v(i,["role"]);return n!=null&&_(e,["role"],n),e}function xD(i,e){const t={},n=v(i,["displayName"]);if(e!==void 0&&n!=null&&_(e,["batch","displayName"],n),v(i,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return t}function AD(i,e){const t={},n=v(i,["displayName"]);e!==void 0&&n!=null&&_(e,["displayName"],n);const s=v(i,["dest"]);return e!==void 0&&s!=null&&_(e,["outputConfig"],pD(fD(s))),t}function TT(i,e){const t={},n=v(e,["model"]);n!=null&&_(t,["_url","model"],Zt(i,n));const s=v(e,["src"]);s!=null&&_(t,["batch","inputConfig"],gD(i,_R(i,s)));const r=v(e,["config"]);return r!=null&&xD(r,t),t}function RD(i,e){const t={},n=v(e,["model"]);n!=null&&_(t,["model"],Zt(i,n));const s=v(e,["src"]);s!=null&&_(t,["inputConfig"],vD(_R(i,s)));const r=v(e,["config"]);return r!=null&&AD(r,t),t}function bD(i,e){const t={},n=v(i,["displayName"]);return e!==void 0&&n!=null&&_(e,["batch","displayName"],n),t}function MD(i,e){const t={},n=v(e,["model"]);n!=null&&_(t,["_url","model"],Zt(i,n));const s=v(e,["src"]);s!=null&&_(t,["batch","inputConfig"],ND(i,s));const r=v(e,["config"]);return r!=null&&bD(r,t),t}function CD(i,e){const t={},n=v(e,["name"]);return n!=null&&_(t,["_url","name"],Pl(i,n)),t}function ID(i,e){const t={},n=v(e,["name"]);return n!=null&&_(t,["_url","name"],Pl(i,n)),t}function LD(i){const e={},t=v(i,["sdkHttpResponse"]);t!=null&&_(e,["sdkHttpResponse"],t);const n=v(i,["name"]);n!=null&&_(e,["name"],n);const s=v(i,["done"]);s!=null&&_(e,["done"],s);const r=v(i,["error"]);return r!=null&&_(e,["error"],r),e}function DD(i){const e={},t=v(i,["sdkHttpResponse"]);t!=null&&_(e,["sdkHttpResponse"],t);const n=v(i,["name"]);n!=null&&_(e,["name"],n);const s=v(i,["done"]);s!=null&&_(e,["done"],s);const r=v(i,["error"]);return r!=null&&_(e,["error"],r),e}function wD(i,e){const t={},n=v(e,["contents"]);if(n!=null){let r=N0(i,n);Array.isArray(r)&&(r=r.map(a=>a)),_(t,["requests[]","request","content"],r)}const s=v(e,["config"]);return s!=null&&(_(t,["_self"],PD(s,t)),IL(t,{"requests[].*":"requests[].request.*"})),t}function PD(i,e){const t={},n=v(i,["taskType"]);e!==void 0&&n!=null&&_(e,["requests[]","taskType"],n);const s=v(i,["title"]);e!==void 0&&s!=null&&_(e,["requests[]","title"],s);const r=v(i,["outputDimensionality"]);if(e!==void 0&&r!=null&&_(e,["requests[]","outputDimensionality"],r),v(i,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(v(i,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function ND(i,e){const t={},n=v(e,["fileName"]);n!=null&&_(t,["file_name"],n);const s=v(e,["inlinedRequests"]);return s!=null&&_(t,["requests"],wD(i,s)),t}function UD(i){const e={};if(v(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=v(i,["fileUri"]);t!=null&&_(e,["fileUri"],t);const n=v(i,["mimeType"]);return n!=null&&_(e,["mimeType"],n),e}function OD(i){const e={},t=v(i,["id"]);t!=null&&_(e,["id"],t);const n=v(i,["args"]);n!=null&&_(e,["args"],n);const s=v(i,["name"]);if(s!=null&&_(e,["name"],s),v(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(v(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function FD(i){const e={},t=v(i,["allowedFunctionNames"]);t!=null&&_(e,["allowedFunctionNames"],t);const n=v(i,["mode"]);if(n!=null&&_(e,["mode"],n),v(i,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function kD(i,e,t){const n={},s=v(e,["systemInstruction"]);t!==void 0&&s!=null&&_(t,["systemInstruction"],TR(mi(s)));const r=v(e,["temperature"]);r!=null&&_(n,["temperature"],r);const a=v(e,["topP"]);a!=null&&_(n,["topP"],a);const u=v(e,["topK"]);u!=null&&_(n,["topK"],u);const f=v(e,["candidateCount"]);f!=null&&_(n,["candidateCount"],f);const c=v(e,["maxOutputTokens"]);c!=null&&_(n,["maxOutputTokens"],c);const d=v(e,["stopSequences"]);d!=null&&_(n,["stopSequences"],d);const p=v(e,["responseLogprobs"]);p!=null&&_(n,["responseLogprobs"],p);const m=v(e,["logprobs"]);m!=null&&_(n,["logprobs"],m);const y=v(e,["presencePenalty"]);y!=null&&_(n,["presencePenalty"],y);const E=v(e,["frequencyPenalty"]);E!=null&&_(n,["frequencyPenalty"],E);const A=v(e,["seed"]);A!=null&&_(n,["seed"],A);const S=v(e,["responseMimeType"]);S!=null&&_(n,["responseMimeType"],S);const x=v(e,["responseSchema"]);x!=null&&_(n,["responseSchema"],U0(x));const M=v(e,["responseJsonSchema"]);if(M!=null&&_(n,["responseJsonSchema"],M),v(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(v(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const b=v(e,["safetySettings"]);if(t!==void 0&&b!=null){let Y=b;Array.isArray(Y)&&(Y=Y.map(ee=>ew(ee))),_(t,["safetySettings"],Y)}const C=v(e,["tools"]);if(t!==void 0&&C!=null){let Y=wl(C);Array.isArray(Y)&&(Y=Y.map(ee=>nw(Dl(ee)))),_(t,["tools"],Y)}const N=v(e,["toolConfig"]);if(t!==void 0&&N!=null&&_(t,["toolConfig"],tw(N)),v(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const U=v(e,["cachedContent"]);t!==void 0&&U!=null&&_(t,["cachedContent"],Lr(i,U));const w=v(e,["responseModalities"]);w!=null&&_(n,["responseModalities"],w);const O=v(e,["mediaResolution"]);O!=null&&_(n,["mediaResolution"],O);const L=v(e,["speechConfig"]);if(L!=null&&_(n,["speechConfig"],O0(L)),v(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const I=v(e,["thinkingConfig"]);I!=null&&_(n,["thinkingConfig"],I);const F=v(e,["imageConfig"]);F!=null&&_(n,["imageConfig"],$D(F));const X=v(e,["enableEnhancedCivicAnswers"]);return X!=null&&_(n,["enableEnhancedCivicAnswers"],X),n}function BD(i){const e={},t=v(i,["sdkHttpResponse"]);t!=null&&_(e,["sdkHttpResponse"],t);const n=v(i,["candidates"]);if(n!=null){let f=n;Array.isArray(f)&&(f=f.map(c=>SD(c))),_(e,["candidates"],f)}const s=v(i,["modelVersion"]);s!=null&&_(e,["modelVersion"],s);const r=v(i,["promptFeedback"]);r!=null&&_(e,["promptFeedback"],r);const a=v(i,["responseId"]);a!=null&&_(e,["responseId"],a);const u=v(i,["usageMetadata"]);return u!=null&&_(e,["usageMetadata"],u),e}function GD(i,e){const t={},n=v(e,["name"]);return n!=null&&_(t,["_url","name"],Pl(i,n)),t}function VD(i,e){const t={},n=v(e,["name"]);return n!=null&&_(t,["_url","name"],Pl(i,n)),t}function HD(i){const e={};if(v(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=v(i,["enableWidget"]);return t!=null&&_(e,["enableWidget"],t),e}function zD(i){const e={};if(v(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(v(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=v(i,["timeRangeFilter"]);return t!=null&&_(e,["timeRangeFilter"],t),e}function $D(i){const e={},t=v(i,["aspectRatio"]);t!=null&&_(e,["aspectRatio"],t);const n=v(i,["imageSize"]);if(n!=null&&_(e,["imageSize"],n),v(i,["personGeneration"])!==void 0)throw new Error("personGeneration parameter is not supported in Gemini API.");if(v(i,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(v(i,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function qD(i,e){const t={},n=v(e,["model"]);n!=null&&_(t,["request","model"],Zt(i,n));const s=v(e,["contents"]);if(s!=null){let u=ds(s);Array.isArray(u)&&(u=u.map(f=>TR(f))),_(t,["request","contents"],u)}const r=v(e,["metadata"]);r!=null&&_(t,["metadata"],r);const a=v(e,["config"]);return a!=null&&_(t,["request","generationConfig"],kD(i,a,v(t,["request"],{}))),t}function WD(i){const e={},t=v(i,["response"]);t!=null&&_(e,["response"],BD(t));const n=v(i,["error"]);return n!=null&&_(e,["error"],n),e}function KD(i,e){const t={},n=v(i,["pageSize"]);e!==void 0&&n!=null&&_(e,["_query","pageSize"],n);const s=v(i,["pageToken"]);if(e!==void 0&&s!=null&&_(e,["_query","pageToken"],s),v(i,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return t}function YD(i,e){const t={},n=v(i,["pageSize"]);e!==void 0&&n!=null&&_(e,["_query","pageSize"],n);const s=v(i,["pageToken"]);e!==void 0&&s!=null&&_(e,["_query","pageToken"],s);const r=v(i,["filter"]);return e!==void 0&&r!=null&&_(e,["_query","filter"],r),t}function XD(i){const e={},t=v(i,["config"]);return t!=null&&KD(t,e),e}function JD(i){const e={},t=v(i,["config"]);return t!=null&&YD(t,e),e}function QD(i){const e={},t=v(i,["sdkHttpResponse"]);t!=null&&_(e,["sdkHttpResponse"],t);const n=v(i,["nextPageToken"]);n!=null&&_(e,["nextPageToken"],n);const s=v(i,["operations"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(a=>id(a))),_(e,["batchJobs"],r)}return e}function ZD(i){const e={},t=v(i,["sdkHttpResponse"]);t!=null&&_(e,["sdkHttpResponse"],t);const n=v(i,["nextPageToken"]);n!=null&&_(e,["nextPageToken"],n);const s=v(i,["batchPredictionJobs"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(a=>mg(a))),_(e,["batchJobs"],r)}return e}function jD(i){const e={},t=v(i,["mediaResolution"]);t!=null&&_(e,["mediaResolution"],t);const n=v(i,["codeExecutionResult"]);n!=null&&_(e,["codeExecutionResult"],n);const s=v(i,["executableCode"]);s!=null&&_(e,["executableCode"],s);const r=v(i,["fileData"]);r!=null&&_(e,["fileData"],UD(r));const a=v(i,["functionCall"]);a!=null&&_(e,["functionCall"],OD(a));const u=v(i,["functionResponse"]);u!=null&&_(e,["functionResponse"],u);const f=v(i,["inlineData"]);f!=null&&_(e,["inlineData"],yD(f));const c=v(i,["text"]);c!=null&&_(e,["text"],c);const d=v(i,["thought"]);d!=null&&_(e,["thought"],d);const p=v(i,["thoughtSignature"]);p!=null&&_(e,["thoughtSignature"],p);const m=v(i,["videoMetadata"]);return m!=null&&_(e,["videoMetadata"],m),e}function ew(i){const e={},t=v(i,["category"]);if(t!=null&&_(e,["category"],t),v(i,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const n=v(i,["threshold"]);return n!=null&&_(e,["threshold"],n),e}function tw(i){const e={},t=v(i,["retrievalConfig"]);t!=null&&_(e,["retrievalConfig"],t);const n=v(i,["functionCallingConfig"]);return n!=null&&_(e,["functionCallingConfig"],FD(n)),e}function nw(i){const e={};if(v(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const t=v(i,["computerUse"]);t!=null&&_(e,["computerUse"],t);const n=v(i,["fileSearch"]);n!=null&&_(e,["fileSearch"],n);const s=v(i,["codeExecution"]);if(s!=null&&_(e,["codeExecution"],s),v(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const r=v(i,["functionDeclarations"]);if(r!=null){let d=r;Array.isArray(d)&&(d=d.map(p=>p)),_(e,["functionDeclarations"],d)}const a=v(i,["googleMaps"]);a!=null&&_(e,["googleMaps"],HD(a));const u=v(i,["googleSearch"]);u!=null&&_(e,["googleSearch"],zD(u));const f=v(i,["googleSearchRetrieval"]);f!=null&&_(e,["googleSearchRetrieval"],f);const c=v(i,["urlContext"]);return c!=null&&_(e,["urlContext"],c),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var br;(function(i){i.PAGED_ITEM_BATCH_JOBS="batchJobs",i.PAGED_ITEM_MODELS="models",i.PAGED_ITEM_TUNING_JOBS="tuningJobs",i.PAGED_ITEM_FILES="files",i.PAGED_ITEM_CACHED_CONTENTS="cachedContents",i.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",i.PAGED_ITEM_DOCUMENTS="documents"})(br||(br={}));class oa{constructor(e,t,n,s){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,n,s)}init(e,t,n){var s,r;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.sdkHttpResponseInternal=t==null?void 0:t.sdkHttpResponse,this.idxInternal=0;let a={config:{}};!n||Object.keys(n).length===0?a={config:{}}:typeof n=="object"?a=Object.assign({},n):a=n,a.config&&(a.config.pageToken=t.nextPageToken),this.paramsInternal=a,this.pageInternalSize=(r=(s=a.config)===null||s===void 0?void 0:s.pageSize)!==null&&r!==void 0?r:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class iw extends Ir{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new oa(br.PAGED_ITEM_BATCH_JOBS,n=>this.listInternal(n),await this.listInternal(t),t),this.create=async t=>(this.apiClient.isVertexAI()&&(t.config=this.formatDestination(t.src,t.config)),this.createInternal(t)),this.createEmbeddings=async t=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(t)}}createInlinedGenerateContentRequest(e){const t=TT(this.apiClient,e),n=t._url,s=Je("{model}:batchGenerateContent",n),u=t.batch.inputConfig.requests,f=u.requests,c=[];for(const d of f){const p=Object.assign({},d);if(p.systemInstruction){const m=p.systemInstruction;delete p.systemInstruction;const y=p.request;y.systemInstruction=m,p.request=y}c.push(p)}return u.requests=c,delete t.config,delete t._url,delete t._query,{path:s,body:t}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,t){const n=t?Object.assign({},t):{},s=Date.now().toString();if(n.displayName||(n.displayName=`genaiBatchJob_${s}`),n.dest===void 0){const r=this.getGcsUri(e),a=this.getBigqueryUri(e);if(r)r.endsWith(".jsonl")?n.dest=`${r.slice(0,-6)}/dest`:n.dest=`${r}_dest_${s}`;else if(a)n.dest=`${a}_dest_${s}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return n}async createInternal(e){var t,n,s,r;let a,u="",f={};if(this.apiClient.isVertexAI()){const c=RD(this.apiClient,e);return u=Je("batchPredictionJobs",c._url),f=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),a.then(d=>mg(d))}else{const c=TT(this.apiClient,e);return u=Je("{model}:batchGenerateContent",c._url),f=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),a.then(d=>id(d))}}async createEmbeddingsInternal(e){var t,n;let s,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=MD(this.apiClient,e);return r=Je("{model}:asyncBatchEmbedContent",u._url),a=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),s.then(f=>id(f))}}async get(e){var t,n,s,r;let a,u="",f={};if(this.apiClient.isVertexAI()){const c=VD(this.apiClient,e);return u=Je("batchPredictionJobs/{name}",c._url),f=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),a.then(d=>mg(d))}else{const c=GD(this.apiClient,e);return u=Je("batches/{name}",c._url),f=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),a.then(d=>id(d))}}async cancel(e){var t,n,s,r;let a="",u={};if(this.apiClient.isVertexAI()){const f=ED(this.apiClient,e);a=Je("batchPredictionJobs/{name}:cancel",f._url),u=f._query,delete f._url,delete f._query,await this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal})}else{const f=_D(this.apiClient,e);a=Je("batches/{name}:cancel",f._url),u=f._query,delete f._url,delete f._query,await this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(e){var t,n,s,r;let a,u="",f={};if(this.apiClient.isVertexAI()){const c=JD(e);return u=Je("batchPredictionJobs",c._url),f=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:d.headers},m})),a.then(d=>{const p=ZD(d),m=new yT;return Object.assign(m,p),m})}else{const c=XD(e);return u=Je("batches",c._url),f=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:d.headers},m})),a.then(d=>{const p=QD(d),m=new yT;return Object.assign(m,p),m})}}async delete(e){var t,n,s,r;let a,u="",f={};if(this.apiClient.isVertexAI()){const c=ID(this.apiClient,e);return u=Je("batchPredictionJobs/{name}",c._url),f=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:d.headers},m})),a.then(d=>DD(d))}else{const c=CD(this.apiClient,e);return u=Je("batches/{name}",c._url),f=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:d.headers},m})),a.then(d=>LD(d))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function sw(i){const e={},t=v(i,["data"]);if(t!=null&&_(e,["data"],t),v(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=v(i,["mimeType"]);return n!=null&&_(e,["mimeType"],n),e}function xT(i){const e={},t=v(i,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(r=>Mw(r))),_(e,["parts"],s)}const n=v(i,["role"]);return n!=null&&_(e,["role"],n),e}function rw(i,e){const t={},n=v(i,["ttl"]);e!==void 0&&n!=null&&_(e,["ttl"],n);const s=v(i,["expireTime"]);e!==void 0&&s!=null&&_(e,["expireTime"],s);const r=v(i,["displayName"]);e!==void 0&&r!=null&&_(e,["displayName"],r);const a=v(i,["contents"]);if(e!==void 0&&a!=null){let d=ds(a);Array.isArray(d)&&(d=d.map(p=>xT(p))),_(e,["contents"],d)}const u=v(i,["systemInstruction"]);e!==void 0&&u!=null&&_(e,["systemInstruction"],xT(mi(u)));const f=v(i,["tools"]);if(e!==void 0&&f!=null){let d=f;Array.isArray(d)&&(d=d.map(p=>Iw(p))),_(e,["tools"],d)}const c=v(i,["toolConfig"]);if(e!==void 0&&c!=null&&_(e,["toolConfig"],Cw(c)),v(i,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return t}function ow(i,e){const t={},n=v(i,["ttl"]);e!==void 0&&n!=null&&_(e,["ttl"],n);const s=v(i,["expireTime"]);e!==void 0&&s!=null&&_(e,["expireTime"],s);const r=v(i,["displayName"]);e!==void 0&&r!=null&&_(e,["displayName"],r);const a=v(i,["contents"]);if(e!==void 0&&a!=null){let p=ds(a);Array.isArray(p)&&(p=p.map(m=>m)),_(e,["contents"],p)}const u=v(i,["systemInstruction"]);e!==void 0&&u!=null&&_(e,["systemInstruction"],mi(u));const f=v(i,["tools"]);if(e!==void 0&&f!=null){let p=f;Array.isArray(p)&&(p=p.map(m=>Lw(m))),_(e,["tools"],p)}const c=v(i,["toolConfig"]);e!==void 0&&c!=null&&_(e,["toolConfig"],c);const d=v(i,["kmsKeyName"]);return e!==void 0&&d!=null&&_(e,["encryption_spec","kmsKeyName"],d),t}function aw(i,e){const t={},n=v(e,["model"]);n!=null&&_(t,["model"],cR(i,n));const s=v(e,["config"]);return s!=null&&rw(s,t),t}function lw(i,e){const t={},n=v(e,["model"]);n!=null&&_(t,["model"],cR(i,n));const s=v(e,["config"]);return s!=null&&ow(s,t),t}function uw(i,e){const t={},n=v(e,["name"]);return n!=null&&_(t,["_url","name"],Lr(i,n)),t}function cw(i,e){const t={},n=v(e,["name"]);return n!=null&&_(t,["_url","name"],Lr(i,n)),t}function fw(i){const e={},t=v(i,["sdkHttpResponse"]);return t!=null&&_(e,["sdkHttpResponse"],t),e}function dw(i){const e={},t=v(i,["sdkHttpResponse"]);return t!=null&&_(e,["sdkHttpResponse"],t),e}function hw(i){const e={};if(v(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=v(i,["fileUri"]);t!=null&&_(e,["fileUri"],t);const n=v(i,["mimeType"]);return n!=null&&_(e,["mimeType"],n),e}function pw(i){const e={},t=v(i,["id"]);t!=null&&_(e,["id"],t);const n=v(i,["args"]);n!=null&&_(e,["args"],n);const s=v(i,["name"]);if(s!=null&&_(e,["name"],s),v(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(v(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function mw(i){const e={},t=v(i,["allowedFunctionNames"]);t!=null&&_(e,["allowedFunctionNames"],t);const n=v(i,["mode"]);if(n!=null&&_(e,["mode"],n),v(i,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function gw(i){const e={},t=v(i,["description"]);t!=null&&_(e,["description"],t);const n=v(i,["name"]);n!=null&&_(e,["name"],n);const s=v(i,["parameters"]);s!=null&&_(e,["parameters"],s);const r=v(i,["parametersJsonSchema"]);r!=null&&_(e,["parametersJsonSchema"],r);const a=v(i,["response"]);a!=null&&_(e,["response"],a);const u=v(i,["responseJsonSchema"]);if(u!=null&&_(e,["responseJsonSchema"],u),v(i,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");return e}function vw(i,e){const t={},n=v(e,["name"]);return n!=null&&_(t,["_url","name"],Lr(i,n)),t}function yw(i,e){const t={},n=v(e,["name"]);return n!=null&&_(t,["_url","name"],Lr(i,n)),t}function _w(i){const e={};if(v(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=v(i,["enableWidget"]);return t!=null&&_(e,["enableWidget"],t),e}function Ew(i){const e={};if(v(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(v(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=v(i,["timeRangeFilter"]);return t!=null&&_(e,["timeRangeFilter"],t),e}function Sw(i,e){const t={},n=v(i,["pageSize"]);e!==void 0&&n!=null&&_(e,["_query","pageSize"],n);const s=v(i,["pageToken"]);return e!==void 0&&s!=null&&_(e,["_query","pageToken"],s),t}function Tw(i,e){const t={},n=v(i,["pageSize"]);e!==void 0&&n!=null&&_(e,["_query","pageSize"],n);const s=v(i,["pageToken"]);return e!==void 0&&s!=null&&_(e,["_query","pageToken"],s),t}function xw(i){const e={},t=v(i,["config"]);return t!=null&&Sw(t,e),e}function Aw(i){const e={},t=v(i,["config"]);return t!=null&&Tw(t,e),e}function Rw(i){const e={},t=v(i,["sdkHttpResponse"]);t!=null&&_(e,["sdkHttpResponse"],t);const n=v(i,["nextPageToken"]);n!=null&&_(e,["nextPageToken"],n);const s=v(i,["cachedContents"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(a=>a)),_(e,["cachedContents"],r)}return e}function bw(i){const e={},t=v(i,["sdkHttpResponse"]);t!=null&&_(e,["sdkHttpResponse"],t);const n=v(i,["nextPageToken"]);n!=null&&_(e,["nextPageToken"],n);const s=v(i,["cachedContents"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(a=>a)),_(e,["cachedContents"],r)}return e}function Mw(i){const e={},t=v(i,["mediaResolution"]);t!=null&&_(e,["mediaResolution"],t);const n=v(i,["codeExecutionResult"]);n!=null&&_(e,["codeExecutionResult"],n);const s=v(i,["executableCode"]);s!=null&&_(e,["executableCode"],s);const r=v(i,["fileData"]);r!=null&&_(e,["fileData"],hw(r));const a=v(i,["functionCall"]);a!=null&&_(e,["functionCall"],pw(a));const u=v(i,["functionResponse"]);u!=null&&_(e,["functionResponse"],u);const f=v(i,["inlineData"]);f!=null&&_(e,["inlineData"],sw(f));const c=v(i,["text"]);c!=null&&_(e,["text"],c);const d=v(i,["thought"]);d!=null&&_(e,["thought"],d);const p=v(i,["thoughtSignature"]);p!=null&&_(e,["thoughtSignature"],p);const m=v(i,["videoMetadata"]);return m!=null&&_(e,["videoMetadata"],m),e}function Cw(i){const e={},t=v(i,["retrievalConfig"]);t!=null&&_(e,["retrievalConfig"],t);const n=v(i,["functionCallingConfig"]);return n!=null&&_(e,["functionCallingConfig"],mw(n)),e}function Iw(i){const e={};if(v(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const t=v(i,["computerUse"]);t!=null&&_(e,["computerUse"],t);const n=v(i,["fileSearch"]);n!=null&&_(e,["fileSearch"],n);const s=v(i,["codeExecution"]);if(s!=null&&_(e,["codeExecution"],s),v(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const r=v(i,["functionDeclarations"]);if(r!=null){let d=r;Array.isArray(d)&&(d=d.map(p=>p)),_(e,["functionDeclarations"],d)}const a=v(i,["googleMaps"]);a!=null&&_(e,["googleMaps"],_w(a));const u=v(i,["googleSearch"]);u!=null&&_(e,["googleSearch"],Ew(u));const f=v(i,["googleSearchRetrieval"]);f!=null&&_(e,["googleSearchRetrieval"],f);const c=v(i,["urlContext"]);return c!=null&&_(e,["urlContext"],c),e}function Lw(i){const e={},t=v(i,["retrieval"]);t!=null&&_(e,["retrieval"],t);const n=v(i,["computerUse"]);if(n!=null&&_(e,["computerUse"],n),v(i,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const s=v(i,["codeExecution"]);s!=null&&_(e,["codeExecution"],s);const r=v(i,["enterpriseWebSearch"]);r!=null&&_(e,["enterpriseWebSearch"],r);const a=v(i,["functionDeclarations"]);if(a!=null){let p=a;Array.isArray(p)&&(p=p.map(m=>gw(m))),_(e,["functionDeclarations"],p)}const u=v(i,["googleMaps"]);u!=null&&_(e,["googleMaps"],u);const f=v(i,["googleSearch"]);f!=null&&_(e,["googleSearch"],f);const c=v(i,["googleSearchRetrieval"]);c!=null&&_(e,["googleSearchRetrieval"],c);const d=v(i,["urlContext"]);return d!=null&&_(e,["urlContext"],d),e}function Dw(i,e){const t={},n=v(i,["ttl"]);e!==void 0&&n!=null&&_(e,["ttl"],n);const s=v(i,["expireTime"]);return e!==void 0&&s!=null&&_(e,["expireTime"],s),t}function ww(i,e){const t={},n=v(i,["ttl"]);e!==void 0&&n!=null&&_(e,["ttl"],n);const s=v(i,["expireTime"]);return e!==void 0&&s!=null&&_(e,["expireTime"],s),t}function Pw(i,e){const t={},n=v(e,["name"]);n!=null&&_(t,["_url","name"],Lr(i,n));const s=v(e,["config"]);return s!=null&&Dw(s,t),t}function Nw(i,e){const t={},n=v(e,["name"]);n!=null&&_(t,["_url","name"],Lr(i,n));const s=v(e,["config"]);return s!=null&&ww(s,t),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Uw extends Ir{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new oa(br.PAGED_ITEM_CACHED_CONTENTS,n=>this.listInternal(n),await this.listInternal(t),t)}async create(e){var t,n,s,r;let a,u="",f={};if(this.apiClient.isVertexAI()){const c=lw(this.apiClient,e);return u=Je("cachedContents",c._url),f=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),a.then(d=>d)}else{const c=aw(this.apiClient,e);return u=Je("cachedContents",c._url),f=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),a.then(d=>d)}}async get(e){var t,n,s,r;let a,u="",f={};if(this.apiClient.isVertexAI()){const c=yw(this.apiClient,e);return u=Je("{name}",c._url),f=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),a.then(d=>d)}else{const c=vw(this.apiClient,e);return u=Je("{name}",c._url),f=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),a.then(d=>d)}}async delete(e){var t,n,s,r;let a,u="",f={};if(this.apiClient.isVertexAI()){const c=cw(this.apiClient,e);return u=Je("{name}",c._url),f=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:d.headers},m})),a.then(d=>{const p=dw(d),m=new gT;return Object.assign(m,p),m})}else{const c=uw(this.apiClient,e);return u=Je("{name}",c._url),f=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:d.headers},m})),a.then(d=>{const p=fw(d),m=new gT;return Object.assign(m,p),m})}}async update(e){var t,n,s,r;let a,u="",f={};if(this.apiClient.isVertexAI()){const c=Nw(this.apiClient,e);return u=Je("{name}",c._url),f=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),a.then(d=>d)}else{const c=Pw(this.apiClient,e);return u=Je("{name}",c._url),f=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),a.then(d=>d)}}async listInternal(e){var t,n,s,r;let a,u="",f={};if(this.apiClient.isVertexAI()){const c=Aw(e);return u=Je("cachedContents",c._url),f=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:d.headers},m})),a.then(d=>{const p=bw(d),m=new vT;return Object.assign(m,p),m})}else{const c=xw(e);return u=Je("cachedContents",c._url),f=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:d.headers},m})),a.then(d=>{const p=Rw(d),m=new vT;return Object.assign(m,p),m})}}}function Td(i,e){var t={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&e.indexOf(n)<0&&(t[n]=i[n]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(i);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(i,n[s])&&(t[n[s]]=i[n[s]]);return t}function AT(i){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&i[e],n=0;if(t)return t.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&n>=i.length&&(i=void 0),{value:i&&i[n++],done:!i}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Tt(i){return this instanceof Tt?(this.v=i,this):new Tt(i)}function Ms(i,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(i,e||[]),s,r=[];return s=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),u("next"),u("throw"),u("return",a),s[Symbol.asyncIterator]=function(){return this},s;function a(y){return function(E){return Promise.resolve(E).then(y,p)}}function u(y,E){n[y]&&(s[y]=function(A){return new Promise(function(S,x){r.push([y,A,S,x])>1||f(y,A)})},E&&(s[y]=E(s[y])))}function f(y,E){try{c(n[y](E))}catch(A){m(r[0][3],A)}}function c(y){y.value instanceof Tt?Promise.resolve(y.value.v).then(d,p):m(r[0][2],y)}function d(y){f("next",y)}function p(y){f("throw",y)}function m(y,E){y(E),r.shift(),r.length&&f(r[0][0],r[0][1])}}function Cs(i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=i[Symbol.asyncIterator],t;return e?e.call(i):(i=typeof AT=="function"?AT(i):i[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=i[r]&&function(a){return new Promise(function(u,f){a=i[r](a),s(u,f,a.done,a.value)})}}function s(r,a,u,f){Promise.resolve(f).then(function(c){r({value:c,done:u})},a)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Ow(i){var e;if(i.candidates==null||i.candidates.length===0)return!1;const t=(e=i.candidates[0])===null||e===void 0?void 0:e.content;return t===void 0?!1:xR(t)}function xR(i){if(i.parts===void 0||i.parts.length===0)return!1;for(const e of i.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function Fw(i){if(i.length!==0){for(const e of i)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function RT(i){if(i===void 0||i.length===0)return[];const e=[],t=i.length;let n=0;for(;n<t;)if(i[n].role==="user")e.push(i[n]),n++;else{const s=[];let r=!0;for(;n<t&&i[n].role==="model";)s.push(i[n]),r&&!xR(i[n])&&(r=!1),n++;r?e.push(...s):e.pop()}return e}class kw{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new Bw(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class Bw{constructor(e,t,n,s={},r=[]){this.apiClient=e,this.modelsModule=t,this.model=n,this.config=s,this.history=r,this.sendPromise=Promise.resolve(),Fw(r)}async sendMessage(e){var t;await this.sendPromise;const n=mi(e.message),s=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(n),config:(t=e.config)!==null&&t!==void 0?t:this.config});return this.sendPromise=(async()=>{var r,a,u;const f=await s,c=(a=(r=f.candidates)===null||r===void 0?void 0:r[0])===null||a===void 0?void 0:a.content,d=f.automaticFunctionCallingHistory,p=this.getHistory(!0).length;let m=[];d!=null&&(m=(u=d.slice(p))!==null&&u!==void 0?u:[]);const y=c?[c]:[];this.recordHistory(n,y,m)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),s}async sendMessageStream(e){var t;await this.sendPromise;const n=mi(e.message),s=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(n),config:(t=e.config)!==null&&t!==void 0?t:this.config});this.sendPromise=s.then(()=>{}).catch(()=>{});const r=await s;return this.processStreamResponse(r,n)}getHistory(e=!1){const t=e?RT(this.history):this.history;return structuredClone(t)}processStreamResponse(e,t){return Ms(this,arguments,function*(){var s,r,a,u,f,c;const d=[];try{for(var p=!0,m=Cs(e),y;y=yield Tt(m.next()),s=y.done,!s;p=!0){u=y.value,p=!1;const E=u;if(Ow(E)){const A=(c=(f=E.candidates)===null||f===void 0?void 0:f[0])===null||c===void 0?void 0:c.content;A!==void 0&&d.push(A)}yield yield Tt(E)}}catch(E){r={error:E}}finally{try{!p&&!s&&(a=m.return)&&(yield Tt(a.call(m)))}finally{if(r)throw r.error}}this.recordHistory(t,d)})}recordHistory(e,t,n){let s=[];t.length>0&&t.every(r=>r.role!==void 0)?s=t:s.push({role:"model",parts:[]}),n&&n.length>0?this.history.push(...RT(n)):this.history.push(e),this.history.push(...s)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Gd extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,Gd.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Gw(i){const e={},t=v(i,["file"]);return t!=null&&_(e,["file"],t),e}function Vw(i){const e={},t=v(i,["sdkHttpResponse"]);return t!=null&&_(e,["sdkHttpResponse"],t),e}function Hw(i){const e={},t=v(i,["name"]);return t!=null&&_(e,["_url","file"],gR(t)),e}function zw(i){const e={},t=v(i,["sdkHttpResponse"]);return t!=null&&_(e,["sdkHttpResponse"],t),e}function $w(i){const e={},t=v(i,["name"]);return t!=null&&_(e,["_url","file"],gR(t)),e}function qw(i,e){const t={},n=v(i,["pageSize"]);e!==void 0&&n!=null&&_(e,["_query","pageSize"],n);const s=v(i,["pageToken"]);return e!==void 0&&s!=null&&_(e,["_query","pageToken"],s),t}function Ww(i){const e={},t=v(i,["config"]);return t!=null&&qw(t,e),e}function Kw(i){const e={},t=v(i,["sdkHttpResponse"]);t!=null&&_(e,["sdkHttpResponse"],t);const n=v(i,["nextPageToken"]);n!=null&&_(e,["nextPageToken"],n);const s=v(i,["files"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(a=>a)),_(e,["files"],r)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Yw extends Ir{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new oa(br.PAGED_ITEM_FILES,n=>this.listInternal(n),await this.listInternal(t),t)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(t=>t)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,n;let s,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=Ww(e);return r=Je("files",u._url),a=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json().then(c=>{const d=c;return d.sdkHttpResponse={headers:f.headers},d})),s.then(f=>{const c=Kw(f),d=new ZL;return Object.assign(d,c),d})}}async createInternal(e){var t,n;let s,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=Gw(e);return r=Je("upload/v1beta/files",u._url),a=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),s.then(f=>{const c=Vw(f),d=new jL;return Object.assign(d,c),d})}}async get(e){var t,n;let s,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=$w(e);return r=Je("files/{file}",u._url),a=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),s.then(f=>f)}}async delete(e){var t,n;let s,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=Hw(e);return r=Je("files/{file}",u._url),a=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json().then(c=>{const d=c;return d.sdkHttpResponse={headers:f.headers},d})),s.then(f=>{const c=zw(f),d=new eD;return Object.assign(d,c),d})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function sd(i){const e={},t=v(i,["data"]);if(t!=null&&_(e,["data"],t),v(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=v(i,["mimeType"]);return n!=null&&_(e,["mimeType"],n),e}function Xw(i){const e={},t=v(i,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(r=>f1(r))),_(e,["parts"],s)}const n=v(i,["role"]);return n!=null&&_(e,["role"],n),e}function Jw(i){const e={};if(v(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=v(i,["fileUri"]);t!=null&&_(e,["fileUri"],t);const n=v(i,["mimeType"]);return n!=null&&_(e,["mimeType"],n),e}function Qw(i){const e={},t=v(i,["id"]);t!=null&&_(e,["id"],t);const n=v(i,["args"]);n!=null&&_(e,["args"],n);const s=v(i,["name"]);if(s!=null&&_(e,["name"],s),v(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(v(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function Zw(i){const e={},t=v(i,["description"]);t!=null&&_(e,["description"],t);const n=v(i,["name"]);n!=null&&_(e,["name"],n);const s=v(i,["parameters"]);s!=null&&_(e,["parameters"],s);const r=v(i,["parametersJsonSchema"]);r!=null&&_(e,["parametersJsonSchema"],r);const a=v(i,["response"]);a!=null&&_(e,["response"],a);const u=v(i,["responseJsonSchema"]);if(u!=null&&_(e,["responseJsonSchema"],u),v(i,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");return e}function jw(i){const e={},t=v(i,["modelSelectionConfig"]);t!=null&&_(e,["modelConfig"],t);const n=v(i,["responseJsonSchema"]);n!=null&&_(e,["responseJsonSchema"],n);const s=v(i,["audioTimestamp"]);s!=null&&_(e,["audioTimestamp"],s);const r=v(i,["candidateCount"]);r!=null&&_(e,["candidateCount"],r);const a=v(i,["enableAffectiveDialog"]);a!=null&&_(e,["enableAffectiveDialog"],a);const u=v(i,["frequencyPenalty"]);u!=null&&_(e,["frequencyPenalty"],u);const f=v(i,["logprobs"]);f!=null&&_(e,["logprobs"],f);const c=v(i,["maxOutputTokens"]);c!=null&&_(e,["maxOutputTokens"],c);const d=v(i,["mediaResolution"]);d!=null&&_(e,["mediaResolution"],d);const p=v(i,["presencePenalty"]);p!=null&&_(e,["presencePenalty"],p);const m=v(i,["responseLogprobs"]);m!=null&&_(e,["responseLogprobs"],m);const y=v(i,["responseMimeType"]);y!=null&&_(e,["responseMimeType"],y);const E=v(i,["responseModalities"]);E!=null&&_(e,["responseModalities"],E);const A=v(i,["responseSchema"]);A!=null&&_(e,["responseSchema"],A);const S=v(i,["routingConfig"]);S!=null&&_(e,["routingConfig"],S);const x=v(i,["seed"]);x!=null&&_(e,["seed"],x);const M=v(i,["speechConfig"]);M!=null&&_(e,["speechConfig"],M);const b=v(i,["stopSequences"]);b!=null&&_(e,["stopSequences"],b);const C=v(i,["temperature"]);C!=null&&_(e,["temperature"],C);const N=v(i,["thinkingConfig"]);N!=null&&_(e,["thinkingConfig"],N);const U=v(i,["topK"]);U!=null&&_(e,["topK"],U);const w=v(i,["topP"]);if(w!=null&&_(e,["topP"],w),v(i,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function e1(i){const e={};if(v(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=v(i,["enableWidget"]);return t!=null&&_(e,["enableWidget"],t),e}function t1(i){const e={};if(v(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(v(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=v(i,["timeRangeFilter"]);return t!=null&&_(e,["timeRangeFilter"],t),e}function n1(i,e){const t={},n=v(i,["generationConfig"]);e!==void 0&&n!=null&&_(e,["setup","generationConfig"],n);const s=v(i,["responseModalities"]);e!==void 0&&s!=null&&_(e,["setup","generationConfig","responseModalities"],s);const r=v(i,["temperature"]);e!==void 0&&r!=null&&_(e,["setup","generationConfig","temperature"],r);const a=v(i,["topP"]);e!==void 0&&a!=null&&_(e,["setup","generationConfig","topP"],a);const u=v(i,["topK"]);e!==void 0&&u!=null&&_(e,["setup","generationConfig","topK"],u);const f=v(i,["maxOutputTokens"]);e!==void 0&&f!=null&&_(e,["setup","generationConfig","maxOutputTokens"],f);const c=v(i,["mediaResolution"]);e!==void 0&&c!=null&&_(e,["setup","generationConfig","mediaResolution"],c);const d=v(i,["seed"]);e!==void 0&&d!=null&&_(e,["setup","generationConfig","seed"],d);const p=v(i,["speechConfig"]);e!==void 0&&p!=null&&_(e,["setup","generationConfig","speechConfig"],F0(p));const m=v(i,["thinkingConfig"]);e!==void 0&&m!=null&&_(e,["setup","generationConfig","thinkingConfig"],m);const y=v(i,["enableAffectiveDialog"]);e!==void 0&&y!=null&&_(e,["setup","generationConfig","enableAffectiveDialog"],y);const E=v(i,["systemInstruction"]);e!==void 0&&E!=null&&_(e,["setup","systemInstruction"],Xw(mi(E)));const A=v(i,["tools"]);if(e!==void 0&&A!=null){let U=wl(A);Array.isArray(U)&&(U=U.map(w=>h1(Dl(w)))),_(e,["setup","tools"],U)}const S=v(i,["sessionResumption"]);e!==void 0&&S!=null&&_(e,["setup","sessionResumption"],d1(S));const x=v(i,["inputAudioTranscription"]);e!==void 0&&x!=null&&_(e,["setup","inputAudioTranscription"],x);const M=v(i,["outputAudioTranscription"]);e!==void 0&&M!=null&&_(e,["setup","outputAudioTranscription"],M);const b=v(i,["realtimeInputConfig"]);e!==void 0&&b!=null&&_(e,["setup","realtimeInputConfig"],b);const C=v(i,["contextWindowCompression"]);e!==void 0&&C!=null&&_(e,["setup","contextWindowCompression"],C);const N=v(i,["proactivity"]);if(e!==void 0&&N!=null&&_(e,["setup","proactivity"],N),v(i,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return t}function i1(i,e){const t={},n=v(i,["generationConfig"]);e!==void 0&&n!=null&&_(e,["setup","generationConfig"],jw(n));const s=v(i,["responseModalities"]);e!==void 0&&s!=null&&_(e,["setup","generationConfig","responseModalities"],s);const r=v(i,["temperature"]);e!==void 0&&r!=null&&_(e,["setup","generationConfig","temperature"],r);const a=v(i,["topP"]);e!==void 0&&a!=null&&_(e,["setup","generationConfig","topP"],a);const u=v(i,["topK"]);e!==void 0&&u!=null&&_(e,["setup","generationConfig","topK"],u);const f=v(i,["maxOutputTokens"]);e!==void 0&&f!=null&&_(e,["setup","generationConfig","maxOutputTokens"],f);const c=v(i,["mediaResolution"]);e!==void 0&&c!=null&&_(e,["setup","generationConfig","mediaResolution"],c);const d=v(i,["seed"]);e!==void 0&&d!=null&&_(e,["setup","generationConfig","seed"],d);const p=v(i,["speechConfig"]);e!==void 0&&p!=null&&_(e,["setup","generationConfig","speechConfig"],F0(p));const m=v(i,["thinkingConfig"]);e!==void 0&&m!=null&&_(e,["setup","generationConfig","thinkingConfig"],m);const y=v(i,["enableAffectiveDialog"]);e!==void 0&&y!=null&&_(e,["setup","generationConfig","enableAffectiveDialog"],y);const E=v(i,["systemInstruction"]);e!==void 0&&E!=null&&_(e,["setup","systemInstruction"],mi(E));const A=v(i,["tools"]);if(e!==void 0&&A!=null){let w=wl(A);Array.isArray(w)&&(w=w.map(O=>p1(Dl(O)))),_(e,["setup","tools"],w)}const S=v(i,["sessionResumption"]);e!==void 0&&S!=null&&_(e,["setup","sessionResumption"],S);const x=v(i,["inputAudioTranscription"]);e!==void 0&&x!=null&&_(e,["setup","inputAudioTranscription"],x);const M=v(i,["outputAudioTranscription"]);e!==void 0&&M!=null&&_(e,["setup","outputAudioTranscription"],M);const b=v(i,["realtimeInputConfig"]);e!==void 0&&b!=null&&_(e,["setup","realtimeInputConfig"],b);const C=v(i,["contextWindowCompression"]);e!==void 0&&C!=null&&_(e,["setup","contextWindowCompression"],C);const N=v(i,["proactivity"]);e!==void 0&&N!=null&&_(e,["setup","proactivity"],N);const U=v(i,["explicitVadSignal"]);return e!==void 0&&U!=null&&_(e,["setup","explicitVadSignal"],U),t}function s1(i,e){const t={},n=v(e,["model"]);n!=null&&_(t,["setup","model"],Zt(i,n));const s=v(e,["config"]);return s!=null&&_(t,["config"],n1(s,t)),t}function r1(i,e){const t={},n=v(e,["model"]);n!=null&&_(t,["setup","model"],Zt(i,n));const s=v(e,["config"]);return s!=null&&_(t,["config"],i1(s,t)),t}function o1(i){const e={},t=v(i,["musicGenerationConfig"]);return t!=null&&_(e,["musicGenerationConfig"],t),e}function a1(i){const e={},t=v(i,["weightedPrompts"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(s=>s)),_(e,["weightedPrompts"],n)}return e}function l1(i){const e={},t=v(i,["media"]);if(t!=null){let c=fR(t);Array.isArray(c)&&(c=c.map(d=>sd(d))),_(e,["mediaChunks"],c)}const n=v(i,["audio"]);n!=null&&_(e,["audio"],sd(hR(n)));const s=v(i,["audioStreamEnd"]);s!=null&&_(e,["audioStreamEnd"],s);const r=v(i,["video"]);r!=null&&_(e,["video"],sd(dR(r)));const a=v(i,["text"]);a!=null&&_(e,["text"],a);const u=v(i,["activityStart"]);u!=null&&_(e,["activityStart"],u);const f=v(i,["activityEnd"]);return f!=null&&_(e,["activityEnd"],f),e}function u1(i){const e={},t=v(i,["media"]);if(t!=null){let c=fR(t);Array.isArray(c)&&(c=c.map(d=>d)),_(e,["mediaChunks"],c)}const n=v(i,["audio"]);n!=null&&_(e,["audio"],hR(n));const s=v(i,["audioStreamEnd"]);s!=null&&_(e,["audioStreamEnd"],s);const r=v(i,["video"]);r!=null&&_(e,["video"],dR(r));const a=v(i,["text"]);a!=null&&_(e,["text"],a);const u=v(i,["activityStart"]);u!=null&&_(e,["activityStart"],u);const f=v(i,["activityEnd"]);return f!=null&&_(e,["activityEnd"],f),e}function c1(i){const e={},t=v(i,["setupComplete"]);t!=null&&_(e,["setupComplete"],t);const n=v(i,["serverContent"]);n!=null&&_(e,["serverContent"],n);const s=v(i,["toolCall"]);s!=null&&_(e,["toolCall"],s);const r=v(i,["toolCallCancellation"]);r!=null&&_(e,["toolCallCancellation"],r);const a=v(i,["usageMetadata"]);a!=null&&_(e,["usageMetadata"],m1(a));const u=v(i,["goAway"]);u!=null&&_(e,["goAway"],u);const f=v(i,["sessionResumptionUpdate"]);f!=null&&_(e,["sessionResumptionUpdate"],f);const c=v(i,["voiceActivityDetectionSignal"]);return c!=null&&_(e,["voiceActivityDetectionSignal"],c),e}function f1(i){const e={},t=v(i,["mediaResolution"]);t!=null&&_(e,["mediaResolution"],t);const n=v(i,["codeExecutionResult"]);n!=null&&_(e,["codeExecutionResult"],n);const s=v(i,["executableCode"]);s!=null&&_(e,["executableCode"],s);const r=v(i,["fileData"]);r!=null&&_(e,["fileData"],Jw(r));const a=v(i,["functionCall"]);a!=null&&_(e,["functionCall"],Qw(a));const u=v(i,["functionResponse"]);u!=null&&_(e,["functionResponse"],u);const f=v(i,["inlineData"]);f!=null&&_(e,["inlineData"],sd(f));const c=v(i,["text"]);c!=null&&_(e,["text"],c);const d=v(i,["thought"]);d!=null&&_(e,["thought"],d);const p=v(i,["thoughtSignature"]);p!=null&&_(e,["thoughtSignature"],p);const m=v(i,["videoMetadata"]);return m!=null&&_(e,["videoMetadata"],m),e}function d1(i){const e={},t=v(i,["handle"]);if(t!=null&&_(e,["handle"],t),v(i,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function h1(i){const e={};if(v(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const t=v(i,["computerUse"]);t!=null&&_(e,["computerUse"],t);const n=v(i,["fileSearch"]);n!=null&&_(e,["fileSearch"],n);const s=v(i,["codeExecution"]);if(s!=null&&_(e,["codeExecution"],s),v(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const r=v(i,["functionDeclarations"]);if(r!=null){let d=r;Array.isArray(d)&&(d=d.map(p=>p)),_(e,["functionDeclarations"],d)}const a=v(i,["googleMaps"]);a!=null&&_(e,["googleMaps"],e1(a));const u=v(i,["googleSearch"]);u!=null&&_(e,["googleSearch"],t1(u));const f=v(i,["googleSearchRetrieval"]);f!=null&&_(e,["googleSearchRetrieval"],f);const c=v(i,["urlContext"]);return c!=null&&_(e,["urlContext"],c),e}function p1(i){const e={},t=v(i,["retrieval"]);t!=null&&_(e,["retrieval"],t);const n=v(i,["computerUse"]);if(n!=null&&_(e,["computerUse"],n),v(i,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const s=v(i,["codeExecution"]);s!=null&&_(e,["codeExecution"],s);const r=v(i,["enterpriseWebSearch"]);r!=null&&_(e,["enterpriseWebSearch"],r);const a=v(i,["functionDeclarations"]);if(a!=null){let p=a;Array.isArray(p)&&(p=p.map(m=>Zw(m))),_(e,["functionDeclarations"],p)}const u=v(i,["googleMaps"]);u!=null&&_(e,["googleMaps"],u);const f=v(i,["googleSearch"]);f!=null&&_(e,["googleSearch"],f);const c=v(i,["googleSearchRetrieval"]);c!=null&&_(e,["googleSearchRetrieval"],c);const d=v(i,["urlContext"]);return d!=null&&_(e,["urlContext"],d),e}function m1(i){const e={},t=v(i,["promptTokenCount"]);t!=null&&_(e,["promptTokenCount"],t);const n=v(i,["cachedContentTokenCount"]);n!=null&&_(e,["cachedContentTokenCount"],n);const s=v(i,["candidatesTokenCount"]);s!=null&&_(e,["responseTokenCount"],s);const r=v(i,["toolUsePromptTokenCount"]);r!=null&&_(e,["toolUsePromptTokenCount"],r);const a=v(i,["thoughtsTokenCount"]);a!=null&&_(e,["thoughtsTokenCount"],a);const u=v(i,["totalTokenCount"]);u!=null&&_(e,["totalTokenCount"],u);const f=v(i,["promptTokensDetails"]);if(f!=null){let y=f;Array.isArray(y)&&(y=y.map(E=>E)),_(e,["promptTokensDetails"],y)}const c=v(i,["cacheTokensDetails"]);if(c!=null){let y=c;Array.isArray(y)&&(y=y.map(E=>E)),_(e,["cacheTokensDetails"],y)}const d=v(i,["candidatesTokensDetails"]);if(d!=null){let y=d;Array.isArray(y)&&(y=y.map(E=>E)),_(e,["responseTokensDetails"],y)}const p=v(i,["toolUsePromptTokensDetails"]);if(p!=null){let y=p;Array.isArray(y)&&(y=y.map(E=>E)),_(e,["toolUsePromptTokensDetails"],y)}const m=v(i,["trafficType"]);return m!=null&&_(e,["trafficType"],m),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function g1(i){const e={},t=v(i,["data"]);if(t!=null&&_(e,["data"],t),v(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=v(i,["mimeType"]);return n!=null&&_(e,["mimeType"],n),e}function v1(i){const e={},t=v(i,["content"]);t!=null&&_(e,["content"],t);const n=v(i,["citationMetadata"]);n!=null&&_(e,["citationMetadata"],y1(n));const s=v(i,["tokenCount"]);s!=null&&_(e,["tokenCount"],s);const r=v(i,["finishReason"]);r!=null&&_(e,["finishReason"],r);const a=v(i,["avgLogprobs"]);a!=null&&_(e,["avgLogprobs"],a);const u=v(i,["groundingMetadata"]);u!=null&&_(e,["groundingMetadata"],u);const f=v(i,["index"]);f!=null&&_(e,["index"],f);const c=v(i,["logprobsResult"]);c!=null&&_(e,["logprobsResult"],c);const d=v(i,["safetyRatings"]);if(d!=null){let m=d;Array.isArray(m)&&(m=m.map(y=>y)),_(e,["safetyRatings"],m)}const p=v(i,["urlContextMetadata"]);return p!=null&&_(e,["urlContextMetadata"],p),e}function y1(i){const e={},t=v(i,["citationSources"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(s=>s)),_(e,["citations"],n)}return e}function _1(i,e){const t={},n=v(e,["model"]);n!=null&&_(t,["_url","model"],Zt(i,n));const s=v(e,["contents"]);if(s!=null){let r=ds(s);Array.isArray(r)&&(r=r.map(a=>a)),_(t,["contents"],r)}return t}function E1(i){const e={},t=v(i,["sdkHttpResponse"]);t!=null&&_(e,["sdkHttpResponse"],t);const n=v(i,["tokensInfo"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(r=>r)),_(e,["tokensInfo"],s)}return e}function S1(i){const e={},t=v(i,["values"]);t!=null&&_(e,["values"],t);const n=v(i,["statistics"]);return n!=null&&_(e,["statistics"],T1(n)),e}function T1(i){const e={},t=v(i,["truncated"]);t!=null&&_(e,["truncated"],t);const n=v(i,["token_count"]);return n!=null&&_(e,["tokenCount"],n),e}function Vd(i){const e={},t=v(i,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(r=>DP(r))),_(e,["parts"],s)}const n=v(i,["role"]);return n!=null&&_(e,["role"],n),e}function x1(i){const e={},t=v(i,["controlType"]);t!=null&&_(e,["controlType"],t);const n=v(i,["enableControlImageComputation"]);return n!=null&&_(e,["computeControl"],n),e}function A1(i){const e={};if(v(i,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(v(i,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(v(i,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function R1(i,e){const t={},n=v(i,["systemInstruction"]);e!==void 0&&n!=null&&_(e,["systemInstruction"],mi(n));const s=v(i,["tools"]);if(e!==void 0&&s!=null){let a=s;Array.isArray(a)&&(a=a.map(u=>MR(u))),_(e,["tools"],a)}const r=v(i,["generationConfig"]);return e!==void 0&&r!=null&&_(e,["generationConfig"],gP(r)),t}function b1(i,e){const t={},n=v(e,["model"]);n!=null&&_(t,["_url","model"],Zt(i,n));const s=v(e,["contents"]);if(s!=null){let a=ds(s);Array.isArray(a)&&(a=a.map(u=>Vd(u))),_(t,["contents"],a)}const r=v(e,["config"]);return r!=null&&A1(r),t}function M1(i,e){const t={},n=v(e,["model"]);n!=null&&_(t,["_url","model"],Zt(i,n));const s=v(e,["contents"]);if(s!=null){let a=ds(s);Array.isArray(a)&&(a=a.map(u=>u)),_(t,["contents"],a)}const r=v(e,["config"]);return r!=null&&R1(r,t),t}function C1(i){const e={},t=v(i,["sdkHttpResponse"]);t!=null&&_(e,["sdkHttpResponse"],t);const n=v(i,["totalTokens"]);n!=null&&_(e,["totalTokens"],n);const s=v(i,["cachedContentTokenCount"]);return s!=null&&_(e,["cachedContentTokenCount"],s),e}function I1(i){const e={},t=v(i,["sdkHttpResponse"]);t!=null&&_(e,["sdkHttpResponse"],t);const n=v(i,["totalTokens"]);return n!=null&&_(e,["totalTokens"],n),e}function L1(i,e){const t={},n=v(e,["model"]);return n!=null&&_(t,["_url","name"],Zt(i,n)),t}function D1(i,e){const t={},n=v(e,["model"]);return n!=null&&_(t,["_url","name"],Zt(i,n)),t}function w1(i){const e={},t=v(i,["sdkHttpResponse"]);return t!=null&&_(e,["sdkHttpResponse"],t),e}function P1(i){const e={},t=v(i,["sdkHttpResponse"]);return t!=null&&_(e,["sdkHttpResponse"],t),e}function N1(i,e){const t={},n=v(i,["outputGcsUri"]);e!==void 0&&n!=null&&_(e,["parameters","storageUri"],n);const s=v(i,["negativePrompt"]);e!==void 0&&s!=null&&_(e,["parameters","negativePrompt"],s);const r=v(i,["numberOfImages"]);e!==void 0&&r!=null&&_(e,["parameters","sampleCount"],r);const a=v(i,["aspectRatio"]);e!==void 0&&a!=null&&_(e,["parameters","aspectRatio"],a);const u=v(i,["guidanceScale"]);e!==void 0&&u!=null&&_(e,["parameters","guidanceScale"],u);const f=v(i,["seed"]);e!==void 0&&f!=null&&_(e,["parameters","seed"],f);const c=v(i,["safetyFilterLevel"]);e!==void 0&&c!=null&&_(e,["parameters","safetySetting"],c);const d=v(i,["personGeneration"]);e!==void 0&&d!=null&&_(e,["parameters","personGeneration"],d);const p=v(i,["includeSafetyAttributes"]);e!==void 0&&p!=null&&_(e,["parameters","includeSafetyAttributes"],p);const m=v(i,["includeRaiReason"]);e!==void 0&&m!=null&&_(e,["parameters","includeRaiReason"],m);const y=v(i,["language"]);e!==void 0&&y!=null&&_(e,["parameters","language"],y);const E=v(i,["outputMimeType"]);e!==void 0&&E!=null&&_(e,["parameters","outputOptions","mimeType"],E);const A=v(i,["outputCompressionQuality"]);e!==void 0&&A!=null&&_(e,["parameters","outputOptions","compressionQuality"],A);const S=v(i,["addWatermark"]);e!==void 0&&S!=null&&_(e,["parameters","addWatermark"],S);const x=v(i,["labels"]);e!==void 0&&x!=null&&_(e,["labels"],x);const M=v(i,["editMode"]);e!==void 0&&M!=null&&_(e,["parameters","editMode"],M);const b=v(i,["baseSteps"]);return e!==void 0&&b!=null&&_(e,["parameters","editConfig","baseSteps"],b),t}function U1(i,e){const t={},n=v(e,["model"]);n!=null&&_(t,["_url","model"],Zt(i,n));const s=v(e,["prompt"]);s!=null&&_(t,["instances[0]","prompt"],s);const r=v(e,["referenceImages"]);if(r!=null){let u=r;Array.isArray(u)&&(u=u.map(f=>FP(f))),_(t,["instances[0]","referenceImages"],u)}const a=v(e,["config"]);return a!=null&&N1(a,t),t}function O1(i){const e={},t=v(i,["sdkHttpResponse"]);t!=null&&_(e,["sdkHttpResponse"],t);const n=v(i,["predictions"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(r=>Hd(r))),_(e,["generatedImages"],s)}return e}function F1(i,e){const t={},n=v(i,["taskType"]);e!==void 0&&n!=null&&_(e,["requests[]","taskType"],n);const s=v(i,["title"]);e!==void 0&&s!=null&&_(e,["requests[]","title"],s);const r=v(i,["outputDimensionality"]);if(e!==void 0&&r!=null&&_(e,["requests[]","outputDimensionality"],r),v(i,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(v(i,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function k1(i,e){const t={},n=v(i,["taskType"]);e!==void 0&&n!=null&&_(e,["instances[]","task_type"],n);const s=v(i,["title"]);e!==void 0&&s!=null&&_(e,["instances[]","title"],s);const r=v(i,["outputDimensionality"]);e!==void 0&&r!=null&&_(e,["parameters","outputDimensionality"],r);const a=v(i,["mimeType"]);e!==void 0&&a!=null&&_(e,["instances[]","mimeType"],a);const u=v(i,["autoTruncate"]);return e!==void 0&&u!=null&&_(e,["parameters","autoTruncate"],u),t}function B1(i,e){const t={},n=v(e,["model"]);n!=null&&_(t,["_url","model"],Zt(i,n));const s=v(e,["contents"]);if(s!=null){let u=N0(i,s);Array.isArray(u)&&(u=u.map(f=>f)),_(t,["requests[]","content"],u)}const r=v(e,["config"]);r!=null&&F1(r,t);const a=v(e,["model"]);return a!==void 0&&_(t,["requests[]","model"],Zt(i,a)),t}function G1(i,e){const t={},n=v(e,["model"]);n!=null&&_(t,["_url","model"],Zt(i,n));const s=v(e,["contents"]);if(s!=null){let a=N0(i,s);Array.isArray(a)&&(a=a.map(u=>u)),_(t,["instances[]","content"],a)}const r=v(e,["config"]);return r!=null&&k1(r,t),t}function V1(i){const e={},t=v(i,["sdkHttpResponse"]);t!=null&&_(e,["sdkHttpResponse"],t);const n=v(i,["embeddings"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(a=>a)),_(e,["embeddings"],r)}const s=v(i,["metadata"]);return s!=null&&_(e,["metadata"],s),e}function H1(i){const e={},t=v(i,["sdkHttpResponse"]);t!=null&&_(e,["sdkHttpResponse"],t);const n=v(i,["predictions[]","embeddings"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(a=>S1(a))),_(e,["embeddings"],r)}const s=v(i,["metadata"]);return s!=null&&_(e,["metadata"],s),e}function z1(i){const e={},t=v(i,["endpoint"]);t!=null&&_(e,["name"],t);const n=v(i,["deployedModelId"]);return n!=null&&_(e,["deployedModelId"],n),e}function $1(i){const e={};if(v(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=v(i,["fileUri"]);t!=null&&_(e,["fileUri"],t);const n=v(i,["mimeType"]);return n!=null&&_(e,["mimeType"],n),e}function q1(i){const e={},t=v(i,["id"]);t!=null&&_(e,["id"],t);const n=v(i,["args"]);n!=null&&_(e,["args"],n);const s=v(i,["name"]);if(s!=null&&_(e,["name"],s),v(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(v(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function W1(i){const e={},t=v(i,["allowedFunctionNames"]);t!=null&&_(e,["allowedFunctionNames"],t);const n=v(i,["mode"]);if(n!=null&&_(e,["mode"],n),v(i,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function K1(i){const e={},t=v(i,["description"]);t!=null&&_(e,["description"],t);const n=v(i,["name"]);n!=null&&_(e,["name"],n);const s=v(i,["parameters"]);s!=null&&_(e,["parameters"],s);const r=v(i,["parametersJsonSchema"]);r!=null&&_(e,["parametersJsonSchema"],r);const a=v(i,["response"]);a!=null&&_(e,["response"],a);const u=v(i,["responseJsonSchema"]);if(u!=null&&_(e,["responseJsonSchema"],u),v(i,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");return e}function Y1(i,e,t){const n={},s=v(e,["systemInstruction"]);t!==void 0&&s!=null&&_(t,["systemInstruction"],Vd(mi(s)));const r=v(e,["temperature"]);r!=null&&_(n,["temperature"],r);const a=v(e,["topP"]);a!=null&&_(n,["topP"],a);const u=v(e,["topK"]);u!=null&&_(n,["topK"],u);const f=v(e,["candidateCount"]);f!=null&&_(n,["candidateCount"],f);const c=v(e,["maxOutputTokens"]);c!=null&&_(n,["maxOutputTokens"],c);const d=v(e,["stopSequences"]);d!=null&&_(n,["stopSequences"],d);const p=v(e,["responseLogprobs"]);p!=null&&_(n,["responseLogprobs"],p);const m=v(e,["logprobs"]);m!=null&&_(n,["logprobs"],m);const y=v(e,["presencePenalty"]);y!=null&&_(n,["presencePenalty"],y);const E=v(e,["frequencyPenalty"]);E!=null&&_(n,["frequencyPenalty"],E);const A=v(e,["seed"]);A!=null&&_(n,["seed"],A);const S=v(e,["responseMimeType"]);S!=null&&_(n,["responseMimeType"],S);const x=v(e,["responseSchema"]);x!=null&&_(n,["responseSchema"],U0(x));const M=v(e,["responseJsonSchema"]);if(M!=null&&_(n,["responseJsonSchema"],M),v(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(v(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const b=v(e,["safetySettings"]);if(t!==void 0&&b!=null){let Y=b;Array.isArray(Y)&&(Y=Y.map(ee=>kP(ee))),_(t,["safetySettings"],Y)}const C=v(e,["tools"]);if(t!==void 0&&C!=null){let Y=wl(C);Array.isArray(Y)&&(Y=Y.map(ee=>qP(Dl(ee)))),_(t,["tools"],Y)}const N=v(e,["toolConfig"]);if(t!==void 0&&N!=null&&_(t,["toolConfig"],$P(N)),v(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const U=v(e,["cachedContent"]);t!==void 0&&U!=null&&_(t,["cachedContent"],Lr(i,U));const w=v(e,["responseModalities"]);w!=null&&_(n,["responseModalities"],w);const O=v(e,["mediaResolution"]);O!=null&&_(n,["mediaResolution"],O);const L=v(e,["speechConfig"]);if(L!=null&&_(n,["speechConfig"],O0(L)),v(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const I=v(e,["thinkingConfig"]);I!=null&&_(n,["thinkingConfig"],I);const F=v(e,["imageConfig"]);F!=null&&_(n,["imageConfig"],SP(F));const X=v(e,["enableEnhancedCivicAnswers"]);return X!=null&&_(n,["enableEnhancedCivicAnswers"],X),n}function X1(i,e,t){const n={},s=v(e,["systemInstruction"]);t!==void 0&&s!=null&&_(t,["systemInstruction"],mi(s));const r=v(e,["temperature"]);r!=null&&_(n,["temperature"],r);const a=v(e,["topP"]);a!=null&&_(n,["topP"],a);const u=v(e,["topK"]);u!=null&&_(n,["topK"],u);const f=v(e,["candidateCount"]);f!=null&&_(n,["candidateCount"],f);const c=v(e,["maxOutputTokens"]);c!=null&&_(n,["maxOutputTokens"],c);const d=v(e,["stopSequences"]);d!=null&&_(n,["stopSequences"],d);const p=v(e,["responseLogprobs"]);p!=null&&_(n,["responseLogprobs"],p);const m=v(e,["logprobs"]);m!=null&&_(n,["logprobs"],m);const y=v(e,["presencePenalty"]);y!=null&&_(n,["presencePenalty"],y);const E=v(e,["frequencyPenalty"]);E!=null&&_(n,["frequencyPenalty"],E);const A=v(e,["seed"]);A!=null&&_(n,["seed"],A);const S=v(e,["responseMimeType"]);S!=null&&_(n,["responseMimeType"],S);const x=v(e,["responseSchema"]);x!=null&&_(n,["responseSchema"],U0(x));const M=v(e,["responseJsonSchema"]);M!=null&&_(n,["responseJsonSchema"],M);const b=v(e,["routingConfig"]);b!=null&&_(n,["routingConfig"],b);const C=v(e,["modelSelectionConfig"]);C!=null&&_(n,["modelConfig"],C);const N=v(e,["safetySettings"]);if(t!==void 0&&N!=null){let V=N;Array.isArray(V)&&(V=V.map(W=>W)),_(t,["safetySettings"],V)}const U=v(e,["tools"]);if(t!==void 0&&U!=null){let V=wl(U);Array.isArray(V)&&(V=V.map(W=>MR(Dl(W)))),_(t,["tools"],V)}const w=v(e,["toolConfig"]);t!==void 0&&w!=null&&_(t,["toolConfig"],w);const O=v(e,["labels"]);t!==void 0&&O!=null&&_(t,["labels"],O);const L=v(e,["cachedContent"]);t!==void 0&&L!=null&&_(t,["cachedContent"],Lr(i,L));const I=v(e,["responseModalities"]);I!=null&&_(n,["responseModalities"],I);const F=v(e,["mediaResolution"]);F!=null&&_(n,["mediaResolution"],F);const X=v(e,["speechConfig"]);X!=null&&_(n,["speechConfig"],O0(X));const Y=v(e,["audioTimestamp"]);Y!=null&&_(n,["audioTimestamp"],Y);const ee=v(e,["thinkingConfig"]);ee!=null&&_(n,["thinkingConfig"],ee);const ne=v(e,["imageConfig"]);if(ne!=null&&_(n,["imageConfig"],TP(ne)),v(e,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return n}function bT(i,e){const t={},n=v(e,["model"]);n!=null&&_(t,["_url","model"],Zt(i,n));const s=v(e,["contents"]);if(s!=null){let a=ds(s);Array.isArray(a)&&(a=a.map(u=>Vd(u))),_(t,["contents"],a)}const r=v(e,["config"]);return r!=null&&_(t,["generationConfig"],Y1(i,r,t)),t}function MT(i,e){const t={},n=v(e,["model"]);n!=null&&_(t,["_url","model"],Zt(i,n));const s=v(e,["contents"]);if(s!=null){let a=ds(s);Array.isArray(a)&&(a=a.map(u=>u)),_(t,["contents"],a)}const r=v(e,["config"]);return r!=null&&_(t,["generationConfig"],X1(i,r,t)),t}function CT(i){const e={},t=v(i,["sdkHttpResponse"]);t!=null&&_(e,["sdkHttpResponse"],t);const n=v(i,["candidates"]);if(n!=null){let f=n;Array.isArray(f)&&(f=f.map(c=>v1(c))),_(e,["candidates"],f)}const s=v(i,["modelVersion"]);s!=null&&_(e,["modelVersion"],s);const r=v(i,["promptFeedback"]);r!=null&&_(e,["promptFeedback"],r);const a=v(i,["responseId"]);a!=null&&_(e,["responseId"],a);const u=v(i,["usageMetadata"]);return u!=null&&_(e,["usageMetadata"],u),e}function IT(i){const e={},t=v(i,["sdkHttpResponse"]);t!=null&&_(e,["sdkHttpResponse"],t);const n=v(i,["candidates"]);if(n!=null){let c=n;Array.isArray(c)&&(c=c.map(d=>d)),_(e,["candidates"],c)}const s=v(i,["createTime"]);s!=null&&_(e,["createTime"],s);const r=v(i,["modelVersion"]);r!=null&&_(e,["modelVersion"],r);const a=v(i,["promptFeedback"]);a!=null&&_(e,["promptFeedback"],a);const u=v(i,["responseId"]);u!=null&&_(e,["responseId"],u);const f=v(i,["usageMetadata"]);return f!=null&&_(e,["usageMetadata"],f),e}function J1(i,e){const t={};if(v(i,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(v(i,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const n=v(i,["numberOfImages"]);e!==void 0&&n!=null&&_(e,["parameters","sampleCount"],n);const s=v(i,["aspectRatio"]);e!==void 0&&s!=null&&_(e,["parameters","aspectRatio"],s);const r=v(i,["guidanceScale"]);if(e!==void 0&&r!=null&&_(e,["parameters","guidanceScale"],r),v(i,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const a=v(i,["safetyFilterLevel"]);e!==void 0&&a!=null&&_(e,["parameters","safetySetting"],a);const u=v(i,["personGeneration"]);e!==void 0&&u!=null&&_(e,["parameters","personGeneration"],u);const f=v(i,["includeSafetyAttributes"]);e!==void 0&&f!=null&&_(e,["parameters","includeSafetyAttributes"],f);const c=v(i,["includeRaiReason"]);e!==void 0&&c!=null&&_(e,["parameters","includeRaiReason"],c);const d=v(i,["language"]);e!==void 0&&d!=null&&_(e,["parameters","language"],d);const p=v(i,["outputMimeType"]);e!==void 0&&p!=null&&_(e,["parameters","outputOptions","mimeType"],p);const m=v(i,["outputCompressionQuality"]);if(e!==void 0&&m!=null&&_(e,["parameters","outputOptions","compressionQuality"],m),v(i,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(v(i,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const y=v(i,["imageSize"]);if(e!==void 0&&y!=null&&_(e,["parameters","sampleImageSize"],y),v(i,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return t}function Q1(i,e){const t={},n=v(i,["outputGcsUri"]);e!==void 0&&n!=null&&_(e,["parameters","storageUri"],n);const s=v(i,["negativePrompt"]);e!==void 0&&s!=null&&_(e,["parameters","negativePrompt"],s);const r=v(i,["numberOfImages"]);e!==void 0&&r!=null&&_(e,["parameters","sampleCount"],r);const a=v(i,["aspectRatio"]);e!==void 0&&a!=null&&_(e,["parameters","aspectRatio"],a);const u=v(i,["guidanceScale"]);e!==void 0&&u!=null&&_(e,["parameters","guidanceScale"],u);const f=v(i,["seed"]);e!==void 0&&f!=null&&_(e,["parameters","seed"],f);const c=v(i,["safetyFilterLevel"]);e!==void 0&&c!=null&&_(e,["parameters","safetySetting"],c);const d=v(i,["personGeneration"]);e!==void 0&&d!=null&&_(e,["parameters","personGeneration"],d);const p=v(i,["includeSafetyAttributes"]);e!==void 0&&p!=null&&_(e,["parameters","includeSafetyAttributes"],p);const m=v(i,["includeRaiReason"]);e!==void 0&&m!=null&&_(e,["parameters","includeRaiReason"],m);const y=v(i,["language"]);e!==void 0&&y!=null&&_(e,["parameters","language"],y);const E=v(i,["outputMimeType"]);e!==void 0&&E!=null&&_(e,["parameters","outputOptions","mimeType"],E);const A=v(i,["outputCompressionQuality"]);e!==void 0&&A!=null&&_(e,["parameters","outputOptions","compressionQuality"],A);const S=v(i,["addWatermark"]);e!==void 0&&S!=null&&_(e,["parameters","addWatermark"],S);const x=v(i,["labels"]);e!==void 0&&x!=null&&_(e,["labels"],x);const M=v(i,["imageSize"]);e!==void 0&&M!=null&&_(e,["parameters","sampleImageSize"],M);const b=v(i,["enhancePrompt"]);return e!==void 0&&b!=null&&_(e,["parameters","enhancePrompt"],b),t}function Z1(i,e){const t={},n=v(e,["model"]);n!=null&&_(t,["_url","model"],Zt(i,n));const s=v(e,["prompt"]);s!=null&&_(t,["instances[0]","prompt"],s);const r=v(e,["config"]);return r!=null&&J1(r,t),t}function j1(i,e){const t={},n=v(e,["model"]);n!=null&&_(t,["_url","model"],Zt(i,n));const s=v(e,["prompt"]);s!=null&&_(t,["instances[0]","prompt"],s);const r=v(e,["config"]);return r!=null&&Q1(r,t),t}function eP(i){const e={},t=v(i,["sdkHttpResponse"]);t!=null&&_(e,["sdkHttpResponse"],t);const n=v(i,["predictions"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(a=>dP(a))),_(e,["generatedImages"],r)}const s=v(i,["positivePromptSafetyAttributes"]);return s!=null&&_(e,["positivePromptSafetyAttributes"],RR(s)),e}function tP(i){const e={},t=v(i,["sdkHttpResponse"]);t!=null&&_(e,["sdkHttpResponse"],t);const n=v(i,["predictions"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(a=>Hd(a))),_(e,["generatedImages"],r)}const s=v(i,["positivePromptSafetyAttributes"]);return s!=null&&_(e,["positivePromptSafetyAttributes"],bR(s)),e}function nP(i,e){const t={},n=v(i,["numberOfVideos"]);if(e!==void 0&&n!=null&&_(e,["parameters","sampleCount"],n),v(i,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(v(i,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const s=v(i,["durationSeconds"]);if(e!==void 0&&s!=null&&_(e,["parameters","durationSeconds"],s),v(i,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const r=v(i,["aspectRatio"]);e!==void 0&&r!=null&&_(e,["parameters","aspectRatio"],r);const a=v(i,["resolution"]);e!==void 0&&a!=null&&_(e,["parameters","resolution"],a);const u=v(i,["personGeneration"]);if(e!==void 0&&u!=null&&_(e,["parameters","personGeneration"],u),v(i,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const f=v(i,["negativePrompt"]);e!==void 0&&f!=null&&_(e,["parameters","negativePrompt"],f);const c=v(i,["enhancePrompt"]);if(e!==void 0&&c!=null&&_(e,["parameters","enhancePrompt"],c),v(i,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");const d=v(i,["lastFrame"]);e!==void 0&&d!=null&&_(e,["instances[0]","lastFrame"],zd(d));const p=v(i,["referenceImages"]);if(e!==void 0&&p!=null){let m=p;Array.isArray(m)&&(m=m.map(y=>sN(y))),_(e,["instances[0]","referenceImages"],m)}if(v(i,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(v(i,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return t}function iP(i,e){const t={},n=v(i,["numberOfVideos"]);e!==void 0&&n!=null&&_(e,["parameters","sampleCount"],n);const s=v(i,["outputGcsUri"]);e!==void 0&&s!=null&&_(e,["parameters","storageUri"],s);const r=v(i,["fps"]);e!==void 0&&r!=null&&_(e,["parameters","fps"],r);const a=v(i,["durationSeconds"]);e!==void 0&&a!=null&&_(e,["parameters","durationSeconds"],a);const u=v(i,["seed"]);e!==void 0&&u!=null&&_(e,["parameters","seed"],u);const f=v(i,["aspectRatio"]);e!==void 0&&f!=null&&_(e,["parameters","aspectRatio"],f);const c=v(i,["resolution"]);e!==void 0&&c!=null&&_(e,["parameters","resolution"],c);const d=v(i,["personGeneration"]);e!==void 0&&d!=null&&_(e,["parameters","personGeneration"],d);const p=v(i,["pubsubTopic"]);e!==void 0&&p!=null&&_(e,["parameters","pubsubTopic"],p);const m=v(i,["negativePrompt"]);e!==void 0&&m!=null&&_(e,["parameters","negativePrompt"],m);const y=v(i,["enhancePrompt"]);e!==void 0&&y!=null&&_(e,["parameters","enhancePrompt"],y);const E=v(i,["generateAudio"]);e!==void 0&&E!=null&&_(e,["parameters","generateAudio"],E);const A=v(i,["lastFrame"]);e!==void 0&&A!=null&&_(e,["instances[0]","lastFrame"],Ls(A));const S=v(i,["referenceImages"]);if(e!==void 0&&S!=null){let b=S;Array.isArray(b)&&(b=b.map(C=>rN(C))),_(e,["instances[0]","referenceImages"],b)}const x=v(i,["mask"]);e!==void 0&&x!=null&&_(e,["instances[0]","mask"],iN(x));const M=v(i,["compressionQuality"]);return e!==void 0&&M!=null&&_(e,["parameters","compressionQuality"],M),t}function sP(i){const e={},t=v(i,["name"]);t!=null&&_(e,["name"],t);const n=v(i,["metadata"]);n!=null&&_(e,["metadata"],n);const s=v(i,["done"]);s!=null&&_(e,["done"],s);const r=v(i,["error"]);r!=null&&_(e,["error"],r);const a=v(i,["response","generateVideoResponse"]);return a!=null&&_(e,["response"],lP(a)),e}function rP(i){const e={},t=v(i,["name"]);t!=null&&_(e,["name"],t);const n=v(i,["metadata"]);n!=null&&_(e,["metadata"],n);const s=v(i,["done"]);s!=null&&_(e,["done"],s);const r=v(i,["error"]);r!=null&&_(e,["error"],r);const a=v(i,["response"]);return a!=null&&_(e,["response"],uP(a)),e}function oP(i,e){const t={},n=v(e,["model"]);n!=null&&_(t,["_url","model"],Zt(i,n));const s=v(e,["prompt"]);s!=null&&_(t,["instances[0]","prompt"],s);const r=v(e,["image"]);r!=null&&_(t,["instances[0]","image"],zd(r));const a=v(e,["video"]);a!=null&&_(t,["instances[0]","video"],CR(a));const u=v(e,["source"]);u!=null&&cP(u,t);const f=v(e,["config"]);return f!=null&&nP(f,t),t}function aP(i,e){const t={},n=v(e,["model"]);n!=null&&_(t,["_url","model"],Zt(i,n));const s=v(e,["prompt"]);s!=null&&_(t,["instances[0]","prompt"],s);const r=v(e,["image"]);r!=null&&_(t,["instances[0]","image"],Ls(r));const a=v(e,["video"]);a!=null&&_(t,["instances[0]","video"],IR(a));const u=v(e,["source"]);u!=null&&fP(u,t);const f=v(e,["config"]);return f!=null&&iP(f,t),t}function lP(i){const e={},t=v(i,["generatedSamples"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(a=>pP(a))),_(e,["generatedVideos"],r)}const n=v(i,["raiMediaFilteredCount"]);n!=null&&_(e,["raiMediaFilteredCount"],n);const s=v(i,["raiMediaFilteredReasons"]);return s!=null&&_(e,["raiMediaFilteredReasons"],s),e}function uP(i){const e={},t=v(i,["videos"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(a=>mP(a))),_(e,["generatedVideos"],r)}const n=v(i,["raiMediaFilteredCount"]);n!=null&&_(e,["raiMediaFilteredCount"],n);const s=v(i,["raiMediaFilteredReasons"]);return s!=null&&_(e,["raiMediaFilteredReasons"],s),e}function cP(i,e){const t={},n=v(i,["prompt"]);e!==void 0&&n!=null&&_(e,["instances[0]","prompt"],n);const s=v(i,["image"]);e!==void 0&&s!=null&&_(e,["instances[0]","image"],zd(s));const r=v(i,["video"]);return e!==void 0&&r!=null&&_(e,["instances[0]","video"],CR(r)),t}function fP(i,e){const t={},n=v(i,["prompt"]);e!==void 0&&n!=null&&_(e,["instances[0]","prompt"],n);const s=v(i,["image"]);e!==void 0&&s!=null&&_(e,["instances[0]","image"],Ls(s));const r=v(i,["video"]);return e!==void 0&&r!=null&&_(e,["instances[0]","video"],IR(r)),t}function dP(i){const e={},t=v(i,["_self"]);t!=null&&_(e,["image"],xP(t));const n=v(i,["raiFilteredReason"]);n!=null&&_(e,["raiFilteredReason"],n);const s=v(i,["_self"]);return s!=null&&_(e,["safetyAttributes"],RR(s)),e}function Hd(i){const e={},t=v(i,["_self"]);t!=null&&_(e,["image"],AR(t));const n=v(i,["raiFilteredReason"]);n!=null&&_(e,["raiFilteredReason"],n);const s=v(i,["_self"]);s!=null&&_(e,["safetyAttributes"],bR(s));const r=v(i,["prompt"]);return r!=null&&_(e,["enhancedPrompt"],r),e}function hP(i){const e={},t=v(i,["_self"]);t!=null&&_(e,["mask"],AR(t));const n=v(i,["labels"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(r=>r)),_(e,["labels"],s)}return e}function pP(i){const e={},t=v(i,["video"]);return t!=null&&_(e,["video"],tN(t)),e}function mP(i){const e={},t=v(i,["_self"]);return t!=null&&_(e,["video"],nN(t)),e}function gP(i){const e={},t=v(i,["modelSelectionConfig"]);t!=null&&_(e,["modelConfig"],t);const n=v(i,["responseJsonSchema"]);n!=null&&_(e,["responseJsonSchema"],n);const s=v(i,["audioTimestamp"]);s!=null&&_(e,["audioTimestamp"],s);const r=v(i,["candidateCount"]);r!=null&&_(e,["candidateCount"],r);const a=v(i,["enableAffectiveDialog"]);a!=null&&_(e,["enableAffectiveDialog"],a);const u=v(i,["frequencyPenalty"]);u!=null&&_(e,["frequencyPenalty"],u);const f=v(i,["logprobs"]);f!=null&&_(e,["logprobs"],f);const c=v(i,["maxOutputTokens"]);c!=null&&_(e,["maxOutputTokens"],c);const d=v(i,["mediaResolution"]);d!=null&&_(e,["mediaResolution"],d);const p=v(i,["presencePenalty"]);p!=null&&_(e,["presencePenalty"],p);const m=v(i,["responseLogprobs"]);m!=null&&_(e,["responseLogprobs"],m);const y=v(i,["responseMimeType"]);y!=null&&_(e,["responseMimeType"],y);const E=v(i,["responseModalities"]);E!=null&&_(e,["responseModalities"],E);const A=v(i,["responseSchema"]);A!=null&&_(e,["responseSchema"],A);const S=v(i,["routingConfig"]);S!=null&&_(e,["routingConfig"],S);const x=v(i,["seed"]);x!=null&&_(e,["seed"],x);const M=v(i,["speechConfig"]);M!=null&&_(e,["speechConfig"],M);const b=v(i,["stopSequences"]);b!=null&&_(e,["stopSequences"],b);const C=v(i,["temperature"]);C!=null&&_(e,["temperature"],C);const N=v(i,["thinkingConfig"]);N!=null&&_(e,["thinkingConfig"],N);const U=v(i,["topK"]);U!=null&&_(e,["topK"],U);const w=v(i,["topP"]);if(w!=null&&_(e,["topP"],w),v(i,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function vP(i,e){const t={},n=v(e,["model"]);return n!=null&&_(t,["_url","name"],Zt(i,n)),t}function yP(i,e){const t={},n=v(e,["model"]);return n!=null&&_(t,["_url","name"],Zt(i,n)),t}function _P(i){const e={};if(v(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=v(i,["enableWidget"]);return t!=null&&_(e,["enableWidget"],t),e}function EP(i){const e={};if(v(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(v(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=v(i,["timeRangeFilter"]);return t!=null&&_(e,["timeRangeFilter"],t),e}function SP(i){const e={},t=v(i,["aspectRatio"]);t!=null&&_(e,["aspectRatio"],t);const n=v(i,["imageSize"]);if(n!=null&&_(e,["imageSize"],n),v(i,["personGeneration"])!==void 0)throw new Error("personGeneration parameter is not supported in Gemini API.");if(v(i,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(v(i,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function TP(i){const e={},t=v(i,["aspectRatio"]);t!=null&&_(e,["aspectRatio"],t);const n=v(i,["imageSize"]);n!=null&&_(e,["imageSize"],n);const s=v(i,["personGeneration"]);s!=null&&_(e,["personGeneration"],s);const r=v(i,["outputMimeType"]);r!=null&&_(e,["imageOutputOptions","mimeType"],r);const a=v(i,["outputCompressionQuality"]);return a!=null&&_(e,["imageOutputOptions","compressionQuality"],a),e}function xP(i){const e={},t=v(i,["bytesBase64Encoded"]);t!=null&&_(e,["imageBytes"],Eo(t));const n=v(i,["mimeType"]);return n!=null&&_(e,["mimeType"],n),e}function AR(i){const e={},t=v(i,["gcsUri"]);t!=null&&_(e,["gcsUri"],t);const n=v(i,["bytesBase64Encoded"]);n!=null&&_(e,["imageBytes"],Eo(n));const s=v(i,["mimeType"]);return s!=null&&_(e,["mimeType"],s),e}function zd(i){const e={};if(v(i,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const t=v(i,["imageBytes"]);t!=null&&_(e,["bytesBase64Encoded"],Eo(t));const n=v(i,["mimeType"]);return n!=null&&_(e,["mimeType"],n),e}function Ls(i){const e={},t=v(i,["gcsUri"]);t!=null&&_(e,["gcsUri"],t);const n=v(i,["imageBytes"]);n!=null&&_(e,["bytesBase64Encoded"],Eo(n));const s=v(i,["mimeType"]);return s!=null&&_(e,["mimeType"],s),e}function AP(i,e,t){const n={},s=v(e,["pageSize"]);t!==void 0&&s!=null&&_(t,["_query","pageSize"],s);const r=v(e,["pageToken"]);t!==void 0&&r!=null&&_(t,["_query","pageToken"],r);const a=v(e,["filter"]);t!==void 0&&a!=null&&_(t,["_query","filter"],a);const u=v(e,["queryBase"]);return t!==void 0&&u!=null&&_(t,["_url","models_url"],vR(i,u)),n}function RP(i,e,t){const n={},s=v(e,["pageSize"]);t!==void 0&&s!=null&&_(t,["_query","pageSize"],s);const r=v(e,["pageToken"]);t!==void 0&&r!=null&&_(t,["_query","pageToken"],r);const a=v(e,["filter"]);t!==void 0&&a!=null&&_(t,["_query","filter"],a);const u=v(e,["queryBase"]);return t!==void 0&&u!=null&&_(t,["_url","models_url"],vR(i,u)),n}function bP(i,e){const t={},n=v(e,["config"]);return n!=null&&AP(i,n,t),t}function MP(i,e){const t={},n=v(e,["config"]);return n!=null&&RP(i,n,t),t}function CP(i){const e={},t=v(i,["sdkHttpResponse"]);t!=null&&_(e,["sdkHttpResponse"],t);const n=v(i,["nextPageToken"]);n!=null&&_(e,["nextPageToken"],n);const s=v(i,["_self"]);if(s!=null){let r=yR(s);Array.isArray(r)&&(r=r.map(a=>gg(a))),_(e,["models"],r)}return e}function IP(i){const e={},t=v(i,["sdkHttpResponse"]);t!=null&&_(e,["sdkHttpResponse"],t);const n=v(i,["nextPageToken"]);n!=null&&_(e,["nextPageToken"],n);const s=v(i,["_self"]);if(s!=null){let r=yR(s);Array.isArray(r)&&(r=r.map(a=>vg(a))),_(e,["models"],r)}return e}function LP(i){const e={},t=v(i,["maskMode"]);t!=null&&_(e,["maskMode"],t);const n=v(i,["segmentationClasses"]);n!=null&&_(e,["maskClasses"],n);const s=v(i,["maskDilation"]);return s!=null&&_(e,["dilation"],s),e}function gg(i){const e={},t=v(i,["name"]);t!=null&&_(e,["name"],t);const n=v(i,["displayName"]);n!=null&&_(e,["displayName"],n);const s=v(i,["description"]);s!=null&&_(e,["description"],s);const r=v(i,["version"]);r!=null&&_(e,["version"],r);const a=v(i,["_self"]);a!=null&&_(e,["tunedModelInfo"],WP(a));const u=v(i,["inputTokenLimit"]);u!=null&&_(e,["inputTokenLimit"],u);const f=v(i,["outputTokenLimit"]);f!=null&&_(e,["outputTokenLimit"],f);const c=v(i,["supportedGenerationMethods"]);c!=null&&_(e,["supportedActions"],c);const d=v(i,["temperature"]);d!=null&&_(e,["temperature"],d);const p=v(i,["maxTemperature"]);p!=null&&_(e,["maxTemperature"],p);const m=v(i,["topP"]);m!=null&&_(e,["topP"],m);const y=v(i,["topK"]);y!=null&&_(e,["topK"],y);const E=v(i,["thinking"]);return E!=null&&_(e,["thinking"],E),e}function vg(i){const e={},t=v(i,["name"]);t!=null&&_(e,["name"],t);const n=v(i,["displayName"]);n!=null&&_(e,["displayName"],n);const s=v(i,["description"]);s!=null&&_(e,["description"],s);const r=v(i,["versionId"]);r!=null&&_(e,["version"],r);const a=v(i,["deployedModels"]);if(a!=null){let p=a;Array.isArray(p)&&(p=p.map(m=>z1(m))),_(e,["endpoints"],p)}const u=v(i,["labels"]);u!=null&&_(e,["labels"],u);const f=v(i,["_self"]);f!=null&&_(e,["tunedModelInfo"],KP(f));const c=v(i,["defaultCheckpointId"]);c!=null&&_(e,["defaultCheckpointId"],c);const d=v(i,["checkpoints"]);if(d!=null){let p=d;Array.isArray(p)&&(p=p.map(m=>m)),_(e,["checkpoints"],p)}return e}function DP(i){const e={},t=v(i,["mediaResolution"]);t!=null&&_(e,["mediaResolution"],t);const n=v(i,["codeExecutionResult"]);n!=null&&_(e,["codeExecutionResult"],n);const s=v(i,["executableCode"]);s!=null&&_(e,["executableCode"],s);const r=v(i,["fileData"]);r!=null&&_(e,["fileData"],$1(r));const a=v(i,["functionCall"]);a!=null&&_(e,["functionCall"],q1(a));const u=v(i,["functionResponse"]);u!=null&&_(e,["functionResponse"],u);const f=v(i,["inlineData"]);f!=null&&_(e,["inlineData"],g1(f));const c=v(i,["text"]);c!=null&&_(e,["text"],c);const d=v(i,["thought"]);d!=null&&_(e,["thought"],d);const p=v(i,["thoughtSignature"]);p!=null&&_(e,["thoughtSignature"],p);const m=v(i,["videoMetadata"]);return m!=null&&_(e,["videoMetadata"],m),e}function wP(i){const e={},t=v(i,["productImage"]);return t!=null&&_(e,["image"],Ls(t)),e}function PP(i,e){const t={},n=v(i,["numberOfImages"]);e!==void 0&&n!=null&&_(e,["parameters","sampleCount"],n);const s=v(i,["baseSteps"]);e!==void 0&&s!=null&&_(e,["parameters","baseSteps"],s);const r=v(i,["outputGcsUri"]);e!==void 0&&r!=null&&_(e,["parameters","storageUri"],r);const a=v(i,["seed"]);e!==void 0&&a!=null&&_(e,["parameters","seed"],a);const u=v(i,["safetyFilterLevel"]);e!==void 0&&u!=null&&_(e,["parameters","safetySetting"],u);const f=v(i,["personGeneration"]);e!==void 0&&f!=null&&_(e,["parameters","personGeneration"],f);const c=v(i,["addWatermark"]);e!==void 0&&c!=null&&_(e,["parameters","addWatermark"],c);const d=v(i,["outputMimeType"]);e!==void 0&&d!=null&&_(e,["parameters","outputOptions","mimeType"],d);const p=v(i,["outputCompressionQuality"]);e!==void 0&&p!=null&&_(e,["parameters","outputOptions","compressionQuality"],p);const m=v(i,["enhancePrompt"]);e!==void 0&&m!=null&&_(e,["parameters","enhancePrompt"],m);const y=v(i,["labels"]);return e!==void 0&&y!=null&&_(e,["labels"],y),t}function NP(i,e){const t={},n=v(e,["model"]);n!=null&&_(t,["_url","model"],Zt(i,n));const s=v(e,["source"]);s!=null&&OP(s,t);const r=v(e,["config"]);return r!=null&&PP(r,t),t}function UP(i){const e={},t=v(i,["predictions"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(s=>Hd(s))),_(e,["generatedImages"],n)}return e}function OP(i,e){const t={},n=v(i,["prompt"]);e!==void 0&&n!=null&&_(e,["instances[0]","prompt"],n);const s=v(i,["personImage"]);e!==void 0&&s!=null&&_(e,["instances[0]","personImage","image"],Ls(s));const r=v(i,["productImages"]);if(e!==void 0&&r!=null){let a=r;Array.isArray(a)&&(a=a.map(u=>wP(u))),_(e,["instances[0]","productImages"],a)}return t}function FP(i){const e={},t=v(i,["referenceImage"]);t!=null&&_(e,["referenceImage"],Ls(t));const n=v(i,["referenceId"]);n!=null&&_(e,["referenceId"],n);const s=v(i,["referenceType"]);s!=null&&_(e,["referenceType"],s);const r=v(i,["maskImageConfig"]);r!=null&&_(e,["maskImageConfig"],LP(r));const a=v(i,["controlImageConfig"]);a!=null&&_(e,["controlImageConfig"],x1(a));const u=v(i,["styleImageConfig"]);u!=null&&_(e,["styleImageConfig"],u);const f=v(i,["subjectImageConfig"]);return f!=null&&_(e,["subjectImageConfig"],f),e}function RR(i){const e={},t=v(i,["safetyAttributes","categories"]);t!=null&&_(e,["categories"],t);const n=v(i,["safetyAttributes","scores"]);n!=null&&_(e,["scores"],n);const s=v(i,["contentType"]);return s!=null&&_(e,["contentType"],s),e}function bR(i){const e={},t=v(i,["safetyAttributes","categories"]);t!=null&&_(e,["categories"],t);const n=v(i,["safetyAttributes","scores"]);n!=null&&_(e,["scores"],n);const s=v(i,["contentType"]);return s!=null&&_(e,["contentType"],s),e}function kP(i){const e={},t=v(i,["category"]);if(t!=null&&_(e,["category"],t),v(i,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const n=v(i,["threshold"]);return n!=null&&_(e,["threshold"],n),e}function BP(i){const e={},t=v(i,["image"]);return t!=null&&_(e,["image"],Ls(t)),e}function GP(i,e){const t={},n=v(i,["mode"]);e!==void 0&&n!=null&&_(e,["parameters","mode"],n);const s=v(i,["maxPredictions"]);e!==void 0&&s!=null&&_(e,["parameters","maxPredictions"],s);const r=v(i,["confidenceThreshold"]);e!==void 0&&r!=null&&_(e,["parameters","confidenceThreshold"],r);const a=v(i,["maskDilation"]);e!==void 0&&a!=null&&_(e,["parameters","maskDilation"],a);const u=v(i,["binaryColorThreshold"]);e!==void 0&&u!=null&&_(e,["parameters","binaryColorThreshold"],u);const f=v(i,["labels"]);return e!==void 0&&f!=null&&_(e,["labels"],f),t}function VP(i,e){const t={},n=v(e,["model"]);n!=null&&_(t,["_url","model"],Zt(i,n));const s=v(e,["source"]);s!=null&&zP(s,t);const r=v(e,["config"]);return r!=null&&GP(r,t),t}function HP(i){const e={},t=v(i,["predictions"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(s=>hP(s))),_(e,["generatedMasks"],n)}return e}function zP(i,e){const t={},n=v(i,["prompt"]);e!==void 0&&n!=null&&_(e,["instances[0]","prompt"],n);const s=v(i,["image"]);e!==void 0&&s!=null&&_(e,["instances[0]","image"],Ls(s));const r=v(i,["scribbleImage"]);return e!==void 0&&r!=null&&_(e,["instances[0]","scribble"],BP(r)),t}function $P(i){const e={},t=v(i,["retrievalConfig"]);t!=null&&_(e,["retrievalConfig"],t);const n=v(i,["functionCallingConfig"]);return n!=null&&_(e,["functionCallingConfig"],W1(n)),e}function qP(i){const e={};if(v(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const t=v(i,["computerUse"]);t!=null&&_(e,["computerUse"],t);const n=v(i,["fileSearch"]);n!=null&&_(e,["fileSearch"],n);const s=v(i,["codeExecution"]);if(s!=null&&_(e,["codeExecution"],s),v(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const r=v(i,["functionDeclarations"]);if(r!=null){let d=r;Array.isArray(d)&&(d=d.map(p=>p)),_(e,["functionDeclarations"],d)}const a=v(i,["googleMaps"]);a!=null&&_(e,["googleMaps"],_P(a));const u=v(i,["googleSearch"]);u!=null&&_(e,["googleSearch"],EP(u));const f=v(i,["googleSearchRetrieval"]);f!=null&&_(e,["googleSearchRetrieval"],f);const c=v(i,["urlContext"]);return c!=null&&_(e,["urlContext"],c),e}function MR(i){const e={},t=v(i,["retrieval"]);t!=null&&_(e,["retrieval"],t);const n=v(i,["computerUse"]);if(n!=null&&_(e,["computerUse"],n),v(i,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const s=v(i,["codeExecution"]);s!=null&&_(e,["codeExecution"],s);const r=v(i,["enterpriseWebSearch"]);r!=null&&_(e,["enterpriseWebSearch"],r);const a=v(i,["functionDeclarations"]);if(a!=null){let p=a;Array.isArray(p)&&(p=p.map(m=>K1(m))),_(e,["functionDeclarations"],p)}const u=v(i,["googleMaps"]);u!=null&&_(e,["googleMaps"],u);const f=v(i,["googleSearch"]);f!=null&&_(e,["googleSearch"],f);const c=v(i,["googleSearchRetrieval"]);c!=null&&_(e,["googleSearchRetrieval"],c);const d=v(i,["urlContext"]);return d!=null&&_(e,["urlContext"],d),e}function WP(i){const e={},t=v(i,["baseModel"]);t!=null&&_(e,["baseModel"],t);const n=v(i,["createTime"]);n!=null&&_(e,["createTime"],n);const s=v(i,["updateTime"]);return s!=null&&_(e,["updateTime"],s),e}function KP(i){const e={},t=v(i,["labels","google-vertex-llm-tuning-base-model-id"]);t!=null&&_(e,["baseModel"],t);const n=v(i,["createTime"]);n!=null&&_(e,["createTime"],n);const s=v(i,["updateTime"]);return s!=null&&_(e,["updateTime"],s),e}function YP(i,e){const t={},n=v(i,["displayName"]);e!==void 0&&n!=null&&_(e,["displayName"],n);const s=v(i,["description"]);e!==void 0&&s!=null&&_(e,["description"],s);const r=v(i,["defaultCheckpointId"]);return e!==void 0&&r!=null&&_(e,["defaultCheckpointId"],r),t}function XP(i,e){const t={},n=v(i,["displayName"]);e!==void 0&&n!=null&&_(e,["displayName"],n);const s=v(i,["description"]);e!==void 0&&s!=null&&_(e,["description"],s);const r=v(i,["defaultCheckpointId"]);return e!==void 0&&r!=null&&_(e,["defaultCheckpointId"],r),t}function JP(i,e){const t={},n=v(e,["model"]);n!=null&&_(t,["_url","name"],Zt(i,n));const s=v(e,["config"]);return s!=null&&YP(s,t),t}function QP(i,e){const t={},n=v(e,["model"]);n!=null&&_(t,["_url","model"],Zt(i,n));const s=v(e,["config"]);return s!=null&&XP(s,t),t}function ZP(i,e){const t={},n=v(i,["outputGcsUri"]);e!==void 0&&n!=null&&_(e,["parameters","storageUri"],n);const s=v(i,["safetyFilterLevel"]);e!==void 0&&s!=null&&_(e,["parameters","safetySetting"],s);const r=v(i,["personGeneration"]);e!==void 0&&r!=null&&_(e,["parameters","personGeneration"],r);const a=v(i,["includeRaiReason"]);e!==void 0&&a!=null&&_(e,["parameters","includeRaiReason"],a);const u=v(i,["outputMimeType"]);e!==void 0&&u!=null&&_(e,["parameters","outputOptions","mimeType"],u);const f=v(i,["outputCompressionQuality"]);e!==void 0&&f!=null&&_(e,["parameters","outputOptions","compressionQuality"],f);const c=v(i,["enhanceInputImage"]);e!==void 0&&c!=null&&_(e,["parameters","upscaleConfig","enhanceInputImage"],c);const d=v(i,["imagePreservationFactor"]);e!==void 0&&d!=null&&_(e,["parameters","upscaleConfig","imagePreservationFactor"],d);const p=v(i,["labels"]);e!==void 0&&p!=null&&_(e,["labels"],p);const m=v(i,["numberOfImages"]);e!==void 0&&m!=null&&_(e,["parameters","sampleCount"],m);const y=v(i,["mode"]);return e!==void 0&&y!=null&&_(e,["parameters","mode"],y),t}function jP(i,e){const t={},n=v(e,["model"]);n!=null&&_(t,["_url","model"],Zt(i,n));const s=v(e,["image"]);s!=null&&_(t,["instances[0]","image"],Ls(s));const r=v(e,["upscaleFactor"]);r!=null&&_(t,["parameters","upscaleConfig","upscaleFactor"],r);const a=v(e,["config"]);return a!=null&&ZP(a,t),t}function eN(i){const e={},t=v(i,["sdkHttpResponse"]);t!=null&&_(e,["sdkHttpResponse"],t);const n=v(i,["predictions"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(r=>Hd(r))),_(e,["generatedImages"],s)}return e}function tN(i){const e={},t=v(i,["uri"]);t!=null&&_(e,["uri"],t);const n=v(i,["encodedVideo"]);n!=null&&_(e,["videoBytes"],Eo(n));const s=v(i,["encoding"]);return s!=null&&_(e,["mimeType"],s),e}function nN(i){const e={},t=v(i,["gcsUri"]);t!=null&&_(e,["uri"],t);const n=v(i,["bytesBase64Encoded"]);n!=null&&_(e,["videoBytes"],Eo(n));const s=v(i,["mimeType"]);return s!=null&&_(e,["mimeType"],s),e}function iN(i){const e={},t=v(i,["image"]);t!=null&&_(e,["_self"],Ls(t));const n=v(i,["maskMode"]);return n!=null&&_(e,["maskMode"],n),e}function sN(i){const e={},t=v(i,["image"]);t!=null&&_(e,["image"],zd(t));const n=v(i,["referenceType"]);return n!=null&&_(e,["referenceType"],n),e}function rN(i){const e={},t=v(i,["image"]);t!=null&&_(e,["image"],Ls(t));const n=v(i,["referenceType"]);return n!=null&&_(e,["referenceType"],n),e}function CR(i){const e={},t=v(i,["uri"]);t!=null&&_(e,["uri"],t);const n=v(i,["videoBytes"]);n!=null&&_(e,["encodedVideo"],Eo(n));const s=v(i,["mimeType"]);return s!=null&&_(e,["encoding"],s),e}function IR(i){const e={},t=v(i,["uri"]);t!=null&&_(e,["gcsUri"],t);const n=v(i,["videoBytes"]);n!=null&&_(e,["bytesBase64Encoded"],Eo(n));const s=v(i,["mimeType"]);return s!=null&&_(e,["mimeType"],s),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function oN(i,e){const t={},n=v(i,["displayName"]);return e!==void 0&&n!=null&&_(e,["displayName"],n),t}function aN(i){const e={},t=v(i,["config"]);return t!=null&&oN(t,e),e}function lN(i,e){const t={},n=v(i,["force"]);return e!==void 0&&n!=null&&_(e,["_query","force"],n),t}function uN(i){const e={},t=v(i,["name"]);t!=null&&_(e,["_url","name"],t);const n=v(i,["config"]);return n!=null&&lN(n,e),e}function cN(i){const e={},t=v(i,["name"]);return t!=null&&_(e,["_url","name"],t),e}function fN(i,e){const t={},n=v(i,["customMetadata"]);if(e!==void 0&&n!=null){let r=n;Array.isArray(r)&&(r=r.map(a=>a)),_(e,["customMetadata"],r)}const s=v(i,["chunkingConfig"]);return e!==void 0&&s!=null&&_(e,["chunkingConfig"],s),t}function dN(i){const e={},t=v(i,["name"]);t!=null&&_(e,["name"],t);const n=v(i,["metadata"]);n!=null&&_(e,["metadata"],n);const s=v(i,["done"]);s!=null&&_(e,["done"],s);const r=v(i,["error"]);r!=null&&_(e,["error"],r);const a=v(i,["response"]);return a!=null&&_(e,["response"],pN(a)),e}function hN(i){const e={},t=v(i,["fileSearchStoreName"]);t!=null&&_(e,["_url","file_search_store_name"],t);const n=v(i,["fileName"]);n!=null&&_(e,["fileName"],n);const s=v(i,["config"]);return s!=null&&fN(s,e),e}function pN(i){const e={},t=v(i,["sdkHttpResponse"]);t!=null&&_(e,["sdkHttpResponse"],t);const n=v(i,["parent"]);n!=null&&_(e,["parent"],n);const s=v(i,["documentName"]);return s!=null&&_(e,["documentName"],s),e}function mN(i,e){const t={},n=v(i,["pageSize"]);e!==void 0&&n!=null&&_(e,["_query","pageSize"],n);const s=v(i,["pageToken"]);return e!==void 0&&s!=null&&_(e,["_query","pageToken"],s),t}function gN(i){const e={},t=v(i,["config"]);return t!=null&&mN(t,e),e}function vN(i){const e={},t=v(i,["sdkHttpResponse"]);t!=null&&_(e,["sdkHttpResponse"],t);const n=v(i,["nextPageToken"]);n!=null&&_(e,["nextPageToken"],n);const s=v(i,["fileSearchStores"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(a=>a)),_(e,["fileSearchStores"],r)}return e}function LR(i,e){const t={},n=v(i,["mimeType"]);e!==void 0&&n!=null&&_(e,["mimeType"],n);const s=v(i,["displayName"]);e!==void 0&&s!=null&&_(e,["displayName"],s);const r=v(i,["customMetadata"]);if(e!==void 0&&r!=null){let u=r;Array.isArray(u)&&(u=u.map(f=>f)),_(e,["customMetadata"],u)}const a=v(i,["chunkingConfig"]);return e!==void 0&&a!=null&&_(e,["chunkingConfig"],a),t}function yN(i){const e={},t=v(i,["fileSearchStoreName"]);t!=null&&_(e,["_url","file_search_store_name"],t);const n=v(i,["config"]);return n!=null&&LR(n,e),e}function _N(i){const e={},t=v(i,["sdkHttpResponse"]);return t!=null&&_(e,["sdkHttpResponse"],t),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const EN="Content-Type",SN="X-Server-Timeout",TN="User-Agent",yg="x-goog-api-client",xN="1.35.0",AN=`google-genai-sdk/${xN}`,RN="v1beta1",bN="v1beta";class MN{constructor(e){var t,n;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const s={};this.clientOptions.vertexai?(s.apiVersion=(t=this.clientOptions.apiVersion)!==null&&t!==void 0?t:RN,s.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(s.apiVersion=(n=this.clientOptions.apiVersion)!==null&&n!==void 0?n:bN,s.baseUrl="https://generativelanguage.googleapis.com/"),s.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=s,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(s,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}async getAuthHeaders(){const e=new Headers;return await this.clientOptions.auth.addAuthHeaders(e),e}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const n=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&n.push(e.apiVersion),n.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),t=new URL(e);return t.protocol=t.protocol=="http:"?"ws":"wss",t.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,t,n){const s=[this.getRequestUrlInternal(t)];return n&&s.push(this.getBaseResourcePath()),e!==""&&s.push(e),new URL(`${s.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const n=this.shouldPrependVertexProjectPath(e),s=this.constructUrl(e.path,t,n);if(e.queryParams)for(const[a,u]of Object.entries(e.queryParams))s.searchParams.append(a,String(u));let r={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else r.body=e.body;return r=await this.includeExtraHttpOptionsToRequestInit(r,t,s.toString(),e.abortSignal),this.unaryApiCall(s,r,e.httpMethod)}patchHttpOptions(e,t){const n=JSON.parse(JSON.stringify(e));for(const[s,r]of Object.entries(t))typeof r=="object"?n[s]=Object.assign(Object.assign({},n[s]),r):r!==void 0&&(n[s]=r);return n}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const n=this.shouldPrependVertexProjectPath(e),s=this.constructUrl(e.path,t,n);(!s.searchParams.has("alt")||s.searchParams.get("alt")!=="sse")&&s.searchParams.set("alt","sse");let r={};return r.body=e.body,r=await this.includeExtraHttpOptionsToRequestInit(r,t,s.toString(),e.abortSignal),this.streamApiCall(s,r,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,n,s){if(t&&t.timeout||s){const r=new AbortController,a=r.signal;if(t.timeout&&(t==null?void 0:t.timeout)>0){const u=setTimeout(()=>r.abort(),t.timeout);u&&typeof u.unref=="function"&&u.unref()}s&&s.addEventListener("abort",()=>{r.abort()}),e.signal=a}return t&&t.extraBody!==null&&CN(e,t.extraBody),e.headers=await this.getHeadersInternal(t,n),e}async unaryApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async s=>(await LT(s),new hg(s))).catch(s=>{throw s instanceof Error?s:new Error(JSON.stringify(s))})}async streamApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async s=>(await LT(s),this.processStreamResponse(s))).catch(s=>{throw s instanceof Error?s:new Error(JSON.stringify(s))})}processStreamResponse(e){return Ms(this,arguments,function*(){var n;const s=(n=e==null?void 0:e.body)===null||n===void 0?void 0:n.getReader(),r=new TextDecoder("utf-8");if(!s)throw new Error("Response body is empty");try{let a="";const u="data:",f=[`

`,"\r\r",`\r
\r
`];for(;;){const{done:c,value:d}=yield Tt(s.read());if(c){if(a.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const p=r.decode(d,{stream:!0});try{const E=JSON.parse(p);if("error"in E){const A=JSON.parse(JSON.stringify(E.error)),S=A.status,x=A.code,M=`got status: ${S}. ${JSON.stringify(E)}`;if(x>=400&&x<600)throw new Gd({message:M,status:x})}}catch(E){if(E.name==="ApiError")throw E}a+=p;let m=-1,y=0;for(;;){m=-1,y=0;for(const S of f){const x=a.indexOf(S);x!==-1&&(m===-1||x<m)&&(m=x,y=S.length)}if(m===-1)break;const E=a.substring(0,m);a=a.substring(m+y);const A=E.trim();if(A.startsWith(u)){const S=A.substring(u.length).trim();try{const x=new Response(S,{headers:e==null?void 0:e.headers,status:e==null?void 0:e.status,statusText:e==null?void 0:e.statusText});yield yield Tt(new hg(x))}catch(x){throw new Error(`exception parsing stream chunk ${S}. ${x}`)}}}}}finally{s.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(n=>{throw new Error(`exception ${n} sending request`)})}getDefaultHeaders(){const e={},t=AN+" "+this.clientOptions.userAgentExtra;return e[TN]=t,e[yg]=t,e[EN]="application/json",e}async getHeadersInternal(e,t){const n=new Headers;if(e&&e.headers){for(const[s,r]of Object.entries(e.headers))n.append(s,r);e.timeout&&e.timeout>0&&n.append(SN,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(n,t),n}getFileName(e){var t;let n="";return typeof e=="string"&&(n=e.replace(/[/\\]+$/,""),n=(t=n.split(/[/\\]/).pop())!==null&&t!==void 0?t:""),n}async uploadFile(e,t){var n;const s={};t!=null&&(s.mimeType=t.mimeType,s.name=t.name,s.displayName=t.displayName),s.name&&!s.name.startsWith("files/")&&(s.name=`files/${s.name}`);const r=this.clientOptions.uploader,a=await r.stat(e);s.sizeBytes=String(a.size);const u=(n=t==null?void 0:t.mimeType)!==null&&n!==void 0?n:a.type;if(u===void 0||u==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");s.mimeType=u;const f={file:s},c=this.getFileName(e),d=Je("upload/v1beta/files",f._url),p=await this.fetchUploadUrl(d,s.sizeBytes,s.mimeType,c,f,t==null?void 0:t.httpOptions);return r.upload(e,p,this)}async uploadFileToFileSearchStore(e,t,n){var s;const r=this.clientOptions.uploader,a=await r.stat(t),u=String(a.size),f=(s=n==null?void 0:n.mimeType)!==null&&s!==void 0?s:a.type;if(f===void 0||f==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");const c=`upload/v1beta/${e}:uploadToFileSearchStore`,d=this.getFileName(t),p={};n!=null&&LR(n,p);const m=await this.fetchUploadUrl(c,u,f,d,p,n==null?void 0:n.httpOptions);return r.uploadToFileSearchStore(t,m,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,t,n,s,r,a){var u;let f={};a?f=a:f={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${t}`,"X-Goog-Upload-Header-Content-Type":`${n}`},s?{"X-Goog-Upload-File-Name":s}:{})};const c=await this.request({path:e,body:JSON.stringify(r),httpMethod:"POST",httpOptions:f});if(!c||!(c!=null&&c.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const d=(u=c==null?void 0:c.headers)===null||u===void 0?void 0:u["x-goog-upload-url"];if(d===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return d}}async function LT(i){var e;if(i===void 0)throw new Error("response is undefined");if(!i.ok){const t=i.status;let n;!((e=i.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?n=await i.json():n={error:{message:await i.text(),code:i.status,status:i.statusText}};const s=JSON.stringify(n);throw t>=400&&t<600?new Gd({message:s,status:t}):new Error(s)}}function CN(i,e){if(!e||Object.keys(e).length===0)return;if(i.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let t={};if(typeof i.body=="string"&&i.body.length>0)try{const r=JSON.parse(i.body);if(typeof r=="object"&&r!==null&&!Array.isArray(r))t=r;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function n(r,a){const u=Object.assign({},r);for(const f in a)if(Object.prototype.hasOwnProperty.call(a,f)){const c=a[f],d=u[f];c&&typeof c=="object"&&!Array.isArray(c)&&d&&typeof d=="object"&&!Array.isArray(d)?u[f]=n(d,c):(d&&c&&typeof d!=typeof c&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${f}". Original type: ${typeof d}, New type: ${typeof c}. Overwriting.`),u[f]=c)}return u}const s=n(t,e);i.body=JSON.stringify(s)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const IN="mcp_used/unknown";let LN=!1;function DR(i){for(const e of i)if(DN(e)||typeof e=="object"&&"inputSchema"in e)return!0;return LN}function wR(i){var e;const t=(e=i[yg])!==null&&e!==void 0?e:"";i[yg]=(t+` ${IN}`).trimStart()}function DN(i){return i!==null&&typeof i=="object"&&i instanceof k0}function wN(i){return Ms(this,arguments,function*(t,n=100){let s,r=0;for(;r<n;){const a=yield Tt(t.listTools({cursor:s}));for(const u of a.tools)yield yield Tt(u),r++;if(!a.nextCursor)break;s=a.nextCursor}})}class k0{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new k0(e,t)}async initialize(){var e,t,n,s;if(this.mcpTools.length>0)return;const r={},a=[];for(const d of this.mcpClients)try{for(var u=!0,f=(t=void 0,Cs(wN(d))),c;c=await f.next(),e=c.done,!e;u=!0){s=c.value,u=!1;const p=s;a.push(p);const m=p.name;if(r[m])throw new Error(`Duplicate function name ${m} found in MCP tools. Please ensure function names are unique.`);r[m]=d}}catch(p){t={error:p}}finally{try{!u&&!e&&(n=f.return)&&await n.call(f)}finally{if(t)throw t.error}}this.mcpTools=a,this.functionNameToMcpClient=r}async tool(){return await this.initialize(),cD(this.mcpTools,this.config)}async callTool(e){await this.initialize();const t=[];for(const n of e)if(n.name in this.functionNameToMcpClient){const s=this.functionNameToMcpClient[n.name];let r;this.config.timeout&&(r={timeout:this.config.timeout});const a=await s.callTool({name:n.name,arguments:n.args},void 0,r);t.push({functionResponse:{name:n.name,response:a.isError?{error:a}:a}})}return t}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function PN(i,e,t){const n=new nD;let s;t.data instanceof Blob?s=JSON.parse(await t.data.text()):s=JSON.parse(t.data),Object.assign(n,s),e(n)}class NN{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n}async connect(e){var t,n;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const s=this.apiClient.getWebsocketBaseUrl(),r=this.apiClient.getApiVersion(),a=FN(this.apiClient.getDefaultHeaders()),u=this.apiClient.getApiKey(),f=`${s}/ws/google.ai.generativelanguage.${r}.GenerativeService.BidiGenerateMusic?key=${u}`;let c=()=>{};const d=new Promise(b=>{c=b}),p=e.callbacks,m=function(){c({})},y=this.apiClient,E={onopen:m,onmessage:b=>{PN(y,p.onmessage,b)},onerror:(t=p==null?void 0:p.onerror)!==null&&t!==void 0?t:function(b){},onclose:(n=p==null?void 0:p.onclose)!==null&&n!==void 0?n:function(b){}},A=this.webSocketFactory.create(f,ON(a),E);A.connect(),await d;const M={setup:{model:Zt(this.apiClient,e.model)}};return A.send(JSON.stringify(M)),new UN(A,this.apiClient)}}class UN{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const t=a1(e);this.conn.send(JSON.stringify({clientContent:t}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const t=o1(e);this.conn.send(JSON.stringify(t))}sendPlaybackControl(e){const t={playbackControl:e};this.conn.send(JSON.stringify(t))}play(){this.sendPlaybackControl(ul.PLAY)}pause(){this.sendPlaybackControl(ul.PAUSE)}stop(){this.sendPlaybackControl(ul.STOP)}resetContext(){this.sendPlaybackControl(ul.RESET_CONTEXT)}close(){this.conn.close()}}function ON(i){const e={};return i.forEach((t,n)=>{e[n]=t}),e}function FN(i){const e=new Headers;for(const[t,n]of Object.entries(i))e.append(t,n);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const kN="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function BN(i,e,t){const n=new tD;let s;t.data instanceof Blob?s=await t.data.text():t.data instanceof ArrayBuffer?s=new TextDecoder().decode(t.data):s=t.data;const r=JSON.parse(s);if(i.isVertexAI()){const a=c1(r);Object.assign(n,a)}else Object.assign(n,r);e(n)}class GN{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n,this.music=new NN(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,n,s,r,a,u;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const f=this.apiClient.getWebsocketBaseUrl(),c=this.apiClient.getApiVersion();let d;const p=this.apiClient.getHeaders();e.config&&e.config.tools&&DR(e.config.tools)&&wR(p);const m=$N(p);if(this.apiClient.isVertexAI())d=`${f}/ws/google.cloud.aiplatform.${c}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(m,d);else{const L=this.apiClient.getApiKey();let I="BidiGenerateContent",F="key";L!=null&&L.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),c!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),I="BidiGenerateContentConstrained",F="access_token"),d=`${f}/ws/google.ai.generativelanguage.${c}.GenerativeService.${I}?${F}=${L}`}let y=()=>{};const E=new Promise(L=>{y=L}),A=e.callbacks,S=function(){var L;(L=A==null?void 0:A.onopen)===null||L===void 0||L.call(A),y({})},x=this.apiClient,M={onopen:S,onmessage:L=>{BN(x,A.onmessage,L)},onerror:(t=A==null?void 0:A.onerror)!==null&&t!==void 0?t:function(L){},onclose:(n=A==null?void 0:A.onclose)!==null&&n!==void 0?n:function(L){}},b=this.webSocketFactory.create(d,zN(m),M);b.connect(),await E;let C=Zt(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&C.startsWith("publishers/")){const L=this.apiClient.getProject(),I=this.apiClient.getLocation();C=`projects/${L}/locations/${I}/`+C}let N={};this.apiClient.isVertexAI()&&((s=e.config)===null||s===void 0?void 0:s.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[_d.AUDIO]}:e.config.responseModalities=[_d.AUDIO]),!((r=e.config)===null||r===void 0)&&r.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const U=(u=(a=e.config)===null||a===void 0?void 0:a.tools)!==null&&u!==void 0?u:[],w=[];for(const L of U)if(this.isCallableTool(L)){const I=L;w.push(await I.tool())}else w.push(L);w.length>0&&(e.config.tools=w);const O={model:C,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?N=r1(this.apiClient,O):N=s1(this.apiClient,O),delete N.config,b.send(JSON.stringify(N)),new HN(b,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}}const VN={turnComplete:!0};class HN{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(t.turns!==null&&t.turns!==void 0){let n=[];try{n=ds(t.turns),e.isVertexAI()||(n=n.map(s=>Vd(s)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:n,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let n=[];if(t.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(t.functionResponses)?n=t.functionResponses:n=[t.functionResponses],n.length===0)throw new Error("functionResponses is required.");for(const r of n){if(typeof r!="object"||r===null||!("name"in r)||!("response"in r))throw new Error(`Could not parse function response, type '${typeof r}'.`);if(!e.isVertexAI()&&!("id"in r))throw new Error(kN)}return{toolResponse:{functionResponses:n}}}sendClientContent(e){e=Object.assign(Object.assign({},VN),e);const t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};this.apiClient.isVertexAI()?t={realtimeInput:u1(e)}:t={realtimeInput:l1(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}}function zN(i){const e={};return i.forEach((t,n)=>{e[n]=t}),e}function $N(i){const e=new Headers;for(const[t,n]of Object.entries(i))e.append(t,n);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const DT=10;function wT(i){var e,t,n;if(!((e=i==null?void 0:i.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let s=!1;for(const a of(t=i==null?void 0:i.tools)!==null&&t!==void 0?t:[])if(pl(a)){s=!0;break}if(!s)return!0;const r=(n=i==null?void 0:i.automaticFunctionCalling)===null||n===void 0?void 0:n.maximumRemoteCalls;return r&&(r<0||!Number.isInteger(r))||r==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",r),!0):!1}function pl(i){return"callTool"in i&&typeof i.callTool=="function"}function qN(i){var e,t,n;return(n=(t=(e=i.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(s=>pl(s)))!==null&&n!==void 0?n:!1}function PT(i){var e;const t=[];return!((e=i==null?void 0:i.config)===null||e===void 0)&&e.tools&&i.config.tools.forEach((n,s)=>{if(pl(n))return;const r=n;r.functionDeclarations&&r.functionDeclarations.length>0&&t.push(s)}),t}function NT(i){var e;return!(!((e=i==null?void 0:i.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class WN extends Ir{constructor(e){super(),this.apiClient=e,this.generateContent=async t=>{var n,s,r,a,u;const f=await this.processParamsMaybeAddMcpUsage(t);if(this.maybeMoveToResponseJsonSchem(t),!qN(t)||wT(t.config))return await this.generateContentInternal(f);const c=PT(t);if(c.length>0){const A=c.map(S=>`tools[${S}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${A}.`)}let d,p;const m=ds(f.contents),y=(r=(s=(n=f.config)===null||n===void 0?void 0:n.automaticFunctionCalling)===null||s===void 0?void 0:s.maximumRemoteCalls)!==null&&r!==void 0?r:DT;let E=0;for(;E<y&&(d=await this.generateContentInternal(f),!(!d.functionCalls||d.functionCalls.length===0));){const A=d.candidates[0].content,S=[];for(const x of(u=(a=t.config)===null||a===void 0?void 0:a.tools)!==null&&u!==void 0?u:[])if(pl(x)){const b=await x.callTool(d.functionCalls);S.push(...b)}E++,p={role:"user",parts:S},f.contents=ds(f.contents),f.contents.push(A),f.contents.push(p),NT(f.config)&&(m.push(A),m.push(p))}return NT(f.config)&&(d.automaticFunctionCallingHistory=m),d},this.generateContentStream=async t=>{var n,s,r,a,u;if(this.maybeMoveToResponseJsonSchem(t),wT(t.config)){const p=await this.processParamsMaybeAddMcpUsage(t);return await this.generateContentStreamInternal(p)}const f=PT(t);if(f.length>0){const p=f.map(m=>`tools[${m}]`).join(", ");throw new Error(`Incompatible tools found at ${p}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}const c=(r=(s=(n=t==null?void 0:t.config)===null||n===void 0?void 0:n.toolConfig)===null||s===void 0?void 0:s.functionCallingConfig)===null||r===void 0?void 0:r.streamFunctionCallArguments,d=(u=(a=t==null?void 0:t.config)===null||a===void 0?void 0:a.automaticFunctionCalling)===null||u===void 0?void 0:u.disable;if(c&&!d)throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(t)},this.generateImages=async t=>await this.generateImagesInternal(t).then(n=>{var s;let r;const a=[];if(n!=null&&n.generatedImages)for(const f of n.generatedImages)f&&(f!=null&&f.safetyAttributes)&&((s=f==null?void 0:f.safetyAttributes)===null||s===void 0?void 0:s.contentType)==="Positive Prompt"?r=f==null?void 0:f.safetyAttributes:a.push(f);let u;return r?u={generatedImages:a,positivePromptSafetyAttributes:r,sdkHttpResponse:n.sdkHttpResponse}:u={generatedImages:a,sdkHttpResponse:n.sdkHttpResponse},u}),this.list=async t=>{var n;const a={config:Object.assign(Object.assign({},{queryBase:!0}),t==null?void 0:t.config)};if(this.apiClient.isVertexAI()&&!a.config.queryBase){if(!((n=a.config)===null||n===void 0)&&n.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");a.config.filter="labels.tune-type:*"}return new oa(br.PAGED_ITEM_MODELS,u=>this.listInternal(u),await this.listInternal(a),a)},this.editImage=async t=>{const n={model:t.model,prompt:t.prompt,referenceImages:[],config:t.config};return t.referenceImages&&t.referenceImages&&(n.referenceImages=t.referenceImages.map(s=>s.toReferenceImageAPI())),await this.editImageInternal(n)},this.upscaleImage=async t=>{let n={numberOfImages:1,mode:"upscale"};t.config&&(n=Object.assign(Object.assign({},n),t.config));const s={model:t.model,image:t.image,upscaleFactor:t.upscaleFactor,config:n};return await this.upscaleImageInternal(s)},this.generateVideos=async t=>{var n,s,r,a,u,f;if((t.prompt||t.image||t.video)&&t.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((n=t.video)===null||n===void 0)&&n.uri&&(!((s=t.video)===null||s===void 0)&&s.videoBytes)?t.video={uri:t.video.uri,mimeType:t.video.mimeType}:!((a=(r=t.source)===null||r===void 0?void 0:r.video)===null||a===void 0)&&a.uri&&(!((f=(u=t.source)===null||u===void 0?void 0:u.video)===null||f===void 0)&&f.videoBytes)&&(t.source.video={uri:t.source.video.uri,mimeType:t.source.video.mimeType})),await this.generateVideosInternal(t)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var t,n,s;const r=(t=e.config)===null||t===void 0?void 0:t.tools;if(!r)return e;const a=await Promise.all(r.map(async f=>pl(f)?await f.tool():f)),u={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:a})};if(u.config.tools=a,e.config&&e.config.tools&&DR(e.config.tools)){const f=(s=(n=e.config.httpOptions)===null||n===void 0?void 0:n.headers)!==null&&s!==void 0?s:{};let c=Object.assign({},f);Object.keys(c).length===0&&(c=this.apiClient.getDefaultHeaders()),wR(c),u.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:c})}return u}async initAfcToolsMap(e){var t,n,s;const r=new Map;for(const a of(n=(t=e.config)===null||t===void 0?void 0:t.tools)!==null&&n!==void 0?n:[])if(pl(a)){const u=a,f=await u.tool();for(const c of(s=f.functionDeclarations)!==null&&s!==void 0?s:[]){if(!c.name)throw new Error("Function declaration name is required.");if(r.has(c.name))throw new Error(`Duplicate tool declaration name: ${c.name}`);r.set(c.name,u)}}return r}async processAfcStream(e){var t,n,s;const r=(s=(n=(t=e.config)===null||t===void 0?void 0:t.automaticFunctionCalling)===null||n===void 0?void 0:n.maximumRemoteCalls)!==null&&s!==void 0?s:DT;let a=!1,u=0;const f=await this.initAfcToolsMap(e);return(function(c,d,p){return Ms(this,arguments,function*(){for(var m,y,E,A,S,x;u<r;){a&&(u++,a=!1);const N=yield Tt(c.processParamsMaybeAddMcpUsage(p)),U=yield Tt(c.generateContentStreamInternal(N)),w=[],O=[];try{for(var M=!0,b=(y=void 0,Cs(U)),C;C=yield Tt(b.next()),m=C.done,!m;M=!0){A=C.value,M=!1;const L=A;if(yield yield Tt(L),L.candidates&&(!((S=L.candidates[0])===null||S===void 0)&&S.content)){O.push(L.candidates[0].content);for(const I of(x=L.candidates[0].content.parts)!==null&&x!==void 0?x:[])if(u<r&&I.functionCall){if(!I.functionCall.name)throw new Error("Function call name was not returned by the model.");if(d.has(I.functionCall.name)){const F=yield Tt(d.get(I.functionCall.name).callTool([I.functionCall]));w.push(...F)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${d.keys()}, mising tool: ${I.functionCall.name}`)}}}}catch(L){y={error:L}}finally{try{!M&&!m&&(E=b.return)&&(yield Tt(E.call(b)))}finally{if(y)throw y.error}}if(w.length>0){a=!0;const L=new Mu;L.candidates=[{content:{role:"user",parts:w}}],yield yield Tt(L);const I=[];I.push(...O),I.push({role:"user",parts:w});const F=ds(p.contents).concat(I);p.contents=F}else break}})})(this,f,e)}async generateContentInternal(e){var t,n,s,r;let a,u="",f={};if(this.apiClient.isVertexAI()){const c=MT(this.apiClient,e);return u=Je("{model}:generateContent",c._url),f=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:d.headers},m})),a.then(d=>{const p=IT(d),m=new Mu;return Object.assign(m,p),m})}else{const c=bT(this.apiClient,e);return u=Je("{model}:generateContent",c._url),f=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:d.headers},m})),a.then(d=>{const p=CT(d),m=new Mu;return Object.assign(m,p),m})}}async generateContentStreamInternal(e){var t,n,s,r;let a,u="",f={};if(this.apiClient.isVertexAI()){const c=MT(this.apiClient,e);return u=Je("{model}:streamGenerateContent?alt=sse",c._url),f=c._query,delete c._url,delete c._query,a=this.apiClient.requestStream({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}),a.then(function(p){return Ms(this,arguments,function*(){var m,y,E,A;try{for(var S=!0,x=Cs(p),M;M=yield Tt(x.next()),m=M.done,!m;S=!0){A=M.value,S=!1;const b=A,C=IT(yield Tt(b.json()));C.sdkHttpResponse={headers:b.headers};const N=new Mu;Object.assign(N,C),yield yield Tt(N)}}catch(b){y={error:b}}finally{try{!S&&!m&&(E=x.return)&&(yield Tt(E.call(x)))}finally{if(y)throw y.error}}})})}else{const c=bT(this.apiClient,e);return u=Je("{model}:streamGenerateContent?alt=sse",c._url),f=c._query,delete c._url,delete c._query,a=this.apiClient.requestStream({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}),a.then(function(p){return Ms(this,arguments,function*(){var m,y,E,A;try{for(var S=!0,x=Cs(p),M;M=yield Tt(x.next()),m=M.done,!m;S=!0){A=M.value,S=!1;const b=A,C=CT(yield Tt(b.json()));C.sdkHttpResponse={headers:b.headers};const N=new Mu;Object.assign(N,C),yield yield Tt(N)}}catch(b){y={error:b}}finally{try{!S&&!m&&(E=x.return)&&(yield Tt(E.call(x)))}finally{if(y)throw y.error}}})})}}async embedContent(e){var t,n,s,r;let a,u="",f={};if(this.apiClient.isVertexAI()){const c=G1(this.apiClient,e);return u=Je("{model}:predict",c._url),f=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:d.headers},m})),a.then(d=>{const p=H1(d),m=new uT;return Object.assign(m,p),m})}else{const c=B1(this.apiClient,e);return u=Je("{model}:batchEmbedContents",c._url),f=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:d.headers},m})),a.then(d=>{const p=V1(d),m=new uT;return Object.assign(m,p),m})}}async generateImagesInternal(e){var t,n,s,r;let a,u="",f={};if(this.apiClient.isVertexAI()){const c=j1(this.apiClient,e);return u=Je("{model}:predict",c._url),f=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:d.headers},m})),a.then(d=>{const p=tP(d),m=new cT;return Object.assign(m,p),m})}else{const c=Z1(this.apiClient,e);return u=Je("{model}:predict",c._url),f=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:d.headers},m})),a.then(d=>{const p=eP(d),m=new cT;return Object.assign(m,p),m})}}async editImageInternal(e){var t,n;let s,r="",a={};if(this.apiClient.isVertexAI()){const u=U1(this.apiClient,e);return r=Je("{model}:predict",u._url),a=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json().then(c=>{const d=c;return d.sdkHttpResponse={headers:f.headers},d})),s.then(f=>{const c=O1(f),d=new $L;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,n;let s,r="",a={};if(this.apiClient.isVertexAI()){const u=jP(this.apiClient,e);return r=Je("{model}:predict",u._url),a=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json().then(c=>{const d=c;return d.sdkHttpResponse={headers:f.headers},d})),s.then(f=>{const c=eN(f),d=new qL;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var t,n;let s,r="",a={};if(this.apiClient.isVertexAI()){const u=NP(this.apiClient,e);return r=Je("{model}:predict",u._url),a=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),s.then(f=>{const c=UP(f),d=new WL;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var t,n;let s,r="",a={};if(this.apiClient.isVertexAI()){const u=VP(this.apiClient,e);return r=Je("{model}:predict",u._url),a=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),s.then(f=>{const c=HP(f),d=new KL;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var t,n,s,r;let a,u="",f={};if(this.apiClient.isVertexAI()){const c=yP(this.apiClient,e);return u=Je("{name}",c._url),f=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),a.then(d=>vg(d))}else{const c=vP(this.apiClient,e);return u=Je("{name}",c._url),f=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),a.then(d=>gg(d))}}async listInternal(e){var t,n,s,r;let a,u="",f={};if(this.apiClient.isVertexAI()){const c=MP(this.apiClient,e);return u=Je("{models_url}",c._url),f=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:d.headers},m})),a.then(d=>{const p=IP(d),m=new fT;return Object.assign(m,p),m})}else{const c=bP(this.apiClient,e);return u=Je("{models_url}",c._url),f=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:d.headers},m})),a.then(d=>{const p=CP(d),m=new fT;return Object.assign(m,p),m})}}async update(e){var t,n,s,r;let a,u="",f={};if(this.apiClient.isVertexAI()){const c=QP(this.apiClient,e);return u=Je("{model}",c._url),f=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),a.then(d=>vg(d))}else{const c=JP(this.apiClient,e);return u=Je("{name}",c._url),f=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),a.then(d=>gg(d))}}async delete(e){var t,n,s,r;let a,u="",f={};if(this.apiClient.isVertexAI()){const c=D1(this.apiClient,e);return u=Je("{name}",c._url),f=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:d.headers},m})),a.then(d=>{const p=P1(d),m=new dT;return Object.assign(m,p),m})}else{const c=L1(this.apiClient,e);return u=Je("{name}",c._url),f=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:d.headers},m})),a.then(d=>{const p=w1(d),m=new dT;return Object.assign(m,p),m})}}async countTokens(e){var t,n,s,r;let a,u="",f={};if(this.apiClient.isVertexAI()){const c=M1(this.apiClient,e);return u=Je("{model}:countTokens",c._url),f=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:d.headers},m})),a.then(d=>{const p=I1(d),m=new hT;return Object.assign(m,p),m})}else{const c=b1(this.apiClient,e);return u=Je("{model}:countTokens",c._url),f=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:d.headers},m})),a.then(d=>{const p=C1(d),m=new hT;return Object.assign(m,p),m})}}async computeTokens(e){var t,n;let s,r="",a={};if(this.apiClient.isVertexAI()){const u=_1(this.apiClient,e);return r=Je("{model}:computeTokens",u._url),a=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json().then(c=>{const d=c;return d.sdkHttpResponse={headers:f.headers},d})),s.then(f=>{const c=E1(f),d=new YL;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var t,n,s,r;let a,u="",f={};if(this.apiClient.isVertexAI()){const c=aP(this.apiClient,e);return u=Je("{model}:predictLongRunning",c._url),f=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),a.then(d=>{const p=rP(d),m=new Ed;return Object.assign(m,p),m})}else{const c=oP(this.apiClient,e);return u=Je("{model}:predictLongRunning",c._url),f=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),a.then(d=>{const p=sP(d),m=new Ed;return Object.assign(m,p),m})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class KN extends Ir{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const t=e.operation,n=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const s=t.name.split("/operations/")[0];let r;n&&"httpOptions"in n&&(r=n.httpOptions);const a=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:s,config:{httpOptions:r}});return t._fromAPIResponse({apiResponse:a,_isVertexAI:!0})}else{const s=await this.getVideosOperationInternal({operationName:t.name,config:n});return t._fromAPIResponse({apiResponse:s,_isVertexAI:!1})}}async get(e){const t=e.operation,n=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const s=t.name.split("/operations/")[0];let r;n&&"httpOptions"in n&&(r=n.httpOptions);const a=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:s,config:{httpOptions:r}});return t._fromAPIResponse({apiResponse:a,_isVertexAI:!0})}else{const s=await this.getVideosOperationInternal({operationName:t.name,config:n});return t._fromAPIResponse({apiResponse:s,_isVertexAI:!1})}}async getVideosOperationInternal(e){var t,n,s,r;let a,u="",f={};if(this.apiClient.isVertexAI()){const c=kL(e);return u=Je("{operationName}",c._url),f=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),a}else{const c=FL(e);return u=Je("{operationName}",c._url),f=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),a}}async fetchPredictVideosOperationInternal(e){var t,n;let s,r="",a={};if(this.apiClient.isVertexAI()){const u=LL(e);return r=Je("{resourceName}:fetchPredictOperation",u._url),a=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),s}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function YN(i){const e={},t=v(i,["data"]);if(t!=null&&_(e,["data"],t),v(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=v(i,["mimeType"]);return n!=null&&_(e,["mimeType"],n),e}function XN(i){const e={},t=v(i,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(r=>sU(r))),_(e,["parts"],s)}const n=v(i,["role"]);return n!=null&&_(e,["role"],n),e}function JN(i,e,t){const n={},s=v(e,["expireTime"]);t!==void 0&&s!=null&&_(t,["expireTime"],s);const r=v(e,["newSessionExpireTime"]);t!==void 0&&r!=null&&_(t,["newSessionExpireTime"],r);const a=v(e,["uses"]);t!==void 0&&a!=null&&_(t,["uses"],a);const u=v(e,["liveConnectConstraints"]);t!==void 0&&u!=null&&_(t,["bidiGenerateContentSetup"],iU(i,u));const f=v(e,["lockAdditionalFields"]);return t!==void 0&&f!=null&&_(t,["fieldMask"],f),n}function QN(i,e){const t={},n=v(e,["config"]);return n!=null&&_(t,["config"],JN(i,n,t)),t}function ZN(i){const e={};if(v(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=v(i,["fileUri"]);t!=null&&_(e,["fileUri"],t);const n=v(i,["mimeType"]);return n!=null&&_(e,["mimeType"],n),e}function jN(i){const e={},t=v(i,["id"]);t!=null&&_(e,["id"],t);const n=v(i,["args"]);n!=null&&_(e,["args"],n);const s=v(i,["name"]);if(s!=null&&_(e,["name"],s),v(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(v(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function eU(i){const e={};if(v(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=v(i,["enableWidget"]);return t!=null&&_(e,["enableWidget"],t),e}function tU(i){const e={};if(v(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(v(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=v(i,["timeRangeFilter"]);return t!=null&&_(e,["timeRangeFilter"],t),e}function nU(i,e){const t={},n=v(i,["generationConfig"]);e!==void 0&&n!=null&&_(e,["setup","generationConfig"],n);const s=v(i,["responseModalities"]);e!==void 0&&s!=null&&_(e,["setup","generationConfig","responseModalities"],s);const r=v(i,["temperature"]);e!==void 0&&r!=null&&_(e,["setup","generationConfig","temperature"],r);const a=v(i,["topP"]);e!==void 0&&a!=null&&_(e,["setup","generationConfig","topP"],a);const u=v(i,["topK"]);e!==void 0&&u!=null&&_(e,["setup","generationConfig","topK"],u);const f=v(i,["maxOutputTokens"]);e!==void 0&&f!=null&&_(e,["setup","generationConfig","maxOutputTokens"],f);const c=v(i,["mediaResolution"]);e!==void 0&&c!=null&&_(e,["setup","generationConfig","mediaResolution"],c);const d=v(i,["seed"]);e!==void 0&&d!=null&&_(e,["setup","generationConfig","seed"],d);const p=v(i,["speechConfig"]);e!==void 0&&p!=null&&_(e,["setup","generationConfig","speechConfig"],F0(p));const m=v(i,["thinkingConfig"]);e!==void 0&&m!=null&&_(e,["setup","generationConfig","thinkingConfig"],m);const y=v(i,["enableAffectiveDialog"]);e!==void 0&&y!=null&&_(e,["setup","generationConfig","enableAffectiveDialog"],y);const E=v(i,["systemInstruction"]);e!==void 0&&E!=null&&_(e,["setup","systemInstruction"],XN(mi(E)));const A=v(i,["tools"]);if(e!==void 0&&A!=null){let U=wl(A);Array.isArray(U)&&(U=U.map(w=>oU(Dl(w)))),_(e,["setup","tools"],U)}const S=v(i,["sessionResumption"]);e!==void 0&&S!=null&&_(e,["setup","sessionResumption"],rU(S));const x=v(i,["inputAudioTranscription"]);e!==void 0&&x!=null&&_(e,["setup","inputAudioTranscription"],x);const M=v(i,["outputAudioTranscription"]);e!==void 0&&M!=null&&_(e,["setup","outputAudioTranscription"],M);const b=v(i,["realtimeInputConfig"]);e!==void 0&&b!=null&&_(e,["setup","realtimeInputConfig"],b);const C=v(i,["contextWindowCompression"]);e!==void 0&&C!=null&&_(e,["setup","contextWindowCompression"],C);const N=v(i,["proactivity"]);if(e!==void 0&&N!=null&&_(e,["setup","proactivity"],N),v(i,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return t}function iU(i,e){const t={},n=v(e,["model"]);n!=null&&_(t,["setup","model"],Zt(i,n));const s=v(e,["config"]);return s!=null&&_(t,["config"],nU(s,t)),t}function sU(i){const e={},t=v(i,["mediaResolution"]);t!=null&&_(e,["mediaResolution"],t);const n=v(i,["codeExecutionResult"]);n!=null&&_(e,["codeExecutionResult"],n);const s=v(i,["executableCode"]);s!=null&&_(e,["executableCode"],s);const r=v(i,["fileData"]);r!=null&&_(e,["fileData"],ZN(r));const a=v(i,["functionCall"]);a!=null&&_(e,["functionCall"],jN(a));const u=v(i,["functionResponse"]);u!=null&&_(e,["functionResponse"],u);const f=v(i,["inlineData"]);f!=null&&_(e,["inlineData"],YN(f));const c=v(i,["text"]);c!=null&&_(e,["text"],c);const d=v(i,["thought"]);d!=null&&_(e,["thought"],d);const p=v(i,["thoughtSignature"]);p!=null&&_(e,["thoughtSignature"],p);const m=v(i,["videoMetadata"]);return m!=null&&_(e,["videoMetadata"],m),e}function rU(i){const e={},t=v(i,["handle"]);if(t!=null&&_(e,["handle"],t),v(i,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function oU(i){const e={};if(v(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const t=v(i,["computerUse"]);t!=null&&_(e,["computerUse"],t);const n=v(i,["fileSearch"]);n!=null&&_(e,["fileSearch"],n);const s=v(i,["codeExecution"]);if(s!=null&&_(e,["codeExecution"],s),v(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const r=v(i,["functionDeclarations"]);if(r!=null){let d=r;Array.isArray(d)&&(d=d.map(p=>p)),_(e,["functionDeclarations"],d)}const a=v(i,["googleMaps"]);a!=null&&_(e,["googleMaps"],eU(a));const u=v(i,["googleSearch"]);u!=null&&_(e,["googleSearch"],tU(u));const f=v(i,["googleSearchRetrieval"]);f!=null&&_(e,["googleSearchRetrieval"],f);const c=v(i,["urlContext"]);return c!=null&&_(e,["urlContext"],c),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function aU(i){const e=[];for(const t in i)if(Object.prototype.hasOwnProperty.call(i,t)){const n=i[t];if(typeof n=="object"&&n!=null&&Object.keys(n).length>0){const s=Object.keys(n).map(r=>`${t}.${r}`);e.push(...s)}else e.push(t)}return e.join(",")}function lU(i,e){let t=null;const n=i.bidiGenerateContentSetup;if(typeof n=="object"&&n!==null&&"setup"in n){const r=n.setup;typeof r=="object"&&r!==null?(i.bidiGenerateContentSetup=r,t=r):delete i.bidiGenerateContentSetup}else n!==void 0&&delete i.bidiGenerateContentSetup;const s=i.fieldMask;if(t){const r=aU(t);if(Array.isArray(e==null?void 0:e.lockAdditionalFields)&&(e==null?void 0:e.lockAdditionalFields.length)===0)r?i.fieldMask=r:delete i.fieldMask;else if(e!=null&&e.lockAdditionalFields&&e.lockAdditionalFields.length>0&&s!==null&&Array.isArray(s)&&s.length>0){const a=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let u=[];s.length>0&&(u=s.map(c=>a.includes(c)?`generationConfig.${c}`:c));const f=[];r&&f.push(r),u.length>0&&f.push(...u),f.length>0?i.fieldMask=f.join(","):delete i.fieldMask}else delete i.fieldMask}else s!==null&&Array.isArray(s)&&s.length>0?i.fieldMask=s.join(","):delete i.fieldMask;return i}class uU extends Ir{constructor(e){super(),this.apiClient=e}async create(e){var t,n;let s,r="",a={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const u=QN(this.apiClient,e);r=Je("auth_tokens",u._url),a=u._query,delete u.config,delete u._url,delete u._query;const f=lU(u,e.config);return s=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(c=>c.json()),s.then(c=>c)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function cU(i,e){const t={},n=v(i,["force"]);return e!==void 0&&n!=null&&_(e,["_query","force"],n),t}function fU(i){const e={},t=v(i,["name"]);t!=null&&_(e,["_url","name"],t);const n=v(i,["config"]);return n!=null&&cU(n,e),e}function dU(i){const e={},t=v(i,["name"]);return t!=null&&_(e,["_url","name"],t),e}function hU(i,e){const t={},n=v(i,["pageSize"]);e!==void 0&&n!=null&&_(e,["_query","pageSize"],n);const s=v(i,["pageToken"]);return e!==void 0&&s!=null&&_(e,["_query","pageToken"],s),t}function pU(i){const e={},t=v(i,["parent"]);t!=null&&_(e,["_url","parent"],t);const n=v(i,["config"]);return n!=null&&hU(n,e),e}function mU(i){const e={},t=v(i,["sdkHttpResponse"]);t!=null&&_(e,["sdkHttpResponse"],t);const n=v(i,["nextPageToken"]);n!=null&&_(e,["nextPageToken"],n);const s=v(i,["documents"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(a=>a)),_(e,["documents"],r)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class gU extends Ir{constructor(e){super(),this.apiClient=e,this.list=async t=>new oa(br.PAGED_ITEM_DOCUMENTS,n=>this.listInternal({parent:t.parent,config:n.config}),await this.listInternal(t),t)}async get(e){var t,n;let s,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=dU(e);return r=Je("{name}",u._url),a=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),s.then(f=>f)}}async delete(e){var t,n;let s="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=fU(e);s=Je("{name}",a._url),r=a._query,delete a._url,delete a._query,await this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal})}}async listInternal(e){var t,n;let s,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=pU(e);return r=Je("{parent}/documents",u._url),a=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),s.then(f=>{const c=mU(f),d=new XL;return Object.assign(d,c),d})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class vU extends Ir{constructor(e,t=new gU(e)){super(),this.apiClient=e,this.documents=t,this.list=async(n={})=>new oa(br.PAGED_ITEM_FILE_SEARCH_STORES,s=>this.listInternal(s),await this.listInternal(n),n)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var t,n;let s,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=aN(e);return r=Je("fileSearchStores",u._url),a=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),s.then(f=>f)}}async get(e){var t,n;let s,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=cN(e);return r=Je("{name}",u._url),a=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),s.then(f=>f)}}async delete(e){var t,n;let s="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=uN(e);s=Je("{name}",a._url),r=a._query,delete a._url,delete a._query,await this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal})}}async listInternal(e){var t,n;let s,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=gN(e);return r=Je("fileSearchStores",u._url),a=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),s.then(f=>{const c=vN(f),d=new JL;return Object.assign(d,c),d})}}async uploadToFileSearchStoreInternal(e){var t,n;let s,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=yN(e);return r=Je("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",u._url),a=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),s.then(f=>{const c=_N(f),d=new QL;return Object.assign(d,c),d})}}async importFile(e){var t,n;let s,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=hN(e);return r=Je("{file_search_store_name}:importFile",u._url),a=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),s.then(f=>{const c=dN(f),d=new w0;return Object.assign(d,c),d})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let PR=function(){const{crypto:i}=globalThis;if(i!=null&&i.randomUUID)return PR=i.randomUUID.bind(i),i.randomUUID();const e=new Uint8Array(1),t=i?()=>i.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,n=>(+n^t()&15>>+n/4).toString(16))};const yU=()=>PR();/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function _g(i){return typeof i=="object"&&i!==null&&("name"in i&&i.name==="AbortError"||"message"in i&&String(i.message).includes("FetchRequestCanceledException"))}const Eg=i=>{if(i instanceof Error)return i;if(typeof i=="object"&&i!==null){try{if(Object.prototype.toString.call(i)==="[object Error]"){const e=new Error(i.message,i.cause?{cause:i.cause}:{});return i.stack&&(e.stack=i.stack),i.cause&&!e.cause&&(e.cause=i.cause),i.name&&(e.name=i.name),e}}catch{}try{return new Error(JSON.stringify(i))}catch{}}return new Error(i)};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class hs extends Error{}class Ai extends hs{constructor(e,t,n,s){super(`${Ai.makeMessage(e,t,n)}`),this.status=e,this.headers=s,this.error=t}static makeMessage(e,t,n){const s=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,n,s){if(!e||!s)return new $d({message:n,cause:Eg(t)});const r=t;return e===400?new UR(e,r,n,s):e===401?new OR(e,r,n,s):e===403?new FR(e,r,n,s):e===404?new kR(e,r,n,s):e===409?new BR(e,r,n,s):e===422?new GR(e,r,n,s):e===429?new VR(e,r,n,s):e>=500?new HR(e,r,n,s):new Ai(e,r,n,s)}}class Sg extends Ai{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class $d extends Ai{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class NR extends $d{constructor({message:e}={}){super({message:e??"Request timed out."})}}class UR extends Ai{}class OR extends Ai{}class FR extends Ai{}class kR extends Ai{}class BR extends Ai{}class GR extends Ai{}class VR extends Ai{}class HR extends Ai{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const _U=/^[a-z][a-z0-9+.-]*:/i,EU=i=>_U.test(i);let Tg=i=>(Tg=Array.isArray,Tg(i));const SU=Tg;let TU=SU;const UT=TU;function xU(i){if(!i)return!0;for(const e in i)return!1;return!0}function AU(i,e){return Object.prototype.hasOwnProperty.call(i,e)}const RU=(i,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new hs(`${i} must be an integer`);if(e<0)throw new hs(`${i} must be a positive integer`);return e},bU=i=>{try{return JSON.parse(i)}catch{return}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const MU=i=>new Promise(e=>setTimeout(e,i));/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const rl="0.0.1";/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function CU(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const IU=()=>{var i,e,t,n,s;const r=CU();if(r==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":rl,"X-Stainless-OS":FT(Deno.build.os),"X-Stainless-Arch":OT(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(e=(i=Deno.version)===null||i===void 0?void 0:i.deno)!==null&&e!==void 0?e:"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":rl,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(r==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":rl,"X-Stainless-OS":FT((t=globalThis.process.platform)!==null&&t!==void 0?t:"unknown"),"X-Stainless-Arch":OT((n=globalThis.process.arch)!==null&&n!==void 0?n:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":(s=globalThis.process.version)!==null&&s!==void 0?s:"unknown"};const a=LU();return a?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":rl,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${a.browser}`,"X-Stainless-Runtime-Version":a.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":rl,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function LU(){if(typeof navigator>"u"||!navigator)return null;const i=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of i){const n=t.exec(navigator.userAgent);if(n){const s=n[1]||0,r=n[2]||0,a=n[3]||0;return{browser:e,version:`${s}.${r}.${a}`}}}return null}const OT=i=>i==="x32"?"x32":i==="x86_64"||i==="x64"?"x64":i==="arm"?"arm":i==="aarch64"||i==="arm64"?"arm64":i?`other:${i}`:"unknown",FT=i=>(i=i.toLowerCase(),i.includes("ios")?"iOS":i==="android"?"Android":i==="darwin"?"MacOS":i==="win32"?"Windows":i==="freebsd"?"FreeBSD":i==="openbsd"?"OpenBSD":i==="linux"?"Linux":i?`Other:${i}`:"Unknown");let pf;const DU=()=>pf??(pf=IU());/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function wU(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new GeminiNextGenAPIClient({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function zR(...i){const e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...i)}function PU(i){let e=Symbol.asyncIterator in i?i[Symbol.asyncIterator]():i[Symbol.iterator]();return zR({start(){},async pull(t){const{done:n,value:s}=await e.next();n?t.close():t.enqueue(s)},async cancel(){var t;await((t=e.return)===null||t===void 0?void 0:t.call(e))}})}function $R(i){if(i[Symbol.asyncIterator])return i;const e=i.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function NU(i){var e,t;if(i===null||typeof i!="object")return;if(i[Symbol.asyncIterator]){await((t=(e=i[Symbol.asyncIterator]()).return)===null||t===void 0?void 0:t.call(e));return}const n=i.getReader(),s=n.cancel();n.releaseLock(),await s}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const UU=({headers:i,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const qR=()=>{var i;if(typeof File>"u"){const{process:e}=globalThis,t=typeof((i=e==null?void 0:e.versions)===null||i===void 0?void 0:i.node)=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function cm(i,e,t){return qR(),new File(i,e??"unknown_file",t)}function OU(i){return(typeof i=="object"&&i!==null&&("name"in i&&i.name&&String(i.name)||"url"in i&&i.url&&String(i.url)||"filename"in i&&i.filename&&String(i.filename)||"path"in i&&i.path&&String(i.path))||"").split(/[\\/]/).pop()||void 0}const FU=i=>i!=null&&typeof i=="object"&&typeof i[Symbol.asyncIterator]=="function";/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const WR=i=>i!=null&&typeof i=="object"&&typeof i.size=="number"&&typeof i.type=="string"&&typeof i.text=="function"&&typeof i.slice=="function"&&typeof i.arrayBuffer=="function",kU=i=>i!=null&&typeof i=="object"&&typeof i.name=="string"&&typeof i.lastModified=="number"&&WR(i),BU=i=>i!=null&&typeof i=="object"&&typeof i.url=="string"&&typeof i.blob=="function";async function GU(i,e,t){if(qR(),i=await i,kU(i))return i instanceof File?i:cm([await i.arrayBuffer()],i.name);if(BU(i)){const s=await i.blob();return e||(e=new URL(i.url).pathname.split(/[\\/]/).pop()),cm(await xg(s),e,t)}const n=await xg(i);if(e||(e=OU(i)),!(t!=null&&t.type)){const s=n.find(r=>typeof r=="object"&&"type"in r&&r.type);typeof s=="string"&&(t=Object.assign(Object.assign({},t),{type:s}))}return cm(n,e,t)}async function xg(i){var e,t,n,s,r;let a=[];if(typeof i=="string"||ArrayBuffer.isView(i)||i instanceof ArrayBuffer)a.push(i);else if(WR(i))a.push(i instanceof Blob?i:await i.arrayBuffer());else if(FU(i))try{for(var u=!0,f=Cs(i),c;c=await f.next(),e=c.done,!e;u=!0){s=c.value,u=!1;const d=s;a.push(...await xg(d))}}catch(d){t={error:d}}finally{try{!u&&!e&&(n=f.return)&&await n.call(f)}finally{if(t)throw t.error}}else{const d=(r=i==null?void 0:i.constructor)===null||r===void 0?void 0:r.name;throw new Error(`Unexpected data type: ${typeof i}${d?`; constructor: ${d}`:""}${VU(i)}`)}return a}function VU(i){return typeof i!="object"||i===null?"":`; props: [${Object.getOwnPropertyNames(i).map(t=>`"${t}"`).join(", ")}]`}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class KR{constructor(e){this._client=e}}KR._key=[];/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function YR(i){return i.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const kT=Object.freeze(Object.create(null)),HU=(i=YR)=>(function(t,...n){if(t.length===1)return t[0];let s=!1;const r=[],a=t.reduce((d,p,m)=>{var y,E,A;/[?#]/.test(p)&&(s=!0);const S=n[m];let x=(s?encodeURIComponent:i)(""+S);return m!==n.length&&(S==null||typeof S=="object"&&S.toString===((A=Object.getPrototypeOf((E=Object.getPrototypeOf((y=S.hasOwnProperty)!==null&&y!==void 0?y:kT))!==null&&E!==void 0?E:kT))===null||A===void 0?void 0:A.toString))&&(x=S+"",r.push({start:d.length+p.length,length:x.length,error:`Value of type ${Object.prototype.toString.call(S).slice(8,-1)} is not a valid path parameter`})),d+p+(m===n.length?"":x)},""),u=a.split(/[?#]/,1)[0],f=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let c;for(;(c=f.exec(u))!==null;)r.push({start:c.index,length:c[0].length,error:`Value "${c[0]}" can't be safely passed as a path parameter`});if(r.sort((d,p)=>d.start-p.start),r.length>0){let d=0;const p=r.reduce((m,y)=>{const E=" ".repeat(y.start-d),A="^".repeat(y.length);return d=y.start+y.length,m+E+A},"");throw new hs(`Path parameters result in path with invalid segments:
${r.map(m=>m.error).join(`
`)}
${a}
${p}`)}return a}),mf=HU(YR);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class XR extends KR{create(e,t){var n;const{api_version:s=this._client.apiVersion}=e,r=Td(e,["api_version"]);if("model"in r&&"agent_config"in r)throw new hs("Invalid request: specified `model` and `agent_config`. If specifying `model`, use `generation_config`.");if("agent"in r&&"generation_config"in r)throw new hs("Invalid request: specified `agent` and `generation_config`. If specifying `agent`, use `agent_config`.");return this._client.post(mf`/${s}/interactions`,Object.assign(Object.assign({body:r},t),{stream:(n=e.stream)!==null&&n!==void 0?n:!1}))}delete(e,t={},n){const{api_version:s=this._client.apiVersion}=t??{};return this._client.delete(mf`/${s}/interactions/${e}`,n)}cancel(e,t={},n){const{api_version:s=this._client.apiVersion}=t??{};return this._client.post(mf`/${s}/interactions/${e}/cancel`,n)}get(e,t={},n){var s;const r=t??{},{api_version:a=this._client.apiVersion}=r,u=Td(r,["api_version"]);return this._client.get(mf`/${a}/interactions/${e}`,Object.assign(Object.assign({query:u},n),{stream:(s=t==null?void 0:t.stream)!==null&&s!==void 0?s:!1}))}}XR._key=Object.freeze(["interactions"]);class JR extends XR{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function zU(i){let e=0;for(const s of i)e+=s.length;const t=new Uint8Array(e);let n=0;for(const s of i)t.set(s,n),n+=s.length;return t}let gf;function B0(i){let e;return(gf??(e=new globalThis.TextEncoder,gf=e.encode.bind(e)))(i)}let vf;function BT(i){let e;return(vf??(e=new globalThis.TextDecoder,vf=e.decode.bind(e)))(i)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class qd{constructor(){this.buffer=new Uint8Array,this.carriageReturnIndex=null}decode(e){if(e==null)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?B0(e):e;this.buffer=zU([this.buffer,t]);const n=[];let s;for(;(s=$U(this.buffer,this.carriageReturnIndex))!=null;){if(s.carriage&&this.carriageReturnIndex==null){this.carriageReturnIndex=s.index;continue}if(this.carriageReturnIndex!=null&&(s.index!==this.carriageReturnIndex+1||s.carriage)){n.push(BT(this.buffer.subarray(0,this.carriageReturnIndex-1))),this.buffer=this.buffer.subarray(this.carriageReturnIndex),this.carriageReturnIndex=null;continue}const r=this.carriageReturnIndex!==null?s.preceding-1:s.preceding,a=BT(this.buffer.subarray(0,r));n.push(a),this.buffer=this.buffer.subarray(s.index),this.carriageReturnIndex=null}return n}flush(){return this.buffer.length?this.decode(`
`):[]}}qd.NEWLINE_CHARS=new Set([`
`,"\r"]);qd.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function $U(i,e){for(let s=e??0;s<i.length;s++){if(i[s]===10)return{preceding:s,index:s+1,carriage:!1};if(i[s]===13)return{preceding:s,index:s+1,carriage:!0}}return null}function qU(i){for(let n=0;n<i.length-1;n++){if(i[n]===10&&i[n+1]===10||i[n]===13&&i[n+1]===13)return n+2;if(i[n]===13&&i[n+1]===10&&n+3<i.length&&i[n+2]===13&&i[n+3]===10)return n+4}return-1}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const xd={off:0,error:200,warn:300,info:400,debug:500},GT=(i,e,t)=>{if(i){if(AU(xd,i))return i;Si(t).warn(`${e} was set to ${JSON.stringify(i)}, expected one of ${JSON.stringify(Object.keys(xd))}`)}};function Nu(){}function yf(i,e,t){return!e||xd[i]>xd[t]?Nu:e[i].bind(e)}const WU={error:Nu,warn:Nu,info:Nu,debug:Nu};let VT=new WeakMap;function Si(i){var e;const t=i.logger,n=(e=i.logLevel)!==null&&e!==void 0?e:"off";if(!t)return WU;const s=VT.get(t);if(s&&s[0]===n)return s[1];const r={error:yf("error",t,n),warn:yf("warn",t,n),info:yf("info",t,n),debug:yf("debug",t,n)};return VT.set(t,[n,r]),r}const Yo=i=>(i.options&&(i.options=Object.assign({},i.options),delete i.options.headers),i.headers&&(i.headers=Object.fromEntries((i.headers instanceof Headers?[...i.headers]:Object.entries(i.headers)).map(([e,t])=>[e,e.toLowerCase()==="x-goog-api-key"||e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in i&&(i.retryOfRequestLogID&&(i.retryOf=i.retryOfRequestLogID),delete i.retryOfRequestLogID),i);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class cl{constructor(e,t,n){this.iterator=e,this.controller=t,this.client=n}static fromSSEResponse(e,t,n){let s=!1;const r=n?Si(n):console;function a(){return Ms(this,arguments,function*(){var f,c,d,p;if(s)throw new hs("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let m=!1;try{try{for(var y=!0,E=Cs(KU(e,t)),A;A=yield Tt(E.next()),f=A.done,!f;y=!0){p=A.value,y=!1;const S=p;if(!m)if(S.data.startsWith("[DONE]")){m=!0;continue}else try{yield yield Tt(JSON.parse(S.data))}catch(x){throw r.error("Could not parse message into JSON:",S.data),r.error("From chunk:",S.raw),x}}}catch(S){c={error:S}}finally{try{!y&&!f&&(d=E.return)&&(yield Tt(d.call(E)))}finally{if(c)throw c.error}}m=!0}catch(S){if(_g(S))return yield Tt(void 0);throw S}finally{m||t.abort()}})}return new cl(a,t,n)}static fromReadableStream(e,t,n){let s=!1;function r(){return Ms(this,arguments,function*(){var f,c,d,p;const m=new qd,y=$R(e);try{for(var E=!0,A=Cs(y),S;S=yield Tt(A.next()),f=S.done,!f;E=!0){p=S.value,E=!1;const x=p;for(const M of m.decode(x))yield yield Tt(M)}}catch(x){c={error:x}}finally{try{!E&&!f&&(d=A.return)&&(yield Tt(d.call(A)))}finally{if(c)throw c.error}}for(const x of m.flush())yield yield Tt(x)})}function a(){return Ms(this,arguments,function*(){var f,c,d,p;if(s)throw new hs("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let m=!1;try{try{for(var y=!0,E=Cs(r()),A;A=yield Tt(E.next()),f=A.done,!f;y=!0){p=A.value,y=!1;const S=p;m||S&&(yield yield Tt(JSON.parse(S)))}}catch(S){c={error:S}}finally{try{!y&&!f&&(d=E.return)&&(yield Tt(d.call(E)))}finally{if(c)throw c.error}}m=!0}catch(S){if(_g(S))return yield Tt(void 0);throw S}finally{m||t.abort()}})}return new cl(a,t,n)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),s=r=>({next:()=>{if(r.length===0){const a=n.next();e.push(a),t.push(a)}return r.shift()}});return[new cl(()=>s(e),this.controller,this.client),new cl(()=>s(t),this.controller,this.client)]}toReadableStream(){const e=this;let t;return zR({async start(){t=e[Symbol.asyncIterator]()},async pull(n){try{const{value:s,done:r}=await t.next();if(r)return n.close();const a=B0(JSON.stringify(s)+`
`);n.enqueue(a)}catch(s){n.error(s)}},async cancel(){var n;await((n=t.return)===null||n===void 0?void 0:n.call(t))}})}}function KU(i,e){return Ms(this,arguments,function*(){var n,s,r,a;if(!i.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new hs("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new hs("Attempted to iterate over a response with no body");const u=new XU,f=new qd,c=$R(i.body);try{for(var d=!0,p=Cs(YU(c)),m;m=yield Tt(p.next()),n=m.done,!n;d=!0){a=m.value,d=!1;const y=a;for(const E of f.decode(y)){const A=u.decode(E);A&&(yield yield Tt(A))}}}catch(y){s={error:y}}finally{try{!d&&!n&&(r=p.return)&&(yield Tt(r.call(p)))}finally{if(s)throw s.error}}for(const y of f.flush()){const E=u.decode(y);E&&(yield yield Tt(E))}})}function YU(i){return Ms(this,arguments,function*(){var t,n,s,r;let a=new Uint8Array;try{for(var u=!0,f=Cs(i),c;c=yield Tt(f.next()),t=c.done,!t;u=!0){r=c.value,u=!1;const d=r;if(d==null)continue;const p=d instanceof ArrayBuffer?new Uint8Array(d):typeof d=="string"?B0(d):d;let m=new Uint8Array(a.length+p.length);m.set(a),m.set(p,a.length),a=m;let y;for(;(y=qU(a))!==-1;)yield yield Tt(a.slice(0,y)),a=a.slice(y)}}catch(d){n={error:d}}finally{try{!u&&!t&&(s=f.return)&&(yield Tt(s.call(f)))}finally{if(n)throw n.error}}a.length>0&&(yield yield Tt(a))})}class XU{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const r={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],r}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,s]=JU(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}}function JU(i,e){const t=i.indexOf(e);return t!==-1?[i.substring(0,t),e,i.substring(t+e.length)]:[i,"",""]}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function QU(i,e){const{response:t,requestLogID:n,retryOfRequestLogID:s,startTime:r}=e,a=await(async()=>{var u;if(e.options.stream)return Si(i).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller,i):cl.fromSSEResponse(t,e.controller,i);if(t.status===204)return null;if(e.options.__binaryResponse)return t;const f=t.headers.get("content-type"),c=(u=f==null?void 0:f.split(";")[0])===null||u===void 0?void 0:u.trim();return(c==null?void 0:c.includes("application/json"))||(c==null?void 0:c.endsWith("+json"))?await t.json():await t.text()})();return Si(i).debug(`[${n}] response parsed`,Yo({retryOfRequestLogID:s,url:t.url,status:t.status,body:a,durationMs:Date.now()-r})),a}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class G0 extends Promise{constructor(e,t,n=QU){super(s=>{s(null)}),this.responsePromise=t,this.parseResponse=n,this.client=e}_thenUnwrap(e){return new G0(this.client,this.responsePromise,async(t,n)=>e(await this.parseResponse(t,n),n))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(this.client,e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const QR=Symbol("brand.privateNullableHeaders");function*ZU(i){if(!i)return;if(QR in i){const{values:n,nulls:s}=i;yield*n.entries();for(const r of s)yield[r,null];return}let e=!1,t;i instanceof Headers?t=i.entries():UT(i)?t=i:(e=!0,t=Object.entries(i??{}));for(let n of t){const s=n[0];if(typeof s!="string")throw new TypeError("expected header name to be a string");const r=UT(n[1])?n[1]:[n[1]];let a=!1;for(const u of r)u!==void 0&&(e&&!a&&(a=!0,yield[s,null]),yield[s,u])}}const Cu=i=>{const e=new Headers,t=new Set;for(const n of i){const s=new Set;for(const[r,a]of ZU(n)){const u=r.toLowerCase();s.has(u)||(e.delete(r),s.add(u)),a===null?(e.delete(r),t.add(u)):(e.append(r,a),t.delete(u))}}return{[QR]:!0,values:e,nulls:t}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const fm=i=>{var e,t,n,s,r,a;if(typeof globalThis.process<"u")return(n=(t=(e=AL)===null||e===void 0?void 0:e[i])===null||t===void 0?void 0:t.trim())!==null&&n!==void 0?n:void 0;if(typeof globalThis.Deno<"u")return(a=(r=(s=globalThis.Deno.env)===null||s===void 0?void 0:s.get)===null||r===void 0?void 0:r.call(s,i))===null||a===void 0?void 0:a.trim()};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var ZR;class Wd{constructor(e){var t,n,s,r,a,u,f,{baseURL:c=fm("GEMINI_NEXT_GEN_API_BASE_URL"),apiKey:d=(t=fm("GEMINI_API_KEY"))!==null&&t!==void 0?t:null,apiVersion:p="v1beta"}=e,m=Td(e,["baseURL","apiKey","apiVersion"]);const y=Object.assign(Object.assign({apiKey:d,apiVersion:p},m),{baseURL:c||"https://generativelanguage.googleapis.com"});this.baseURL=y.baseURL,this.timeout=(n=y.timeout)!==null&&n!==void 0?n:Wd.DEFAULT_TIMEOUT,this.logger=(s=y.logger)!==null&&s!==void 0?s:console;const E="warn";this.logLevel=E,this.logLevel=(a=(r=GT(y.logLevel,"ClientOptions.logLevel",this))!==null&&r!==void 0?r:GT(fm("GEMINI_NEXT_GEN_API_LOG"),"process.env['GEMINI_NEXT_GEN_API_LOG']",this))!==null&&a!==void 0?a:E,this.fetchOptions=y.fetchOptions,this.maxRetries=(u=y.maxRetries)!==null&&u!==void 0?u:2,this.fetch=(f=y.fetch)!==null&&f!==void 0?f:wU(),this.encoder=UU,this._options=y,this.apiKey=d,this.apiVersion=p,this.clientAdapter=y.clientAdapter}withOptions(e){return new this.constructor(Object.assign(Object.assign(Object.assign({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,apiVersion:this.apiVersion}),e))}baseURLOverridden(){return this.baseURL!=="https://generativelanguage.googleapis.com"}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){if(!(e.has("authorization")||e.has("x-goog-api-key"))&&!(this.apiKey&&e.get("x-goog-api-key"))&&!t.has("x-goog-api-key"))throw new Error('Could not resolve authentication method. Expected the apiKey to be set. Or for the "x-goog-api-key" headers to be explicitly omitted')}async authHeaders(e){const t=Cu([e.headers]);if(!(t.values.has("authorization")||t.values.has("x-goog-api-key"))){if(this.apiKey)return Cu([{"x-goog-api-key":this.apiKey}]);if(this.clientAdapter.isVertexAI())return Cu([await this.clientAdapter.getAuthHeaders()])}}stringifyQuery(e){return Object.entries(e).filter(([t,n])=>typeof n<"u").map(([t,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(t)}=`;throw new hs(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${rl}`}defaultIdempotencyKey(){return`stainless-node-retry-${yU()}`}makeStatusError(e,t,n,s){return Ai.generate(e,t,n,s)}buildURL(e,t,n){const s=!this.baseURLOverridden()&&n||this.baseURL,r=EU(e)?new URL(e):new URL(s+(s.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),a=this.defaultQuery();return xU(a)||(t=Object.assign(Object.assign({},a),t)),typeof t=="object"&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}async prepareOptions(e){if(this.clientAdapter&&this.clientAdapter.isVertexAI()&&!e.path.startsWith(`/${this.apiVersion}/projects/`)){const t=e.path.slice(this.apiVersion.length+1);e.path=`/${this.apiVersion}/projects/${this.clientAdapter.getProject()}/locations/${this.clientAdapter.getLocation()}${t}`}}async prepareRequest(e,{url:t,options:n}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(s=>Object.assign({method:e,path:t},s)))}request(e,t=null){return new G0(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,n){var s,r,a;const u=await e,f=(s=u.maxRetries)!==null&&s!==void 0?s:this.maxRetries;t==null&&(t=f),await this.prepareOptions(u);const{req:c,url:d,timeout:p}=await this.buildRequest(u,{retryCount:f-t});await this.prepareRequest(c,{url:d,options:u});const m="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),y=n===void 0?"":`, retryOf: ${n}`,E=Date.now();if(Si(this).debug(`[${m}] sending request`,Yo({retryOfRequestLogID:n,method:u.method,url:d,options:u,headers:c.headers})),!((r=u.signal)===null||r===void 0)&&r.aborted)throw new Sg;const A=new AbortController,S=await this.fetchWithTimeout(d,c,p,A).catch(Eg),x=Date.now();if(S instanceof globalThis.Error){const b=`retrying, ${t} attempts remaining`;if(!((a=u.signal)===null||a===void 0)&&a.aborted)throw new Sg;const C=_g(S)||/timed? ?out/i.test(String(S)+("cause"in S?String(S.cause):""));if(t)return Si(this).info(`[${m}] connection ${C?"timed out":"failed"} - ${b}`),Si(this).debug(`[${m}] connection ${C?"timed out":"failed"} (${b})`,Yo({retryOfRequestLogID:n,url:d,durationMs:x-E,message:S.message})),this.retryRequest(u,t,n??m);throw Si(this).info(`[${m}] connection ${C?"timed out":"failed"} - error; no more retries left`),Si(this).debug(`[${m}] connection ${C?"timed out":"failed"} (error; no more retries left)`,Yo({retryOfRequestLogID:n,url:d,durationMs:x-E,message:S.message})),C?new NR:new $d({cause:S})}const M=`[${m}${y}] ${c.method} ${d} ${S.ok?"succeeded":"failed"} with status ${S.status} in ${x-E}ms`;if(!S.ok){const b=await this.shouldRetry(S);if(t&&b){const L=`retrying, ${t} attempts remaining`;return await NU(S.body),Si(this).info(`${M} - ${L}`),Si(this).debug(`[${m}] response error (${L})`,Yo({retryOfRequestLogID:n,url:S.url,status:S.status,headers:S.headers,durationMs:x-E})),this.retryRequest(u,t,n??m,S.headers)}const C=b?"error; no more retries left":"error; not retryable";Si(this).info(`${M} - ${C}`);const N=await S.text().catch(L=>Eg(L).message),U=bU(N),w=U?void 0:N;throw Si(this).debug(`[${m}] response error (${C})`,Yo({retryOfRequestLogID:n,url:S.url,status:S.status,headers:S.headers,message:w,durationMs:Date.now()-E})),this.makeStatusError(S.status,U,w,S.headers)}return Si(this).info(M),Si(this).debug(`[${m}] response start`,Yo({retryOfRequestLogID:n,url:S.url,status:S.status,headers:S.headers,durationMs:x-E})),{response:S,options:u,controller:A,requestLogID:m,retryOfRequestLogID:n,startTime:E}}async fetchWithTimeout(e,t,n,s){const r=t||{},{signal:a,method:u}=r,f=Td(r,["signal","method"]);a&&a.addEventListener("abort",()=>s.abort());const c=setTimeout(()=>s.abort(),n),d=globalThis.ReadableStream&&f.body instanceof globalThis.ReadableStream||typeof f.body=="object"&&f.body!==null&&Symbol.asyncIterator in f.body,p=Object.assign(Object.assign(Object.assign({signal:s.signal},d?{duplex:"half"}:{}),{method:"GET"}),f);u&&(p.method=u.toUpperCase());try{return await this.fetch.call(void 0,e,p)}finally{clearTimeout(c)}}async shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n,s){var r;let a;const u=s==null?void 0:s.get("retry-after-ms");if(u){const c=parseFloat(u);Number.isNaN(c)||(a=c)}const f=s==null?void 0:s.get("retry-after");if(f&&!a){const c=parseFloat(f);Number.isNaN(c)?a=Date.parse(f)-Date.now():a=c*1e3}if(!(a&&0<=a&&a<60*1e3)){const c=(r=e.maxRetries)!==null&&r!==void 0?r:this.maxRetries;a=this.calculateDefaultRetryTimeoutMillis(t,c)}return await MU(a),this.makeRequest(e,t-1,n)}calculateDefaultRetryTimeoutMillis(e,t){const r=t-e,a=Math.min(.5*Math.pow(2,r),8),u=1-Math.random()*.25;return a*u*1e3}async buildRequest(e,{retryCount:t=0}={}){var n,s,r;const a=Object.assign({},e),{method:u,path:f,query:c,defaultBaseURL:d}=a,p=this.buildURL(f,c,d);"timeout"in a&&RU("timeout",a.timeout),a.timeout=(n=a.timeout)!==null&&n!==void 0?n:this.timeout;const{bodyHeaders:m,body:y}=this.buildBody({options:a}),E=await this.buildHeaders({options:e,method:u,bodyHeaders:m,retryCount:t});return{req:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({method:u,headers:E},a.signal&&{signal:a.signal}),globalThis.ReadableStream&&y instanceof globalThis.ReadableStream&&{duplex:"half"}),y&&{body:y}),(s=this.fetchOptions)!==null&&s!==void 0?s:{}),(r=a.fetchOptions)!==null&&r!==void 0?r:{}),url:p,timeout:a.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:n,retryCount:s}){let r={};this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),r[this.idempotencyHeader]=e.idempotencyKey);const a=await this.authHeaders(e);let u=Cu([r,Object.assign(Object.assign({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(s)},e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{}),DU()),this._options.defaultHeaders,n,e.headers,a]);return this.validateHeaders(u),u.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};const n=Cu([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&n.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:PU(e)}:this.encoder({body:e,headers:n})}}Wd.DEFAULT_TIMEOUT=6e4;class ni extends Wd{constructor(){super(...arguments),this.interactions=new JR(this)}}ZR=ni;ni.GeminiNextGenAPIClient=ZR;ni.GeminiNextGenAPIClientError=hs;ni.APIError=Ai;ni.APIConnectionError=$d;ni.APIConnectionTimeoutError=NR;ni.APIUserAbortError=Sg;ni.NotFoundError=kR;ni.ConflictError=BR;ni.RateLimitError=VR;ni.BadRequestError=UR;ni.AuthenticationError=OR;ni.InternalServerError=HR;ni.PermissionDeniedError=FR;ni.UnprocessableEntityError=GR;ni.toFile=GU;ni.Interactions=JR;/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function jU(i,e){const t={},n=v(i,["name"]);return n!=null&&_(t,["_url","name"],n),t}function eO(i,e){const t={},n=v(i,["name"]);return n!=null&&_(t,["_url","name"],n),t}function tO(i,e){const t={},n=v(i,["sdkHttpResponse"]);return n!=null&&_(t,["sdkHttpResponse"],n),t}function nO(i,e){const t={},n=v(i,["sdkHttpResponse"]);return n!=null&&_(t,["sdkHttpResponse"],n),t}function iO(i,e,t){const n={};if(v(i,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const s=v(i,["tunedModelDisplayName"]);if(e!==void 0&&s!=null&&_(e,["displayName"],s),v(i,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const r=v(i,["epochCount"]);e!==void 0&&r!=null&&_(e,["tuningTask","hyperparameters","epochCount"],r);const a=v(i,["learningRateMultiplier"]);if(a!=null&&_(n,["tuningTask","hyperparameters","learningRateMultiplier"],a),v(i,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(v(i,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(v(i,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const u=v(i,["batchSize"]);e!==void 0&&u!=null&&_(e,["tuningTask","hyperparameters","batchSize"],u);const f=v(i,["learningRate"]);if(e!==void 0&&f!=null&&_(e,["tuningTask","hyperparameters","learningRate"],f),v(i,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(v(i,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return n}function sO(i,e,t){const n={};let s=v(t,["config","method"]);if(s===void 0&&(s="SUPERVISED_FINE_TUNING"),s==="SUPERVISED_FINE_TUNING"){const y=v(i,["validationDataset"]);e!==void 0&&y!=null&&_(e,["supervisedTuningSpec"],HT(y))}else if(s==="PREFERENCE_TUNING"){const y=v(i,["validationDataset"]);e!==void 0&&y!=null&&_(e,["preferenceOptimizationSpec"],HT(y))}const r=v(i,["tunedModelDisplayName"]);e!==void 0&&r!=null&&_(e,["tunedModelDisplayName"],r);const a=v(i,["description"]);e!==void 0&&a!=null&&_(e,["description"],a);let u=v(t,["config","method"]);if(u===void 0&&(u="SUPERVISED_FINE_TUNING"),u==="SUPERVISED_FINE_TUNING"){const y=v(i,["epochCount"]);e!==void 0&&y!=null&&_(e,["supervisedTuningSpec","hyperParameters","epochCount"],y)}else if(u==="PREFERENCE_TUNING"){const y=v(i,["epochCount"]);e!==void 0&&y!=null&&_(e,["preferenceOptimizationSpec","hyperParameters","epochCount"],y)}let f=v(t,["config","method"]);if(f===void 0&&(f="SUPERVISED_FINE_TUNING"),f==="SUPERVISED_FINE_TUNING"){const y=v(i,["learningRateMultiplier"]);e!==void 0&&y!=null&&_(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],y)}else if(f==="PREFERENCE_TUNING"){const y=v(i,["learningRateMultiplier"]);e!==void 0&&y!=null&&_(e,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],y)}let c=v(t,["config","method"]);if(c===void 0&&(c="SUPERVISED_FINE_TUNING"),c==="SUPERVISED_FINE_TUNING"){const y=v(i,["exportLastCheckpointOnly"]);e!==void 0&&y!=null&&_(e,["supervisedTuningSpec","exportLastCheckpointOnly"],y)}else if(c==="PREFERENCE_TUNING"){const y=v(i,["exportLastCheckpointOnly"]);e!==void 0&&y!=null&&_(e,["preferenceOptimizationSpec","exportLastCheckpointOnly"],y)}let d=v(t,["config","method"]);if(d===void 0&&(d="SUPERVISED_FINE_TUNING"),d==="SUPERVISED_FINE_TUNING"){const y=v(i,["adapterSize"]);e!==void 0&&y!=null&&_(e,["supervisedTuningSpec","hyperParameters","adapterSize"],y)}else if(d==="PREFERENCE_TUNING"){const y=v(i,["adapterSize"]);e!==void 0&&y!=null&&_(e,["preferenceOptimizationSpec","hyperParameters","adapterSize"],y)}if(v(i,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(v(i,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");const p=v(i,["labels"]);e!==void 0&&p!=null&&_(e,["labels"],p);const m=v(i,["beta"]);return e!==void 0&&m!=null&&_(e,["preferenceOptimizationSpec","hyperParameters","beta"],m),n}function rO(i,e){const t={},n=v(i,["baseModel"]);n!=null&&_(t,["baseModel"],n);const s=v(i,["preTunedModel"]);s!=null&&_(t,["preTunedModel"],s);const r=v(i,["trainingDataset"]);r!=null&&gO(r);const a=v(i,["config"]);return a!=null&&iO(a,t),t}function oO(i,e){const t={},n=v(i,["baseModel"]);n!=null&&_(t,["baseModel"],n);const s=v(i,["preTunedModel"]);s!=null&&_(t,["preTunedModel"],s);const r=v(i,["trainingDataset"]);r!=null&&vO(r,t,e);const a=v(i,["config"]);return a!=null&&sO(a,t,e),t}function aO(i,e){const t={},n=v(i,["name"]);return n!=null&&_(t,["_url","name"],n),t}function lO(i,e){const t={},n=v(i,["name"]);return n!=null&&_(t,["_url","name"],n),t}function uO(i,e,t){const n={},s=v(i,["pageSize"]);e!==void 0&&s!=null&&_(e,["_query","pageSize"],s);const r=v(i,["pageToken"]);e!==void 0&&r!=null&&_(e,["_query","pageToken"],r);const a=v(i,["filter"]);return e!==void 0&&a!=null&&_(e,["_query","filter"],a),n}function cO(i,e,t){const n={},s=v(i,["pageSize"]);e!==void 0&&s!=null&&_(e,["_query","pageSize"],s);const r=v(i,["pageToken"]);e!==void 0&&r!=null&&_(e,["_query","pageToken"],r);const a=v(i,["filter"]);return e!==void 0&&a!=null&&_(e,["_query","filter"],a),n}function fO(i,e){const t={},n=v(i,["config"]);return n!=null&&uO(n,t),t}function dO(i,e){const t={},n=v(i,["config"]);return n!=null&&cO(n,t),t}function hO(i,e){const t={},n=v(i,["sdkHttpResponse"]);n!=null&&_(t,["sdkHttpResponse"],n);const s=v(i,["nextPageToken"]);s!=null&&_(t,["nextPageToken"],s);const r=v(i,["tunedModels"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(u=>jR(u))),_(t,["tuningJobs"],a)}return t}function pO(i,e){const t={},n=v(i,["sdkHttpResponse"]);n!=null&&_(t,["sdkHttpResponse"],n);const s=v(i,["nextPageToken"]);s!=null&&_(t,["nextPageToken"],s);const r=v(i,["tuningJobs"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(u=>Ag(u))),_(t,["tuningJobs"],a)}return t}function mO(i,e){const t={},n=v(i,["name"]);n!=null&&_(t,["model"],n);const s=v(i,["name"]);return s!=null&&_(t,["endpoint"],s),t}function gO(i,e){const t={};if(v(i,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(v(i,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const n=v(i,["examples"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(r=>r)),_(t,["examples","examples"],s)}return t}function vO(i,e,t){const n={};let s=v(t,["config","method"]);if(s===void 0&&(s="SUPERVISED_FINE_TUNING"),s==="SUPERVISED_FINE_TUNING"){const a=v(i,["gcsUri"]);e!==void 0&&a!=null&&_(e,["supervisedTuningSpec","trainingDatasetUri"],a)}else if(s==="PREFERENCE_TUNING"){const a=v(i,["gcsUri"]);e!==void 0&&a!=null&&_(e,["preferenceOptimizationSpec","trainingDatasetUri"],a)}let r=v(t,["config","method"]);if(r===void 0&&(r="SUPERVISED_FINE_TUNING"),r==="SUPERVISED_FINE_TUNING"){const a=v(i,["vertexDatasetResource"]);e!==void 0&&a!=null&&_(e,["supervisedTuningSpec","trainingDatasetUri"],a)}else if(r==="PREFERENCE_TUNING"){const a=v(i,["vertexDatasetResource"]);e!==void 0&&a!=null&&_(e,["preferenceOptimizationSpec","trainingDatasetUri"],a)}if(v(i,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return n}function jR(i,e){const t={},n=v(i,["sdkHttpResponse"]);n!=null&&_(t,["sdkHttpResponse"],n);const s=v(i,["name"]);s!=null&&_(t,["name"],s);const r=v(i,["state"]);r!=null&&_(t,["state"],mR(r));const a=v(i,["createTime"]);a!=null&&_(t,["createTime"],a);const u=v(i,["tuningTask","startTime"]);u!=null&&_(t,["startTime"],u);const f=v(i,["tuningTask","completeTime"]);f!=null&&_(t,["endTime"],f);const c=v(i,["updateTime"]);c!=null&&_(t,["updateTime"],c);const d=v(i,["description"]);d!=null&&_(t,["description"],d);const p=v(i,["baseModel"]);p!=null&&_(t,["baseModel"],p);const m=v(i,["_self"]);return m!=null&&_(t,["tunedModel"],mO(m)),t}function Ag(i,e){const t={},n=v(i,["sdkHttpResponse"]);n!=null&&_(t,["sdkHttpResponse"],n);const s=v(i,["name"]);s!=null&&_(t,["name"],s);const r=v(i,["state"]);r!=null&&_(t,["state"],mR(r));const a=v(i,["createTime"]);a!=null&&_(t,["createTime"],a);const u=v(i,["startTime"]);u!=null&&_(t,["startTime"],u);const f=v(i,["endTime"]);f!=null&&_(t,["endTime"],f);const c=v(i,["updateTime"]);c!=null&&_(t,["updateTime"],c);const d=v(i,["error"]);d!=null&&_(t,["error"],d);const p=v(i,["description"]);p!=null&&_(t,["description"],p);const m=v(i,["baseModel"]);m!=null&&_(t,["baseModel"],m);const y=v(i,["tunedModel"]);y!=null&&_(t,["tunedModel"],y);const E=v(i,["preTunedModel"]);E!=null&&_(t,["preTunedModel"],E);const A=v(i,["supervisedTuningSpec"]);A!=null&&_(t,["supervisedTuningSpec"],A);const S=v(i,["preferenceOptimizationSpec"]);S!=null&&_(t,["preferenceOptimizationSpec"],S);const x=v(i,["tuningDataStats"]);x!=null&&_(t,["tuningDataStats"],x);const M=v(i,["encryptionSpec"]);M!=null&&_(t,["encryptionSpec"],M);const b=v(i,["partnerModelTuningSpec"]);b!=null&&_(t,["partnerModelTuningSpec"],b);const C=v(i,["customBaseModel"]);C!=null&&_(t,["customBaseModel"],C);const N=v(i,["experiment"]);N!=null&&_(t,["experiment"],N);const U=v(i,["labels"]);U!=null&&_(t,["labels"],U);const w=v(i,["outputUri"]);w!=null&&_(t,["outputUri"],w);const O=v(i,["pipelineJob"]);O!=null&&_(t,["pipelineJob"],O);const L=v(i,["serviceAccount"]);L!=null&&_(t,["serviceAccount"],L);const I=v(i,["tunedModelDisplayName"]);I!=null&&_(t,["tunedModelDisplayName"],I);const F=v(i,["veoTuningSpec"]);return F!=null&&_(t,["veoTuningSpec"],F),t}function yO(i,e){const t={},n=v(i,["sdkHttpResponse"]);n!=null&&_(t,["sdkHttpResponse"],n);const s=v(i,["name"]);s!=null&&_(t,["name"],s);const r=v(i,["metadata"]);r!=null&&_(t,["metadata"],r);const a=v(i,["done"]);a!=null&&_(t,["done"],a);const u=v(i,["error"]);return u!=null&&_(t,["error"],u),t}function HT(i,e){const t={},n=v(i,["gcsUri"]);n!=null&&_(t,["validationDatasetUri"],n);const s=v(i,["vertexDatasetResource"]);return s!=null&&_(t,["validationDatasetUri"],s),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class _O extends Ir{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new oa(br.PAGED_ITEM_TUNING_JOBS,n=>this.listInternal(n),await this.listInternal(t),t),this.get=async t=>await this.getInternal(t),this.tune=async t=>{var n;if(this.apiClient.isVertexAI())if(t.baseModel.startsWith("projects/")){const s={tunedModelName:t.baseModel};!((n=t.config)===null||n===void 0)&&n.preTunedModelCheckpointId&&(s.checkpointId=t.config.preTunedModelCheckpointId);const r=Object.assign(Object.assign({},t),{preTunedModel:s});return r.baseModel=void 0,await this.tuneInternal(r)}else{const s=Object.assign({},t);return await this.tuneInternal(s)}else{const s=Object.assign({},t),r=await this.tuneMldevInternal(s);let a="";return r.metadata!==void 0&&r.metadata.tunedModel!==void 0?a=r.metadata.tunedModel:r.name!==void 0&&r.name.includes("/operations/")&&(a=r.name.split("/operations/")[0]),{name:a,state:dg.JOB_STATE_QUEUED}}}}async getInternal(e){var t,n,s,r;let a,u="",f={};if(this.apiClient.isVertexAI()){const c=lO(e);return u=Je("{name}",c._url),f=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:d.headers},m})),a.then(d=>Ag(d))}else{const c=aO(e);return u=Je("{name}",c._url),f=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:d.headers},m})),a.then(d=>jR(d))}}async listInternal(e){var t,n,s,r;let a,u="",f={};if(this.apiClient.isVertexAI()){const c=dO(e);return u=Je("tuningJobs",c._url),f=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:d.headers},m})),a.then(d=>{const p=pO(d),m=new pT;return Object.assign(m,p),m})}else{const c=fO(e);return u=Je("tunedModels",c._url),f=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:d.headers},m})),a.then(d=>{const p=hO(d),m=new pT;return Object.assign(m,p),m})}}async cancel(e){var t,n,s,r;let a,u="",f={};if(this.apiClient.isVertexAI()){const c=eO(e);return u=Je("{name}:cancel",c._url),f=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:d.headers},m})),a.then(d=>{const p=nO(d),m=new mT;return Object.assign(m,p),m})}else{const c=jU(e);return u=Je("{name}:cancel",c._url),f=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:d.headers},m})),a.then(d=>{const p=tO(d),m=new mT;return Object.assign(m,p),m})}}async tuneInternal(e){var t,n;let s,r="",a={};if(this.apiClient.isVertexAI()){const u=oO(e,e);return r=Je("tuningJobs",u._url),a=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json().then(c=>{const d=c;return d.sdkHttpResponse={headers:f.headers},d})),s.then(f=>Ag(f))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,n;let s,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=rO(e);return r=Je("tunedModels",u._url),a=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json().then(c=>{const d=c;return d.sdkHttpResponse={headers:f.headers},d})),s.then(f=>yO(f))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class EO{async download(e,t){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const SO=1024*1024*8,TO=3,xO=1e3,AO=2,Ad="x-goog-upload-status";async function RO(i,e,t){var n;const s=await eb(i,e,t),r=await(s==null?void 0:s.json());if(((n=s==null?void 0:s.headers)===null||n===void 0?void 0:n[Ad])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return r.file}async function bO(i,e,t){var n;const s=await eb(i,e,t),r=await(s==null?void 0:s.json());if(((n=s==null?void 0:s.headers)===null||n===void 0?void 0:n[Ad])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");const a=uR(r),u=new P0;return Object.assign(u,a),u}async function eb(i,e,t){var n,s;let r=0,a=0,u=new hg(new Response),f="upload";for(r=i.size;a<r;){const c=Math.min(SO,r-a),d=i.slice(a,a+c);a+c>=r&&(f+=", finalize");let p=0,m=xO;for(;p<TO&&(u=await t.request({path:"",body:d,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":f,"X-Goog-Upload-Offset":String(a),"Content-Length":String(c)}}}),!(!((n=u==null?void 0:u.headers)===null||n===void 0)&&n[Ad]));)p++,await CO(m),m=m*AO;if(a+=c,((s=u==null?void 0:u.headers)===null||s===void 0?void 0:s[Ad])!=="active")break;if(r<=a)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return u}async function MO(i){return{size:i.size,type:i.type}}function CO(i){return new Promise(e=>setTimeout(e,i))}class IO{async upload(e,t,n){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await RO(e,t,n)}async uploadToFileSearchStore(e,t,n){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await bO(e,t,n)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await MO(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class LO{create(e,t,n){return new DO(e,t,n)}}class DO{constructor(e,t,n){this.url=e,this.headers=t,this.callbacks=n}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const zT="x-goog-api-key";class wO{constructor(e){this.apiKey=e}async addAuthHeaders(e,t){if(e.get(zT)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(zT,this.apiKey)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const PO="gl-node/";class NO{get interactions(){if(this._interactions!==void 0)return this._interactions;console.warn("GoogleGenAI.interactions: Interactions usage is experimental and may change in future versions.");const e=this.httpOptions;e!=null&&e.extraBody&&console.warn("GoogleGenAI.interactions: Client level httpOptions.extraBody is not supported by the interactions client and will be ignored.");const t=new ni({baseURL:this.apiClient.getBaseUrl(),apiKey:this.apiKey,apiVersion:this.apiClient.getApiVersion(),clientAdapter:this.apiClient,defaultHeaders:this.apiClient.getDefaultHeaders(),timeout:e==null?void 0:e.timeout});return this._interactions=t.interactions,this._interactions}constructor(e){var t;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(t=e.vertexai)!==null&&t!==void 0?t:!1,this.apiKey=e.apiKey;const n=CL(e.httpOptions,e.vertexai,void 0,void 0);n&&(e.httpOptions?e.httpOptions.baseUrl=n:e.httpOptions={baseUrl:n}),this.apiVersion=e.apiVersion,this.httpOptions=e.httpOptions;const s=new wO(this.apiKey);this.apiClient=new MN({auth:s,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:PO+"web",uploader:new IO,downloader:new EO}),this.models=new WN(this.apiClient),this.live=new GN(this.apiClient,s,new LO),this.batches=new iw(this.apiClient),this.chats=new kw(this.models,this.apiClient),this.caches=new Uw(this.apiClient),this.files=new Yw(this.apiClient),this.operations=new KN(this.apiClient),this.authTokens=new uU(this.apiClient),this.tunings=new _O(this.apiClient),this.fileSearchStores=new vU(this.apiClient)}}const UO=()=>new NO({apiKey:""}),OO=async(i,e)=>{const t=UO(),n=`
    Analyze the word "${i}" in the context of the sentence: "${e}".
    Provide a translation, phonetic pronunciation, word type (verb, noun, etc.), and a short usage example.
    Output JSON.
  `;try{const s=await t.models.generateContent({model:"gemini-2.5-flash",contents:n,config:{responseMimeType:"application/json",responseSchema:{type:ji.OBJECT,properties:{translation:{type:ji.STRING},pronunciation:{type:ji.STRING},type:{type:ji.STRING},contextUsage:{type:ji.STRING}},required:["translation","pronunciation","type"]}}});if(s.text){const r=JSON.parse(s.text);return{word:i,translation:r.translation,pronunciation:r.pronunciation,type:r.type,contextUsage:r.contextUsage}}throw new Error("No data returned")}catch(s){return console.error("Gemini Translation Error:",s),{word:i,translation:"Error",pronunciation:"...",type:"Unknown",contextUsage:"Could not fetch definition."}}},FO=i=>{const e=[];return i.trim().split(/\n\s*\n/).forEach((n,s)=>{const r=n.split(`
`);if(r.length<3)return;let a=1;r[0].match(/\d+/)?r[1].indexOf("-->")===-1&&(a=1):a=0;const u=r[a];if(!u||u.indexOf("-->")===-1)return;const[f,c]=u.split("-->").map(A=>A.trim()),d=$T(f),p=$T(c),y=r.slice(a+1).join(" ").replace(/<[^>]*>/g,""),E=y.split(/\s+/);e.push({id:`cue-${s}`,startTime:d,endTime:p,text:y,parsedWords:E})}),e},$T=i=>{const e=i.split(":"),t=e[2].split(","),n=parseInt(e[0],10),s=parseInt(e[1],10),r=parseInt(t[0],10),a=parseInt(t[1],10);return n*3600+s*60+r+a/1e3};var tn=(i=>(i.NONE="NONE",i.MAGIC_WINDOW="MAGIC_WINDOW",i.STEREO="STEREO",i))(tn||{}),Hu=(i=>(i.CINEMA="CINEMA",i.IMAX="IMAX",i))(Hu||{}),Kn=(i=>(i.MONO_2D="MONO_2D",i.STEREO_SBS="STEREO_SBS",i.STEREO_TB="STEREO_TB",i.VR180_SBS="VR180_SBS",i.VR180_TB="VR180_TB",i.VR180_MONO="VR180_MONO",i.VR360_SBS="VR360_SBS",i.VR360_TB="VR360_TB",i.VR360_MONO="VR360_MONO",i))(Kn||{});const Ye=Number.isFinite||function(i){return typeof i=="number"&&isFinite(i)},kO=Number.isSafeInteger||function(i){return typeof i=="number"&&Math.abs(i)<=BO},BO=Number.MAX_SAFE_INTEGER||9007199254740991;let lt=(function(i){return i.NETWORK_ERROR="networkError",i.MEDIA_ERROR="mediaError",i.KEY_SYSTEM_ERROR="keySystemError",i.MUX_ERROR="muxError",i.OTHER_ERROR="otherError",i})({}),ce=(function(i){return i.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",i.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",i.KEY_SYSTEM_NO_SESSION="keySystemNoSession",i.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",i.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",i.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",i.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",i.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",i.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",i.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",i.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",i.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",i.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",i.MANIFEST_LOAD_ERROR="manifestLoadError",i.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",i.MANIFEST_PARSING_ERROR="manifestParsingError",i.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",i.LEVEL_EMPTY_ERROR="levelEmptyError",i.LEVEL_LOAD_ERROR="levelLoadError",i.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",i.LEVEL_PARSING_ERROR="levelParsingError",i.LEVEL_SWITCH_ERROR="levelSwitchError",i.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",i.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",i.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",i.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",i.FRAG_LOAD_ERROR="fragLoadError",i.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",i.FRAG_DECRYPT_ERROR="fragDecryptError",i.FRAG_PARSING_ERROR="fragParsingError",i.FRAG_GAP="fragGap",i.REMUX_ALLOC_ERROR="remuxAllocError",i.KEY_LOAD_ERROR="keyLoadError",i.KEY_LOAD_TIMEOUT="keyLoadTimeOut",i.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",i.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",i.BUFFER_APPEND_ERROR="bufferAppendError",i.BUFFER_APPENDING_ERROR="bufferAppendingError",i.BUFFER_STALLED_ERROR="bufferStalledError",i.BUFFER_FULL_ERROR="bufferFullError",i.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",i.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",i.ASSET_LIST_LOAD_ERROR="assetListLoadError",i.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",i.ASSET_LIST_PARSING_ERROR="assetListParsingError",i.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",i.INTERNAL_EXCEPTION="internalException",i.INTERNAL_ABORTED="aborted",i.ATTACH_MEDIA_ERROR="attachMediaError",i.UNKNOWN="unknown",i})({}),P=(function(i){return i.MEDIA_ATTACHING="hlsMediaAttaching",i.MEDIA_ATTACHED="hlsMediaAttached",i.MEDIA_DETACHING="hlsMediaDetaching",i.MEDIA_DETACHED="hlsMediaDetached",i.MEDIA_ENDED="hlsMediaEnded",i.STALL_RESOLVED="hlsStallResolved",i.BUFFER_RESET="hlsBufferReset",i.BUFFER_CODECS="hlsBufferCodecs",i.BUFFER_CREATED="hlsBufferCreated",i.BUFFER_APPENDING="hlsBufferAppending",i.BUFFER_APPENDED="hlsBufferAppended",i.BUFFER_EOS="hlsBufferEos",i.BUFFERED_TO_END="hlsBufferedToEnd",i.BUFFER_FLUSHING="hlsBufferFlushing",i.BUFFER_FLUSHED="hlsBufferFlushed",i.MANIFEST_LOADING="hlsManifestLoading",i.MANIFEST_LOADED="hlsManifestLoaded",i.MANIFEST_PARSED="hlsManifestParsed",i.LEVEL_SWITCHING="hlsLevelSwitching",i.LEVEL_SWITCHED="hlsLevelSwitched",i.LEVEL_LOADING="hlsLevelLoading",i.LEVEL_LOADED="hlsLevelLoaded",i.LEVEL_UPDATED="hlsLevelUpdated",i.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",i.LEVELS_UPDATED="hlsLevelsUpdated",i.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",i.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",i.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",i.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",i.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",i.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",i.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",i.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",i.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",i.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",i.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",i.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",i.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",i.CUES_PARSED="hlsCuesParsed",i.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",i.INIT_PTS_FOUND="hlsInitPtsFound",i.FRAG_LOADING="hlsFragLoading",i.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",i.FRAG_LOADED="hlsFragLoaded",i.FRAG_DECRYPTED="hlsFragDecrypted",i.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",i.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",i.FRAG_PARSING_METADATA="hlsFragParsingMetadata",i.FRAG_PARSED="hlsFragParsed",i.FRAG_BUFFERED="hlsFragBuffered",i.FRAG_CHANGED="hlsFragChanged",i.FPS_DROP="hlsFpsDrop",i.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",i.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",i.ERROR="hlsError",i.DESTROYING="hlsDestroying",i.KEY_LOADING="hlsKeyLoading",i.KEY_LOADED="hlsKeyLoaded",i.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",i.BACK_BUFFER_REACHED="hlsBackBufferReached",i.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",i.ASSET_LIST_LOADING="hlsAssetListLoading",i.ASSET_LIST_LOADED="hlsAssetListLoaded",i.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",i.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",i.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",i.INTERSTITIAL_STARTED="hlsInterstitialStarted",i.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",i.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",i.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",i.INTERSTITIAL_ENDED="hlsInterstitialEnded",i.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",i.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",i.EVENT_CUE_ENTER="hlsEventCueEnter",i})({});var Nt={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},et={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class Ga{constructor(e,t=0,n=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=n}sample(e,t){const n=Math.pow(this.alpha_,e);this.estimate_=t*(1-n)+n*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class GO{constructor(e,t,n,s=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Ga(e),this.fast_=new Ga(t),this.defaultTTFB_=s,this.ttfb_=new Ga(e)}update(e,t){const{slow_:n,fast_:s,ttfb_:r}=this;n.halfLife!==e&&(this.slow_=new Ga(e,n.getEstimate(),n.getTotalWeight())),s.halfLife!==t&&(this.fast_=new Ga(t,s.getEstimate(),s.getTotalWeight())),r.halfLife!==e&&(this.ttfb_=new Ga(e,r.getEstimate(),r.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const n=8*t,s=e/1e3,r=n/s;this.fast_.sample(s,r),this.slow_.sample(s,r)}sampleTTFB(e){const t=e/1e3,n=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(n,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function VO(i,e,t){return(e=zO(e))in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function pn(){return pn=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i},pn.apply(null,arguments)}function qT(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(i,s).enumerable})),t.push.apply(t,n)}return t}function on(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?qT(Object(t),!0).forEach(function(n){VO(i,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):qT(Object(t)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(t,n))})}return i}function HO(i,e){if(typeof i!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var n=t.call(i,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function zO(i){var e=HO(i,"string");return typeof e=="symbol"?e:e+""}class ms{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const n=`[${e}]:`;this.trace=uo,this.debug=t.debug.bind(null,n),this.log=t.log.bind(null,n),this.warn=t.warn.bind(null,n),this.info=t.info.bind(null,n),this.error=t.error.bind(null,n)}}const uo=function(){},$O={trace:uo,debug:uo,log:uo,warn:uo,info:uo,error:uo};function Rg(){return pn({},$O)}function qO(i,e){const t=self.console[i];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${i}] >`):uo}function WT(i,e,t){return e[i]?e[i].bind(e):qO(i,t)}const bg=Rg();function WO(i,e,t){const n=Rg();if(typeof console=="object"&&i===!0||typeof i=="object"){const s=["debug","log","info","warn","error"];s.forEach(r=>{n[r]=WT(r,i,t)});try{n.log(`Debug logs enabled for "${e}" in hls.js version 1.6.15`)}catch{return Rg()}s.forEach(r=>{bg[r]=WT(r,i)})}else pn(bg,n);return n}const an=bg;function go(i=!0){return typeof self>"u"?void 0:(i||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function KO(i){return typeof self<"u"&&i===self.ManagedMediaSource}function tb(i,e){const t=Object.keys(i),n=Object.keys(e),s=t.length,r=n.length;return!s||!r||s===r&&!t.some(a=>n.indexOf(a)===-1)}function es(i,e=!1){if(typeof TextDecoder<"u"){const c=new TextDecoder("utf-8").decode(i);if(e){const d=c.indexOf("\0");return d!==-1?c.substring(0,d):c}return c.replace(/\0/g,"")}const t=i.length;let n,s,r,a="",u=0;for(;u<t;){if(n=i[u++],n===0&&e)return a;if(n===0||n===3)continue;switch(n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(n);break;case 12:case 13:s=i[u++],a+=String.fromCharCode((n&31)<<6|s&63);break;case 14:s=i[u++],r=i[u++],a+=String.fromCharCode((n&15)<<12|(s&63)<<6|(r&63)<<0);break}}return a}function ui(i){let e="";for(let t=0;t<i.length;t++){let n=i[t].toString(16);n.length<2&&(n="0"+n),e+=n}return e}function nb(i){return Uint8Array.from(i.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function YO(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var dm={exports:{}},KT;function XO(){return KT||(KT=1,(function(i,e){(function(t){var n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,s=/^(?=([^\/?#]*))\1([^]*)$/,r=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,u={buildAbsoluteURL:function(f,c,d){if(d=d||{},f=f.trim(),c=c.trim(),!c){if(!d.alwaysNormalize)return f;var p=u.parseURL(f);if(!p)throw new Error("Error trying to parse base URL.");return p.path=u.normalizePath(p.path),u.buildURLFromParts(p)}var m=u.parseURL(c);if(!m)throw new Error("Error trying to parse relative URL.");if(m.scheme)return d.alwaysNormalize?(m.path=u.normalizePath(m.path),u.buildURLFromParts(m)):c;var y=u.parseURL(f);if(!y)throw new Error("Error trying to parse base URL.");if(!y.netLoc&&y.path&&y.path[0]!=="/"){var E=s.exec(y.path);y.netLoc=E[1],y.path=E[2]}y.netLoc&&!y.path&&(y.path="/");var A={scheme:y.scheme,netLoc:m.netLoc,path:null,params:m.params,query:m.query,fragment:m.fragment};if(!m.netLoc&&(A.netLoc=y.netLoc,m.path[0]!=="/"))if(!m.path)A.path=y.path,m.params||(A.params=y.params,m.query||(A.query=y.query));else{var S=y.path,x=S.substring(0,S.lastIndexOf("/")+1)+m.path;A.path=u.normalizePath(x)}return A.path===null&&(A.path=d.alwaysNormalize?u.normalizePath(m.path):m.path),u.buildURLFromParts(A)},parseURL:function(f){var c=n.exec(f);return c?{scheme:c[1]||"",netLoc:c[2]||"",path:c[3]||"",params:c[4]||"",query:c[5]||"",fragment:c[6]||""}:null},normalizePath:function(f){for(f=f.split("").reverse().join("").replace(r,"");f.length!==(f=f.replace(a,"")).length;);return f.split("").reverse().join("")},buildURLFromParts:function(f){return f.scheme+f.netLoc+f.path+f.params+f.query+f.fragment}};i.exports=u})()})(dm)),dm.exports}var V0=XO();class H0{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var vn={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class ib{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,QO(this,"stats")}setByteRange(e,t){const n=e.split("@",2);let s;n.length===1?s=(t==null?void 0:t.byteRangeEndOffset)||0:s=parseInt(n[1]),this._byteRange=[s,parseInt(n[0])+s]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[vn.AUDIO]:null,[vn.VIDEO]:null,[vn.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new H0),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=V0.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[vn.AUDIO]=null,e[vn.VIDEO]=null,e[vn.AUDIOVIDEO]=null}}function Nn(i){return i.sn!=="initSegment"}class hm extends ib{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(Ye(e)&&Ye(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const n=Object.keys(t);if(n.length===1){const s=this._decryptdata=t[n[0]]||null;s&&(this._decryptdata=s.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=Ye(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const n=Object.keys(this.levelkeys),s=n.length;if(s>1||s===1&&(t=this.levelkeys[n[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!Ye(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return Nn(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var n;const s=t[e];s&&!((n=this._decryptdata)!=null&&n.keyId)&&(this._decryptdata=s.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,n,s,r,a=!1){const{elementaryStreams:u}=this,f=u[e];if(!f){u[e]={startPTS:t,endPTS:n,startDTS:s,endDTS:r,partial:a};return}f.startPTS=Math.min(f.startPTS,t),f.endPTS=Math.max(f.endPTS,n),f.startDTS=Math.min(f.startDTS,s),f.endDTS=Math.max(f.endDTS,r)}}class JO extends ib{constructor(e,t,n,s,r){super(n),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=s;const a=e.enumeratedString("BYTERANGE");a&&this.setByteRange(a,r),r&&(this.fragOffset=r.fragOffset+r.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function sb(i,e){const t=Object.getPrototypeOf(i);if(t){const n=Object.getOwnPropertyDescriptor(t,e);return n||sb(t,e)}}function QO(i,e){const t=sb(i,e);t&&(t.enumerable=!0,Object.defineProperty(i,e,t))}const YT=Math.pow(2,32)-1,ZO=[].push,rb={video:1,audio:2,id3:3,text:4};function Yn(i){return String.fromCharCode.apply(null,i)}function ob(i,e){const t=i[e]<<8|i[e+1];return t<0?65536+t:t}function Et(i,e){const t=ab(i,e);return t<0?4294967296+t:t}function XT(i,e){let t=Et(i,e);return t*=Math.pow(2,32),t+=Et(i,e+4),t}function ab(i,e){return i[e]<<24|i[e+1]<<16|i[e+2]<<8|i[e+3]}function jO(i){const e=i.byteLength;for(let t=0;t<e;){const n=Et(i,t);if(n>8&&i[t+4]===109&&i[t+5]===111&&i[t+6]===111&&i[t+7]===102)return!0;t=n>1?t+n:e}return!1}function Pt(i,e){const t=[];if(!e.length)return t;const n=i.byteLength;for(let s=0;s<n;){const r=Et(i,s),a=Yn(i.subarray(s+4,s+8)),u=r>1?s+r:n;if(a===e[0])if(e.length===1)t.push(i.subarray(s+8,u));else{const f=Pt(i.subarray(s+8,u),e.slice(1));f.length&&ZO.apply(t,f)}s=u}return t}function eF(i){const e=[],t=i[0];let n=8;const s=Et(i,n);n+=4;let r=0,a=0;t===0?(r=Et(i,n),a=Et(i,n+4),n+=8):(r=XT(i,n),a=XT(i,n+8),n+=16),n+=2;let u=i.length+a;const f=ob(i,n);n+=2;for(let c=0;c<f;c++){let d=n;const p=Et(i,d);d+=4;const m=p&2147483647;if((p&2147483648)>>>31===1)return an.warn("SIDX has hierarchical references (not supported)"),null;const E=Et(i,d);d+=4,e.push({referenceSize:m,subsegmentDuration:E,info:{duration:E/s,start:u,end:u+m-1}}),u+=m,d+=4,n=d}return{earliestPresentationTime:r,timescale:s,version:t,referencesCount:f,references:e}}function lb(i){const e=[],t=Pt(i,["moov","trak"]);for(let s=0;s<t.length;s++){const r=t[s],a=Pt(r,["tkhd"])[0];if(a){let u=a[0];const f=Et(a,u===0?12:20),c=Pt(r,["mdia","mdhd"])[0];if(c){u=c[0];const d=Et(c,u===0?12:20),p=Pt(r,["mdia","hdlr"])[0];if(p){const m=Yn(p.subarray(8,12)),y={soun:vn.AUDIO,vide:vn.VIDEO}[m],E=Pt(r,["mdia","minf","stbl","stsd"])[0],A=tF(E);y?(e[f]={timescale:d,type:y,stsd:A},e[y]=on({timescale:d,id:f},A)):e[f]={timescale:d,type:m,stsd:A}}}}}return Pt(i,["moov","mvex","trex"]).forEach(s=>{const r=Et(s,4),a=e[r];a&&(a.default={duration:Et(s,12),flags:Et(s,20)})}),e}function tF(i){const e=i.subarray(8),t=e.subarray(86),n=Yn(e.subarray(4,8));let s=n,r;const a=n==="enca"||n==="encv";if(a){const c=Pt(e,[n])[0].subarray(n==="enca"?28:78);Pt(c,["sinf"]).forEach(p=>{const m=Pt(p,["schm"])[0];if(m){const y=Yn(m.subarray(4,8));if(y==="cbcs"||y==="cenc"){const E=Pt(p,["frma"])[0];E&&(s=Yn(E))}}})}const u=s;switch(s){case"avc1":case"avc2":case"avc3":case"avc4":{const f=Pt(t,["avcC"])[0];f&&f.length>3&&(s+="."+Ef(f[1])+Ef(f[2])+Ef(f[3]),r=_f(u==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const f=Pt(e,[n])[0],c=Pt(f.subarray(28),["esds"])[0];if(c&&c.length>7){let d=4;if(c[d++]!==3)break;d=pm(c,d),d+=2;const p=c[d++];if(p&128&&(d+=2),p&64&&(d+=c[d++]),c[d++]!==4)break;d=pm(c,d);const m=c[d++];if(m===64)s+="."+Ef(m);else break;if(d+=12,c[d++]!==5)break;d=pm(c,d);const y=c[d++];let E=(y&248)>>3;E===31&&(E+=1+((y&7)<<3)+((c[d]&224)>>5)),s+="."+E}break}case"hvc1":case"hev1":{const f=Pt(t,["hvcC"])[0];if(f&&f.length>12){const c=f[1],d=["","A","B","C"][c>>6],p=c&31,m=Et(f,2),y=(c&32)>>5?"H":"L",E=f[12],A=f.subarray(6,12);s+="."+d+p,s+="."+nF(m).toString(16).toUpperCase(),s+="."+y+E;let S="";for(let x=A.length;x--;){const M=A[x];(M||S)&&(S="."+M.toString(16).toUpperCase()+S)}s+=S}r=_f(u=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{s=_f(s,t)||s;break}case"vp09":{const f=Pt(t,["vpcC"])[0];if(f&&f.length>6){const c=f[4],d=f[5],p=f[6]>>4&15;s+="."+Fs(c)+"."+Fs(d)+"."+Fs(p)}break}case"av01":{const f=Pt(t,["av1C"])[0];if(f&&f.length>2){const c=f[1]>>>5,d=f[1]&31,p=f[2]>>>7?"H":"M",m=(f[2]&64)>>6,y=(f[2]&32)>>5,E=c===2&&m?y?12:10:m?10:8,A=(f[2]&16)>>4,S=(f[2]&8)>>3,x=(f[2]&4)>>2,M=f[2]&3;s+="."+c+"."+Fs(d)+p+"."+Fs(E)+"."+A+"."+S+x+M+"."+Fs(1)+"."+Fs(1)+"."+Fs(1)+"."+0,r=_f("dav1",t)}break}}return{codec:s,encrypted:a,supplemental:r}}function _f(i,e){const t=Pt(e,["dvvC"]),n=t.length?t[0]:Pt(e,["dvcC"])[0];if(n){const s=n[2]>>1&127,r=n[2]<<5&32|n[3]>>3&31;return i+"."+Fs(s)+"."+Fs(r)}}function nF(i){let e=0;for(let t=0;t<32;t++)e|=(i>>t&1)<<31-t;return e>>>0}function pm(i,e){const t=e+5;for(;i[e++]&128&&e<t;);return e}function Ef(i){return("0"+i.toString(16).toUpperCase()).slice(-2)}function Fs(i){return(i<10?"0":"")+i}function iF(i,e){if(!i||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&ub(i,(n,s)=>{const r=n.subarray(8,24);r.some(a=>a!==0)||(an.log(`[eme] Patching keyId in 'enc${s?"a":"v"}>sinf>>tenc' box: ${ui(r)} -> ${ui(t)}`),n.set(t,8))})}function sF(i){const e=[];return ub(i,t=>e.push(t.subarray(8,24))),e}function ub(i,e){Pt(i,["moov","trak"]).forEach(n=>{const s=Pt(n,["mdia","minf","stbl","stsd"])[0];if(!s)return;const r=s.subarray(8);let a=Pt(r,["enca"]);const u=a.length>0;u||(a=Pt(r,["encv"])),a.forEach(f=>{const c=u?f.subarray(28):f.subarray(78);Pt(c,["sinf"]).forEach(p=>{const m=cb(p);m&&e(m,u)})})})}function cb(i){const e=Pt(i,["schm"])[0];if(e){const t=Yn(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){const n=Pt(i,["schi","tenc"])[0];if(n)return n}}}function rF(i,e,t){const n={},s=Pt(i,["moof","traf"]);for(let r=0;r<s.length;r++){const a=s[r],u=Pt(a,["tfhd"])[0],f=Et(u,4),c=e[f];if(!c)continue;n[f]||(n[f]={start:NaN,duration:0,sampleCount:0,timescale:c.timescale,type:c.type});const d=n[f],p=Pt(a,["tfdt"])[0];if(p){const b=p[0];let C=Et(p,4);b===1&&(C===YT?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(C*=YT+1,C+=Et(p,8))),Ye(C)&&(!Ye(d.start)||C<d.start)&&(d.start=C)}const m=c.default,y=Et(u,0)|(m==null?void 0:m.flags);let E=(m==null?void 0:m.duration)||0;y&8&&(y&2?E=Et(u,12):E=Et(u,8));const A=Pt(a,["trun"]);let S=d.start||0,x=0,M=E;for(let b=0;b<A.length;b++){const C=A[b],N=Et(C,4),U=d.sampleCount;d.sampleCount+=N;const w=C[3]&1,O=C[3]&4,L=C[2]&1,I=C[2]&2,F=C[2]&4,X=C[2]&8;let Y=8,ee=N;for(w&&(Y+=4),O&&N&&(!(C[Y+1]&1)&&d.keyFrameIndex===void 0&&(d.keyFrameIndex=U),Y+=4,L?(M=Et(C,Y),Y+=4):M=E,I&&(Y+=4),X&&(Y+=4),S+=M,x+=M,ee--);ee--;)L?(M=Et(C,Y),Y+=4):M=E,I&&(Y+=4),F&&(C[Y+1]&1||d.keyFrameIndex===void 0&&(d.keyFrameIndex=d.sampleCount-(ee+1),d.keyFrameStart=S),Y+=4),X&&(Y+=4),S+=M,x+=M;!x&&E&&(x+=E*N)}d.duration+=x}if(!Object.keys(n).some(r=>n[r].duration)){let r=1/0,a=0;const u=Pt(i,["sidx"]);for(let f=0;f<u.length;f++){const c=eF(u[f]);if(c!=null&&c.references){r=Math.min(r,c.earliestPresentationTime/c.timescale);const d=c.references.reduce((p,m)=>p+m.info.duration||0,0);a=Math.max(a,d+c.earliestPresentationTime/c.timescale)}}a&&Ye(a)&&Object.keys(n).forEach(f=>{n[f].duration||(n[f].duration=a*n[f].timescale-n[f].start)})}return n}function oF(i){const e={valid:null,remainder:null},t=Pt(i,["moof"]);if(t.length<2)return e.remainder=i,e;const n=t[t.length-1];return e.valid=i.slice(0,n.byteOffset-8),e.remainder=i.slice(n.byteOffset-8),e}function ps(i,e){const t=new Uint8Array(i.length+e.length);return t.set(i),t.set(e,i.length),t}function JT(i,e){const t=[],n=e.samples,s=e.timescale,r=e.id;let a=!1;return Pt(n,["moof"]).map(f=>{const c=f.byteOffset-8;Pt(f,["traf"]).map(p=>{const m=Pt(p,["tfdt"]).map(y=>{const E=y[0];let A=Et(y,4);return E===1&&(A*=Math.pow(2,32),A+=Et(y,8)),A/s})[0];return m!==void 0&&(i=m),Pt(p,["tfhd"]).map(y=>{const E=Et(y,4),A=Et(y,0)&16777215,S=(A&1)!==0,x=(A&2)!==0,M=(A&8)!==0;let b=0;const C=(A&16)!==0;let N=0;const U=(A&32)!==0;let w=8;E===r&&(S&&(w+=8),x&&(w+=4),M&&(b=Et(y,w),w+=4),C&&(N=Et(y,w),w+=4),U&&(w+=4),e.type==="video"&&(a=Kd(e.codec)),Pt(p,["trun"]).map(O=>{const L=O[0],I=Et(O,0)&16777215,F=(I&1)!==0;let X=0;const Y=(I&4)!==0,ee=(I&256)!==0;let ne=0;const V=(I&512)!==0;let W=0;const q=(I&1024)!==0,oe=(I&2048)!==0;let he=0;const G=Et(O,4);let K=8;F&&(X=Et(O,K),K+=4),Y&&(K+=4);let fe=X+c;for(let Q=0;Q<G;Q++){if(ee?(ne=Et(O,K),K+=4):ne=b,V?(W=Et(O,K),K+=4):W=N,q&&(K+=4),oe&&(L===0?he=Et(O,K):he=ab(O,K),K+=4),e.type===vn.VIDEO){let ue=0;for(;ue<W;){const ae=Et(n,fe);if(fe+=4,aF(a,n[fe])){const Ee=n.subarray(fe,fe+ae);z0(Ee,a?2:1,i+he/s,t)}fe+=ae,ue+=ae+4}}i+=ne/s}}))})})}),t}function Kd(i){if(!i)return!1;const e=i.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function aF(i,e){if(i){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function z0(i,e,t,n){const s=fb(i);let r=0;r+=e;let a=0,u=0,f=0;for(;r<s.length;){a=0;do{if(r>=s.length)break;f=s[r++],a+=f}while(f===255);u=0;do{if(r>=s.length)break;f=s[r++],u+=f}while(f===255);const c=s.length-r;let d=r;if(u<c)r+=u;else if(u>c){an.error(`Malformed SEI payload. ${u} is too small, only ${c} bytes left to parse.`);break}if(a===4){if(s[d++]===181){const m=ob(s,d);if(d+=2,m===49){const y=Et(s,d);if(d+=4,y===1195456820){const E=s[d++];if(E===3){const A=s[d++],S=31&A,x=64&A,M=x?2+S*3:0,b=new Uint8Array(M);if(x){b[0]=A;for(let C=1;C<M;C++)b[C]=s[d++]}n.push({type:E,payloadType:a,pts:t,bytes:b})}}}}}else if(a===5&&u>16){const p=[];for(let E=0;E<16;E++){const A=s[d++].toString(16);p.push(A.length==1?"0"+A:A),(E===3||E===5||E===7||E===9)&&p.push("-")}const m=u-16,y=new Uint8Array(m);for(let E=0;E<m;E++)y[E]=s[d++];n.push({payloadType:a,pts:t,uuid:p.join(""),userData:es(y),userDataBytes:y})}}}function fb(i){const e=i.byteLength,t=[];let n=1;for(;n<e-2;)i[n]===0&&i[n+1]===0&&i[n+2]===3?(t.push(n+2),n+=2):n++;if(t.length===0)return i;const s=e-t.length,r=new Uint8Array(s);let a=0;for(n=0;n<s;a++,n++)a===t[0]&&(a++,t.shift()),r[n]=i[a];return r}function lF(i){const e=i[0];let t="",n="",s=0,r=0,a=0,u=0,f=0,c=0;if(e===0){for(;Yn(i.subarray(c,c+1))!=="\0";)t+=Yn(i.subarray(c,c+1)),c+=1;for(t+=Yn(i.subarray(c,c+1)),c+=1;Yn(i.subarray(c,c+1))!=="\0";)n+=Yn(i.subarray(c,c+1)),c+=1;n+=Yn(i.subarray(c,c+1)),c+=1,s=Et(i,12),r=Et(i,16),u=Et(i,20),f=Et(i,24),c=28}else if(e===1){c+=4,s=Et(i,c),c+=4;const p=Et(i,c);c+=4;const m=Et(i,c);for(c+=4,a=2**32*p+m,kO(a)||(a=Number.MAX_SAFE_INTEGER,an.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),u=Et(i,c),c+=4,f=Et(i,c),c+=4;Yn(i.subarray(c,c+1))!=="\0";)t+=Yn(i.subarray(c,c+1)),c+=1;for(t+=Yn(i.subarray(c,c+1)),c+=1;Yn(i.subarray(c,c+1))!=="\0";)n+=Yn(i.subarray(c,c+1)),c+=1;n+=Yn(i.subarray(c,c+1)),c+=1}const d=i.subarray(c,i.byteLength);return{schemeIdUri:t,value:n,timeScale:s,presentationTime:a,presentationTimeDelta:r,eventDuration:u,id:f,payload:d}}function uF(i,...e){const t=e.length;let n=8,s=t;for(;s--;)n+=e[s].byteLength;const r=new Uint8Array(n);for(r[0]=n>>24&255,r[1]=n>>16&255,r[2]=n>>8&255,r[3]=n&255,r.set(i,4),s=0,n=8;s<t;s++)r.set(e[s],n),n+=e[s].byteLength;return r}function cF(i,e,t){if(i.byteLength!==16)throw new RangeError("Invalid system id");let n,s;n=0,s=new Uint8Array;let r;n>0?(r=new Uint8Array(4),e.length>0&&new DataView(r.buffer).setUint32(0,e.length,!1)):r=new Uint8Array;const a=new Uint8Array(4);return t.byteLength>0&&new DataView(a.buffer).setUint32(0,t.byteLength,!1),uF([112,115,115,104],new Uint8Array([n,0,0,0]),i,r,s,a,t)}function fF(i){const e=[];if(i instanceof ArrayBuffer){const t=i.byteLength;let n=0;for(;n+32<t;){const s=new DataView(i,n),r=dF(s);e.push(r),n+=r.size}}return e}function dF(i){const e=i.getUint32(0),t=i.byteOffset,n=i.byteLength;if(n<e)return{offset:t,size:n};if(i.getUint32(4)!==1886614376)return{offset:t,size:e};const r=i.getUint32(8)>>>24;if(r!==0&&r!==1)return{offset:t,size:e};const a=i.buffer,u=ui(new Uint8Array(a,t+12,16));let f=null,c=null,d=0;if(r===0)d=28;else{const m=i.getUint32(28);if(!m||n<32+m*16)return{offset:t,size:e};f=[];for(let y=0;y<m;y++)f.push(new Uint8Array(a,t+32+y*16,16));d=32+m*16}if(!d)return{offset:t,size:e};const p=i.getUint32(d);return e-32<p?{offset:t,size:e}:(c=new Uint8Array(a,t+d+4,p),{version:r,systemId:u,kids:f,data:c,offset:t,size:e})}const db=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),Tl={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function $0(i,e){const t=Tl[e];return!!t&&!!t[i.slice(0,4)]}function zu(i,e,t=!0){return!i.split(",").some(n=>!q0(n,e,t))}function q0(i,e,t=!0){var n;const s=go(t);return(n=s==null?void 0:s.isTypeSupported($u(i,e)))!=null?n:!1}function $u(i,e){return`${e}/mp4;codecs=${i}`}function QT(i){if(i){const e=i.substring(0,4);return Tl.video[e]}return 2}function Rd(i){const e=db();return i.split(",").reduce((t,n)=>{const r=e&&Kd(n)?9:Tl.video[n];return r?(r*2+t)/(t?3:2):(Tl.audio[n]+t)/(t?2:1)},0)}const mm={};function hF(i,e=!0){if(mm[i])return mm[i];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[i];for(let s=0;s<t.length;s++){var n;if(q0(t[s],"audio",e))return mm[i]=t[s],t[s];if(t[s]==="mp3"&&(n=go(e))!=null&&n.isTypeSupported("audio/mpeg"))return""}return i}const pF=/flac|opus|mp4a\.40\.34/i;function bd(i,e=!0){return i.replace(pF,t=>hF(t.toLowerCase(),e))}function mF(i,e){const t=[];if(i){const n=i.split(",");for(let s=0;s<n.length;s++)$0(n[s],"video")||t.push(n[s])}return e&&t.push(e),t.join(",")}function rd(i,e){if(i&&(i.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(i)!==-1)&&(ZT(i,"audio")||ZT(i,"video")))return i;if(e){const t=e.split(",");if(t.length>1){if(i){for(let n=t.length;n--;)if(t[n].substring(0,4)===i.substring(0,4))return t[n]}return t[0]}}return e||i}function ZT(i,e){return $0(i,e)&&q0(i,e)}function gF(i){const e=i.split(",");for(let t=0;t<e.length;t++){const n=e[t].split(".");n.length>2&&n[0]==="avc1"&&(e[t]=`avc1.${parseInt(n[1]).toString(16)}${("000"+parseInt(n[2]).toString(16)).slice(-4)}`)}return e.join(",")}function vF(i){if(i.startsWith("av01.")){const e=i.split("."),t=["0","111","01","01","01","0"];for(let n=e.length;n>4&&n<10;n++)e[n]=t[n-4];return e.join(".")}return i}function jT(i){const e=go(i)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function Mg(i){return i.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const yF={supported:!0,powerEfficient:!0,smooth:!0},_F={supported:!1,smooth:!1,powerEfficient:!1},hb={supported:!0,configurations:[],decodingInfoResults:[yF]};function pb(i,e){return{supported:!1,configurations:e,decodingInfoResults:[_F],error:i}}function EF(i,e,t,n,s,r){const a=i.videoCodec,u=i.audioCodec?i.audioGroups:null,f=r==null?void 0:r.audioCodec,c=r==null?void 0:r.channels,d=c?parseInt(c):f?1/0:2;let p=null;if(u!=null&&u.length)try{u.length===1&&u[0]?p=e.groups[u[0]].channels:p=u.reduce((m,y)=>{if(y){const E=e.groups[y];if(!E)throw new Error(`Audio track group ${y} not found`);Object.keys(E.channels).forEach(A=>{m[A]=(m[A]||0)+E.channels[A]})}return m},{2:0})}catch{return!0}return a!==void 0&&(a.split(",").some(m=>Kd(m))||i.width>1920&&i.height>1088||i.height>1920&&i.width>1088||i.frameRate>Math.max(n,30)||i.videoRange!=="SDR"&&i.videoRange!==t||i.bitrate>Math.max(s,8e6))||!!p&&Ye(d)&&Object.keys(p).some(m=>parseInt(m)>d)}function mb(i,e,t,n={}){const s=i.videoCodec;if(!s&&!i.audioCodec||!t)return Promise.resolve(hb);const r=[],a=SF(i),u=a.length,f=TF(i,e,u>0),c=f.length;for(let d=u||1*c||1;d--;){const p={type:"media-source"};if(u&&(p.video=a[d%u]),c){p.audio=f[d%c];const m=p.audio.bitrate;p.video&&m&&(p.video.bitrate-=m)}r.push(p)}if(s){const d=navigator.userAgent;if(s.split(",").some(p=>Kd(p))&&db())return Promise.resolve(pb(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${d})`),r))}return Promise.all(r.map(d=>{const p=AF(d);return n[p]||(n[p]=t.decodingInfo(d))})).then(d=>({supported:!d.some(p=>!p.supported),configurations:r,decodingInfoResults:d})).catch(d=>({supported:!1,configurations:r,decodingInfoResults:[],error:d}))}function SF(i){var e;const t=(e=i.videoCodec)==null?void 0:e.split(","),n=gb(i),s=i.width||640,r=i.height||480,a=i.frameRate||30,u=i.videoRange.toLowerCase();return t?t.map(f=>{const c={contentType:$u(vF(f),"video"),width:s,height:r,bitrate:n,framerate:a};return u!=="sdr"&&(c.transferFunction=u),c}):[]}function TF(i,e,t){var n;const s=(n=i.audioCodec)==null?void 0:n.split(","),r=gb(i);return s&&i.audioGroups?i.audioGroups.reduce((a,u)=>{var f;const c=u?(f=e.groups[u])==null?void 0:f.tracks:null;return c?c.reduce((d,p)=>{if(p.groupId===u){const m=parseFloat(p.channels||"");s.forEach(y=>{const E={contentType:$u(y,"audio"),bitrate:t?xF(y,r):r};m&&(E.channels=""+m),d.push(E)})}return d},a):a},[]):[]}function xF(i,e){if(e<=1)return 1;let t=128e3;return i==="ec-3"?t=768e3:i==="ac-3"&&(t=64e4),Math.min(e/2,t)}function gb(i){return Math.ceil(Math.max(i.bitrate*.9,i.averageBitrate)/1e3)*1e3||1}function AF(i){let e="";const{audio:t,video:n}=i;if(n){const s=Mg(n.contentType);e+=`${s}_r${n.height}x${n.width}f${Math.ceil(n.framerate)}${n.transferFunction||"sd"}_${Math.ceil(n.bitrate/1e5)}`}if(t){const s=Mg(t.contentType);e+=`${n?"_":""}${s}_c${t.channels}`}return e}const Cg=["NONE","TYPE-0","TYPE-1",null];function RF(i){return Cg.indexOf(i)>-1}const Md=["SDR","PQ","HLG"];function bF(i){return!!i&&Md.indexOf(i)>-1}var od={No:"",Yes:"YES",v2:"v2"};function ex(i){const{canSkipUntil:e,canSkipDateRanges:t,age:n}=i,s=n<e/2;return e&&s?t?od.v2:od.Yes:od.No}class tx{constructor(e,t,n){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=n}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class qu{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(n=>!!n).map(n=>n.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const n=(t=e.supplemental)==null?void 0:t.videoCodec;n&&n!==e.videoCodec&&(this.codecSet+=`,${n.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return nx(this._audioGroups,e)}hasSubtitleGroup(e){return nx(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let n=this._audioGroups;n||(n=this._audioGroups=[]),n.indexOf(t)===-1&&n.push(t)}else if(e==="text"){let n=this._subtitleGroups;n||(n=this._subtitleGroups=[]),n.indexOf(t)===-1&&n.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function nx(i,e){return!e||!i?!1:i.indexOf(e)!==-1}function MF(){if(typeof matchMedia=="function"){const i=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(i.media!==e.media)return i.matches===!0}return!1}function CF(i,e){let t=!1,n=[];if(i&&(t=i!=="SDR",n=[i]),e){n=e.allowedVideoRanges||Md.slice(0);const s=n.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:s&&MF(),t||(n=["SDR"])}return{preferHDR:t,allowedVideoRanges:n}}const IF=i=>{const e=new WeakSet;return(t,n)=>{if(i&&(n=i(t,n)),typeof n=="object"&&n!==null){if(e.has(n))return;e.add(n)}return n}},yn=(i,e)=>JSON.stringify(i,IF(e));function LF(i,e,t,n,s){const r=Object.keys(i),a=n==null?void 0:n.channels,u=n==null?void 0:n.audioCodec,f=s==null?void 0:s.videoCodec,c=a&&parseInt(a)===2;let d=!1,p=!1,m=1/0,y=1/0,E=1/0,A=1/0,S=0,x=[];const{preferHDR:M,allowedVideoRanges:b}=CF(e,s);for(let O=r.length;O--;){const L=i[r[O]];d||(d=L.channels[2]>0),m=Math.min(m,L.minHeight),y=Math.min(y,L.minFramerate),E=Math.min(E,L.minBitrate),b.filter(F=>L.videoRanges[F]>0).length>0&&(p=!0)}m=Ye(m)?m:0,y=Ye(y)?y:0;const C=Math.max(1080,m),N=Math.max(30,y);E=Ye(E)?E:t,t=Math.max(E,t),p||(e=void 0);const U=r.length>1;return{codecSet:r.reduce((O,L)=>{const I=i[L];if(L===O)return O;if(x=p?b.filter(F=>I.videoRanges[F]>0):[],U){if(I.minBitrate>t)return Us(L,`min bitrate of ${I.minBitrate} > current estimate of ${t}`),O;if(!I.hasDefaultAudio)return Us(L,"no renditions with default or auto-select sound found"),O;if(u&&L.indexOf(u.substring(0,4))%5!==0)return Us(L,`audio codec preference "${u}" not found`),O;if(a&&!c){if(!I.channels[a])return Us(L,`no renditions with ${a} channel sound found (channels options: ${Object.keys(I.channels)})`),O}else if((!u||c)&&d&&I.channels[2]===0)return Us(L,"no renditions with stereo sound found"),O;if(I.minHeight>C)return Us(L,`min resolution of ${I.minHeight} > maximum of ${C}`),O;if(I.minFramerate>N)return Us(L,`min framerate of ${I.minFramerate} > maximum of ${N}`),O;if(!x.some(F=>I.videoRanges[F]>0))return Us(L,`no variants with VIDEO-RANGE of ${yn(x)} found`),O;if(f&&L.indexOf(f.substring(0,4))%5!==0)return Us(L,`video codec preference "${f}" not found`),O;if(I.maxScore<S)return Us(L,`max score of ${I.maxScore} < selected max of ${S}`),O}return O&&(Rd(L)>=Rd(O)||I.fragmentError>i[O].fragmentError)?O:(A=I.minIndex,S=I.maxScore,L)},void 0),videoRanges:x,preferHDR:M,minFramerate:y,minBitrate:E,minIndex:A}}function Us(i,e){an.log(`[abr] start candidates with "${i}" ignored because ${e}`)}function vb(i){return i.reduce((e,t)=>{let n=e.groups[t.groupId];n||(n=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),n.tracks.push(t);const s=t.channels||"2";return n.channels[s]=(n.channels[s]||0)+1,n.hasDefault=n.hasDefault||t.default,n.hasAutoSelect=n.hasAutoSelect||t.autoselect,n.hasDefault&&(e.hasDefaultAudio=!0),n.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function DF(i,e,t,n){return i.slice(t,n+1).reduce((s,r,a)=>{if(!r.codecSet)return s;const u=r.audioGroups;let f=s[r.codecSet];f||(s[r.codecSet]=f={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:a,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!u,fragmentError:0}),f.minBitrate=Math.min(f.minBitrate,r.bitrate);const c=Math.min(r.height,r.width);return f.minHeight=Math.min(f.minHeight,c),f.minFramerate=Math.min(f.minFramerate,r.frameRate),f.minIndex=Math.min(f.minIndex,a),f.maxScore=Math.max(f.maxScore,r.score),f.fragmentError+=r.fragmentError,f.videoRanges[r.videoRange]=(f.videoRanges[r.videoRange]||0)+1,u&&u.forEach(d=>{if(!d)return;const p=e.groups[d];p&&(f.hasDefaultAudio=f.hasDefaultAudio||e.hasDefaultAudio?p.hasDefault:p.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(p.channels).forEach(m=>{f.channels[m]=(f.channels[m]||0)+p.channels[m]}))}),s},{})}function ix(i){if(!i)return i;const{lang:e,assocLang:t,characteristics:n,channels:s,audioCodec:r}=i;return{lang:e,assocLang:t,characteristics:n,channels:s,audioCodec:r}}function Gs(i,e,t){if("attrs"in i){const n=e.indexOf(i);if(n!==-1)return n}for(let n=0;n<e.length;n++){const s=e[n];if(na(i,s,t))return n}return-1}function na(i,e,t){const{groupId:n,name:s,lang:r,assocLang:a,default:u}=i,f=i.forced;return(n===void 0||e.groupId===n)&&(s===void 0||e.name===s)&&(r===void 0||wF(r,e.lang))&&(r===void 0||e.assocLang===a)&&(u===void 0||e.default===u)&&(f===void 0||e.forced===f)&&(!("characteristics"in i)||PF(i.characteristics||"",e.characteristics))&&(t===void 0||t(i,e))}function wF(i,e="--"){return i.length===e.length?i===e:i.startsWith(e)||e.startsWith(i)}function PF(i,e=""){const t=i.split(","),n=e.split(",");return t.length===n.length&&!t.some(s=>n.indexOf(s)===-1)}function Xo(i,e){const{audioCodec:t,channels:n}=i;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(n===void 0||n===(e.channels||"2"))}function NF(i,e,t,n,s){const r=e[n],u=e.reduce((m,y,E)=>{const A=y.uri;return(m[A]||(m[A]=[])).push(E),m},{})[r.uri];u.length>1&&(n=Math.max.apply(Math,u));const f=r.videoRange,c=r.frameRate,d=r.codecSet.substring(0,4),p=sx(e,n,m=>{if(m.videoRange!==f||m.frameRate!==c||m.codecSet.substring(0,4)!==d)return!1;const y=m.audioGroups,E=t.filter(A=>!y||y.indexOf(A.groupId)!==-1);return Gs(i,E,s)>-1});return p>-1?p:sx(e,n,m=>{const y=m.audioGroups,E=t.filter(A=>!y||y.indexOf(A.groupId)!==-1);return Gs(i,E,s)>-1})}function sx(i,e,t){for(let n=e;n>-1;n--)if(t(i[n]))return n;for(let n=e+1;n<i.length;n++)if(t(i[n]))return n;return-1}function Cd(i,e){var t;return!!i&&i!==((t=e.loadLevelObj)==null?void 0:t.uri)}class UF extends ms{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var n;const{fragCurrent:s,partCurrent:r,hls:a}=this,{autoLevelEnabled:u,media:f}=a;if(!s||!f)return;const c=performance.now(),d=r?r.stats:s.stats,p=r?r.duration:s.duration,m=c-d.loading.start,y=a.minAutoLevel,E=s.level,A=this._nextAutoLevel;if(d.aborted||d.loaded&&d.loaded===d.total||E<=y){this.clearTimer(),this._nextAutoLevel=-1;return}if(!u)return;const S=A>-1&&A!==E,x=!!t||S;if(!x&&(f.paused||!f.playbackRate||!f.readyState))return;const M=a.mainForwardBufferInfo;if(!x&&M===null)return;const b=this.bwEstimator.getEstimateTTFB(),C=Math.abs(f.playbackRate);if(m<=Math.max(b,1e3*(p/(C*2))))return;const N=M?M.len/C:0,U=d.loading.first?d.loading.first-d.loading.start:-1,w=d.loaded&&U>-1,O=this.getBwEstimate(),L=a.levels,I=L[E],F=Math.max(d.loaded,Math.round(p*(s.bitrate||I.averageBitrate)/8));let X=w?m-U:m;X<1&&w&&(X=Math.min(m,d.loaded*8/O));const Y=w?d.loaded*1e3/X:0,ee=b/1e3,ne=Y?(F-d.loaded)/Y:F*8/O+ee;if(ne<=N)return;const V=Y?Y*8:O,W=((n=(t==null?void 0:t.details)||this.hls.latestLevelDetails)==null?void 0:n.live)===!0,q=this.hls.config.abrBandWidthUpFactor;let oe=Number.POSITIVE_INFINITY,he;for(he=E-1;he>y;he--){const Q=L[he].maxBitrate,ue=!L[he].details||W;if(oe=this.getTimeToLoadFrag(ee,V,p*Q,ue),oe<Math.min(N,p+ee))break}if(oe>=ne||oe>p*10)return;w?this.bwEstimator.sample(m-Math.min(b,U),d.loaded):this.bwEstimator.sampleTTFB(m);const G=L[he].maxBitrate;this.getBwEstimate()*q>G&&this.resetEstimator(G);const K=this.findBestLevel(G,y,he,0,N,1,1);K>-1&&(he=K),this.warn(`Fragment ${s.sn}${r?" part "+r.index:""} of level ${E} is loading too slowly;
      Fragment duration: ${s.duration.toFixed(3)}
      Time to underbuffer: ${N.toFixed(3)} s
      Estimated load time for current fragment: ${ne.toFixed(3)} s
      Estimated load time for down switch fragment: ${oe.toFixed(3)} s
      TTFB estimate: ${U|0} ms
      Current BW estimate: ${Ye(O)?O|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${he} @ ${G|0} bps`),a.nextLoadLevel=a.nextAutoLevel=he,this.clearTimer();const fe=()=>{if(this.clearTimer(),this.fragCurrent===s&&this.hls.loadLevel===he&&he>0){const Q=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${he>0?"and switching down":""}
      Fragment duration: ${s.duration.toFixed(3)} s
      Time to underbuffer: ${Q.toFixed(3)} s`),s.abortRequests(),this.fragCurrent=this.partCurrent=null,he>y){let ue=this.findBestLevel(this.hls.levels[y].bitrate,y,he,0,Q,1,1);ue===-1&&(ue=y),this.hls.nextLoadLevel=this.hls.nextAutoLevel=ue,this.resetEstimator(this.hls.levels[ue].bitrate)}}};S||ne>oe*2?fe():this.timer=self.setInterval(fe,oe*1e3),a.trigger(P.FRAG_LOAD_EMERGENCY_ABORTED,{frag:s,part:r,stats:d})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new GO(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(P.MANIFEST_LOADING,this.onManifestLoading,this),e.on(P.FRAG_LOADING,this.onFragLoading,this),e.on(P.FRAG_LOADED,this.onFragLoaded,this),e.on(P.FRAG_BUFFERED,this.onFragBuffered,this),e.on(P.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(P.LEVEL_LOADED,this.onLevelLoaded,this),e.on(P.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(P.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(P.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(P.MANIFEST_LOADING,this.onManifestLoading,this),e.off(P.FRAG_LOADING,this.onFragLoading,this),e.off(P.FRAG_LOADED,this.onFragLoaded,this),e.off(P.FRAG_BUFFERED,this.onFragBuffered,this),e.off(P.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(P.LEVEL_LOADED,this.onLevelLoaded,this),e.off(P.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(P.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(P.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const n=t.frag;if(!this.ignoreFragment(n)){if(!n.bitrateTest){var s;this.fragCurrent=n,this.partCurrent=(s=t.part)!=null?s:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case ce.BUFFER_ADD_CODEC_ERROR:case ce.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case ce.FRAG_LOAD_TIMEOUT:{const n=t.frag,{fragCurrent:s,partCurrent:r}=this;if(n&&s&&n.sn===s.sn&&n.level===s.level){const a=performance.now(),u=r?r.stats:n.stats,f=a-u.loading.start,c=u.loading.first?u.loading.first-u.loading.start:-1;if(u.loaded&&c>-1){const p=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(f-Math.min(p,c),u.loaded)}else this.bwEstimator.sampleTTFB(f)}break}}}getTimeToLoadFrag(e,t,n,s){const r=e+n/t,a=s?e+this.lastLevelLoadSec:0;return r+a}onLevelLoaded(e,t){const n=this.hls.config,{loading:s}=t.stats,r=s.end-s.first;Ye(r)&&(this.lastLevelLoadSec=r/1e3),t.details.live?this.bwEstimator.update(n.abrEwmaSlowLive,n.abrEwmaFastLive):this.bwEstimator.update(n.abrEwmaSlowVoD,n.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:n}){const s=n?n.stats:t.stats;if(t.type===et.MAIN&&this.bwEstimator.sampleTTFB(s.loading.first-s.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const r=n?n.duration:t.duration,a=this.hls.levels[t.level],u=(a.loaded?a.loaded.bytes:0)+s.loaded,f=(a.loaded?a.loaded.duration:0)+r;a.loaded={bytes:u,duration:f},a.realBitrate=Math.round(8*u/f)}if(t.bitrateTest){const r={stats:s,frag:t,part:n,id:t.type};this.onFragBuffered(P.FRAG_BUFFERED,r),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:n,part:s}=t,r=s!=null&&s.stats.loaded?s.stats:n.stats;if(r.aborted||this.ignoreFragment(n))return;const a=r.parsing.end-r.loading.start-Math.min(r.loading.first-r.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(a,r.loaded),r.bwEstimate=this.getBwEstimate(),n.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==et.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,n=this.getBwEstimate(),s=this.hls.config.maxStarvationDelay,r=this.findBestLevel(n,t,e,0,s,1,1);if(r>-1)return r;const a=this.hls.firstLevel,u=Math.min(Math.max(a,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${a} clamped to ${u}`),u}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,n=this.bwEstimator.canEstimate(),s=this.lastLoadedFragLevel>-1;if(e!==-1&&(!n||!s||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const r=n&&s?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const a=this.hls.levels;if(a.length>Math.max(e,r)&&a[e].loadError<=a[r].loadError)return e}return this._nextAutoLevel=r,this.nextAutoLevelKey=this.getAutoLevelKey(),r}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:n}=this;if(n.levels.length<=1)return n.loadLevel;const{maxAutoLevel:s,config:r,minAutoLevel:a}=n,u=t?t.duration:e?e.duration:0,f=this.getBwEstimate(),c=this.getStarvationDelay();let d=r.abrBandWidthFactor,p=r.abrBandWidthUpFactor;if(c){const S=this.findBestLevel(f,a,s,c,0,d,p);if(S>=0)return this.rebufferNotice=-1,S}let m=u?Math.min(u,r.maxStarvationDelay):r.maxStarvationDelay;if(!c){const S=this.bitrateTestDelay;S&&(m=(u?Math.min(u,r.maxLoadingDelay):r.maxLoadingDelay)-S,this.info(`bitrate test took ${Math.round(1e3*S)}ms, set first fragment max fetchDuration to ${Math.round(1e3*m)} ms`),d=p=1)}const y=this.findBestLevel(f,a,s,c,m,d,p);if(this.rebufferNotice!==y&&(this.rebufferNotice=y,this.info(`${c?"rebuffering expected":"buffer is empty"}, optimal quality level ${y}`)),y>-1)return y;const E=n.levels[a],A=n.loadLevelObj;return A&&(E==null?void 0:E.bitrate)<A.bitrate?a:n.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const n=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,s=e.mainForwardBufferInfo;return(s?s.len:0)/n}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,n,s,r,a,u){var f;const c=s+r,d=this.lastLoadedFragLevel,p=d===-1?this.hls.firstLevel:d,{fragCurrent:m,partCurrent:y}=this,{levels:E,allAudioTracks:A,loadLevel:S,config:x}=this.hls;if(E.length===1)return 0;const M=E[p],b=!!((f=this.hls.latestLevelDetails)!=null&&f.live),C=S===-1||d===-1;let N,U="SDR",w=(M==null?void 0:M.frameRate)||0;const{audioPreference:O,videoPreference:L}=x,I=this.audioTracksByGroup||(this.audioTracksByGroup=vb(A));let F=-1;if(C){if(this.firstSelection!==-1)return this.firstSelection;const V=this.codecTiers||(this.codecTiers=DF(E,I,t,n)),W=LF(V,U,e,O,L),{codecSet:q,videoRanges:oe,minFramerate:he,minBitrate:G,minIndex:K,preferHDR:fe}=W;F=K,N=q,U=fe?oe[oe.length-1]:oe[0],w=he,e=Math.max(e,G),this.log(`picked start tier ${yn(W)}`)}else N=M==null?void 0:M.codecSet,U=M==null?void 0:M.videoRange;const X=y?y.duration:m?m.duration:0,Y=this.bwEstimator.getEstimateTTFB()/1e3,ee=[];for(let V=n;V>=t;V--){var ne;const W=E[V],q=V>p;if(!W)continue;if(x.useMediaCapabilities&&!W.supportedResult&&!W.supportedPromise){const ue=navigator.mediaCapabilities;typeof(ue==null?void 0:ue.decodingInfo)=="function"&&EF(W,I,U,w,e,O)?(W.supportedPromise=mb(W,I,ue,this.supportedCache),W.supportedPromise.then(ae=>{if(!this.hls)return;W.supportedResult=ae;const Ee=this.hls.levels,pe=Ee.indexOf(W);ae.error?this.warn(`MediaCapabilities decodingInfo error: "${ae.error}" for level ${pe} ${yn(ae)}`):ae.supported?ae.decodingInfoResults.some(Ae=>Ae.smooth===!1||Ae.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${pe} not smooth or powerEfficient: ${yn(ae)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${pe} ${yn(ae)}`),pe>-1&&Ee.length>1&&(this.log(`Removing unsupported level ${pe}`),this.hls.removeLevel(pe),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(ae=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${ae}`)})):W.supportedResult=hb}if((N&&W.codecSet!==N||U&&W.videoRange!==U||q&&w>W.frameRate||!q&&w>0&&w<W.frameRate||(ne=W.supportedResult)!=null&&(ne=ne.decodingInfoResults)!=null&&ne.some(ue=>ue.smooth===!1))&&(!C||V!==F)){ee.push(V);continue}const oe=W.details,he=(y?oe==null?void 0:oe.partTarget:oe==null?void 0:oe.averagetargetduration)||X;let G;q?G=u*e:G=a*e;const K=X&&s>=X*2&&r===0?W.averageBitrate:W.maxBitrate,fe=this.getTimeToLoadFrag(Y,G,K*he,oe===void 0);if(G>=K&&(V===d||W.loadError===0&&W.fragmentError===0)&&(fe<=Y||!Ye(fe)||b&&!this.bitrateTestDelay||fe<c)){const ue=this.forcedAutoLevel;return V!==S&&(ue===-1||ue!==S)&&(ee.length&&this.trace(`Skipped level(s) ${ee.join(",")} of ${n} max with CODECS and VIDEO-RANGE:"${E[ee[0]].codecs}" ${E[ee[0]].videoRange}; not compatible with "${N}" ${U}`),this.info(`switch candidate:${p}->${V} adjustedbw(${Math.round(G)})-bitrate=${Math.round(G-K)} ttfb:${Y.toFixed(1)} avgDuration:${he.toFixed(1)} maxFetchDuration:${c.toFixed(1)} fetchDuration:${fe.toFixed(1)} firstSelection:${C} codecSet:${W.codecSet} videoRange:${W.videoRange} hls.loadLevel:${S}`)),C&&(this.firstSelection=V),V}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:n}=this.hls;return Math.min(Math.max(e,n),t)}}const yb={search:function(i,e){let t=0,n=i.length-1,s=null,r=null;for(;t<=n;){s=(t+n)/2|0,r=i[s];const a=e(r);if(a>0)t=s+1;else if(a<0)n=s-1;else return r}return null}};function OF(i,e,t){if(e===null||!Array.isArray(i)||!i.length||!Ye(e))return null;const n=i[0].programDateTime;if(e<(n||0))return null;const s=i[i.length-1].endProgramDateTime;if(e>=(s||0))return null;for(let r=0;r<i.length;++r){const a=i[r];if(kF(e,t,a))return a}return null}function ia(i,e,t=0,n=0,s=.005){let r=null;if(i){r=e[1+i.sn-e[0].sn]||null;const u=i.endDTS-t;u>0&&u<15e-7&&(t+=15e-7),r&&i.level!==r.level&&r.end<=i.end&&(r=e[2+i.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(r=e[0]);if(r&&((!i||i.level===r.level)&&rx(t,n,r)===0||FF(r,i,Math.min(s,n))))return r;const a=yb.search(e,rx.bind(null,t,n));return a&&(a!==i||!r)?a:r}function FF(i,e,t){if(e&&e.start===0&&e.level<i.level&&(e.endPTS||0)>0){const n=e.tagList.reduce((s,r)=>(r[0]==="INF"&&(s+=parseFloat(r[1])),s),t);return i.start<=n}return!1}function rx(i=0,e=0,t){if(t.start<=i&&t.start+t.duration>i)return 0;const n=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-n<=i?1:t.start-n>i&&t.start?-1:0}function kF(i,e,t){const n=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-n>i}function _b(i,e,t){if(i&&i.startCC<=e&&i.endCC>=e){let n=i.fragments;const{fragmentHint:s}=i;s&&(n=n.concat(s));let r;return yb.search(n,a=>a.cc<e?1:a.cc>e?-1:(r=a,a.end<=t?1:a.start>t?-1:0)),r||null}return null}function Id(i){switch(i.details){case ce.FRAG_LOAD_TIMEOUT:case ce.KEY_LOAD_TIMEOUT:case ce.LEVEL_LOAD_TIMEOUT:case ce.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Eb(i){return i.details.startsWith("key")}function Sb(i){return Eb(i)&&!!i.frag&&!i.frag.decryptdata}function ox(i,e){const t=Id(e);return i.default[`${t?"timeout":"error"}Retry`]}function W0(i,e){const t=i.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*i.retryDelayMs,i.maxRetryDelayMs)}function ax(i){return on(on({},i),{errorRetry:null,timeoutRetry:null})}function Ld(i,e,t,n){if(!i)return!1;const s=n==null?void 0:n.code,r=e<i.maxNumRetry&&(BF(s)||!!t);return i.shouldRetry?i.shouldRetry(i,e,t,n,r):r}function BF(i){return Ig(i)||!!i&&(i<400||i>499)}function Ig(i){return i===0&&navigator.onLine===!1}var li={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},Xi={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};class GF extends ms{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(P.ERROR,this.onError,this),e.on(P.MANIFEST_LOADING,this.onManifestLoading,this),e.on(P.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(P.ERROR,this.onError,this),e.off(P.ERROR,this.onErrorOut,this),e.off(P.MANIFEST_LOADING,this.onManifestLoading,this),e.off(P.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===et.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,n=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||n===-1?t.loadLevel:n}variantHasKey(e,t){if(e){var n;if((n=e.details)!=null&&n.hasKey(t))return!0;const s=e.audioGroups;if(s)return this.hls.allAudioTracks.filter(a=>s.indexOf(a.groupId)>=0).some(a=>{var u;return(u=a.details)==null?void 0:u.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var n;if(t.fatal)return;const s=this.hls,r=t.context;switch(t.details){case ce.FRAG_LOAD_ERROR:case ce.FRAG_LOAD_TIMEOUT:case ce.KEY_LOAD_ERROR:case ce.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case ce.FRAG_PARSING_ERROR:if((n=t.frag)!=null&&n.gap){t.errorAction=ml();return}case ce.FRAG_GAP:case ce.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=li.SendAlternateToPenaltyBox;return}case ce.LEVEL_EMPTY_ERROR:case ce.LEVEL_PARSING_ERROR:{var a;const f=t.parent===et.MAIN?t.level:s.loadLevel;t.details===ce.LEVEL_EMPTY_ERROR&&((a=t.context)!=null&&(a=a.levelDetails)!=null&&a.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,f):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,f))}return;case ce.LEVEL_LOAD_ERROR:case ce.LEVEL_LOAD_TIMEOUT:typeof(r==null?void 0:r.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.level));return;case ce.AUDIO_TRACK_LOAD_ERROR:case ce.AUDIO_TRACK_LOAD_TIMEOUT:case ce.SUBTITLE_LOAD_ERROR:case ce.SUBTITLE_TRACK_LOAD_TIMEOUT:if(r){const f=s.loadLevelObj;if(f&&(r.type===Nt.AUDIO_TRACK&&f.hasAudioGroup(r.groupId)||r.type===Nt.SUBTITLE_TRACK&&f.hasSubtitleGroup(r.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.loadLevel),t.errorAction.action=li.SendAlternateToPenaltyBox,t.errorAction.flags=Xi.MoveAllAlternatesMatchingHost;return}}return;case ce.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:li.SendAlternateToPenaltyBox,flags:Xi.MoveAllAlternatesMatchingHDCP};return;case ce.KEY_SYSTEM_SESSION_UPDATE_FAILED:case ce.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case ce.KEY_SYSTEM_NO_SESSION:t.errorAction={action:li.SendAlternateToPenaltyBox,flags:Xi.MoveAllAlternatesMatchingKey};return;case ce.BUFFER_ADD_CODEC_ERROR:case ce.REMUX_ALLOC_ERROR:case ce.BUFFER_APPEND_ERROR:if(!t.errorAction){var u;t.errorAction=this.getLevelSwitchAction(t,(u=t.level)!=null?u:s.loadLevel)}return;case ce.INTERNAL_EXCEPTION:case ce.BUFFER_APPENDING_ERROR:case ce.BUFFER_FULL_ERROR:case ce.LEVEL_SWITCH_ERROR:case ce.BUFFER_STALLED_ERROR:case ce.BUFFER_SEEK_OVER_HOLE:case ce.BUFFER_NUDGE_ON_STALL:t.errorAction=ml();return}t.type===lt.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=ml())}getPlaylistRetryOrSwitchAction(e,t){const n=this.hls,s=ox(n.config.playlistLoadPolicy,e),r=this.playlistError++;if(Ld(s,r,Id(e),e.response))return{action:li.RetryRequest,flags:Xi.None,retryConfig:s,retryCount:r};const u=this.getLevelSwitchAction(e,t);return s&&(u.retryConfig=s,u.retryCount=r),u}getFragRetryOrSwitchAction(e){const t=this.hls,n=this.getVariantLevelIndex(e.frag),s=t.levels[n],{fragLoadPolicy:r,keyLoadPolicy:a}=t.config,u=ox(Eb(e)?a:r,e),f=t.levels.reduce((d,p)=>d+p.fragmentError,0);if(s&&(e.details!==ce.FRAG_GAP&&s.fragmentError++,!Sb(e)&&Ld(u,f,Id(e),e.response)))return{action:li.RetryRequest,flags:Xi.None,retryConfig:u,retryCount:f};const c=this.getLevelSwitchAction(e,n);return u&&(c.retryConfig=u,c.retryCount=f),c}getLevelSwitchAction(e,t){const n=this.hls;t==null&&(t=n.loadLevel);const s=this.hls.levels[t];if(s){var r,a;const c=e.details;s.loadError++,c===ce.BUFFER_APPEND_ERROR&&s.fragmentError++;let d=-1;const{levels:p,loadLevel:m,minAutoLevel:y,maxAutoLevel:E}=n;!n.autoLevelEnabled&&!n.config.preserveManualLevelOnError&&(n.loadLevel=-1);const A=(r=e.frag)==null?void 0:r.type,x=(A===et.AUDIO&&c===ce.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(c===ce.BUFFER_ADD_CODEC_ERROR||c===ce.BUFFER_APPEND_ERROR))&&p.some(({audioCodec:U})=>s.audioCodec!==U),b=e.sourceBufferName==="video"&&(c===ce.BUFFER_ADD_CODEC_ERROR||c===ce.BUFFER_APPEND_ERROR)&&p.some(({codecSet:U,audioCodec:w})=>s.codecSet!==U&&s.audioCodec===w),{type:C,groupId:N}=(a=e.context)!=null?a:{};for(let U=p.length;U--;){const w=(U+m)%p.length;if(w!==m&&w>=y&&w<=E&&p[w].loadError===0){var u,f;const O=p[w];if(c===ce.FRAG_GAP&&A===et.MAIN&&e.frag){const L=p[w].details;if(L){const I=ia(e.frag,L.fragments,e.frag.start);if(I!=null&&I.gap)continue}}else{if(C===Nt.AUDIO_TRACK&&O.hasAudioGroup(N)||C===Nt.SUBTITLE_TRACK&&O.hasSubtitleGroup(N))continue;if(A===et.AUDIO&&(u=s.audioGroups)!=null&&u.some(L=>O.hasAudioGroup(L))||A===et.SUBTITLE&&(f=s.subtitleGroups)!=null&&f.some(L=>O.hasSubtitleGroup(L))||x&&s.audioCodec===O.audioCodec||b&&s.codecSet===O.codecSet||!x&&s.codecSet!==O.codecSet)continue}d=w;break}}if(d>-1&&n.loadLevel!==d)return e.levelRetry=!0,this.playlistError=0,{action:li.SendAlternateToPenaltyBox,flags:Xi.None,nextAutoLevel:d}}return{action:li.SendAlternateToPenaltyBox,flags:Xi.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var n;switch((n=t.errorAction)==null?void 0:n.action){case li.DoNothing:break;case li.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==ce.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,n=e.errorAction;if(!n)return;const{flags:s}=n,r=n.nextAutoLevel;switch(s){case Xi.None:this.switchLevel(e,r);break;case Xi.MoveAllAlternatesMatchingHDCP:{const f=this.getVariantLevelIndex(e.frag),c=t.levels[f],d=c==null?void 0:c.attrs["HDCP-LEVEL"];if(n.hdcpLevel=d,d==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(d){t.maxHdcpLevel=Cg[Cg.indexOf(d)-1],n.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case Xi.MoveAllAlternatesMatchingKey:{const f=e.decryptdata;if(f){const c=this.hls.levels,d=c.length;for(let m=d;m--;)if(this.variantHasKey(c[m],f)){var a,u;this.log(`Banned key found in level ${m} (${c[m].bitrate}bps) or audio group "${(a=c[m].audioGroups)==null?void 0:a.join(",")}" (${(u=e.frag)==null?void 0:u.type} fragment) ${ui(f.keyId||[])}`),c[m].fragmentError++,c[m].loadError++,this.log(`Removing level ${m} with key error (${e.error})`),this.hls.removeLevel(m)}const p=e.frag;if(this.hls.levels.length<d)n.resolved=!0;else if(p&&p.type!==et.MAIN){const m=p.decryptdata;m&&!f.matches(m)&&(n.resolved=!0)}}break}}n.resolved||this.switchLevel(e,r)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===ce.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const n=Mg(e.mimeType),s=this.hls.levels;for(let r=s.length;r--;)s[r][`${e.sourceBufferName}Codec`]===n&&(this.log(`Removing level ${r} for ${e.details} ("${n}" not supported)`),this.hls.removeLevel(r))}}}function ml(i){const e={action:li.DoNothing,flags:Xi.None};return i&&(e.resolved=!0),e}var Xn={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class VF{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(P.MANIFEST_LOADING,this.onManifestLoading,this),e.on(P.BUFFER_APPENDED,this.onBufferAppended,this),e.on(P.FRAG_BUFFERED,this.onFragBuffered,this),e.on(P.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(P.MANIFEST_LOADING,this.onManifestLoading,this),e.off(P.BUFFER_APPENDED,this.onBufferAppended,this),e.off(P.FRAG_BUFFERED,this.onFragBuffered,this),e.off(P.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const n=this.activePartLists[t];if(n)for(let s=n.length;s--;){const r=n[s];if(!r)break;if(r.start<=e&&e<=r.end&&r.loaded)return r}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,n){const{fragments:s}=this,r=Object.keys(s);for(let a=r.length;a--;){const u=s[r[a]];if((u==null?void 0:u.body.type)===t&&(!n||u.buffered)){const f=u.body;if(f.start<=e&&e<=f.end)return f}}return null}detectEvictedFragments(e,t,n,s,r){this.timeRanges&&(this.timeRanges[e]=t);const a=(s==null?void 0:s.fragment.sn)||-1;Object.keys(this.fragments).forEach(u=>{const f=this.fragments[u];if(!f||a>=f.body.sn)return;if(!f.buffered&&(!f.loaded||r)){f.body.type===n&&this.removeFragment(f.body);return}const c=f.range[e];if(c){if(c.time.length===0){this.removeFragment(f.body);return}c.time.some(d=>{const p=!this.isTimeBuffered(d.startPTS,d.endPTS,t);return p&&this.removeFragment(f.body),p})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const n=e.frag,s=Va(n),r=this.fragments[s];if(!r||r.buffered&&n.gap)return;const a=!n.relurl;Object.keys(t).forEach(u=>{const f=n.elementaryStreams[u];if(!f)return;const c=t[u],d=a||f.partial===!0;r.range[u]=this.getBufferedTimes(n,e.part,d,c)}),r.loaded=null,Object.keys(r.range).length?(this.bufferedEnd(r,n),Sf(r)||this.removeParts(n.sn-1,n.type)):this.removeFragment(r.body)}bufferedEnd(e,t){e.buffered=!0,(e.body.endList=t.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,t){const n=this.activePartLists[t];n&&(this.activePartLists[t]=lx(n,s=>s.fragment.sn>=e))}fragBuffered(e,t){const n=Va(e);let s=this.fragments[n];!s&&t&&(s=this.fragments[n]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),s&&(s.loaded=null,this.bufferedEnd(s,e))}getBufferedTimes(e,t,n,s){const r={time:[],partial:n},a=e.start,u=e.end,f=e.minEndPTS||u,c=e.maxStartPTS||a;for(let d=0;d<s.length;d++){const p=s.start(d)-this.bufferPadding,m=s.end(d)+this.bufferPadding;if(c>=p&&f<=m){r.time.push({startPTS:Math.max(a,s.start(d)),endPTS:Math.min(u,s.end(d))});break}else if(a<m&&u>p){const y=Math.max(a,s.start(d)),E=Math.min(u,s.end(d));E>y&&(r.partial=!0,r.time.push({startPTS:y,endPTS:E}))}else if(u<=p)break}return r}getPartialFragment(e){let t=null,n,s,r,a=0;const{bufferPadding:u,fragments:f}=this;return Object.keys(f).forEach(c=>{const d=f[c];d&&Sf(d)&&(s=d.body.start-u,r=d.body.end+u,e>=s&&e<=r&&(n=Math.min(e-s,r-e),a<=n&&(t=d.body,a=n)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||Sf(t))}getState(e){const t=Va(e),n=this.fragments[t];return n?n.buffered?Sf(n)?Xn.PARTIAL:Xn.OK:Xn.APPENDING:Xn.NOT_LOADED}isTimeBuffered(e,t,n){let s,r;for(let a=0;a<n.length;a++){if(s=n.start(a)-this.bufferPadding,r=n.end(a)+this.bufferPadding,e>=s&&t<=r)return!0;if(t<=s)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const n=t.frag,s=t.part?null:t,r=Va(n);this.fragments[r]={body:n,appendedPTS:null,loaded:s,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:n,part:s,timeRanges:r,type:a}=t;if(n.sn==="initSegment")return;const u=n.type;if(s){let c=this.activePartLists[u];c||(this.activePartLists[u]=c=[]),c.push(s)}this.timeRanges=r;const f=r[a];this.detectEvictedFragments(a,f,u,s)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=Va(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,n=Object.keys(t);if(!e)return n.length>0;for(let s=n.length;s--;){const r=t[n[s]];if((r==null?void 0:r.body.type)===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,n,s,r){s&&!this.hasGaps||Object.keys(this.fragments).forEach(a=>{const u=this.fragments[a];if(!u)return;const f=u.body;f.type!==n||s&&!f.gap||f.start<t&&f.end>e&&(u.buffered||r)&&this.removeFragment(f)})}removeFragment(e){const t=Va(e);e.clearElementaryStreamInfo();const n=this.activePartLists[e.type];if(n){const s=e.sn;this.activePartLists[e.type]=lx(n,r=>r.fragment.sn!==s)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(n=>n.clearElementaryStreamInfo())}}function Sf(i){var e,t,n;return i.buffered&&!!(i.body.gap||(e=i.range.video)!=null&&e.partial||(t=i.range.audio)!=null&&t.partial||(n=i.range.audiovideo)!=null&&n.partial)}function Va(i){return`${i.type}_${i.level}_${i.sn}`}function lx(i,e){return i.filter(t=>{const n=e(t);return n||t.clearElementaryStreamInfo(),n})}var vo={cbc:0,ctr:1};class HF{constructor(e,t,n){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=n}decrypt(e,t){switch(this.aesMode){case vo.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case vo.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function zF(i){const e=i.byteLength,t=e&&new DataView(i.buffer).getUint8(e-1);return t?i.slice(0,e-t):i}class $F{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),n=new Uint32Array(4);for(let s=0;s<4;s++)n[s]=t.getUint32(s*4);return n}initTable(){const e=this.sBox,t=this.invSBox,n=this.subMix,s=n[0],r=n[1],a=n[2],u=n[3],f=this.invSubMix,c=f[0],d=f[1],p=f[2],m=f[3],y=new Uint32Array(256);let E=0,A=0,S=0;for(S=0;S<256;S++)S<128?y[S]=S<<1:y[S]=S<<1^283;for(S=0;S<256;S++){let x=A^A<<1^A<<2^A<<3^A<<4;x=x>>>8^x&255^99,e[E]=x,t[x]=E;const M=y[E],b=y[M],C=y[b];let N=y[x]*257^x*16843008;s[E]=N<<24|N>>>8,r[E]=N<<16|N>>>16,a[E]=N<<8|N>>>24,u[E]=N,N=C*16843009^b*65537^M*257^E*16843008,c[x]=N<<24|N>>>8,d[x]=N<<16|N>>>16,p[x]=N<<8|N>>>24,m[x]=N,E?(E=M^y[y[y[C^M]]],A^=y[y[A]]):E=A=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let n=!0,s=0;for(;s<t.length&&n;)n=t[s]===this.key[s],s++;if(n)return;this.key=t;const r=this.keySize=t.length;if(r!==4&&r!==6&&r!==8)throw new Error("Invalid aes key size="+r);const a=this.ksRows=(r+6+1)*4;let u,f;const c=this.keySchedule=new Uint32Array(a),d=this.invKeySchedule=new Uint32Array(a),p=this.sBox,m=this.rcon,y=this.invSubMix,E=y[0],A=y[1],S=y[2],x=y[3];let M,b;for(u=0;u<a;u++){if(u<r){M=c[u]=t[u];continue}b=M,u%r===0?(b=b<<8|b>>>24,b=p[b>>>24]<<24|p[b>>>16&255]<<16|p[b>>>8&255]<<8|p[b&255],b^=m[u/r|0]<<24):r>6&&u%r===4&&(b=p[b>>>24]<<24|p[b>>>16&255]<<16|p[b>>>8&255]<<8|p[b&255]),c[u]=M=(c[u-r]^b)>>>0}for(f=0;f<a;f++)u=a-f,f&3?b=c[u]:b=c[u-4],f<4||u<=4?d[f]=b:d[f]=E[p[b>>>24]]^A[p[b>>>16&255]]^S[p[b>>>8&255]]^x[p[b&255]],d[f]=d[f]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,n){const s=this.keySize+6,r=this.invKeySchedule,a=this.invSBox,u=this.invSubMix,f=u[0],c=u[1],d=u[2],p=u[3],m=this.uint8ArrayToUint32Array_(n);let y=m[0],E=m[1],A=m[2],S=m[3];const x=new Int32Array(e),M=new Int32Array(x.length);let b,C,N,U,w,O,L,I,F,X,Y,ee,ne,V;const W=this.networkToHostOrderSwap;for(;t<x.length;){for(F=W(x[t]),X=W(x[t+1]),Y=W(x[t+2]),ee=W(x[t+3]),w=F^r[0],O=ee^r[1],L=Y^r[2],I=X^r[3],ne=4,V=1;V<s;V++)b=f[w>>>24]^c[O>>16&255]^d[L>>8&255]^p[I&255]^r[ne],C=f[O>>>24]^c[L>>16&255]^d[I>>8&255]^p[w&255]^r[ne+1],N=f[L>>>24]^c[I>>16&255]^d[w>>8&255]^p[O&255]^r[ne+2],U=f[I>>>24]^c[w>>16&255]^d[O>>8&255]^p[L&255]^r[ne+3],w=b,O=C,L=N,I=U,ne=ne+4;b=a[w>>>24]<<24^a[O>>16&255]<<16^a[L>>8&255]<<8^a[I&255]^r[ne],C=a[O>>>24]<<24^a[L>>16&255]<<16^a[I>>8&255]<<8^a[w&255]^r[ne+1],N=a[L>>>24]<<24^a[I>>16&255]<<16^a[w>>8&255]<<8^a[O&255]^r[ne+2],U=a[I>>>24]<<24^a[w>>16&255]<<16^a[O>>8&255]<<8^a[L&255]^r[ne+3],M[t]=W(b^y),M[t+1]=W(U^E),M[t+2]=W(N^A),M[t+3]=W(C^S),y=F,E=X,A=Y,S=ee,t=t+4}return M.buffer}}class qF{constructor(e,t,n){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=n}expandKey(){const e=WF(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function WF(i){switch(i){case vo.cbc:return"AES-CBC";case vo.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${i}`)}}const KF=16;class K0{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const n=self.crypto;n&&(this.subtle=n.subtle||n.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const n=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?zF(n):n}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,n,s){return this.useSoftware?new Promise((r,a)=>{const u=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(u,t,n,s);const f=this.flush();f?r(f.buffer):a(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,n,s)}softwareDecrypt(e,t,n,s){const{currentIV:r,currentResult:a,remainderData:u}=this;if(s!==vo.cbc||t.byteLength!==16)return an.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),u&&(e=ps(u,e),this.remainderData=null);const f=this.getValidChunk(e);if(!f.length)return null;r&&(n=r);let c=this.softwareDecrypter;c||(c=this.softwareDecrypter=new $F),c.expandKey(t);const d=a;return this.currentResult=c.decrypt(f.buffer,0,n),this.currentIV=f.slice(-16).buffer,d||null}webCryptoDecrypt(e,t,n,s){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,n,s));this.key=t,this.fastAesKey=new qF(this.subtle,t,s)}return this.fastAesKey.expandKey().then(r=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new HF(this.subtle,new Uint8Array(n),s).decrypt(e.buffer,r)):Promise.reject(new Error("web crypto not initialized"))).catch(r=>(an.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${r.name}: ${r.message}`),this.onWebCryptoError(e,t,n,s)))}onWebCryptoError(e,t,n,s){const r=this.enableSoftwareAES;if(r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,n,s);const a=this.flush();if(a)return a.buffer}throw new Error("WebCrypto"+(r?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const n=e.length-e.length%KF;return n!==e.length&&(t=e.slice(0,n),this.remainderData=e.slice(n)),t}logOnce(e){this.logEnabled&&(an.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const ux=Math.pow(2,17);class YF{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const n=e.url;if(!n)return Promise.reject(new _r({type:lt.NETWORK_ERROR,details:ce.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${n?"part list":"url"}`),networkDetails:null}));this.abort();const s=this.config,r=s.fLoader,a=s.loader;return new Promise((u,f)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(E=>E[0]==="GAP")){f(fx(e));return}else e.gap=!1;const c=this.loader=r?new r(s):new a(s),d=cx(e);e.loader=c;const p=ax(s.fragLoadPolicy.default),m={loadPolicy:p,timeout:p.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:ux};e.stats=c.stats;const y={onSuccess:(E,A,S,x)=>{this.resetLoader(e,c);let M=E.data;S.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(M.slice(0,16)),M=M.slice(16)),u({frag:e,part:null,payload:M,networkDetails:x})},onError:(E,A,S,x)=>{this.resetLoader(e,c),f(new _r({type:lt.NETWORK_ERROR,details:ce.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:on({url:n,data:void 0},E),error:new Error(`HTTP Error ${E.code} ${E.text}`),networkDetails:S,stats:x}))},onAbort:(E,A,S)=>{this.resetLoader(e,c),f(new _r({type:lt.NETWORK_ERROR,details:ce.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:S,stats:E}))},onTimeout:(E,A,S)=>{this.resetLoader(e,c),f(new _r({type:lt.NETWORK_ERROR,details:ce.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${m.timeout}ms`),networkDetails:S,stats:E}))}};t&&(y.onProgress=(E,A,S,x)=>t({frag:e,part:null,payload:S,networkDetails:x})),c.load(d,m,y)})}loadPart(e,t,n){this.abort();const s=this.config,r=s.fLoader,a=s.loader;return new Promise((u,f)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){f(fx(e,t));return}const c=this.loader=r?new r(s):new a(s),d=cx(e,t);e.loader=c;const p=ax(s.fragLoadPolicy.default),m={loadPolicy:p,timeout:p.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:ux};t.stats=c.stats,c.load(d,m,{onSuccess:(y,E,A,S)=>{this.resetLoader(e,c),this.updateStatsFromPart(e,t);const x={frag:e,part:t,payload:y.data,networkDetails:S};n(x),u(x)},onError:(y,E,A,S)=>{this.resetLoader(e,c),f(new _r({type:lt.NETWORK_ERROR,details:ce.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:on({url:d.url,data:void 0},y),error:new Error(`HTTP Error ${y.code} ${y.text}`),networkDetails:A,stats:S}))},onAbort:(y,E,A)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,c),f(new _r({type:lt.NETWORK_ERROR,details:ce.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:A,stats:y}))},onTimeout:(y,E,A)=>{this.resetLoader(e,c),f(new _r({type:lt.NETWORK_ERROR,details:ce.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${m.timeout}ms`),networkDetails:A,stats:y}))}})})}updateStatsFromPart(e,t){const n=e.stats,s=t.stats,r=s.total;if(n.loaded+=s.loaded,r){const f=Math.round(e.duration/t.duration),c=Math.min(Math.round(n.loaded/r),f),p=(f-c)*Math.round(n.loaded/c);n.total=n.loaded+p}else n.total=Math.max(n.loaded,n.total);const a=n.loading,u=s.loading;a.start?a.first+=u.first-u.start:(a.start=u.start,a.first=u.first),a.end=u.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function cx(i,e=null){const t=e||i,n={frag:i,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},s=t.byteRangeStartOffset,r=t.byteRangeEndOffset;if(Ye(s)&&Ye(r)){var a;let u=s,f=r;if(i.sn==="initSegment"&&XF((a=i.decryptdata)==null?void 0:a.method)){const c=r-s;c%16&&(f=r+(16-c%16)),s!==0&&(n.resetIV=!0,u=s-16)}n.rangeStart=u,n.rangeEnd=f}return n}function fx(i,e){const t=new Error(`GAP ${i.gap?"tag":"attribute"} found`),n={type:lt.MEDIA_ERROR,details:ce.FRAG_GAP,fatal:!1,frag:i,error:t,networkDetails:null};return e&&(n.part=e),(e||i).stats.aborted=!0,new _r(n)}function XF(i){return i==="AES-128"||i==="AES-256"}class _r extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class Tb extends ms{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class Y0{constructor(e,t,n,s=0,r=-1,a=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=Tf(),this.buffering={audio:Tf(),video:Tf(),audiovideo:Tf()},this.level=e,this.sn=t,this.id=n,this.size=s,this.part=r,this.partial=a}}function Tf(){return{start:0,executeStart:0,executeEnd:0,end:0}}const dx={length:0,start:()=>0,end:()=>0};class xt{static isBuffered(e,t){if(e){const n=xt.getBuffered(e);for(let s=n.length;s--;)if(t>=n.start(s)&&t<=n.end(s))return!0}return!1}static bufferedRanges(e){if(e){const t=xt.getBuffered(e);return xt.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let n=0;n<e.length;n++)t.push({start:e.start(n),end:e.end(n)});return t}static bufferInfo(e,t,n){if(e){const s=xt.bufferedRanges(e);if(s.length)return xt.bufferedInfo(s,t,n)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,n){t=Math.max(0,t),e.length>1&&e.sort((d,p)=>d.start-p.start||p.end-d.end);let s=-1,r=[];if(n)for(let d=0;d<e.length;d++){t>=e[d].start&&t<=e[d].end&&(s=d);const p=r.length;if(p){const m=r[p-1].end;e[d].start-m<n?e[d].end>m&&(r[p-1].end=e[d].end):r.push(e[d])}else r.push(e[d])}else r=e;let a=0,u,f=t,c=t;for(let d=0;d<r.length;d++){const p=r[d].start,m=r[d].end;if(s===-1&&t>=p&&t<=m&&(s=d),t+n>=p&&t<m)f=p,c=m,a=c-t;else if(t+n<p){u=p;break}}return{len:a,start:f||0,end:c||0,nextStart:u,buffered:e,bufferedIndex:s}}static getBuffered(e){try{return e.buffered||dx}catch(t){return an.log("failed to get media.buffered",t),dx}}}const xb=/\{\$([a-zA-Z0-9-_]+)\}/g;function hx(i){return xb.test(i)}function Lg(i,e){if(i.variableList!==null||i.hasVariableRefs){const t=i.variableList;return e.replace(xb,n=>{const s=n.substring(2,n.length-1),r=t==null?void 0:t[s];return r===void 0?(i.playlistParsingError||(i.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${s}"`)),n):r})}return e}function px(i,e,t){let n=i.variableList;n||(i.variableList=n={});let s,r;if("QUERYPARAM"in e){s=e.QUERYPARAM;try{const a=new self.URL(t).searchParams;if(a.has(s))r=a.get(s);else throw new Error(`"${s}" does not match any query parameter in URI: "${t}"`)}catch(a){i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${a.message}`))}}else s=e.NAME,r=e.VALUE;s in n?i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${s}"`)):n[s]=r||""}function JF(i,e,t){const n=e.IMPORT;if(t&&n in t){let s=i.variableList;s||(i.variableList=s={}),s[n]=t[n]}else i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${n}"`))}const QF=/^(\d+)x(\d+)$/,mx=/(.+?)=(".*?"|.*?)(?:,|$)/g;class Rn{constructor(e,t){typeof e=="string"&&(e=Rn.parseAttrList(e,t)),pn(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const n=new Uint8Array(t.length/2);for(let s=0;s<t.length/2;s++)n[s]=parseInt(t.slice(s*2,s*2+2),16);return n}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const n=this[e];return n?parseFloat(n):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const n=this[e];return(n?n.split(/[ ,]+/):[]).reduce((s,r)=>(s[r.toLowerCase()]=!0,s),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=QF.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let n;const s={};for(mx.lastIndex=0;(n=mx.exec(e))!==null;){const a=n[1].trim();let u=n[2];const f=u.indexOf('"')===0&&u.lastIndexOf('"')===u.length-1;let c=!1;if(f)u=u.slice(1,-1);else switch(a){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":c=!0}if(t&&(f||c))u=Lg(t,u);else if(!c&&!f)switch(a){case"CLOSED-CAPTIONS":if(u==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":an.warn(`${e}: attribute ${a} is missing quotes`)}s[a]=u}return s}}const ZF="com.apple.hls.interstitial";function jF(i){return i!=="ID"&&i!=="CLASS"&&i!=="CUE"&&i!=="START-DATE"&&i!=="DURATION"&&i!=="END-DATE"&&i!=="END-ON-NEXT"}function e2(i){return i==="SCTE35-OUT"||i==="SCTE35-IN"||i==="SCTE35-CMD"}class Ab{constructor(e,t,n=0){var s;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(t==null?void 0:t.tagAnchor)||null,this.tagOrder=(s=t==null?void 0:t.tagOrder)!=null?s:n,t){const r=t.attr;for(const a in r)if(Object.prototype.hasOwnProperty.call(e,a)&&e[a]!==r[a]){an.warn(`DATERANGE tag attribute: "${a}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=a;break}e=pn(new Rn({}),r,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const r=(t==null?void 0:t.endDate)||new Date(this.attr["END-DATE"]);Ye(r.getTime())&&(this._endDate=r)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(an.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(Ye(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===ZF}get isValid(){return!!this.id&&!this._badValueForSameId&&Ye(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const t2=10;class n2{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,n=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!n||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&n>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let n=t.decryptdata;return n||(t.setKeyFormat(e.keyFormat),n=t.decryptdata),!!n&&e.matches(n)})}get hasProgramDateTime(){return this.fragments.length?Ye(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||t2}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let n=e.length;n--;)if(e[n].index>t)return e[n].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function Dd(i,e){return i.length===e.length?!i.some((t,n)=>t!==e[n]):!1}function gx(i,e){return!i&&!e?!0:!i||!e?!1:Dd(i,e)}function gl(i){return i==="AES-128"||i==="AES-256"||i==="AES-256-CTR"}function X0(i){switch(i){case"AES-128":case"AES-256":return vo.cbc;case"AES-256-CTR":return vo.ctr;default:throw new Error(`invalid full segment method ${i}`)}}function J0(i){return Uint8Array.from(atob(i),e=>e.charCodeAt(0))}function Dg(i){return Uint8Array.from(unescape(encodeURIComponent(i)),e=>e.charCodeAt(0))}function i2(i){const e=Dg(i).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function Rb(i){const e=function(n,s,r){const a=n[s];n[s]=n[r],n[r]=a};e(i,0,3),e(i,1,2),e(i,4,5),e(i,6,7)}function bb(i){const e=i.split(":");let t=null;if(e[0]==="data"&&e.length===2){const n=e[1].split(";"),s=n[n.length-1].split(",");if(s.length===2){const r=s[0]==="base64",a=s[1];r?(n.splice(-1,1),t=J0(a)):t=i2(a)}}return t}const wd=typeof self<"u"?self:void 0;var bn={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},ci={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function ad(i){switch(i){case ci.FAIRPLAY:return bn.FAIRPLAY;case ci.PLAYREADY:return bn.PLAYREADY;case ci.WIDEVINE:return bn.WIDEVINE;case ci.CLEARKEY:return bn.CLEARKEY}}function gm(i){switch(i){case bn.FAIRPLAY:return ci.FAIRPLAY;case bn.PLAYREADY:return ci.PLAYREADY;case bn.WIDEVINE:return ci.WIDEVINE;case bn.CLEARKEY:return ci.CLEARKEY}}function Uu(i){const{drmSystems:e,widevineLicenseUrl:t}=i,n=e?[bn.FAIRPLAY,bn.WIDEVINE,bn.PLAYREADY,bn.CLEARKEY].filter(s=>!!e[s]):[];return!n[bn.WIDEVINE]&&t&&n.push(bn.WIDEVINE),n}const Mb=(function(i){return wd!=null&&(i=wd.navigator)!=null&&i.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null})();function s2(i,e,t,n){let s;switch(i){case bn.FAIRPLAY:s=["cenc","sinf"];break;case bn.WIDEVINE:case bn.PLAYREADY:s=["cenc"];break;case bn.CLEARKEY:s=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${i}`)}return r2(s,e,t,n)}function r2(i,e,t,n){return[{initDataTypes:i,persistentState:n.persistentState||"optional",distinctiveIdentifier:n.distinctiveIdentifier||"optional",sessionTypes:n.sessionTypes||[n.sessionType||"temporary"],audioCapabilities:e.map(r=>({contentType:`audio/mp4; codecs=${r}`,robustness:n.audioRobustness||"",encryptionScheme:n.audioEncryptionScheme||null})),videoCapabilities:t.map(r=>({contentType:`video/mp4; codecs=${r}`,robustness:n.videoRobustness||"",encryptionScheme:n.videoEncryptionScheme||null}))}]}function o2(i){var e;return!!i&&(i.sessionType==="persistent-license"||!!((e=i.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function Cb(i){const e=new Uint16Array(i.buffer,i.byteOffset,i.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),n=t.substring(t.indexOf("<"),t.length),a=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("KID")[0];if(a){const u=a.childNodes[0]?a.childNodes[0].nodeValue:a.getAttribute("VALUE");if(u){const f=J0(u).subarray(0,16);return Rb(f),f}}return null}let Ha={};class ho{static clearKeyUriToKeyIdMap(){Ha={}}static setKeyIdForUri(e,t){Ha[e]=t}static addKeyIdForUri(e){const t=Object.keys(Ha).length%Number.MAX_SAFE_INTEGER,n=new Uint8Array(16);return new DataView(n.buffer,12,4).setUint32(0,t),Ha[e]=n,n}constructor(e,t,n,s=[1],r=null,a){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=n,this.keyFormatVersions=s,this.iv=r,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!gl(e),a!=null&&a.startsWith("0x")&&(this.keyId=new Uint8Array(nb(a)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&Dd(e.keyFormatVersions,this.keyFormatVersions)&&gx(e.iv,this.iv)&&gx(e.keyId,this.keyId)}isSupported(){if(this.method){if(gl(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case ci.FAIRPLAY:case ci.WIDEVINE:case ci.PLAYREADY:case ci.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(gl(this.method)){let r=this.iv;return r||(typeof e!="number"&&(an.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),r=l2(e)),new ho(this.method,this.uri,"identity",this.keyFormatVersions,r)}if(this.keyId){const r=Ha[this.uri];if(r&&!Dd(this.keyId,r)&&ho.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const n=bb(this.uri);if(n)switch(this.keyFormat){case ci.WIDEVINE:if(this.pssh=n,!this.keyId){const r=fF(n.buffer);if(r.length){var s;const a=r[0];this.keyId=(s=a.kids)!=null&&s.length?a.kids[0]:null}}this.keyId||(this.keyId=vx(t));break;case ci.PLAYREADY:{const r=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=cF(r,null,n),this.keyId=Cb(n);break}default:{let r=n.subarray(0,16);if(r.length!==16){const a=new Uint8Array(16);a.set(r,16-r.length),r=a}this.keyId=r;break}}if(!this.keyId||this.keyId.byteLength!==16){let r;r=a2(t),r||(r=vx(t),r||(r=Ha[this.uri])),r&&(this.keyId=r,ho.setKeyIdForUri(this.uri,r))}return this}}function a2(i){const e=i==null?void 0:i[ci.WIDEVINE];return e?e.keyId:null}function vx(i){const e=i==null?void 0:i[ci.PLAYREADY];if(e){const t=bb(e.uri);if(t)return Cb(t)}return null}function l2(i){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=i>>8*(15-t)&255;return e}const yx=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,_x=/#EXT-X-MEDIA:(.*)/g,u2=/^#EXT(?:INF|-X-TARGETDURATION):/m,vm=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),c2=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Vs{static findGroup(e,t){for(let n=0;n<e.length;n++){const s=e[n];if(s.id===t)return s}}static resolve(e,t){return V0.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return u2.test(e)}static parseMasterPlaylist(e,t){const n=hx(e),s={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:n},r=[];if(yx.lastIndex=0,!e.startsWith("#EXTM3U"))return s.playlistParsingError=new Error("no EXTM3U delimiter"),s;let a;for(;(a=yx.exec(e))!=null;)if(a[1]){var u;const c=new Rn(a[1],s),d=Lg(s,a[2]),p={attrs:c,bitrate:c.decimalInteger("BANDWIDTH")||c.decimalInteger("AVERAGE-BANDWIDTH"),name:c.NAME,url:Vs.resolve(d,t)},m=c.decimalResolution("RESOLUTION");m&&(p.width=m.width,p.height=m.height),Tx(c.CODECS,p);const y=c["SUPPLEMENTAL-CODECS"];y&&(p.supplemental={},Tx(y,p.supplemental)),(u=p.unknownCodecs)!=null&&u.length||r.push(p),s.levels.push(p)}else if(a[3]){const c=a[3],d=a[4];switch(c){case"SESSION-DATA":{const p=new Rn(d,s),m=p["DATA-ID"];m&&(s.sessionData===null&&(s.sessionData={}),s.sessionData[m]=p);break}case"SESSION-KEY":{const p=Ex(d,t,s);p.encrypted&&p.isSupported()?(s.sessionKeys===null&&(s.sessionKeys=[]),s.sessionKeys.push(p)):an.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${d}"`);break}case"DEFINE":{{const p=new Rn(d,s);px(s,p,t)}break}case"CONTENT-STEERING":{const p=new Rn(d,s);s.contentSteering={uri:Vs.resolve(p["SERVER-URI"],t),pathwayId:p["PATHWAY-ID"]||"."};break}case"START":{s.startTimeOffset=Sx(d);break}}}const f=r.length>0&&r.length<s.levels.length;return s.levels=f?r:s.levels,s.levels.length===0&&(s.playlistParsingError=new Error("no levels found in manifest")),s}static parseMasterPlaylistMedia(e,t,n){let s;const r={},a=n.levels,u={AUDIO:a.map(c=>({id:c.attrs.AUDIO,audioCodec:c.audioCodec})),SUBTITLES:a.map(c=>({id:c.attrs.SUBTITLES,textCodec:c.textCodec})),"CLOSED-CAPTIONS":[]};let f=0;for(_x.lastIndex=0;(s=_x.exec(e))!==null;){const c=new Rn(s[1],n),d=c.TYPE;if(d){const p=u[d],m=r[d]||[];r[d]=m;const y=c.LANGUAGE,E=c["ASSOC-LANGUAGE"],A=c.CHANNELS,S=c.CHARACTERISTICS,x=c["INSTREAM-ID"],M={attrs:c,bitrate:0,id:f++,groupId:c["GROUP-ID"]||"",name:c.NAME||y||"",type:d,default:c.bool("DEFAULT"),autoselect:c.bool("AUTOSELECT"),forced:c.bool("FORCED"),lang:y,url:c.URI?Vs.resolve(c.URI,t):""};if(E&&(M.assocLang=E),A&&(M.channels=A),S&&(M.characteristics=S),x&&(M.instreamId=x),p!=null&&p.length){const b=Vs.findGroup(p,M.groupId)||p[0];xx(M,b,"audioCodec"),xx(M,b,"textCodec")}m.push(M)}}return r}static parseLevelPlaylist(e,t,n,s,r,a){var u;const f={url:t},c=new n2(t),d=c.fragments,p=[];let m=null,y=0,E=0,A=0,S=0,x=0,M=null,b=new hm(s,f),C,N,U,w=-1,O=!1,L=null,I;if(vm.lastIndex=0,c.m3u8=e,c.hasVariableRefs=hx(e),((u=vm.exec(e))==null?void 0:u[0])!=="#EXTM3U")return c.playlistParsingError=new Error("Missing format identifier #EXTM3U"),c;for(;(C=vm.exec(e))!==null;){O&&(O=!1,b=new hm(s,f),b.playlistOffset=A,b.setStart(A),b.sn=y,b.cc=S,x&&(b.bitrate=x),b.level=n,m&&(b.initSegment=m,m.rawProgramDateTime&&(b.rawProgramDateTime=m.rawProgramDateTime,m.rawProgramDateTime=null),L&&(b.setByteRange(L),L=null)));const ee=C[1];if(ee){b.duration=parseFloat(ee);const ne=(" "+C[2]).slice(1);b.title=ne||null,b.tagList.push(ne?["INF",ee,ne]:["INF",ee])}else if(C[3]){if(Ye(b.duration)){b.playlistOffset=A,b.setStart(A),U&&Rx(b,U,c),b.sn=y,b.level=n,b.cc=S,d.push(b);const ne=(" "+C[3]).slice(1);b.relurl=Lg(c,ne),wg(b,M,p),M=b,A+=b.duration,y++,E=0,O=!0}}else{if(C=C[0].match(c2),!C){an.warn("No matches on slow regex match for level playlist!");continue}for(N=1;N<C.length&&C[N]===void 0;N++);const ne=(" "+C[N]).slice(1),V=(" "+C[N+1]).slice(1),W=C[N+2]?(" "+C[N+2]).slice(1):null;switch(ne){case"BYTERANGE":M?b.setByteRange(V,M):b.setByteRange(V);break;case"PROGRAM-DATE-TIME":b.rawProgramDateTime=V,b.tagList.push(["PROGRAM-DATE-TIME",V]),w===-1&&(w=d.length);break;case"PLAYLIST-TYPE":c.type&&fr(c,ne,C),c.type=V.toUpperCase();break;case"MEDIA-SEQUENCE":c.startSN!==0?fr(c,ne,C):d.length>0&&bx(c,ne,C),y=c.startSN=parseInt(V);break;case"SKIP":{c.skippedSegments&&fr(c,ne,C);const q=new Rn(V,c),oe=q.decimalInteger("SKIPPED-SEGMENTS");if(Ye(oe)){c.skippedSegments+=oe;for(let G=oe;G--;)d.push(null);y+=oe}const he=q.enumeratedString("RECENTLY-REMOVED-DATERANGES");he&&(c.recentlyRemovedDateranges=(c.recentlyRemovedDateranges||[]).concat(he.split("	")));break}case"TARGETDURATION":c.targetduration!==0&&fr(c,ne,C),c.targetduration=Math.max(parseInt(V),1);break;case"VERSION":c.version!==null&&fr(c,ne,C),c.version=parseInt(V);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":c.live||fr(c,ne,C),c.live=!1;break;case"#":(V||W)&&b.tagList.push(W?[V,W]:[V]);break;case"DISCONTINUITY":S++,b.tagList.push(["DIS"]);break;case"GAP":b.gap=!0,b.tagList.push([ne]);break;case"BITRATE":b.tagList.push([ne,V]),x=parseInt(V)*1e3,Ye(x)?b.bitrate=x:x=0;break;case"DATERANGE":{const q=new Rn(V,c),oe=new Ab(q,c.dateRanges[q.ID],c.dateRangeTagCount);c.dateRangeTagCount++,oe.isValid||c.skippedSegments?c.dateRanges[oe.id]=oe:an.warn(`Ignoring invalid DATERANGE tag: "${V}"`),b.tagList.push(["EXT-X-DATERANGE",V]);break}case"DEFINE":{{const q=new Rn(V,c);"IMPORT"in q?JF(c,q,a):px(c,q,t)}break}case"DISCONTINUITY-SEQUENCE":c.startCC!==0?fr(c,ne,C):d.length>0&&bx(c,ne,C),c.startCC=S=parseInt(V);break;case"KEY":{const q=Ex(V,t,c);if(q.isSupported()){if(q.method==="NONE"){U=void 0;break}U||(U={});const oe=U[q.keyFormat];oe!=null&&oe.matches(q)||(oe&&(U=pn({},U)),U[q.keyFormat]=q)}else an.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${V}"`);break}case"START":c.startTimeOffset=Sx(V);break;case"MAP":{const q=new Rn(V,c);if(b.duration){const oe=new hm(s,f);Ax(oe,q,n,U),m=oe,b.initSegment=m,m.rawProgramDateTime&&!b.rawProgramDateTime&&(b.rawProgramDateTime=m.rawProgramDateTime)}else{const oe=b.byteRangeEndOffset;if(oe){const he=b.byteRangeStartOffset;L=`${oe-he}@${he}`}else L=null;Ax(b,q,n,U),m=b,O=!0}m.cc=S;break}case"SERVER-CONTROL":{I&&fr(c,ne,C),I=new Rn(V),c.canBlockReload=I.bool("CAN-BLOCK-RELOAD"),c.canSkipUntil=I.optionalFloat("CAN-SKIP-UNTIL",0),c.canSkipDateRanges=c.canSkipUntil>0&&I.bool("CAN-SKIP-DATERANGES"),c.partHoldBack=I.optionalFloat("PART-HOLD-BACK",0),c.holdBack=I.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{c.partTarget&&fr(c,ne,C);const q=new Rn(V);c.partTarget=q.decimalFloatingPoint("PART-TARGET");break}case"PART":{let q=c.partList;q||(q=c.partList=[]);const oe=E>0?q[q.length-1]:void 0,he=E++,G=new Rn(V,c),K=new JO(G,b,f,he,oe);q.push(K),b.duration+=K.duration;break}case"PRELOAD-HINT":{const q=new Rn(V,c);c.preloadHint=q;break}case"RENDITION-REPORT":{const q=new Rn(V,c);c.renditionReports=c.renditionReports||[],c.renditionReports.push(q);break}default:an.warn(`line parsed but not handled: ${C}`);break}}}M&&!M.relurl?(d.pop(),A-=M.duration,c.partList&&(c.fragmentHint=M)):c.partList&&(wg(b,M,p),b.cc=S,c.fragmentHint=b,U&&Rx(b,U,c)),c.targetduration||(c.playlistParsingError=new Error("Missing Target Duration"));const F=d.length,X=d[0],Y=d[F-1];if(A+=c.skippedSegments*c.targetduration,A>0&&F&&Y){c.averagetargetduration=A/F;const ee=Y.sn;c.endSN=ee!=="initSegment"?ee:0,c.live||(Y.endList=!0),w>0&&(d2(d,w),X&&p.unshift(X))}return c.fragmentHint&&(A+=c.fragmentHint.duration),c.totalduration=A,p.length&&c.dateRangeTagCount&&X&&Ib(p,c),c.endCC=S,c}}function Ib(i,e){let t=i.length;if(!t)if(e.hasProgramDateTime){const u=e.fragments[e.fragments.length-1];i.push(u),t++}else return;const n=i[t-1],s=e.live?1/0:e.totalduration,r=Object.keys(e.dateRanges);for(let u=r.length;u--;){const f=e.dateRanges[r[u]],c=f.startDate.getTime();f.tagAnchor=n.ref;for(let d=t;d--;){var a;if(((a=i[d])==null?void 0:a.sn)<e.startSN)break;const p=f2(e,c,i,d,s);if(p!==-1){f.tagAnchor=e.fragments[p].ref;break}}}}function f2(i,e,t,n,s){const r=t[n];if(r){const u=r.programDateTime;if(e>=u||n===0){var a;const f=(((a=t[n+1])==null?void 0:a.start)||s)-r.start;if(e<=u+f*1e3){const c=t[n].sn-i.startSN;if(c<0)return-1;const d=i.fragments;if(d.length>t.length){const m=(t[n+1]||d[d.length-1]).sn-i.startSN;for(let y=m;y>c;y--){const E=d[y].programDateTime;if(e>=E&&e<E+d[y].duration*1e3)return y}}return c}}}return-1}function Ex(i,e,t){var n,s;const r=new Rn(i,t),a=(n=r.METHOD)!=null?n:"",u=r.URI,f=r.hexadecimalInteger("IV"),c=r.KEYFORMATVERSIONS,d=(s=r.KEYFORMAT)!=null?s:"identity";u&&r.IV&&!f&&an.error(`Invalid IV: ${r.IV}`);const p=u?Vs.resolve(u,e):"",m=(c||"1").split("/").map(Number).filter(Number.isFinite);return new ho(a,p,d,m,f,r.KEYID)}function Sx(i){const t=new Rn(i).decimalFloatingPoint("TIME-OFFSET");return Ye(t)?t:null}function Tx(i,e){let t=(i||"").split(/[ ,]+/).filter(n=>n);["video","audio","text"].forEach(n=>{const s=t.filter(r=>$0(r,n));s.length&&(e[`${n}Codec`]=s.map(r=>r.split("/")[0]).join(","),t=t.filter(r=>s.indexOf(r)===-1))}),e.unknownCodecs=t}function xx(i,e,t){const n=e[t];n&&(i[t]=n)}function d2(i,e){let t=i[e];for(let n=e;n--;){const s=i[n];if(!s)return;s.programDateTime=t.programDateTime-s.duration*1e3,t=s}}function wg(i,e,t){i.rawProgramDateTime?t.push(i):e!=null&&e.programDateTime&&(i.programDateTime=e.endProgramDateTime)}function Ax(i,e,t,n){i.relurl=e.URI,e.BYTERANGE&&i.setByteRange(e.BYTERANGE),i.level=t,i.sn="initSegment",n&&(i.levelkeys=n),i.initSegment=null}function Rx(i,e,t){i.levelkeys=e;const{encryptedFragments:n}=t;(!n.length||n[n.length-1].levelkeys!==e)&&Object.keys(e).some(s=>e[s].isCommonEncryption)&&n.push(i)}function fr(i,e,t){i.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function bx(i,e,t){i.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function ym(i,e){const t=e.startPTS;if(Ye(t)){let n=0,s;e.sn>i.sn?(n=t-i.start,s=i):(n=i.start-t,s=e),s.duration!==n&&s.setDuration(n)}else e.sn>i.sn?i.cc===e.cc&&i.minEndPTS?e.setStart(i.start+(i.minEndPTS-i.start)):e.setStart(i.start+i.duration):e.setStart(Math.max(i.start-e.duration,0))}function Lb(i,e,t,n,s,r,a){n-t<=0&&(a.warn("Fragment should have a positive duration",e),n=t+e.duration,r=s+e.duration);let f=t,c=n;const d=e.startPTS,p=e.endPTS;if(Ye(d)){const x=Math.abs(d-t);i&&x>i.totalduration?a.warn(`media timestamps and playlist times differ by ${x}s for level ${e.level} ${i.url}`):Ye(e.deltaPTS)?e.deltaPTS=Math.max(x,e.deltaPTS):e.deltaPTS=x,f=Math.max(t,d),t=Math.min(t,d),s=e.startDTS!==void 0?Math.min(s,e.startDTS):s,c=Math.min(n,p),n=Math.max(n,p),r=e.endDTS!==void 0?Math.max(r,e.endDTS):r}const m=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(n-e.start),e.startPTS=t,e.maxStartPTS=f,e.startDTS=s,e.endPTS=n,e.minEndPTS=c,e.endDTS=r;const y=e.sn;if(!i||y<i.startSN||y>i.endSN)return 0;let E;const A=y-i.startSN,S=i.fragments;for(S[A]=e,E=A;E>0;E--)ym(S[E],S[E-1]);for(E=A;E<S.length-1;E++)ym(S[E],S[E+1]);return i.fragmentHint&&ym(S[S.length-1],i.fragmentHint),i.PTSKnown=i.alignedSliding=!0,m}function h2(i,e,t){if(i===e)return;let n=null;const s=i.fragments;for(let d=s.length-1;d>=0;d--){const p=s[d].initSegment;if(p){n=p;break}}i.fragmentHint&&delete i.fragmentHint.endPTS;let r;g2(i,e,(d,p,m,y)=>{if((!e.startCC||e.skippedSegments)&&p.cc!==d.cc){const E=d.cc-p.cc;for(let A=m;A<y.length;A++)y[A].cc+=E;e.endCC=y[y.length-1].cc}Ye(d.startPTS)&&Ye(d.endPTS)&&(p.setStart(p.startPTS=d.startPTS),p.startDTS=d.startDTS,p.maxStartPTS=d.maxStartPTS,p.endPTS=d.endPTS,p.endDTS=d.endDTS,p.minEndPTS=d.minEndPTS,p.setDuration(d.endPTS-d.startPTS),p.duration&&(r=p),e.PTSKnown=e.alignedSliding=!0),d.hasStreams&&(p.elementaryStreams=d.elementaryStreams),p.loader=d.loader,d.hasStats&&(p.stats=d.stats),d.initSegment&&(p.initSegment=d.initSegment,n=d.initSegment)});const a=e.fragments,u=e.fragmentHint?a.concat(e.fragmentHint):a;if(n&&u.forEach(d=>{var p;d&&(!d.initSegment||d.initSegment.relurl===((p=n)==null?void 0:p.relurl))&&(d.initSegment=n)}),e.skippedSegments){if(e.deltaUpdateFailed=a.some(d=>!d),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let d=e.skippedSegments;d--;)a.shift();e.startSN=a[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=p2(i.dateRanges,e,t));const d=i.fragments.filter(p=>p.rawProgramDateTime);if(i.hasProgramDateTime&&!e.hasProgramDateTime)for(let p=1;p<u.length;p++)u[p].programDateTime===null&&wg(u[p],u[p-1],d);Ib(d,e)}e.endCC=a[a.length-1].cc}if(!e.startCC){var f;const d=Pb(i,e.startSN-1);e.startCC=(f=d==null?void 0:d.cc)!=null?f:a[0].cc}m2(i.partList,e.partList,(d,p)=>{p.elementaryStreams=d.elementaryStreams,p.stats=d.stats}),r?Lb(e,r,r.startPTS,r.endPTS,r.startDTS,r.endDTS,t):Db(i,e),a.length&&(e.totalduration=e.edge-a[0].start),e.driftStartTime=i.driftStartTime,e.driftStart=i.driftStart;const c=e.advancedDateTime;if(e.advanced&&c){const d=e.edge;e.driftStart||(e.driftStartTime=c,e.driftStart=d),e.driftEndTime=c,e.driftEnd=d}else e.driftEndTime=i.driftEndTime,e.driftEnd=i.driftEnd,e.advancedDateTime=i.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=i.requestScheduled)}function p2(i,e,t){const{dateRanges:n,recentlyRemovedDateranges:s}=e,r=pn({},i);s&&s.forEach(f=>{delete r[f]});const u=Object.keys(r).length;return u?(Object.keys(n).forEach(f=>{const c=r[f],d=new Ab(n[f].attr,c);d.isValid?(r[f]=d,c||(d.tagOrder+=u)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${yn(n[f].attr)}"`)}),r):n}function m2(i,e,t){if(i&&e){let n=0;for(let s=0,r=i.length;s<=r;s++){const a=i[s],u=e[s+n];a&&u&&a.index===u.index&&a.fragment.sn===u.fragment.sn?t(a,u):n--}}}function g2(i,e,t){const n=e.skippedSegments,s=Math.max(i.startSN,e.startSN)-e.startSN,r=(i.fragmentHint?1:0)+(n?e.endSN:Math.min(i.endSN,e.endSN))-e.startSN,a=e.startSN-i.startSN,u=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,f=i.fragmentHint?i.fragments.concat(i.fragmentHint):i.fragments;for(let c=s;c<=r;c++){const d=f[a+c];let p=u[c];if(n&&!p&&d&&(p=e.fragments[c]=d),d&&p){t(d,p,c,u);const m=d.relurl,y=p.relurl;if(m&&v2(m,y)){e.playlistParsingError=Mx(`media sequence mismatch ${p.sn}:`,i,e,d,p);return}else if(d.cc!==p.cc){e.playlistParsingError=Mx(`discontinuity sequence mismatch (${d.cc}!=${p.cc})`,i,e,d,p);return}}}}function Mx(i,e,t,n,s){return new Error(`${i} ${s.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function Db(i,e,t=!0){const n=e.startSN+e.skippedSegments-i.startSN,s=i.fragments,r=n>=0;let a=0;if(r&&n<s.length)a=s[n].start;else if(r&&e.startSN===i.endSN+1)a=i.fragmentEnd;else if(r&&t)a=i.fragmentStart+n*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)a=i.fragmentStart;else return;Pg(e,a)}function Pg(i,e){if(e){const t=i.fragments;for(let n=i.skippedSegments;n<t.length;n++)t[n].addStart(e);i.fragmentHint&&i.fragmentHint.addStart(e)}}function wb(i,e=1/0){let t=1e3*i.targetduration;if(i.updated){const n=i.fragments;if(n.length&&t*4>e){const r=n[n.length-1].duration*1e3;r<t&&(t=r)}}else t/=2;return Math.round(t)}function Pb(i,e,t){if(!i)return null;let n=i.fragments[e-i.startSN];return n||(n=i.fragmentHint,n&&n.sn===e)?n:e<i.startSN&&t&&t.sn===e?t:null}function Cx(i,e,t){return i?Nb(i.partList,e,t):null}function Nb(i,e,t){if(i)for(let n=i.length;n--;){const s=i[n];if(s.index===t&&s.fragment.sn===e)return s}return null}function Ub(i){i.forEach((e,t)=>{var n;(n=e.details)==null||n.fragments.forEach(s=>{s.level=t,s.initSegment&&(s.initSegment.level=t)})})}function v2(i,e){return i!==e&&e?Ix(i)!==Ix(e):!1}function Ix(i){return i.replace(/\?[^?]*$/,"")}function Fu(i,e){for(let n=0,s=i.length;n<s;n++){var t;if(((t=i[n])==null?void 0:t.cc)===e)return i[n]}return null}function y2(i,e){return!!(i&&e.startCC<i.endCC&&e.endCC>i.startCC)}function Lx(i,e){const t=i.start+e;i.startPTS=t,i.setStart(t),i.endPTS=t+i.duration}function Ob(i,e){const t=e.fragments;for(let n=0,s=t.length;n<s;n++)Lx(t[n],i);e.fragmentHint&&Lx(e.fragmentHint,i),e.alignedSliding=!0}function _2(i,e){i&&(Fb(e,i),e.alignedSliding||Pd(e,i),!e.alignedSliding&&!e.skippedSegments&&Db(i,e,!1))}function Fb(i,e){if(!y2(e,i))return;const t=Math.min(e.endCC,i.endCC),n=Fu(e.fragments,t),s=Fu(i.fragments,t);if(!n||!s)return;an.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const r=n.start-s.start;Ob(r,i)}function Pd(i,e){if(!i.hasProgramDateTime||!e.hasProgramDateTime)return;const t=i.fragments,n=e.fragments;if(!t.length||!n.length)return;let s,r;const a=Math.min(e.endCC,i.endCC);e.startCC<a&&i.startCC<a&&(s=Fu(n,a),r=Fu(t,a)),(!s||!r)&&(s=n[Math.floor(n.length/2)],r=Fu(t,s.cc)||t[Math.floor(t.length/2)]);const u=s.programDateTime,f=r.programDateTime;if(!u||!f)return;const c=(f-u)/1e3-(r.start-s.start);Ob(c,i)}function Ti(i,e,t){Ui(i,e,t),i.addEventListener(e,t)}function Ui(i,e,t){i.removeEventListener(e,t)}const E2={toString:function(i){let e="";const t=i.length;for(let n=0;n<t;n++)e+=`[${i.start(n).toFixed(3)}-${i.end(n).toFixed(3)}]`;return e}},Ce={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class Q0 extends Tb{constructor(e,t,n,s,r){super(s,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=Ce.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:a,fragCurrent:u,media:f,mediaBuffer:c,state:d}=this,p=f?f.currentTime:0,m=xt.bufferInfo(c||f,p,a.maxBufferHole),y=!m.len;if(this.log(`Media seeking to ${Ye(p)?p.toFixed(3):p}, state: ${d}, ${y?"out of":"in"} buffer`),this.state===Ce.ENDED)this.resetLoadingState();else if(u){const E=a.maxFragLookUpTolerance,A=u.start-E,S=u.start+u.duration+E;if(y||S<m.start||A>m.end){const x=p>S;(p<A||x)&&(x&&u.loader&&(this.log(`Cancelling fragment load for seek (sn: ${u.sn})`),u.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(f){this.fragmentTracker.removeFragmentsInRange(p,1/0,this.playlistType,!0);const E=this.lastCurrentTime;if(p>E&&(this.lastCurrentTime=p),!this.loadingParts){const A=Math.max(m.end,p),S=this.shouldLoadParts(this.getLevelDetails(),A);S&&(this.log(`LL-Part loading ON after seeking to ${p.toFixed(2)} with buffer @${A.toFixed(2)}`),this.loadingParts=S)}}this.hls.hasEnoughToStart||(this.log(`Setting ${y?"startPosition":"nextLoadPosition"} to ${p} for seek without enough to start`),this.nextLoadPosition=p,y&&(this.startPosition=p)),y&&this.state===Ce.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=r,this.hls=e,this.fragmentLoader=new YF(e.config),this.keyLoader=n,this.fragmentTracker=t,this.config=e.config,this.decrypter=new K0(e.config)}registerListeners(){const{hls:e}=this;e.on(P.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(P.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(P.MANIFEST_LOADING,this.onManifestLoading,this),e.on(P.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(P.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(P.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(P.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(P.MANIFEST_LOADING,this.onManifestLoading,this),e.off(P.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(P.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===Ce.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=Ce.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const n=e.end||0,s=this.config.timelineOffset||0;if(n<=s)return!1;const r=e.buffered;this.config.maxBufferHole&&r&&r.length>1&&(e=xt.bufferedInfo(r,e.start,0));const a=e.nextStart;if(a&&a>s&&a<t.edge||this.media.currentTime<e.start)return!1;const f=t.partList;if(f!=null&&f.length){const d=f[f.length-1];return xt.isBuffered(this.media,d.start+d.duration/2)}const c=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(c)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const n=this.media=this.mediaBuffer=t.media;Ti(n,"seeking",this.onMediaSeeking),Ti(n,"ended",this.onMediaEnded);const s=this.config;this.levels&&s.autoStartLoad&&this.state===Ce.STOPPED&&this.startLoad(s.startPosition)}onMediaDetaching(e,t){const n=!!t.transferMedia,s=this.media;if(s!==null){if(s.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),Ui(s,"seeking",this.onMediaSeeking),Ui(s,"ended",this.onMediaEnded),this.keyLoader&&!n&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,n){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=Ce.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,n){this.startFragRequested=!0,this._loadFragForPlayback(e,t,n)}_loadFragForPlayback(e,t,n){const s=r=>{const a=r.frag;if(this.fragContextChanged(a)){this.warn(`${a.type} sn: ${a.sn}${r.part?" part: "+r.part.index:""} of ${this.fragInfo(a,!1,r.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(a);return}a.stats.chunkCount++,this._handleFragmentLoadProgress(r)};this._doFragLoad(e,t,n,s).then(r=>{if(!r)return;const a=this.state,u=r.frag;if(this.fragContextChanged(u)){(a===Ce.FRAG_LOADING||!this.fragCurrent&&a===Ce.PARSING)&&(this.fragmentTracker.removeFragment(u),this.state=Ce.IDLE);return}"payload"in r&&(this.log(`Loaded ${u.type} sn: ${u.sn} of ${this.playlistLabel()} ${u.level}`),this.hls.trigger(P.FRAG_LOADED,r)),this._handleFragmentLoadComplete(r)}).catch(r=>{this.state===Ce.STOPPED||this.state===Ce.ERROR||(this.warn(`Frag error: ${(r==null?void 0:r.message)||r}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:n}=this;if(n.getState(e)===Xn.APPENDING){const r=e.type,a=this.getFwdBufferInfo(this.mediaBuffer,r),u=Math.max(e.duration,a?a.len:this.config.maxBufferLength),f=this.backtrackFragment;((f?e.sn-f.sn:0)===1||this.reduceMaxBufferLength(u,e.duration))&&n.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?n.removeAllFragments():n.hasParts(e.type)&&(n.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),n.getState(e)===Xn.PARTIAL&&n.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(t==null?void 0:t.live)&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,n=null){if(!(e-t))return;const s={startOffset:e,endOffset:t,type:n};this.hls.trigger(P.BUFFER_FLUSHING,s)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(n=>{const s=n==null?void 0:n.frag;if(!s||this.fragContextChanged(s)||!this.levels)throw new Error("init load aborted");return n}).then(n=>{const{hls:s}=this,{frag:r,payload:a}=n,u=r.decryptdata;if(a&&a.byteLength>0&&u!=null&&u.key&&u.iv&&gl(u.method)){const f=self.performance.now();return this.decrypter.decrypt(new Uint8Array(a),u.key.buffer,u.iv.buffer,X0(u.method)).catch(c=>{throw s.trigger(P.ERROR,{type:lt.MEDIA_ERROR,details:ce.FRAG_DECRYPT_ERROR,fatal:!1,error:c,reason:c.message,frag:r}),c}).then(c=>{const d=self.performance.now();return s.trigger(P.FRAG_DECRYPTED,{frag:r,payload:c,stats:{tstart:f,tdecrypt:d}}),n.payload=c,this.completeInitSegmentLoad(n)})}return this.completeInitSegmentLoad(n)}).catch(n=>{this.state===Ce.STOPPED||this.state===Ce.ERROR||(this.warn(n),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const n=e.frag.stats;this.state!==Ce.STOPPED&&(this.state=Ce.IDLE),e.frag.data=new Uint8Array(e.payload),n.parsing.start=n.buffering.start=self.performance.now(),n.parsing.end=n.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var n,s;const r=e.tracks;if(r&&!t.encrypted&&((n=r.audio)!=null&&n.encrypted||(s=r.video)!=null&&s.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const a=this.media,u=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${a?"attached mediaKeys: "+a.mediaKeys:"detached"})`);return this.warn(u.message),!a||a.mediaKeys?!1:(this.hls.trigger(P.ERROR,{type:lt.KEY_SYSTEM_ERROR,details:ce.KEY_SYSTEM_NO_KEYS,fatal:!1,error:u,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const n=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${n?E2.toString(xt.getBuffered(n)):"(detached)"})`),Nn(e)){var s;if(e.type!==et.SUBTITLE){const a=e.elementaryStreams;if(!Object.keys(a).some(u=>!!a[u])){this.state=Ce.IDLE;return}}const r=(s=this.levels)==null?void 0:s[e.level];r!=null&&r.fragmentError&&(this.log(`Resetting level fragment error count of ${r.fragmentError} on frag buffered`),r.fragmentError=0)}this.state=Ce.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:n,part:s,partsLoaded:r}=e,a=!r||r.length===0||r.some(f=>!f),u=new Y0(n.level,n.sn,n.stats.chunkCount+1,0,s?s.index:-1,!a);t.flush(u)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,n=null,s){var r;this.fragCurrent=e;const a=t.details;if(!this.levels||!a)throw new Error(`frag load aborted, missing level${a?"":" detail"}s`);let u=null;if(e.encrypted&&!((r=e.decryptdata)!=null&&r.key)){if(this.log(`Loading key for ${e.sn} of [${a.startSN}-${a.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=Ce.KEY_LOADING,this.fragCurrent=e,u=this.keyLoader.load(e).then(m=>{if(!this.fragContextChanged(m.frag))return this.hls.trigger(P.KEY_LOADED,m),this.state===Ce.KEY_LOADING&&(this.state=Ce.IDLE),m}),this.hls.trigger(P.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(u=this.keyLoader.loadClear(e,a.encryptedFragments,this.startFragRequested),u&&this.log("[eme] blocking frag load until media-keys acquired"));const f=this.fragPrevious;if(Nn(e)&&(!f||e.sn!==f.sn)){const m=this.shouldLoadParts(t.details,e.end);m!==this.loadingParts&&(this.log(`LL-Part loading ${m?"ON":"OFF"} loading sn ${f==null?void 0:f.sn}->${e.sn}`),this.loadingParts=m)}if(n=Math.max(e.start,n||0),this.loadingParts&&Nn(e)){const m=a.partList;if(m&&s){n>a.fragmentEnd&&a.fragmentHint&&(e=a.fragmentHint);const y=this.getNextPart(m,e,n);if(y>-1){const E=m[y];e=this.fragCurrent=E.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${E.index} (${y}/${m.length-1}) of ${this.fragInfo(e,!1,E)}) cc: ${e.cc} [${a.startSN}-${a.endSN}], target: ${parseFloat(n.toFixed(3))}`),this.nextLoadPosition=E.start+E.duration,this.state=Ce.FRAG_LOADING;let A;return u?A=u.then(S=>!S||this.fragContextChanged(S.frag)?null:this.doFragPartsLoad(e,E,t,s)).catch(S=>this.handleFragLoadError(S)):A=this.doFragPartsLoad(e,E,t,s).catch(S=>this.handleFragLoadError(S)),this.hls.trigger(P.FRAG_LOADING,{frag:e,part:E,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):A}else if(!e.url||this.loadedEndOfParts(m,n))return Promise.resolve(null)}}if(Nn(e)&&this.loadingParts){var c;this.log(`LL-Part loading OFF after next part miss @${n.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(c=a.partList)==null?void 0:c.filter(m=>m.loaded).map(m=>`[${m.start}-${m.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+a.startSN+"-"+a.endSN+"]"}, target: ${parseFloat(n.toFixed(3))}`),Ye(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=Ce.FRAG_LOADING;const d=this.config.progressive&&e.type!==et.SUBTITLE;let p;return d&&u?p=u.then(m=>!m||this.fragContextChanged(m.frag)?null:this.fragmentLoader.load(e,s)).catch(m=>this.handleFragLoadError(m)):p=Promise.all([this.fragmentLoader.load(e,d?s:void 0),u]).then(([m])=>(!d&&s&&s(m),m)).catch(m=>this.handleFragLoadError(m)),this.hls.trigger(P.FRAG_LOADING,{frag:e,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):p}doFragPartsLoad(e,t,n,s){return new Promise((r,a)=>{var u;const f=[],c=(u=n.details)==null?void 0:u.partList,d=p=>{this.fragmentLoader.loadPart(e,p,s).then(m=>{f[p.index]=m;const y=m.part;this.hls.trigger(P.FRAG_LOADED,m);const E=Cx(n.details,e.sn,p.index+1)||Nb(c,e.sn,p.index+1);if(E)d(E);else return r({frag:e,part:y,partsLoaded:f})}).catch(a)};d(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===ce.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===lt.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(P.ERROR,t)}else this.hls.trigger(P.ERROR,{type:lt.OTHER_ERROR,details:ce.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==Ce.PARSING){!this.fragCurrent&&this.state!==Ce.STOPPED&&this.state!==Ce.ERROR&&(this.state=Ce.IDLE);return}const{frag:n,part:s,level:r}=t,a=self.performance.now();n.stats.parsing.end=a,s&&(s.stats.parsing.end=a);const u=this.getLevelDetails(),c=u&&n.sn>u.endSN||this.shouldLoadParts(u,n.end);c!==this.loadingParts&&(this.log(`LL-Part loading ${c?"ON":"OFF"} after parsing segment ending @${n.end.toFixed(2)}`),this.loadingParts=c),this.updateLevelTiming(n,s,r,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var n;const r=e.partList[0];if(r.fragment.type===et.SUBTITLE)return!1;const a=r.end+(((n=e.fragmentHint)==null?void 0:n.duration)||0);if(t>=a){var s;if((this.hls.hasEnoughToStart?((s=this.media)==null?void 0:s.currentTime)||this.lastCurrentTime:this.getLoadPosition())>r.start-r.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:n}=this,{level:s,sn:r,part:a}=e;if(!(t!=null&&t[s]))return this.warn(`Levels object was unset while buffering fragment ${r} of ${this.playlistLabel()} ${s}. The current chunk will not be buffered.`),null;const u=t[s],f=u.details,c=a>-1?Cx(f,r,a):null,d=c?c.fragment:Pb(f,r,n);return d?(n&&n!==d&&(d.stats=n.stats),{frag:d,part:c,level:u}):null}bufferFragmentData(e,t,n,s,r){if(this.state!==Ce.PARSING)return;const{data1:a,data2:u}=e;let f=a;if(u&&(f=ps(a,u)),!f.length)return;const c=this.initPTS[t.cc],d=c?-c.baseTime/c.timescale:void 0,p={type:e.type,frag:t,part:n,chunkMeta:s,offset:d,parent:t.type,data:f};if(this.hls.trigger(P.BUFFER_APPENDING,p),e.dropped&&e.independent&&!n){if(r)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!xt.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const n=t.currentTime,s=xt.bufferInfo(t,n,0),r=e.duration,a=Math.min(this.config.maxFragLookUpTolerance*2,r*.25),u=Math.max(Math.min(e.start-a,s.end-a),n+a);e.start-u>a&&this.flushMainBuffer(u,e.start)}getFwdBufferInfo(e,t){var n;const s=this.getLoadPosition();if(!Ye(s))return null;const a=this.lastCurrentTime>s||(n=this.media)!=null&&n.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,s,t,a)}getFwdBufferInfoAtPos(e,t,n,s){const r=xt.bufferInfo(e,t,s);if(r.len===0&&r.nextStart!==void 0){const a=this.fragmentTracker.getBufferedFrag(t,n);if(a&&(r.nextStart<=a.end||a.gap)){const u=Math.max(Math.min(r.nextStart,a.end)-t,s);return xt.bufferInfo(e,t,u)}}return r}getMaxBufferLength(e){const{config:t}=this;let n;return e?n=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):n=t.maxBufferLength,Math.min(n,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const n=this.config,s=Math.max(Math.min(e-t,n.maxBufferLength),t),r=Math.max(e-t*3,n.maxMaxBufferLength/2,s);return r>=s?(n.maxMaxBufferLength=r,this.warn(`Reduce max buffer length to ${r}s`),!0):!1}getAppendedFrag(e,t=et.MAIN){const n=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return n&&"fragment"in n?n.fragment:n}getNextFragment(e,t){const n=t.fragments,s=n.length;if(!s)return null;const{config:r}=this,a=n[0].start,u=r.lowLatencyMode&&!!t.partList;let f=null;if(t.live){const p=r.initialLiveManifestSize;if(s<p)return this.warn(`Not enough fragments to start playback (have: ${s}, need: ${p})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<a){var c;u&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),f=this.getInitialLiveFragment(t);const m=this.hls.startPosition,y=this.hls.liveSyncPosition,E=f?(m!==-1&&m>=a?m:y)||f.start:e;this.log(`Setting startPosition to ${E} to match start frag at live edge. mainStart: ${m} liveSyncPosition: ${y} frag.start: ${(c=f)==null?void 0:c.start}`),this.startPosition=this.nextLoadPosition=E}}else e<=a&&(f=n[0]);if(!f){const p=this.loadingParts?t.partEnd:t.fragmentEnd;f=this.getFragmentAtPosition(e,p,t)}let d=this.filterReplacedPrimary(f,t);if(!d&&f){const p=f.sn-t.startSN;d=this.filterReplacedPrimary(n[p+1]||null,t)}return this.mapToInitFragWhenRequired(d)}isLoopLoading(e,t){const n=this.fragmentTracker.getState(e);return(n===Xn.OK||n===Xn.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,n,s,r){let a=null;if(e.gap&&(a=this.getNextFragment(this.nextLoadPosition,t),a&&!a.gap&&n.nextStart)){const u=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,n.nextStart,s,0);if(u!==null&&n.len+u.len>=r){const f=a.sn;return this.loopSn!==f&&(this.log(`buffer full after gaps in "${s}" playlist starting at sn: ${f}`),this.loopSn=f),null}}return this.loopSn=void 0,a}get primaryPrefetch(){if(Dx(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(Dx(this.config)&&e.type!==et.SUBTITLE){const n=this.hls.interstitialsManager,s=n==null?void 0:n.bufferingItem;if(s){const a=s.event;if(a){if(a.appendInPlace||Math.abs(e.start-s.start)>1||s.start===0)return null}else if(e.end<=s.start&&(t==null?void 0:t.live)===!1||e.start>s.end&&s.nextEvent&&(s.nextEvent.appendInPlace||e.start-s.end>1))return null}const r=n==null?void 0:n.playerQueue;if(r)for(let a=r.length;a--;){const u=r[a].interstitial;if(u.appendInPlace&&e.start>=u.startTime&&e.end<=u.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,n){let s=-1,r=!1,a=!0;for(let u=0,f=e.length;u<f;u++){const c=e[u];if(a=a&&!c.independent,s>-1&&n<c.start)break;const d=c.loaded;d?s=-1:(r||(c.independent||a)&&c.fragment===t)&&(c.fragment!==t&&this.warn(`Need buffer at ${n} but next unloaded part starts at ${c.start}`),s=u),r=d}return s}loadedEndOfParts(e,t){let n;for(let s=e.length;s--;){if(n=e[s],!n.loaded)return!1;if(t>n.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,n=this.fragPrevious;let s=null;if(n){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${n.programDateTime}`),s=OF(t,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),!s){const r=n.sn+1;if(r>=e.startSN&&r<=e.endSN){const a=t[r-e.startSN];n.cc===a.cc&&(s=a,this.log(`Live playlist, switching playlist, load frag with next SN: ${s.sn}`))}s||(s=_b(e,n.cc,n.end),s&&this.log(`Live playlist, switching playlist, load frag with same CC: ${s.sn}`))}}else{const r=this.hls.liveSyncPosition;r!==null&&(s=this.getFragmentAtPosition(r,this.bitrateTest?e.fragmentEnd:e.edge,e))}return s}getFragmentAtPosition(e,t,n){const{config:s}=this;let{fragPrevious:r}=this,{fragments:a,endSN:u}=n;const{fragmentHint:f}=n,{maxFragLookUpTolerance:c}=s,d=n.partList,p=!!(this.loadingParts&&d!=null&&d.length&&f);p&&!this.bitrateTest&&d[d.length-1].fragment.sn===f.sn&&(a=a.concat(f),u=f.sn);let m;if(e<t){var y;const A=e<this.lastCurrentTime||e>t-c||(y=this.media)!=null&&y.paused||!this.startFragRequested?0:c;m=ia(r,a,e,A)}else m=a[a.length-1];if(m){const E=m.sn-n.startSN,A=this.fragmentTracker.getState(m);if((A===Xn.OK||A===Xn.PARTIAL&&m.gap)&&(r=m),r&&m.sn===r.sn&&(!p||d[0].fragment.sn>m.sn||!n.live)&&m.level===r.level){const x=a[E+1];m.sn<u&&this.fragmentTracker.getState(x)!==Xn.OK?m=x:m=null}}return m}alignPlaylists(e,t,n){const s=e.fragments.length;if(!s)return this.warn("No fragments in live playlist"),0;const r=e.fragmentStart,a=!t,u=e.alignedSliding&&Ye(r);if(a||!u&&!r){_2(n,e);const f=e.fragmentStart;return this.log(`Live playlist sliding: ${f.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${s}`),f}return r}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let n=this.startPosition;n<t&&(n=-1);const s=this.timelineOffset;if(n===-1){const r=this.startTimeOffset!==null,a=r?this.startTimeOffset:e.startTimeOffset;a!==null&&Ye(a)?(n=t+a,a<0&&(n+=e.edge),n=Math.min(Math.max(t,n),t+e.totalduration),this.log(`Setting startPosition to ${n} for start time offset ${a} found in ${r?"multivariant":"media"} playlist`),this.startPosition=n):e.live?(n=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${n}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=n=0),this.lastCurrentTime=n+s}this.nextLoadPosition=n+s}getLoadPosition(){var e;const{media:t}=this;let n=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?n=t.currentTime:this.nextLoadPosition>=0&&(n=this.nextLoadPosition),n}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&Nn(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==Ce.FRAG_LOADING_WAITING_RETRY)&&(this.state=Ce.IDLE)}onFragmentOrKeyLoadError(e,t){var n;if(t.chunkMeta&&!t.frag){const x=this.getCurrentContext(t.chunkMeta);x&&(t.frag=x.frag)}const s=t.frag;if(!s||s.type!==e||!this.levels)return;if(this.fragContextChanged(s)){var r;this.warn(`Frag load error must match current frag to retry ${s.url} > ${(r=this.fragCurrent)==null?void 0:r.url}`);return}const a=t.details===ce.FRAG_GAP;a&&this.fragmentTracker.fragBuffered(s,!0);const u=t.errorAction;if(!u){this.state=Ce.ERROR;return}const{action:f,flags:c,retryCount:d=0,retryConfig:p}=u,m=!!p,y=m&&f===li.RetryRequest,E=m&&!u.resolved&&c===Xi.MoveAllAlternatesMatchingHost,A=(n=this.hls.latestLevelDetails)==null?void 0:n.live;if(!y&&E&&Nn(s)&&!s.endList&&A&&!Sb(t))this.resetFragmentErrors(e),this.treatAsGap(s),u.resolved=!0;else if((y||E)&&d<p.maxNumRetry){var S;const x=Ig((S=t.response)==null?void 0:S.code),M=W0(p,d);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+M,this.state=Ce.FRAG_LOADING_WAITING_RETRY,u.resolved=!0,x){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${s.sn} of ${e} ${s.level} errored with ${t.details}, retrying loading ${d+1}/${p.maxNumRetry} in ${M}ms`)}else if(p)if(this.resetFragmentErrors(e),d<p.maxNumRetry)!a&&f!==li.RemoveAlternatePermanently&&(u.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${d})`);return}else f===li.SendAlternateToPenaltyBox?this.state=Ce.WAITING_LEVEL:this.state=Ce.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,n=t===1/0;(!t||e>=t||n&&!Ig(0))&&(n&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=Ce.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===Ce.PARSING||this.state===Ce.PARSED){const t=e.frag,n=e.parent,s=this.getFwdBufferInfo(this.mediaBuffer,n),r=s&&s.len>.5;r&&this.reduceMaxBufferLength(s.len,(t==null?void 0:t.duration)||10);const a=!r;return a&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${n} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),a}return!1}resetFragmentErrors(e){e===et.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==Ce.STOPPED&&(this.state=Ce.IDLE)}afterBufferFlushed(e,t,n){if(!e)return;const s=xt.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,s,n),this.state===Ce.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==Ce.STOPPED&&(this.state=Ce.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,n,s){const r=n.details;if(!r){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((f,c)=>{const d=e.elementaryStreams[c];if(d){const p=d.endPTS-d.startPTS;if(p<=0)return this.warn(`Could not parse fragment ${e.sn} ${c} duration reliably (${p})`),f||!1;const m=s?0:Lb(r,e,d.startPTS,d.endPTS,d.startDTS,d.endDTS,this);return this.hls.trigger(P.LEVEL_PTS_UPDATED,{details:r,level:n,drift:m,type:c,frag:e,start:d.startPTS,end:d.endPTS}),!0}return f},!1)){var u;const f=((u=this.transmuxer)==null?void 0:u.error)===null;if((n.fragmentError===0||f&&(n.fragmentError<2||e.endList))&&this.treatAsGap(e,n),f){const c=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(c.message),this.hls.trigger(P.ERROR,{type:lt.MEDIA_ERROR,details:ce.FRAG_PARSING_ERROR,fatal:!1,error:c,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${n.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=Ce.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(P.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===et.MAIN?"level":"track"}fragInfo(e,t=!0,n){var s,r;return`${this.playlistLabel()} ${e.level} (${n?"part":"frag"}:[${((s=t&&!n?e.startPTS:(n||e).start)!=null?s:NaN).toFixed(3)}-${((r=t&&!n?e.endPTS:(n||e).end)!=null?r:NaN).toFixed(3)}]${n&&e.type==="main"?"INDEPENDENT="+(n.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function Dx(i){return!!i.interstitialsController&&i.enableInterstitialPlayback!==!1}class kb{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let n;if(e.length)e.length===1?n=e[0]:n=S2(e,t);else return new Uint8Array(0);return this.reset(),n}reset(){this.chunks.length=0,this.dataLength=0}}function S2(i,e){const t=new Uint8Array(e);let n=0;for(let s=0;s<i.length;s++){const r=i[s];t.set(r,n),n+=r.length}return t}var _m={exports:{}},wx;function T2(){return wx||(wx=1,(function(i){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function s(f,c,d){this.fn=f,this.context=c,this.once=d||!1}function r(f,c,d,p,m){if(typeof d!="function")throw new TypeError("The listener must be a function");var y=new s(d,p||f,m),E=t?t+c:c;return f._events[E]?f._events[E].fn?f._events[E]=[f._events[E],y]:f._events[E].push(y):(f._events[E]=y,f._eventsCount++),f}function a(f,c){--f._eventsCount===0?f._events=new n:delete f._events[c]}function u(){this._events=new n,this._eventsCount=0}u.prototype.eventNames=function(){var c=[],d,p;if(this._eventsCount===0)return c;for(p in d=this._events)e.call(d,p)&&c.push(t?p.slice(1):p);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(d)):c},u.prototype.listeners=function(c){var d=t?t+c:c,p=this._events[d];if(!p)return[];if(p.fn)return[p.fn];for(var m=0,y=p.length,E=new Array(y);m<y;m++)E[m]=p[m].fn;return E},u.prototype.listenerCount=function(c){var d=t?t+c:c,p=this._events[d];return p?p.fn?1:p.length:0},u.prototype.emit=function(c,d,p,m,y,E){var A=t?t+c:c;if(!this._events[A])return!1;var S=this._events[A],x=arguments.length,M,b;if(S.fn){switch(S.once&&this.removeListener(c,S.fn,void 0,!0),x){case 1:return S.fn.call(S.context),!0;case 2:return S.fn.call(S.context,d),!0;case 3:return S.fn.call(S.context,d,p),!0;case 4:return S.fn.call(S.context,d,p,m),!0;case 5:return S.fn.call(S.context,d,p,m,y),!0;case 6:return S.fn.call(S.context,d,p,m,y,E),!0}for(b=1,M=new Array(x-1);b<x;b++)M[b-1]=arguments[b];S.fn.apply(S.context,M)}else{var C=S.length,N;for(b=0;b<C;b++)switch(S[b].once&&this.removeListener(c,S[b].fn,void 0,!0),x){case 1:S[b].fn.call(S[b].context);break;case 2:S[b].fn.call(S[b].context,d);break;case 3:S[b].fn.call(S[b].context,d,p);break;case 4:S[b].fn.call(S[b].context,d,p,m);break;default:if(!M)for(N=1,M=new Array(x-1);N<x;N++)M[N-1]=arguments[N];S[b].fn.apply(S[b].context,M)}}return!0},u.prototype.on=function(c,d,p){return r(this,c,d,p,!1)},u.prototype.once=function(c,d,p){return r(this,c,d,p,!0)},u.prototype.removeListener=function(c,d,p,m){var y=t?t+c:c;if(!this._events[y])return this;if(!d)return a(this,y),this;var E=this._events[y];if(E.fn)E.fn===d&&(!m||E.once)&&(!p||E.context===p)&&a(this,y);else{for(var A=0,S=[],x=E.length;A<x;A++)(E[A].fn!==d||m&&!E[A].once||p&&E[A].context!==p)&&S.push(E[A]);S.length?this._events[y]=S.length===1?S[0]:S:a(this,y)}return this},u.prototype.removeAllListeners=function(c){var d;return c?(d=t?t+c:c,this._events[d]&&a(this,d)):(this._events=new n,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=t,u.EventEmitter=u,i.exports=u})(_m)),_m.exports}var x2=T2(),Z0=YO(x2);const Wu="1.6.15",xl={};function A2(){return typeof __HLS_WORKER_BUNDLE__=="function"}function R2(){const i=xl[Wu];if(i)return i.clientCount++,i;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),s={worker:new self.Worker(t),objectURL:t,clientCount:1};return xl[Wu]=s,s}function b2(i){const e=xl[i];if(e)return e.clientCount++,e;const t=new self.URL(i,self.location.href).href,s={worker:new self.Worker(t),scriptURL:t,clientCount:1};return xl[i]=s,s}function M2(i){const e=xl[i||Wu];if(e&&e.clientCount--===1){const{worker:n,objectURL:s}=e;delete xl[i||Wu],s&&self.URL.revokeObjectURL(s),n.terminate()}}function Bb(i,e){return e+10<=i.length&&i[e]===51&&i[e+1]===68&&i[e+2]===73&&i[e+3]<255&&i[e+4]<255&&i[e+6]<128&&i[e+7]<128&&i[e+8]<128&&i[e+9]<128}function j0(i,e){return e+10<=i.length&&i[e]===73&&i[e+1]===68&&i[e+2]===51&&i[e+3]<255&&i[e+4]<255&&i[e+6]<128&&i[e+7]<128&&i[e+8]<128&&i[e+9]<128}function Yd(i,e){let t=0;return t=(i[e]&127)<<21,t|=(i[e+1]&127)<<14,t|=(i[e+2]&127)<<7,t|=i[e+3]&127,t}function Ku(i,e){const t=e;let n=0;for(;j0(i,e);){n+=10;const s=Yd(i,e+6);n+=s,Bb(i,e+10)&&(n+=10),e+=n}if(n>0)return i.subarray(t,t+n)}function C2(i,e,t,n){const s=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],r=e[t+2],a=r>>2&15;if(a>12){const y=new Error(`invalid ADTS sampling index:${a}`);i.emit(P.ERROR,P.ERROR,{type:lt.MEDIA_ERROR,details:ce.FRAG_PARSING_ERROR,fatal:!0,error:y,reason:y.message});return}const u=(r>>6&3)+1,f=e[t+3]>>6&3|(r&1)<<2,c="mp4a.40."+u,d=s[a];let p=a;(u===5||u===29)&&(p-=3);const m=[u<<3|(p&14)>>1,(p&1)<<7|f<<3];return an.log(`manifest codec:${n}, parsed codec:${c}, channels:${f}, rate:${d} (ADTS object type:${u} sampling index:${a})`),{config:m,samplerate:d,channelCount:f,codec:c,parsedCodec:c,manifestCodec:n}}function Gb(i,e){return i[e]===255&&(i[e+1]&246)===240}function Vb(i,e){return i[e+1]&1?7:9}function ev(i,e){return(i[e+3]&3)<<11|i[e+4]<<3|(i[e+5]&224)>>>5}function I2(i,e){return e+5<i.length}function Nd(i,e){return e+1<i.length&&Gb(i,e)}function L2(i,e){return I2(i,e)&&Gb(i,e)&&ev(i,e)<=i.length-e}function D2(i,e){if(Nd(i,e)){const t=Vb(i,e);if(e+t>=i.length)return!1;const n=ev(i,e);if(n<=t)return!1;const s=e+n;return s===i.length||Nd(i,s)}return!1}function Hb(i,e,t,n,s){if(!i.samplerate){const r=C2(e,t,n,s);if(!r)return;pn(i,r)}}function zb(i){return 1024*9e4/i}function w2(i,e){const t=Vb(i,e);if(e+t<=i.length){const n=ev(i,e)-t;if(n>0)return{headerLength:t,frameLength:n}}}function $b(i,e,t,n,s){const r=zb(i.samplerate),a=n+s*r,u=w2(e,t);let f;if(u){const{frameLength:p,headerLength:m}=u,y=m+p,E=Math.max(0,t+y-e.length);E?(f=new Uint8Array(y-m),f.set(e.subarray(t+m,e.length),0)):f=e.subarray(t+m,t+y);const A={unit:f,pts:a};return E||i.samples.push(A),{sample:A,length:y,missing:E}}const c=e.length-t;return f=new Uint8Array(c),f.set(e.subarray(t,e.length),0),{sample:{unit:f,pts:a},length:c,missing:-1}}function P2(i,e){return j0(i,e)&&Yd(i,e+6)+10<=i.length-e}function N2(i){return i instanceof ArrayBuffer?i:i.byteOffset==0&&i.byteLength==i.buffer.byteLength?i.buffer:new Uint8Array(i).buffer}function Em(i,e=0,t=1/0){return U2(i,e,t,Uint8Array)}function U2(i,e,t,n){const s=O2(i);let r=1;"BYTES_PER_ELEMENT"in n&&(r=n.BYTES_PER_ELEMENT);const a=F2(i)?i.byteOffset:0,u=(a+i.byteLength)/r,f=(a+e)/r,c=Math.floor(Math.max(0,Math.min(f,u))),d=Math.floor(Math.min(c+Math.max(t,0),u));return new n(s,c,d-c)}function O2(i){return i instanceof ArrayBuffer?i:i.buffer}function F2(i){return i&&i.buffer instanceof ArrayBuffer&&i.byteLength!==void 0&&i.byteOffset!==void 0}function k2(i){const e={key:i.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(i.size<2)return;if(i.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const n=i.data.subarray(1).indexOf(0);if(n===-1)return;const s=es(Em(i.data,1,n)),r=i.data[2+n],a=i.data.subarray(3+n).indexOf(0);if(a===-1)return;const u=es(Em(i.data,3+n,a));let f;return s==="-->"?f=es(Em(i.data,4+n+a)):f=N2(i.data.subarray(4+n+a)),e.mimeType=s,e.pictureType=r,e.description=u,e.data=f,e}function B2(i){if(i.size<2)return;const e=es(i.data,!0),t=new Uint8Array(i.data.subarray(e.length+1));return{key:i.type,info:e,data:t.buffer}}function G2(i){if(i.size<2)return;if(i.type==="TXXX"){let t=1;const n=es(i.data.subarray(t),!0);t+=n.length+1;const s=es(i.data.subarray(t));return{key:i.type,info:n,data:s}}const e=es(i.data.subarray(1));return{key:i.type,info:"",data:e}}function V2(i){if(i.type==="WXXX"){if(i.size<2)return;let t=1;const n=es(i.data.subarray(t),!0);t+=n.length+1;const s=es(i.data.subarray(t));return{key:i.type,info:n,data:s}}const e=es(i.data);return{key:i.type,info:"",data:e}}function H2(i){return i.type==="PRIV"?B2(i):i.type[0]==="W"?V2(i):i.type==="APIC"?k2(i):G2(i)}function z2(i){const e=String.fromCharCode(i[0],i[1],i[2],i[3]),t=Yd(i,4),n=10;return{type:e,size:t,data:i.subarray(n,n+t)}}const xf=10,$2=10;function qb(i){let e=0;const t=[];for(;j0(i,e);){const n=Yd(i,e+6);i[e+5]>>6&1&&(e+=xf),e+=xf;const s=e+n;for(;e+$2<s;){const r=z2(i.subarray(e)),a=H2(r);a&&t.push(a),e+=r.size+xf}Bb(i,e)&&(e+=xf)}return t}function Wb(i){return i&&i.key==="PRIV"&&i.info==="com.apple.streaming.transportStreamTimestamp"}function q2(i){if(i.data.byteLength===8){const e=new Uint8Array(i.data),t=e[3]&1;let n=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return n/=45,t&&(n+=4772185884e-2),Math.round(n)}}function tv(i){const e=qb(i);for(let t=0;t<e.length;t++){const n=e[t];if(Wb(n))return q2(n)}}let Zi=(function(i){return i.audioId3="org.id3",i.dateRange="com.apple.quicktime.HLS",i.emsg="https://aomedia.org/emsg/ID3",i.misbklv="urn:misb:KLV:bin:1910.1",i})({});function ks(i="",e=9e4){return{type:i,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class nv{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,n,s){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,n){}demux(e,t){this.cachedData&&(e=ps(this.cachedData,e),this.cachedData=null);let n=Ku(e,0),s=n?n.length:0,r;const a=this._audioTrack,u=this._id3Track,f=n?tv(n):void 0,c=e.length;for((this.basePTS===null||this.frameIndex===0&&Ye(f))&&(this.basePTS=W2(f,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),n&&n.length>0&&u.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:Zi.audioId3,duration:Number.POSITIVE_INFINITY});s<c;){if(this.canParse(e,s)){const d=this.appendFrame(a,e,s);d?(this.frameIndex++,this.lastPTS=d.sample.pts,s+=d.length,r=s):s=c}else P2(e,s)?(n=Ku(e,s),u.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:Zi.audioId3,duration:Number.POSITIVE_INFINITY}),s+=n.length,r=s):s++;if(s===c&&r!==c){const d=e.slice(r);this.cachedData?this.cachedData=ps(this.cachedData,d):this.cachedData=d}}return{audioTrack:a,videoTrack:ks(),id3Track:u,textTrack:ks()}}demuxSampleAes(e,t,n){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:ks(),id3Track:this._id3Track,textTrack:ks()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const W2=(i,e,t)=>{if(Ye(i))return i*90;const n=t?t.baseTime*9e4/t.timescale:0;return e*9e4+n};let Af=null;const K2=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],Y2=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],X2=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],J2=[0,1,1,4];function Kb(i,e,t,n,s){if(t+24>e.length)return;const r=Yb(e,t);if(r&&t+r.frameLength<=e.length){const a=r.samplesPerFrame*9e4/r.sampleRate,u=n+s*a,f={unit:e.subarray(t,t+r.frameLength),pts:u,dts:u};return i.config=[],i.channelCount=r.channelCount,i.samplerate=r.sampleRate,i.samples.push(f),{sample:f,length:r.frameLength,missing:0}}}function Yb(i,e){const t=i[e+1]>>3&3,n=i[e+1]>>1&3,s=i[e+2]>>4&15,r=i[e+2]>>2&3;if(t!==1&&s!==0&&s!==15&&r!==3){const a=i[e+2]>>1&1,u=i[e+3]>>6,f=t===3?3-n:n===3?3:4,c=K2[f*14+s-1]*1e3,p=Y2[(t===3?0:t===2?1:2)*3+r],m=u===3?1:2,y=X2[t][n],E=J2[n],A=y*8*E,S=Math.floor(y*c/p+a)*E;if(Af===null){const b=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Af=b?parseInt(b[1]):0}return!!Af&&Af<=87&&n===2&&c>=224e3&&u===0&&(i[e+3]=i[e+3]|128),{sampleRate:p,channelCount:m,frameLength:S,samplesPerFrame:A}}}function iv(i,e){return i[e]===255&&(i[e+1]&224)===224&&(i[e+1]&6)!==0}function Xb(i,e){return e+1<i.length&&iv(i,e)}function Q2(i,e){return iv(i,e)&&4<=i.length-e}function Jb(i,e){if(e+1<i.length&&iv(i,e)){const n=Yb(i,e);let s=4;n!=null&&n.frameLength&&(s=n.frameLength);const r=e+s;return r===i.length||Xb(i,r)}return!1}class Z2 extends nv{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,n,s){super.resetInitSegment(e,t,n,s),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const n=Ku(e,0);let s=(n==null?void 0:n.length)||0;if(Jb(e,s))return!1;for(let r=e.length;s<r;s++)if(D2(e,s))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return L2(e,t)}appendFrame(e,t,n){Hb(e,this.observer,t,n,e.manifestCodec);const s=$b(e,t,n,this.basePTS,this.frameIndex);if(s&&s.missing===0)return s}}const Qb=(i,e)=>{let t=0,n=5;e+=n;const s=new Uint32Array(1),r=new Uint32Array(1),a=new Uint8Array(1);for(;n>0;){a[0]=i[e];const u=Math.min(n,8),f=8-u;r[0]=4278190080>>>24+f<<f,s[0]=(a[0]&r[0])>>f,t=t?t<<u|s[0]:s[0],e+=1,n-=u}return t};class j2 extends nv{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,n,s){super.resetInitSegment(e,t,n,s),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,n){const s=Zb(e,t,n,this.basePTS,this.frameIndex);if(s!==-1)return{sample:e.samples[e.samples.length-1],length:s,missing:0}}static probe(e){if(!e)return!1;const t=Ku(e,0);if(!t)return!1;const n=t.length;return e[n]===11&&e[n+1]===119&&tv(t)!==void 0&&Qb(e,n)<16}}function Zb(i,e,t,n,s){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const r=e[t+4]>>6;if(r>=3)return-1;const u=[48e3,44100,32e3][r],f=e[t+4]&63,d=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][f*3+r]*2;if(t+d>e.length)return-1;const p=e[t+6]>>5;let m=0;p===2?m+=2:(p&1&&p!==1&&(m+=2),p&4&&(m+=2));const y=(e[t+6]<<8|e[t+7])>>12-m&1,A=[2,1,2,3,3,4,4,5][p]+y,S=e[t+5]>>3,x=e[t+5]&7,M=new Uint8Array([r<<6|S<<1|x>>2,(x&3)<<6|p<<3|y<<2|f>>4,f<<4&224]),b=1536/u*9e4,C=n+s*b,N=e.subarray(t,t+d);return i.config=M,i.channelCount=A,i.samplerate=u,i.samples.push({unit:N,pts:C}),d}class ek extends nv{resetInitSegment(e,t,n,s){super.resetInitSegment(e,t,n,s),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Ku(e,0);let n=(t==null?void 0:t.length)||0;if(t&&e[n]===11&&e[n+1]===119&&tv(t)!==void 0&&Qb(e,n)<=16)return!1;for(let s=e.length;n<s;n++)if(Jb(e,n))return an.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return Q2(e,t)}appendFrame(e,t,n){if(this.basePTS!==null)return Kb(e,t,n,this.basePTS,this.frameIndex)}}const tk=/\/emsg[-/]ID3/i;class nk{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,n,s){const r=this.videoTrack=ks("video",1),a=this.audioTrack=ks("audio",1),u=this.txtTrack=ks("text",1);if(this.id3Track=ks("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const f=lb(e);if(f.video){const{id:c,timescale:d,codec:p,supplemental:m}=f.video;r.id=c,r.timescale=u.timescale=d,r.codec=p,r.supplemental=m}if(f.audio){const{id:c,timescale:d,codec:p}=f.audio;a.id=c,a.timescale=d,a.codec=p}u.id=rb.text,r.sampleDuration=0,r.duration=a.duration=s}resetContiguity(){this.remainderData=null}static probe(e){return jO(e)}demux(e,t){this.timeOffset=t;let n=e;const s=this.videoTrack,r=this.txtTrack;if(this.config.progressive){this.remainderData&&(n=ps(this.remainderData,e));const u=oF(n);this.remainderData=u.remainder,s.samples=u.valid||new Uint8Array}else s.samples=n;const a=this.extractID3Track(s,t);return r.samples=JT(t,s),{videoTrack:s,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,n=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const s=this.extractID3Track(t,this.timeOffset);return n.samples=JT(e,t),{videoTrack:t,audioTrack:ks(),id3Track:s,textTrack:ks()}}extractID3Track(e,t){const n=this.id3Track;if(e.samples.length){const s=Pt(e.samples,["emsg"]);s&&s.forEach(r=>{const a=lF(r);if(tk.test(a.schemeIdUri)){const u=Px(a,t);let f=a.eventDuration===4294967295?Number.POSITIVE_INFINITY:a.eventDuration/a.timeScale;f<=.001&&(f=Number.POSITIVE_INFINITY);const c=a.payload;n.samples.push({data:c,len:c.byteLength,dts:u,pts:u,type:Zi.emsg,duration:f})}else if(this.config.enableEmsgKLVMetadata&&a.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const u=Px(a,t);n.samples.push({data:a.payload,len:a.payload.byteLength,dts:u,pts:u,type:Zi.misbklv,duration:Number.POSITIVE_INFINITY})}})}return n}demuxSampleAes(e,t,n){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function Px(i,e){return Ye(i.presentationTime)?i.presentationTime/i.timeScale:e+i.presentationTimeDelta/i.timeScale}class ik{constructor(e,t,n){this.keyData=void 0,this.decrypter=void 0,this.keyData=n,this.decrypter=new K0(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,vo.cbc)}decryptAacSample(e,t,n){const s=e[t].unit;if(s.length<=16)return;const r=s.subarray(16,s.length-s.length%16),a=r.buffer.slice(r.byteOffset,r.byteOffset+r.length);this.decryptBuffer(a).then(u=>{const f=new Uint8Array(u);s.set(f,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,n)}).catch(n)}decryptAacSamples(e,t,n){for(;;t++){if(t>=e.length){n();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,n),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,n=new Int8Array(t);let s=0;for(let r=32;r<e.length-16;r+=160,s+=16)n.set(e.subarray(r,r+16),s);return n}getAvcDecryptedUnit(e,t){const n=new Uint8Array(t);let s=0;for(let r=32;r<e.length-16;r+=160,s+=16)e.set(n.subarray(s,s+16),r);return e}decryptAvcSample(e,t,n,s,r){const a=fb(r.data),u=this.getAvcEncryptedData(a);this.decryptBuffer(u.buffer).then(f=>{r.data=this.getAvcDecryptedUnit(a,f),this.decrypter.isSync()||this.decryptAvcSamples(e,t,n+1,s)}).catch(s)}decryptAvcSamples(e,t,n,s){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,n=0){if(t>=e.length){s();return}const r=e[t].units;for(;!(n>=r.length);n++){const a=r[n];if(!(a.data.length<=48||a.type!==1&&a.type!==5)&&(this.decryptAvcSample(e,t,n,s,a),!this.decrypter.isSync()))return}}}}class jb{constructor(){this.VideoSample=null}createVideoSample(e,t,n){return{key:e,frame:!1,pts:t,dts:n,units:[],length:0}}getLastNalUnit(e){var t;let n=this.VideoSample,s;if((!n||n.units.length===0)&&(n=e[e.length-1]),(t=n)!=null&&t.units){const r=n.units;s=r[r.length-1]}return s}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const n=t.samples,s=n.length;if(s){const r=n[s-1];e.pts=r.pts,e.dts=r.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,n){const s=t.byteLength;let r=e.naluState||0;const a=r,u=[];let f=0,c,d,p,m=-1,y=0;for(r===-1&&(m=0,y=this.getNALuType(t,0),r=0,f=1);f<s;){if(c=t[f++],!r){r=c?0:1;continue}if(r===1){r=c?0:2;continue}if(!c)r=3;else if(c===1){if(d=f-r-1,m>=0){const E={data:t.subarray(m,d),type:y};u.push(E)}else{const E=this.getLastNalUnit(e.samples);E&&(a&&f<=4-a&&E.state&&(E.data=E.data.subarray(0,E.data.byteLength-a)),d>0&&(E.data=ps(E.data,t.subarray(0,d)),E.state=0))}f<s?(p=this.getNALuType(t,f),m=f,y=p,r=0):r=-1}else r=0}if(m>=0&&r>=0){const E={data:t.subarray(m,s),type:y,state:r};u.push(E)}if(u.length===0){const E=this.getLastNalUnit(e.samples);E&&(E.data=ps(E.data,t))}return e.naluState=r,u}}class ku{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,n=e.byteLength-t,s=new Uint8Array(4),r=Math.min(4,t);if(r===0)throw new Error("no bytes available");s.set(e.subarray(n,n+r)),this.word=new DataView(s.buffer).getUint32(0),this.bitsAvailable=r*8,this.bytesAvailable-=r}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const n=this.word>>>32-t;if(e>32&&an.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?n<<t|this.readBits(t):n}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!==0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class sk extends jb{parsePES(e,t,n,s){const r=this.parseNALu(e,n.data,s);let a=this.VideoSample,u,f=!1;n.data=null,a&&r.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),r.forEach(c=>{var d,p;switch(c.type){case 1:{let A=!1;u=!0;const S=c.data;if(f&&S.length>4){const x=this.readSliceType(S);(x===2||x===4||x===7||x===9)&&(A=!0)}if(A){var m;(m=a)!=null&&m.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.frame=!0,a.key=A;break}case 5:u=!0,(d=a)!=null&&d.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0,a.frame=!0;break;case 6:{u=!0,z0(c.data,1,n.pts,t.samples);break}case 7:{var y,E;u=!0,f=!0;const A=c.data,S=this.readSPS(A);if(!e.sps||e.width!==S.width||e.height!==S.height||((y=e.pixelRatio)==null?void 0:y[0])!==S.pixelRatio[0]||((E=e.pixelRatio)==null?void 0:E[1])!==S.pixelRatio[1]){e.width=S.width,e.height=S.height,e.pixelRatio=S.pixelRatio,e.sps=[A];const x=A.subarray(1,4);let M="avc1.";for(let b=0;b<3;b++){let C=x[b].toString(16);C.length<2&&(C="0"+C),M+=C}e.codec=M}break}case 8:u=!0,e.pps=[c.data];break;case 9:u=!0,e.audFound=!0,(p=a)!=null&&p.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;case 12:u=!0;break;default:u=!1;break}a&&u&&a.units.push(c)}),s&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new ku(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let n=8,s=8,r;for(let a=0;a<e;a++)s!==0&&(r=t.readEG(),s=(n+r+256)%256),n=s===0?n:s}readSPS(e){const t=new ku(e);let n=0,s=0,r=0,a=0,u,f,c;const d=t.readUByte.bind(t),p=t.readBits.bind(t),m=t.readUEG.bind(t),y=t.readBoolean.bind(t),E=t.skipBits.bind(t),A=t.skipEG.bind(t),S=t.skipUEG.bind(t),x=this.skipScalingList.bind(this);d();const M=d();if(p(5),E(3),d(),S(),M===100||M===110||M===122||M===244||M===44||M===83||M===86||M===118||M===128){const O=m();if(O===3&&E(1),S(),S(),E(1),y())for(f=O!==3?8:12,c=0;c<f;c++)y()&&(c<6?x(16,t):x(64,t))}S();const b=m();if(b===0)m();else if(b===1)for(E(1),A(),A(),u=m(),c=0;c<u;c++)A();S(),E(1);const C=m(),N=m(),U=p(1);U===0&&E(1),E(1),y()&&(n=m(),s=m(),r=m(),a=m());let w=[1,1];if(y()&&y())switch(d()){case 1:w=[1,1];break;case 2:w=[12,11];break;case 3:w=[10,11];break;case 4:w=[16,11];break;case 5:w=[40,33];break;case 6:w=[24,11];break;case 7:w=[20,11];break;case 8:w=[32,11];break;case 9:w=[80,33];break;case 10:w=[18,11];break;case 11:w=[15,11];break;case 12:w=[64,33];break;case 13:w=[160,99];break;case 14:w=[4,3];break;case 15:w=[3,2];break;case 16:w=[2,1];break;case 255:{w=[d()<<8|d(),d()<<8|d()];break}}return{width:Math.ceil((C+1)*16-n*2-s*2),height:(2-U)*(N+1)*16-(U?2:4)*(r+a),pixelRatio:w}}}class rk extends jb{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,n,s){const r=this.parseNALu(e,n.data,s);let a=this.VideoSample,u,f=!1;n.data=null,a&&r.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),r.forEach(c=>{var d,p;switch(c.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:a||(a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),a.frame=!0,u=!0;break;case 16:case 17:case 18:case 21:if(u=!0,f){var m;(m=a)!=null&&m.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0,a.frame=!0;break;case 19:case 20:u=!0,(d=a)!=null&&d.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0,a.frame=!0;break;case 39:u=!0,z0(c.data,2,n.pts,t.samples);break;case 32:u=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=pn(e.params,this.readVPS(c.data)),this.initVPS=c.data),e.vps=[c.data];break;case 33:if(u=!0,f=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],c.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const y=this.readSPS(c.data);e.width=y.width,e.height=y.height,e.pixelRatio=y.pixelRatio,e.codec=y.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const E in y.params)e.params[E]=y.params[E]}this.pushParameterSet(e.sps,c.data,e.vps),a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0;break;case 34:if(u=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const y=this.readPPS(c.data);for(const E in y)e.params[E]=y[E]}this.pushParameterSet(e.pps,c.data,e.vps)}break;case 35:u=!0,e.audFound=!0,(p=a)!=null&&p.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;default:u=!1;break}a&&u&&a.units.push(c)}),s&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}pushParameterSet(e,t,n){(n&&n[0]===this.initVPS||!n&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let n=0;for(let s=0;s<e.byteLength;s++)s>=2&&e[s]===3&&e[s-1]===0&&e[s-2]===0||(t[n]=e[s],n++);return new Uint8Array(t.buffer,0,n)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new ku(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const n=t.readBits(3),s=t.readBoolean();return{numTemporalLayers:n+1,temporalIdNested:s}}readSPS(e){const t=new ku(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const n=t.readBits(3);t.readBoolean();const s=t.readBits(2),r=t.readBoolean(),a=t.readBits(5),u=t.readUByte(),f=t.readUByte(),c=t.readUByte(),d=t.readUByte(),p=t.readUByte(),m=t.readUByte(),y=t.readUByte(),E=t.readUByte(),A=t.readUByte(),S=t.readUByte(),x=t.readUByte(),M=[],b=[];for(let He=0;He<n;He++)M.push(t.readBoolean()),b.push(t.readBoolean());if(n>0)for(let He=n;He<8;He++)t.readBits(2);for(let He=0;He<n;He++)M[He]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),b[He]&&t.readUByte();t.readUEG();const C=t.readUEG();C==3&&t.skipBits(1);const N=t.readUEG(),U=t.readUEG(),w=t.readBoolean();let O=0,L=0,I=0,F=0;w&&(O+=t.readUEG(),L+=t.readUEG(),I+=t.readUEG(),F+=t.readUEG());const X=t.readUEG(),Y=t.readUEG(),ee=t.readUEG(),ne=t.readBoolean();for(let He=ne?0:n;He<=n;He++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let ut=0;ut<4;ut++)for(let Qe=0;Qe<(ut===3?2:6);Qe++)if(!t.readBoolean())t.readUEG();else{const $e=Math.min(64,1<<4+(ut<<1));ut>1&&t.readEG();for(let $=0;$<$e;$++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const q=t.readUEG();let oe=0;for(let He=0;He<q;He++){let ut=!1;if(He!==0&&(ut=t.readBoolean()),ut){He===q&&t.readUEG(),t.readBoolean(),t.readUEG();let Qe=0;for(let Dt=0;Dt<=oe;Dt++){const $e=t.readBoolean();let $=!1;$e||($=t.readBoolean()),($e||$)&&Qe++}oe=Qe}else{const Qe=t.readUEG(),Dt=t.readUEG();oe=Qe+Dt;for(let $e=0;$e<Qe;$e++)t.readUEG(),t.readBoolean();for(let $e=0;$e<Dt;$e++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const He=t.readUEG();for(let ut=0;ut<He;ut++){for(let Qe=0;Qe<ee+4;Qe++)t.readBits(1);t.readBits(1)}}let G=0,K=1,fe=1,Q=!0,ue=1,ae=0;t.readBoolean(),t.readBoolean();let Ee=!1;if(t.readBoolean()){if(t.readBoolean()){const k=t.readUByte(),me=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],Re=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];k>0&&k<16?(K=me[k-1],fe=Re[k-1]):k===255&&(K=t.readBits(16),fe=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),Ee=t.readBoolean(),Ee&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(ue=t.readBits(32),ae=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const Re=t.readBoolean(),Pe=t.readBoolean();let be=!1;(Re||Pe)&&(be=t.readBoolean(),be&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),be&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let nt=0;nt<=n;nt++){Q=t.readBoolean();const Be=Q||t.readBoolean();let Fe=!1;Be?t.readEG():Fe=t.readBoolean();const Ct=Fe?1:t.readUEG()+1;if(Re)for(let Ue=0;Ue<Ct;Ue++)t.readUEG(),t.readUEG(),be&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(Pe)for(let Ue=0;Ue<Ct;Ue++)t.readUEG(),t.readUEG(),be&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),G=t.readUEG())}let Ae=N,Ne=U;if(w){let He=1,ut=1;C===1?He=ut=2:C==2&&(He=2),Ae=N-He*L-He*O,Ne=U-ut*F-ut*I}const je=s?["A","B","C"][s]:"",Mt=u<<24|f<<16|c<<8|d;let rt=0;for(let He=0;He<32;He++)rt=(rt|(Mt>>He&1)<<31-He)>>>0;let J=rt.toString(16);return a===1&&J==="2"&&(J="6"),{codecString:`hvc1.${je}${a}.${J}.${r?"H":"L"}${x}.B0`,params:{general_tier_flag:r,general_profile_idc:a,general_profile_space:s,general_profile_compatibility_flags:[u,f,c,d],general_constraint_indicator_flags:[p,m,y,E,A,S],general_level_idc:x,bit_depth:X+8,bit_depth_luma_minus8:X,bit_depth_chroma_minus8:Y,min_spatial_segmentation_idc:G,chroma_format_idc:C,frame_rate:{fixed:Q,fps:ae/ue}},width:Ae,height:Ne,pixelRatio:[K,fe]}}readPPS(e){const t=new ku(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const s=t.readBoolean(),r=t.readBoolean();let a=1;return r&&s?a=0:r?a=3:s&&(a=2),{parallelismType:a}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const ei=188;class co{constructor(e,t,n,s){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.logger=s,this.videoParser=null}static probe(e,t){const n=co.syncOffset(e);return n>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${n}`),n!==-1}static syncOffset(e){const t=e.length;let n=Math.min(ei*5,t-ei)+1,s=0;for(;s<n;){let r=!1,a=-1,u=0;for(let f=s;f<t;f+=ei)if(e[f]===71&&(t-f===ei||e[f+ei]===71)){if(u++,a===-1&&(a=f,a!==0&&(n=Math.min(a+ei*99,e.length-ei)+1)),r||(r=Ng(e,f)===0),r&&u>1&&(a===0&&u>2||f+ei>n))return a}else{if(u)return-1;break}s++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:rb[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,n,s){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=co.createTrack("video"),this._videoTrack.duration=s,this._audioTrack=co.createTrack("audio",s),this._id3Track=co.createTrack("id3"),this._txtTrack=co.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=n}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:n}=this;e&&(e.pesData=null),t&&(t.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,n=!1,s=!1){n||(this.sampleAes=null);let r;const a=this._videoTrack,u=this._audioTrack,f=this._id3Track,c=this._txtTrack;let d=a.pid,p=a.pesData,m=u.pid,y=f.pid,E=u.pesData,A=f.pesData,S=null,x=this.pmtParsed,M=this._pmtId,b=e.length;if(this.remainderData&&(e=ps(this.remainderData,e),b=e.length,this.remainderData=null),b<ei&&!s)return this.remainderData=e,{audioTrack:u,videoTrack:a,id3Track:f,textTrack:c};const C=Math.max(0,co.syncOffset(e));b-=(b-C)%ei,b<e.byteLength&&!s&&(this.remainderData=new Uint8Array(e.buffer,b,e.buffer.byteLength-b));let N=0;for(let w=C;w<b;w+=ei)if(e[w]===71){const O=!!(e[w+1]&64),L=Ng(e,w),I=(e[w+3]&48)>>4;let F;if(I>1){if(F=w+5+e[w+4],F===w+ei)continue}else F=w+4;switch(L){case d:O&&(p&&(r=za(p,this.logger))&&(this.readyVideoParser(a.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(a,c,r,!1)),p={data:[],size:0}),p&&(p.data.push(e.subarray(F,w+ei)),p.size+=w+ei-F);break;case m:if(O){if(E&&(r=za(E,this.logger)))switch(u.segmentCodec){case"aac":this.parseAACPES(u,r);break;case"mp3":this.parseMPEGPES(u,r);break;case"ac3":this.parseAC3PES(u,r);break}E={data:[],size:0}}E&&(E.data.push(e.subarray(F,w+ei)),E.size+=w+ei-F);break;case y:O&&(A&&(r=za(A,this.logger))&&this.parseID3PES(f,r),A={data:[],size:0}),A&&(A.data.push(e.subarray(F,w+ei)),A.size+=w+ei-F);break;case 0:O&&(F+=e[F]+1),M=this._pmtId=ok(e,F);break;case M:{O&&(F+=e[F]+1);const X=ak(e,F,this.typeSupported,n,this.observer,this.logger);d=X.videoPid,d>0&&(a.pid=d,a.segmentCodec=X.segmentVideoCodec),m=X.audioPid,m>0&&(u.pid=m,u.segmentCodec=X.segmentAudioCodec),y=X.id3Pid,y>0&&(f.pid=y),S!==null&&!x&&(this.logger.warn(`MPEG-TS PMT found at ${w} after unknown PID '${S}'. Backtracking to sync byte @${C} to parse all TS packets.`),S=null,w=C-188),x=this.pmtParsed=!0;break}case 17:case 8191:break;default:S=L;break}}else N++;N>0&&Ug(this.observer,new Error(`Found ${N} TS packet/s that do not start with 0x47`),void 0,this.logger),a.pesData=p,u.pesData=E,f.pesData=A;const U={audioTrack:u,videoTrack:a,id3Track:f,textTrack:c};return s&&this.extractRemainingSamples(U),U}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:n,id3Track:s,textTrack:r}=e,a=n.pesData,u=t.pesData,f=s.pesData;let c;if(a&&(c=za(a,this.logger))?(this.readyVideoParser(n.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(n,r,c,!0),n.pesData=null)):n.pesData=a,u&&(c=za(u,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,c);break;case"mp3":this.parseMPEGPES(t,c);break;case"ac3":this.parseAC3PES(t,c);break}t.pesData=null}else u!=null&&u.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=u;f&&(c=za(f,this.logger))?(this.parseID3PES(s,c),s.pesData=null):s.pesData=f}demuxSampleAes(e,t,n){const s=this.demux(e,n,!0,!this.config.progressive),r=this.sampleAes=new ik(this.observer,this.config,t);return this.decrypt(s,r)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new sk:e==="hevc"&&(this.videoParser=new rk))}decrypt(e,t){return new Promise(n=>{const{audioTrack:s,videoTrack:r}=e;s.samples&&s.segmentCodec==="aac"?t.decryptAacSamples(s.samples,0,()=>{r.samples?t.decryptAvcSamples(r.samples,0,0,()=>{n(e)}):n(e)}):r.samples&&t.decryptAvcSamples(r.samples,0,0,()=>{n(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let n=0;const s=this.aacOverFlow;let r=t.data;if(s){this.aacOverFlow=null;const p=s.missing,m=s.sample.unit.byteLength;if(p===-1)r=ps(s.sample.unit,r);else{const y=m-p;s.sample.unit.set(r.subarray(0,p),y),e.samples.push(s.sample),n=s.missing}}let a,u;for(a=n,u=r.length;a<u-1&&!Nd(r,a);a++);if(a!==n){let p;const m=a<u-1;if(m?p=`AAC PES did not start with ADTS header,offset:${a}`:p="No ADTS header found in AAC PES",Ug(this.observer,new Error(p),m,this.logger),!m)return}Hb(e,this.observer,r,a,this.audioCodec);let f;if(t.pts!==void 0)f=t.pts;else if(s){const p=zb(e.samplerate);f=s.sample.pts+p}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let c=0,d;for(;a<u;)if(d=$b(e,r,a,f,c),a+=d.length,d.missing){this.aacOverFlow=d;break}else for(c++;a<u-1&&!Nd(r,a);a++);}parseMPEGPES(e,t){const n=t.data,s=n.length;let r=0,a=0;const u=t.pts;if(u===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;a<s;)if(Xb(n,a)){const f=Kb(e,n,a,u,r);if(f)a+=f.length,r++;else break}else a++}parseAC3PES(e,t){{const n=t.data,s=t.pts;if(s===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const r=n.length;let a=0,u=0,f;for(;u<r&&(f=Zb(e,n,u,s,a++))>0;)u+=f}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const n=pn({},t,{type:this._videoTrack?Zi.emsg:Zi.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(n)}}function Ng(i,e){return((i[e+1]&31)<<8)+i[e+2]}function ok(i,e){return(i[e+10]&31)<<8|i[e+11]}function ak(i,e,t,n,s,r){const a={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},u=(i[e+1]&15)<<8|i[e+2],f=e+3+u-4,c=(i[e+10]&15)<<8|i[e+11];for(e+=12+c;e<f;){const d=Ng(i,e),p=(i[e+3]&15)<<8|i[e+4];switch(i[e]){case 207:if(!n){Sm("ADTS AAC",r);break}case 15:a.audioPid===-1&&(a.audioPid=d);break;case 21:a.id3Pid===-1&&(a.id3Pid=d);break;case 219:if(!n){Sm("H.264",r);break}case 27:a.videoPid===-1&&(a.videoPid=d);break;case 3:case 4:!t.mpeg&&!t.mp3?r.log("MPEG audio found, not supported in this browser"):a.audioPid===-1&&(a.audioPid=d,a.segmentAudioCodec="mp3");break;case 193:if(!n){Sm("AC-3",r);break}case 129:t.ac3?a.audioPid===-1&&(a.audioPid=d,a.segmentAudioCodec="ac3"):r.log("AC-3 audio found, not supported in this browser");break;case 6:if(a.audioPid===-1&&p>0){let m=e+5,y=p;for(;y>2;){switch(i[m]){case 106:t.ac3!==!0?r.log("AC-3 audio found, not supported in this browser for now"):(a.audioPid=d,a.segmentAudioCodec="ac3");break}const A=i[m+1]+2;m+=A,y-=A}}break;case 194:case 135:return Ug(s,new Error("Unsupported EC-3 in M2TS found"),void 0,r),a;case 36:a.videoPid===-1&&(a.videoPid=d,a.segmentVideoCodec="hevc",r.log("HEVC in M2TS found"));break}e+=p+5}return a}function Ug(i,e,t,n){n.warn(`parsing error: ${e.message}`),i.emit(P.ERROR,P.ERROR,{type:lt.MEDIA_ERROR,details:ce.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function Sm(i,e){e.log(`${i} with AES-128-CBC encryption found in unencrypted stream`)}function za(i,e){let t=0,n,s,r,a,u;const f=i.data;if(!i||i.size===0)return null;for(;f[0].length<19&&f.length>1;)f[0]=ps(f[0],f[1]),f.splice(1,1);if(n=f[0],(n[0]<<16)+(n[1]<<8)+n[2]===1){if(s=(n[4]<<8)+n[5],s&&s>i.size-6)return null;const d=n[7];d&192&&(a=(n[9]&14)*536870912+(n[10]&255)*4194304+(n[11]&254)*16384+(n[12]&255)*128+(n[13]&254)/2,d&64?(u=(n[14]&14)*536870912+(n[15]&255)*4194304+(n[16]&254)*16384+(n[17]&255)*128+(n[18]&254)/2,a-u>60*9e4&&(e.warn(`${Math.round((a-u)/9e4)}s delta between PTS and DTS, align them`),a=u)):u=a),r=n[8];let p=r+9;if(i.size<=p)return null;i.size-=p;const m=new Uint8Array(i.size);for(let y=0,E=f.length;y<E;y++){n=f[y];let A=n.byteLength;if(p)if(p>A){p-=A;continue}else n=n.subarray(p),A-=p,p=0;m.set(n,t),t+=A}return s&&(s-=r+3),{data:m,pts:a,dts:u,len:s}}return null}class lk{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const to=Math.pow(2,32)-1;class le{static init(){le.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in le.types)le.types.hasOwnProperty(e)&&(le.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);le.HDLR_TYPES={video:t,audio:n};const s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),r=new Uint8Array([0,0,0,0,0,0,0,0]);le.STTS=le.STSC=le.STCO=r,le.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),le.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),le.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),le.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const a=new Uint8Array([105,115,111,109]),u=new Uint8Array([97,118,99,49]),f=new Uint8Array([0,0,0,1]);le.FTYP=le.box(le.types.ftyp,a,f,a,u),le.DINF=le.box(le.types.dinf,le.box(le.types.dref,s))}static box(e,...t){let n=8,s=t.length;const r=s;for(;s--;)n+=t[s].byteLength;const a=new Uint8Array(n);for(a[0]=n>>24&255,a[1]=n>>16&255,a[2]=n>>8&255,a[3]=n&255,a.set(e,4),s=0,n=8;s<r;s++)a.set(t[s],n),n+=t[s].byteLength;return a}static hdlr(e){return le.box(le.types.hdlr,le.HDLR_TYPES[e])}static mdat(e){return le.box(le.types.mdat,e)}static mdhd(e,t){t*=e;const n=Math.floor(t/(to+1)),s=Math.floor(t%(to+1));return le.box(le.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,s>>24,s>>16&255,s>>8&255,s&255,85,196,0,0]))}static mdia(e){return le.box(le.types.mdia,le.mdhd(e.timescale||0,e.duration||0),le.hdlr(e.type),le.minf(e))}static mfhd(e){return le.box(le.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?le.box(le.types.minf,le.box(le.types.smhd,le.SMHD),le.DINF,le.stbl(e)):le.box(le.types.minf,le.box(le.types.vmhd,le.VMHD),le.DINF,le.stbl(e))}static moof(e,t,n){return le.box(le.types.moof,le.mfhd(e),le.traf(n,t))}static moov(e){let t=e.length;const n=[];for(;t--;)n[t]=le.trak(e[t]);return le.box.apply(null,[le.types.moov,le.mvhd(e[0].timescale||0,e[0].duration||0)].concat(n).concat(le.mvex(e)))}static mvex(e){let t=e.length;const n=[];for(;t--;)n[t]=le.trex(e[t]);return le.box.apply(null,[le.types.mvex,...n])}static mvhd(e,t){t*=e;const n=Math.floor(t/(to+1)),s=Math.floor(t%(to+1)),r=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,s>>24,s>>16&255,s>>8&255,s&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return le.box(le.types.mvhd,r)}static sdtp(e){const t=e.samples||[],n=new Uint8Array(4+t.length);let s,r;for(s=0;s<t.length;s++)r=t[s].flags,n[s+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return le.box(le.types.sdtp,n)}static stbl(e){return le.box(le.types.stbl,le.stsd(e),le.box(le.types.stts,le.STTS),le.box(le.types.stsc,le.STSC),le.box(le.types.stsz,le.STSZ),le.box(le.types.stco,le.STCO))}static avc1(e){let t=[],n=[],s,r,a;for(s=0;s<e.sps.length;s++)r=e.sps[s],a=r.byteLength,t.push(a>>>8&255),t.push(a&255),t=t.concat(Array.prototype.slice.call(r));for(s=0;s<e.pps.length;s++)r=e.pps[s],a=r.byteLength,n.push(a>>>8&255),n.push(a&255),n=n.concat(Array.prototype.slice.call(r));const u=le.box(le.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(n))),f=e.width,c=e.height,d=e.pixelRatio[0],p=e.pixelRatio[1];return le.box(le.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,f>>8&255,f&255,c>>8&255,c&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),u,le.box(le.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),le.box(le.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,d&255,p>>24,p>>16&255,p>>8&255,p&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return le.box(le.types.mp4a,le.audioStsd(e),le.box(le.types.esds,le.esds(e)))}static mp3(e){return le.box(le.types[".mp3"],le.audioStsd(e))}static ac3(e){return le.box(le.types["ac-3"],le.audioStsd(e),le.box(le.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return le.box(le.types.stsd,le.STSD,le.mp4a(e));if(t==="ac3"&&e.config)return le.box(le.types.stsd,le.STSD,le.ac3(e));if(t==="mp3"&&e.codec==="mp3")return le.box(le.types.stsd,le.STSD,le.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return le.box(le.types.stsd,le.STSD,le.avc1(e));if(t==="hevc"&&e.vps)return le.box(le.types.stsd,le.STSD,le.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,n=(e.duration||0)*(e.timescale||0),s=e.width||0,r=e.height||0,a=Math.floor(n/(to+1)),u=Math.floor(n%(to+1));return le.box(le.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,u>>24,u>>16&255,u>>8&255,u&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,s&255,0,0,r>>8&255,r&255,0,0]))}static traf(e,t){const n=le.sdtp(e),s=e.id,r=Math.floor(t/(to+1)),a=Math.floor(t%(to+1));return le.box(le.types.traf,le.box(le.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,s&255])),le.box(le.types.tfdt,new Uint8Array([1,0,0,0,r>>24,r>>16&255,r>>8&255,r&255,a>>24,a>>16&255,a>>8&255,a&255])),le.trun(e,n.length+16+20+8+16+8+8),n)}static trak(e){return e.duration=e.duration||4294967295,le.box(le.types.trak,le.tkhd(e),le.mdia(e))}static trex(e){const t=e.id;return le.box(le.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const n=e.samples||[],s=n.length,r=12+16*s,a=new Uint8Array(r);let u,f,c,d,p,m;for(t+=8+r,a.set([e.type==="video"?1:0,0,15,1,s>>>24&255,s>>>16&255,s>>>8&255,s&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),u=0;u<s;u++)f=n[u],c=f.duration,d=f.size,p=f.flags,m=f.cts,a.set([c>>>24&255,c>>>16&255,c>>>8&255,c&255,d>>>24&255,d>>>16&255,d>>>8&255,d&255,p.isLeading<<2|p.dependsOn,p.isDependedOn<<6|p.hasRedundancy<<4|p.paddingValue<<1|p.isNonSync,p.degradPrio&61440,p.degradPrio&15,m>>>24&255,m>>>16&255,m>>>8&255,m&255],12+16*u);return le.box(le.types.trun,a)}static initSegment(e){le.types||le.init();const t=le.moov(e);return ps(le.FTYP,t)}static hvc1(e){const t=e.params,n=[e.vps,e.sps,e.pps],s=4,r=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),s-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),n.length]);let a=r.length;for(let E=0;E<n.length;E+=1){a+=3;for(let A=0;A<n[E].length;A+=1)a+=2+n[E][A].length}const u=new Uint8Array(a);u.set(r,0),a=r.length;const f=n.length-1;for(let E=0;E<n.length;E+=1){u.set(new Uint8Array([32+E|(E===f?128:0),0,n[E].length]),a),a+=3;for(let A=0;A<n[E].length;A+=1)u.set(new Uint8Array([n[E][A].length>>8,n[E][A].length&255]),a),a+=2,u.set(n[E][A],a),a+=n[E][A].length}const c=le.box(le.types.hvcC,u),d=e.width,p=e.height,m=e.pixelRatio[0],y=e.pixelRatio[1];return le.box(le.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,d>>8&255,d&255,p>>8&255,p&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c,le.box(le.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),le.box(le.types.pasp,new Uint8Array([m>>24,m>>16&255,m>>8&255,m&255,y>>24,y>>16&255,y>>8&255,y&255])))}}le.types=void 0;le.HDLR_TYPES=void 0;le.STTS=void 0;le.STSC=void 0;le.STCO=void 0;le.STSZ=void 0;le.VMHD=void 0;le.SMHD=void 0;le.STSD=void 0;le.FTYP=void 0;le.DINF=void 0;const eM=9e4;function sv(i,e,t=1,n=!1){const s=i*e*t;return n?Math.round(s):s}function uk(i,e,t=1,n=!1){return sv(i,e,1/t,n)}function Iu(i,e=!1){return sv(i,1e3,1/eM,e)}function ck(i,e=1){return sv(i,eM,1/e)}function Nx(i){const{baseTime:e,timescale:t,trackId:n}=i;return`${e/t} (${e}/${t}) trackId: ${n}`}const fk=10*1e3,dk=1024,hk=1152,pk=1536;let $a=null,Tm=null;function Ux(i,e,t,n){return{duration:e,size:t,cts:n,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:i?2:1,isNonSync:i?0:1}}}class ld extends ms{constructor(e,t,n,s){if(super("mp4-remuxer",s),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.ISGenerated=!1,$a===null){const a=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);$a=a?parseInt(a[1]):0}if(Tm===null){const r=navigator.userAgent.match(/Safari\/(\d+)/i);Tm=r?parseInt(r[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&Nx(t)} > ${e&&Nx(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const n=e[0].pts,s=e.reduce((r,a)=>{let u=a.pts,f=u-r;return f<-4294967296&&(t=!0,u=Ji(u,n),f=u-r),f>0?r:u},n);return t&&this.debug("PTS rollover detected"),s}remux(e,t,n,s,r,a,u,f){let c,d,p,m,y,E,A=r,S=r;const x=e.pid>-1,M=t.pid>-1,b=t.samples.length,C=e.samples.length>0,N=u&&b>0||b>1;if((!x||C)&&(!M||N)||this.ISGenerated||u){if(this.ISGenerated){var w,O,L,I;const ee=this.videoTrackConfig;(ee&&(t.width!==ee.width||t.height!==ee.height||((w=t.pixelRatio)==null?void 0:w[0])!==((O=ee.pixelRatio)==null?void 0:O[0])||((L=t.pixelRatio)==null?void 0:L[1])!==((I=ee.pixelRatio)==null?void 0:I[1]))||!ee&&N||this.nextAudioTs===null&&C)&&this.resetInitSegment()}this.ISGenerated||(p=this.generateIS(e,t,r,a));const F=this.isVideoContiguous;let X=-1,Y;if(N&&(X=mk(t.samples),!F&&this.config.forceKeyFrameOnDiscontinuity))if(E=!0,X>0){this.warn(`Dropped ${X} out of ${b} video samples due to a missing keyframe`);const ee=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(X),t.dropped+=X,S+=(t.samples[0].pts-ee)/t.inputTimeScale,Y=S}else X===-1&&(this.warn(`No keyframe found out of ${b} video samples`),E=!1);if(this.ISGenerated){if(C&&N){const ee=this.getVideoStartPts(t.samples),V=(Ji(e.samples[0].pts,ee)-ee)/t.inputTimeScale;A+=Math.max(0,V),S+=Math.max(0,-V)}if(C){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),p=this.generateIS(e,t,r,a)),d=this.remuxAudio(e,A,this.isAudioContiguous,a,M||N||f===et.AUDIO?S:void 0),N){const ee=d?d.endPTS-d.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),p=this.generateIS(e,t,r,a)),c=this.remuxVideo(t,S,F,ee)}}else N&&(c=this.remuxVideo(t,S,F,0));c&&(c.firstKeyFrame=X,c.independent=X!==-1,c.firstKeyFramePTS=Y)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(n.samples.length&&(y=tM(n,r,this._initPTS,this._initDTS)),s.samples.length&&(m=nM(s,r,this._initPTS))),{audio:d,video:c,initSegment:p,independent:E,text:m,id3:y}}computeInitPts(e,t,n,s){const r=Math.round(n*t);let a=Ji(e,r);if(a<r+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(r-a)/t} ${s}`);a<r+t;)a+=8589934592;return a-r}generateIS(e,t,n,s){const r=e.samples,a=t.samples,u=this.typeSupported,f={},c=this._initPTS;let d=!c||s,p="audio/mp4",m,y,E,A=-1;if(d&&(m=y=1/0),e.config&&r.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":u.mpeg?(p="audio/mpeg",e.codec=""):u.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}f.audio={id:"audio",container:p,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&u.mpeg?new Uint8Array(0):le.initSegment([e]),metadata:{channelCount:e.channelCount}},d&&(A=e.id,E=e.inputTimeScale,!c||E!==c.timescale?m=y=this.computeInitPts(r[0].pts,E,n,"audio"):d=!1)}if(t.sps&&t.pps&&a.length){if(t.timescale=t.inputTimeScale,f.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:le.initSegment([t]),metadata:{width:t.width,height:t.height}},d)if(A=t.id,E=t.inputTimeScale,!c||E!==c.timescale){const S=this.getVideoStartPts(a),x=Ji(a[0].dts,S),M=this.computeInitPts(x,E,n,"video"),b=this.computeInitPts(S,E,n,"video");y=Math.min(y,M),m=Math.min(m,b)}else d=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(f).length)return this.ISGenerated=!0,d?(c&&this.warn(`Timestamps at playlist time: ${s?"":"~"}${n} ${m/E} != initPTS: ${c.baseTime/c.timescale} (${c.baseTime}/${c.timescale}) trackId: ${c.trackId}`),this.log(`Found initPTS at playlist time: ${n} offset: ${m/E} (${m}/${E}) trackId: ${A}`),this._initPTS={baseTime:m,timescale:E,trackId:A},this._initDTS={baseTime:y,timescale:E,trackId:A}):m=E=void 0,{tracks:f,initPTS:m,timescale:E,trackId:A}}remuxVideo(e,t,n,s){const r=e.inputTimeScale,a=e.samples,u=[],f=a.length,c=this._initPTS,d=c.baseTime*r/c.timescale;let p=this.nextVideoTs,m=8,y=this.videoSampleDuration,E,A,S=Number.POSITIVE_INFINITY,x=Number.NEGATIVE_INFINITY,M=!1;if(!n||p===null){const G=d+t*r,K=a[0].pts-Ji(a[0].dts,a[0].pts);$a&&p!==null&&Math.abs(G-K-(p+d))<15e3?n=!0:p=G-K-d}const b=p+d;for(let G=0;G<f;G++){const K=a[G];K.pts=Ji(K.pts,b),K.dts=Ji(K.dts,b),K.dts<a[G>0?G-1:G].dts&&(M=!0)}M&&a.sort(function(G,K){const fe=G.dts-K.dts,Q=G.pts-K.pts;return fe||Q}),E=a[0].dts,A=a[a.length-1].dts;const C=A-E,N=C?Math.round(C/(f-1)):y||e.inputTimeScale/30;if(n){const G=E-b,K=G>N,fe=G<-1;if((K||fe)&&(K?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Iu(G,!0)} ms (${G}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Iu(-G,!0)} ms (${G}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!fe||b>=a[0].pts||$a)){E=b;const Q=a[0].pts-G;if(K)a[0].dts=E,a[0].pts=Q;else{let ue=!0;for(let ae=0;ae<a.length&&!(a[ae].dts>Q&&ue);ae++){const Ee=a[ae].pts;if(a[ae].dts-=G,a[ae].pts-=G,ae<a.length-1){const pe=a[ae+1].pts,Ae=a[ae].pts,Ne=pe<=Ae,je=pe<=Ee;ue=Ne==je}}}this.log(`Video: Initial PTS/DTS adjusted: ${Iu(Q,!0)}/${Iu(E,!0)}, delta: ${Iu(G,!0)} ms`)}}E=Math.max(0,E);let U=0,w=0,O=E;for(let G=0;G<f;G++){const K=a[G],fe=K.units,Q=fe.length;let ue=0;for(let ae=0;ae<Q;ae++)ue+=fe[ae].data.length;w+=ue,U+=Q,K.length=ue,K.dts<O?(K.dts=O,O+=N/4|0||1):O=K.dts,S=Math.min(K.pts,S),x=Math.max(K.pts,x)}A=a[f-1].dts;const L=w+4*U+8;let I;try{I=new Uint8Array(L)}catch(G){this.observer.emit(P.ERROR,P.ERROR,{type:lt.MUX_ERROR,details:ce.REMUX_ALLOC_ERROR,fatal:!1,error:G,bytes:L,reason:`fail allocating video mdat ${L}`});return}const F=new DataView(I.buffer);F.setUint32(0,L),I.set(le.types.mdat,4);let X=!1,Y=Number.POSITIVE_INFINITY,ee=Number.POSITIVE_INFINITY,ne=Number.NEGATIVE_INFINITY,V=Number.NEGATIVE_INFINITY;for(let G=0;G<f;G++){const K=a[G],fe=K.units;let Q=0;for(let Ee=0,pe=fe.length;Ee<pe;Ee++){const Ae=fe[Ee],Ne=Ae.data,je=Ae.data.byteLength;F.setUint32(m,je),m+=4,I.set(Ne,m),m+=je,Q+=4+je}let ue;if(G<f-1)y=a[G+1].dts-K.dts,ue=a[G+1].pts-K.pts;else{const Ee=this.config,pe=G>0?K.dts-a[G-1].dts:N;if(ue=G>0?K.pts-a[G-1].pts:N,Ee.stretchShortVideoTrack&&this.nextAudioTs!==null){const Ae=Math.floor(Ee.maxBufferHole*r),Ne=(s?S+s*r:this.nextAudioTs+d)-K.pts;Ne>Ae?(y=Ne-pe,y<0?y=pe:X=!0,this.log(`It is approximately ${Ne/90} ms to the next segment; using duration ${y/90} ms for the last video frame.`)):y=pe}else y=pe}const ae=Math.round(K.pts-K.dts);Y=Math.min(Y,y),ne=Math.max(ne,y),ee=Math.min(ee,ue),V=Math.max(V,ue),u.push(Ux(K.key,y,Q,ae))}if(u.length){if($a){if($a<70){const G=u[0].flags;G.dependsOn=2,G.isNonSync=0}}else if(Tm&&V-ee<ne-Y&&N/ne<.025&&u[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let G=E;for(let K=0,fe=u.length;K<fe;K++){const Q=G+u[K].duration,ue=G+u[K].cts;if(K<fe-1){const ae=Q+u[K+1].cts;u[K].duration=ae-ue}else u[K].duration=K?u[K-1].duration:N;u[K].cts=0,G=Q}}}y=X||!y?N:y;const W=A+y;this.nextVideoTs=p=W-d,this.videoSampleDuration=y,this.isVideoContiguous=!0;const he={data1:le.moof(e.sequenceNumber++,E,pn(e,{samples:u})),data2:I,startPTS:(S-d)/r,endPTS:(x+y-d)/r,startDTS:(E-d)/r,endDTS:p/r,type:"video",hasAudio:!1,hasVideo:!0,nb:u.length,dropped:e.dropped};return e.samples=[],e.dropped=0,he}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return hk;case"ac3":return pk;default:return dk}}remuxAudio(e,t,n,s,r){const a=e.inputTimeScale,u=e.samplerate?e.samplerate:a,f=a/u,c=this.getSamplesPerFrame(e),d=c*f,p=this._initPTS,m=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,y=[],E=r!==void 0;let A=e.samples,S=m?0:8,x=this.nextAudioTs||-1;const M=p.baseTime*a/p.timescale,b=M+t*a;if(this.isAudioContiguous=n=n||A.length&&x>0&&(s&&Math.abs(b-(x+M))<9e3||Math.abs(Ji(A[0].pts,b)-(x+M))<20*d),A.forEach(function(V){V.pts=Ji(V.pts,b)}),!n||x<0){const V=A.length;if(A=A.filter(W=>W.pts>=0),V!==A.length&&this.warn(`Removed ${A.length-V} of ${V} samples (initPTS ${M} / ${a})`),!A.length)return;r===0?x=0:s&&!E?x=Math.max(0,b-M):x=A[0].pts-M}if(e.segmentCodec==="aac"){const V=this.config.maxAudioFramesDrift;for(let W=0,q=x+M;W<A.length;W++){const oe=A[W],he=oe.pts,G=he-q,K=Math.abs(1e3*G/a);if(G<=-V*d&&E)W===0&&(this.warn(`Audio frame @ ${(he/a).toFixed(3)}s overlaps marker by ${Math.round(1e3*G/a)} ms.`),this.nextAudioTs=x=he-M,q=he);else if(G>=V*d&&K<fk&&E){let fe=Math.round(G/d);for(q=he-fe*d;q<0&&fe&&d;)fe--,q+=d;W===0&&(this.nextAudioTs=x=q-M),this.warn(`Injecting ${fe} audio frames @ ${((q-M)/a).toFixed(3)}s due to ${Math.round(1e3*G/a)} ms gap.`);for(let Q=0;Q<fe;Q++){let ue=lk.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);ue||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),ue=oe.unit.subarray()),A.splice(W,0,{unit:ue,pts:q}),q+=d,W++}}oe.pts=q,q+=d}}let C=null,N=null,U,w=0,O=A.length;for(;O--;)w+=A[O].unit.byteLength;for(let V=0,W=A.length;V<W;V++){const q=A[V],oe=q.unit;let he=q.pts;if(N!==null){const K=y[V-1];K.duration=Math.round((he-N)/f)}else if(n&&e.segmentCodec==="aac"&&(he=x+M),C=he,w>0){w+=S;try{U=new Uint8Array(w)}catch(K){this.observer.emit(P.ERROR,P.ERROR,{type:lt.MUX_ERROR,details:ce.REMUX_ALLOC_ERROR,fatal:!1,error:K,bytes:w,reason:`fail allocating audio mdat ${w}`});return}m||(new DataView(U.buffer).setUint32(0,w),U.set(le.types.mdat,4))}else return;U.set(oe,S);const G=oe.byteLength;S+=G,y.push(Ux(!0,c,G,0)),N=he}const L=y.length;if(!L)return;const I=y[y.length-1];x=N-M,this.nextAudioTs=x+f*I.duration;const F=m?new Uint8Array(0):le.moof(e.sequenceNumber++,C/f,pn({},e,{samples:y}));e.samples=[];const X=(C-M)/a,Y=this.nextAudioTs/a,ne={data1:F,data2:U,startPTS:X,endPTS:Y,startDTS:X,endDTS:Y,type:"audio",hasAudio:!0,hasVideo:!1,nb:L};return this.isAudioContiguous=!0,ne}}function Ji(i,e){let t;if(e===null)return i;for(e<i?t=-8589934592:t=8589934592;Math.abs(i-e)>4294967296;)i+=t;return i}function mk(i){for(let e=0;e<i.length;e++)if(i[e].key)return e;return-1}function tM(i,e,t,n){const s=i.samples.length;if(!s)return;const r=i.inputTimeScale;for(let u=0;u<s;u++){const f=i.samples[u];f.pts=Ji(f.pts-t.baseTime*r/t.timescale,e*r)/r,f.dts=Ji(f.dts-n.baseTime*r/n.timescale,e*r)/r}const a=i.samples;return i.samples=[],{samples:a}}function nM(i,e,t){const n=i.samples.length;if(!n)return;const s=i.inputTimeScale;for(let a=0;a<n;a++){const u=i.samples[a];u.pts=Ji(u.pts-t.baseTime*s/t.timescale,e*s)/s}i.samples.sort((a,u)=>a.pts-u.pts);const r=i.samples;return i.samples=[],{samples:r}}class gk extends ms{constructor(e,t,n,s){super("passthrough-remuxer",s),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,n,s){this.audioCodec=t,this.videoCodec=n,this.generateInitSegment(e,s),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:n,videoCodec:s}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:r,video:a}=this.initData=lb(e);if(t)iF(e,t);else{const f=r||a;f!=null&&f.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${f.codec}")!`)}r&&(n=Ox(r,vn.AUDIO,this)),a&&(s=Ox(a,vn.VIDEO,this));const u={};r&&a?u.audiovideo={container:"video/mp4",codec:n+","+s,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:r?u.audio={container:"audio/mp4",codec:n,encrypted:r.encrypted,initSegment:e,id:"audio"}:a?u.video={container:"video/mp4",codec:s,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=u}remux(e,t,n,s,r,a){var u,f;let{initPTS:c,lastEndTime:d}=this;const p={audio:void 0,video:void 0,text:s,id3:n,initSegment:void 0};Ye(d)||(d=this.lastEndTime=r||0);const m=t.samples;if(!m.length)return p;const y={initPTS:void 0,timescale:void 0,trackId:void 0};let E=this.initData;if((u=E)!=null&&u.length||(this.generateInitSegment(m),E=this.initData),!((f=E)!=null&&f.length))return this.warn("Failed to generate initSegment."),p;this.emitInitSegment&&(y.tracks=this.initTracks,this.emitInitSegment=!1);const A=rF(m,E,this),S=E.audio?A[E.audio.id]:null,x=E.video?A[E.video.id]:null,M=Rf(x,1/0),b=Rf(S,1/0),C=Rf(x,0,!0),N=Rf(S,0,!0);let U=r,w=0;const O=S&&(!x||!c&&b<M||c&&c.trackId===E.audio.id),L=O?S:x;if(L){const q=L.timescale,oe=L.start-r*q,he=O?E.audio.id:E.video.id;U=L.start/q,w=O?N-b:C-M,(a||!c)&&(vk(c,U,r,w)||q!==c.timescale)&&(c&&this.warn(`Timestamps at playlist time: ${a?"":"~"}${r} ${oe/q} != initPTS: ${c.baseTime/c.timescale} (${c.baseTime}/${c.timescale}) trackId: ${c.trackId}`),this.log(`Found initPTS at playlist time: ${r} offset: ${U-r} (${oe}/${q}) trackId: ${he}`),c=null,y.initPTS=oe,y.timescale=q,y.trackId=he)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${r}`);c?(y.initPTS=c.baseTime,y.timescale=c.timescale,y.trackId=c.trackId):((!y.timescale||y.trackId===void 0||y.initPTS===void 0)&&(this.warn("Could not set initPTS"),y.initPTS=U,y.timescale=1,y.trackId=-1),this.initPTS=c={baseTime:y.initPTS,timescale:y.timescale,trackId:y.trackId});const I=U-c.baseTime/c.timescale,F=I+w;w>0?this.lastEndTime=F:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const X=!!E.audio,Y=!!E.video;let ee="";X&&(ee+="audio"),Y&&(ee+="video");const ne=(E.audio?E.audio.encrypted:!1)||(E.video?E.video.encrypted:!1),V={data1:m,startPTS:I,startDTS:I,endPTS:F,endDTS:F,type:ee,hasAudio:X,hasVideo:Y,nb:1,dropped:0,encrypted:ne};p.audio=X&&!Y?V:void 0,p.video=Y?V:void 0;const W=x==null?void 0:x.sampleCount;if(W){const q=x.keyFrameIndex,oe=q!==-1;V.nb=W,V.dropped=q===0||this.isVideoContiguous?0:oe?q:W,V.independent=oe,V.firstKeyFrame=q,oe&&x.keyFrameStart&&(V.firstKeyFramePTS=(x.keyFrameStart-c.baseTime)/c.timescale),this.isVideoContiguous||(p.independent=oe),this.isVideoContiguous||(this.isVideoContiguous=oe),V.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${q}/${W} dropped: ${V.dropped} start: ${V.firstKeyFramePTS||"NA"}`)}return p.initSegment=y,p.id3=tM(n,r,c,c),s.samples.length&&(p.text=nM(s,r,c)),p}}function Rf(i,e,t=!1){return(i==null?void 0:i.start)!==void 0?(i.start+(t?i.duration:0))/i.timescale:e}function vk(i,e,t,n){if(i===null)return!0;const s=Math.max(n,1),r=e-i.baseTime/i.timescale;return Math.abs(r-t)>s}function Ox(i,e,t){const n=i.codec;return n&&n.length>4?n:e===vn.AUDIO?n==="ec-3"||n==="ac-3"||n==="alac"?n:n==="fLaC"||n==="Opus"?bd(n,!1):(t.warn(`Unhandled audio codec "${n}" in mp4 MAP`),n||"mp4a"):(t.warn(`Unhandled video codec "${n}" in mp4 MAP`),n||"avc1")}let Er;try{Er=self.performance.now.bind(self.performance)}catch{Er=Date.now}const ud=[{demux:nk,remux:gk},{demux:co,remux:ld},{demux:Z2,remux:ld},{demux:ek,remux:ld}];ud.splice(2,0,{demux:j2,remux:ld});class Fx{constructor(e,t,n,s,r,a){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=n,this.id=r,this.logger=a}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,n,s){const r=n.transmuxing;r.executeStart=Er();let a=new Uint8Array(e);const{currentTransmuxState:u,transmuxConfig:f}=this;s&&(this.currentTransmuxState=s);const{contiguous:c,discontinuity:d,trackSwitch:p,accurateTimeOffset:m,timeOffset:y,initSegmentChange:E}=s||u,{audioCodec:A,videoCodec:S,defaultInitPts:x,duration:M,initSegmentData:b}=f,C=yk(a,t);if(C&&gl(C.method)){const O=this.getDecrypter(),L=X0(C.method);if(O.isSync()){let I=O.softwareDecrypt(a,C.key.buffer,C.iv.buffer,L);if(n.part>-1){const X=O.flush();I=X&&X.buffer}if(!I)return r.executeEnd=Er(),xm(n);a=new Uint8Array(I)}else return this.asyncResult=!0,this.decryptionPromise=O.webCryptoDecrypt(a,C.key.buffer,C.iv.buffer,L).then(I=>{const F=this.push(I,null,n);return this.decryptionPromise=null,F}),this.decryptionPromise}const N=this.needsProbing(d,p);if(N){const O=this.configureTransmuxer(a);if(O)return this.logger.warn(`[transmuxer] ${O.message}`),this.observer.emit(P.ERROR,P.ERROR,{type:lt.MEDIA_ERROR,details:ce.FRAG_PARSING_ERROR,fatal:!1,error:O,reason:O.message}),r.executeEnd=Er(),xm(n)}(d||p||E||N)&&this.resetInitSegment(b,A,S,M,t),(d||E||N)&&this.resetInitialTimestamp(x),c||this.resetContiguity();const U=this.transmux(a,C,y,m,n);this.asyncResult=Yu(U);const w=this.currentTransmuxState;return w.contiguous=!0,w.discontinuity=!1,w.trackSwitch=!1,r.executeEnd=Er(),U}flush(e){const t=e.transmuxing;t.executeStart=Er();const{decrypter:n,currentTransmuxState:s,decryptionPromise:r}=this;if(r)return this.asyncResult=!0,r.then(()=>this.flush(e));const a=[],{timeOffset:u}=s;if(n){const p=n.flush();p&&a.push(this.push(p.buffer,null,e))}const{demuxer:f,remuxer:c}=this;if(!f||!c){t.executeEnd=Er();const p=[xm(e)];return this.asyncResult?Promise.resolve(p):p}const d=f.flush(u);return Yu(d)?(this.asyncResult=!0,d.then(p=>(this.flushRemux(a,p,e),a))):(this.flushRemux(a,d,e),this.asyncResult?Promise.resolve(a):a)}flushRemux(e,t,n){const{audioTrack:s,videoTrack:r,id3Track:a,textTrack:u}=t,{accurateTimeOffset:f,timeOffset:c}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${n.sn}${n.part>-1?" part: "+n.part:""} of ${this.id===et.MAIN?"level":"track"} ${n.level}`);const d=this.remuxer.remux(s,r,a,u,c,f,!0,this.id);e.push({remuxResult:d,chunkMeta:n}),n.transmuxing.executeEnd=Er()}resetInitialTimestamp(e){const{demuxer:t,remuxer:n}=this;!t||!n||(t.resetTimeStamp(e),n.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,n,s,r){const{demuxer:a,remuxer:u}=this;!a||!u||(a.resetInitSegment(e,t,n,s),u.resetInitSegment(e,t,n,r))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,n,s,r){let a;return t&&t.method==="SAMPLE-AES"?a=this.transmuxSampleAes(e,t,n,s,r):a=this.transmuxUnencrypted(e,n,s,r),a}transmuxUnencrypted(e,t,n,s){const{audioTrack:r,videoTrack:a,id3Track:u,textTrack:f}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(r,a,u,f,t,n,!1,this.id),chunkMeta:s}}transmuxSampleAes(e,t,n,s,r){return this.demuxer.demuxSampleAes(e,t,n).then(a=>({remuxResult:this.remuxer.remux(a.audioTrack,a.videoTrack,a.id3Track,a.textTrack,n,s,!1,this.id),chunkMeta:r}))}configureTransmuxer(e){const{config:t,observer:n,typeSupported:s}=this;let r;for(let p=0,m=ud.length;p<m;p++){var a;if((a=ud[p].demux)!=null&&a.probe(e,this.logger)){r=ud[p];break}}if(!r)return new Error("Failed to find demuxer by probing fragment data");const u=this.demuxer,f=this.remuxer,c=r.remux,d=r.demux;(!f||!(f instanceof c))&&(this.remuxer=new c(n,t,s,this.logger)),(!u||!(u instanceof d))&&(this.demuxer=new d(n,t,s,this.logger),this.probe=d.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new K0(this.config)),e}}function yk(i,e){let t=null;return i.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const xm=i=>({remuxResult:{},chunkMeta:i});function Yu(i){return"then"in i&&i.then instanceof Function}class _k{constructor(e,t,n,s,r){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=n,this.duration=s,this.defaultInitPts=r||null}}class Ek{constructor(e,t,n,s,r,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=n,this.trackSwitch=s,this.timeOffset=r,this.initSegmentChange=a}}let kx=0;class iM{constructor(e,t,n,s){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=kx++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=f=>{const c=f.data,d=this.hls;if(!(!d||!(c!=null&&c.event)||c.instanceNo!==this.instanceNo))switch(c.event){case"init":{var p;const m=(p=this.workerContext)==null?void 0:p.objectURL;m&&self.URL.revokeObjectURL(m);break}case"transmuxComplete":{this.handleTransmuxComplete(c.data);break}case"flush":{this.onFlush(c.data);break}case"workerLog":{d.logger[c.data.logType]&&d.logger[c.data.logType](c.data.message);break}default:{c.data=c.data||{},c.data.frag=this.frag,c.data.part=this.part,c.data.id=this.id,d.trigger(c.event,c.data);break}}},this.onWorkerError=f=>{if(!this.hls)return;const c=new Error(`${f.message}  (${f.filename}:${f.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(P.ERROR,{type:lt.OTHER_ERROR,details:ce.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:c})};const r=e.config;this.hls=e,this.id=t,this.useWorker=!!r.enableWorker,this.onTransmuxComplete=n,this.onFlush=s;const a=(f,c)=>{c=c||{},c.frag=this.frag||void 0,f===P.ERROR&&(c=c,c.parent=this.id,c.part=this.part,this.error=c.error),this.hls.trigger(f,c)};this.observer=new Z0,this.observer.on(P.FRAG_DECRYPTED,a),this.observer.on(P.ERROR,a);const u=jT(r.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const f=this.hls.logger;if(r.workerPath||A2()){try{r.workerPath?(f.log(`loading Web Worker ${r.workerPath} for "${t}"`),this.workerContext=b2(r.workerPath)):(f.log(`injecting Web Worker for "${t}"`),this.workerContext=R2());const{worker:d}=this.workerContext;d.addEventListener("message",this.onWorkerMessage),d.addEventListener("error",this.onWorkerError),d.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:u,id:t,config:yn(r)})}catch(d){f.warn(`Error setting up "${t}" Web Worker, fallback to inline`,d),this.terminateWorker(),this.error=null,this.transmuxer=new Fx(this.observer,u,r,"",t,e.logger)}return}}this.transmuxer=new Fx(this.observer,u,r,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=kx++;const t=this.hls.config,n=jT(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:n,id:this.id,config:yn(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),M2(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,n,s,r,a,u,f,c,d){var p,m;c.transmuxing.start=self.performance.now();const{instanceNo:y,transmuxer:E}=this,A=a?a.start:r.start,S=r.decryptdata,x=this.frag,M=!(x&&r.cc===x.cc),b=!(x&&c.level===x.level),C=x?c.sn-x.sn:-1,N=this.part?c.part-this.part.index:-1,U=C===0&&c.id>1&&c.id===(x==null?void 0:x.stats.chunkCount),w=!b&&(C===1||C===0&&(N===1||U&&N<=0)),O=self.performance.now();(b||C||r.stats.parsing.start===0)&&(r.stats.parsing.start=O),a&&(N||!w)&&(a.stats.parsing.start=O);const L=!(x&&((p=r.initSegment)==null?void 0:p.url)===((m=x.initSegment)==null?void 0:m.url)),I=new Ek(M,w,f,b,A,L);if(!w||M||L){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${r.type} sn: ${c.sn}${c.part>-1?" part: "+c.part:""} ${this.id===et.MAIN?"level":"track"}: ${c.level} id: ${c.id}
        discontinuity: ${M}
        trackSwitch: ${b}
        contiguous: ${w}
        accurateTimeOffset: ${f}
        timeOffset: ${A}
        initSegmentChange: ${L}`);const F=new _k(n,s,t,u,d);this.configureTransmuxer(F)}if(this.frag=r,this.part=a,this.workerContext)this.workerContext.worker.postMessage({instanceNo:y,cmd:"demux",data:e,decryptdata:S,chunkMeta:c,state:I},e instanceof ArrayBuffer?[e]:[]);else if(E){const F=E.push(e,S,c,I);Yu(F)?F.then(X=>{this.handleTransmuxComplete(X)}).catch(X=>{this.transmuxerError(X,c,"transmuxer-interface push error")}):this.handleTransmuxComplete(F)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:n}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(n){const s=n.flush(e);Yu(s)?s.then(r=>{this.handleFlushResult(r,e)}).catch(r=>{this.transmuxerError(r,e,"transmuxer-interface flush error")}):this.handleFlushResult(s,e)}}transmuxerError(e,t,n){this.hls&&(this.error=e,this.hls.trigger(P.ERROR,{type:lt.MEDIA_ERROR,details:ce.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:n}))}handleFlushResult(e,t){e.forEach(n=>{this.handleTransmuxComplete(n)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:n}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):n&&n.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const Bx=100;class Sk extends Q0{constructor(e,t,n){super(e,t,n,"audio-stream-controller",et.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(P.LEVEL_LOADED,this.onLevelLoaded,this),e.on(P.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(P.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(P.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(P.BUFFER_RESET,this.onBufferReset,this),e.on(P.BUFFER_CREATED,this.onBufferCreated,this),e.on(P.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(P.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(P.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(P.FRAG_LOADING,this.onFragLoading,this),e.on(P.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(P.LEVEL_LOADED,this.onLevelLoaded,this),e.off(P.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(P.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(P.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(P.BUFFER_RESET,this.onBufferReset,this),e.off(P.BUFFER_CREATED,this.onBufferCreated,this),e.off(P.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(P.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(P.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(P.FRAG_LOADING,this.onFragLoading,this),e.off(P.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:n,initPTS:s,timescale:r,trackId:a}){if(n===et.MAIN){const u=t.cc,f=this.fragCurrent;if(this.initPTS[u]={baseTime:s,timescale:r,trackId:a},this.log(`InitPTS for cc: ${u} found from main: ${s/r} (${s}/${r}) trackId: ${a}`),this.mainAnchor=t,this.state===Ce.WAITING_INIT_PTS){const c=this.waitingData;(!c&&!this.loadingParts||c&&c.frag.cc!==u)&&this.syncWithAnchor(t,c==null?void 0:c.frag)}else!this.hls.hasEnoughToStart&&f&&f.cc!==u?(f.abortRequests(),this.syncWithAnchor(t,f)):this.state===Ce.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var n;const s=((n=this.mainFragLoading)==null?void 0:n.frag)||null;if(t&&(s==null?void 0:s.cc)===t.cc)return;const r=(s||e).cc,a=this.getLevelDetails(),u=this.getLoadPosition(),f=_b(a,r,u);f&&(this.log(`Syncing with main frag at ${f.start} cc ${f.cc}`),this.startFragRequested=!1,this.nextLoadPosition=f.start,this.resetLoadingState(),this.state===Ce.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=Ce.STOPPED;return}const n=this.lastCurrentTime;this.stopLoad(),this.setInterval(Bx),n>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${n.toFixed(3)}`),e=n,this.state=Ce.IDLE):this.state=Ce.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case Ce.IDLE:this.doTickIdle();break;case Ce.WAITING_TRACK:{const{levels:e,trackId:t}=this,n=e==null?void 0:e[t],s=n==null?void 0:n.details;if(s&&!this.waitForLive(n)){if(this.waitForCdnTuneIn(s))break;this.state=Ce.WAITING_INIT_PTS}break}case Ce.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case Ce.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:n,cache:s,complete:r}=e,a=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=Ce.FRAG_LOADING;const u=s.flush().buffer,f={frag:t,part:n,payload:u,networkDetails:null};this._handleFragmentLoadProgress(f),r&&super._handleFragmentLoadComplete(f)}else a&&a.cc!==e.frag.cc&&this.syncWithAnchor(a,e.frag)}else this.state=Ce.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:n,media:s,trackId:r}=this,a=t.config;if(!this.buffering||!s&&!this.primaryPrefetch&&(this.startFragRequested||!a.startFragPrefetch)||!(n!=null&&n[r]))return;const u=n[r],f=u.details;if(!f||this.waitForLive(u)||this.waitForCdnTuneIn(f)){this.state=Ce.WAITING_TRACK,this.startFragRequested=!1;return}const c=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&c&&(this.bufferFlushed=!1,this.afterBufferFlushed(c,vn.AUDIO,et.AUDIO));const d=this.getFwdBufferInfo(c,et.AUDIO);if(d===null)return;if(!this.switchingTrack&&this._streamEnded(d,f)){t.trigger(P.BUFFER_EOS,{type:"audio"}),this.state=Ce.ENDED;return}const p=d.len,m=t.maxBufferLength,y=f.fragments,E=y[0].start,A=this.getLoadPosition(),S=this.flushing?A:d.end;if(this.switchingTrack&&s){const b=A;f.PTSKnown&&b<E&&(d.end>E||d.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),s.currentTime=E+.05)}if(p>=m&&!this.switchingTrack&&S<y[y.length-1].start)return;let x=this.getNextFragment(S,f);if(x&&this.isLoopLoading(x,S)&&(x=this.getNextFragmentLoopLoading(x,f,d,et.MAIN,m)),!x){this.bufferFlushed=!0;return}let M=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&M&&Nn(x)&&!x.endList&&(!f.live||!this.loadingParts&&S<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(M)===Xn.OK&&(this.mainFragLoading=M=null),M&&Nn(M))){if(x.start>M.end){const C=this.fragmentTracker.getFragAtPos(S,et.MAIN);C&&C.end>M.end&&(M=C,this.mainFragLoading={frag:C,targetBufferTime:null})}if(x.start>M.end)return}this.loadFragment(x,u,S)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(n=>new qu(n))}onAudioTrackSwitching(e,t){const n=!!t.url;this.trackId=t.id;const{fragCurrent:s}=this;s&&(s.abortRequests(),this.removeUnbufferedFrags(s.start)),this.resetLoadingState(),n?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==Ce.STOPPED&&(this.setInterval(Bx),this.state=Ce.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const n=this.cachedTrackLoadedData;n&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(P.AUDIO_TRACK_LOADED,n))}onAudioTrackLoaded(e,t){var n;const{levels:s}=this,{details:r,id:a,groupId:u,track:f}=t;if(!s){this.warn(`Audio tracks reset while loading track ${a} "${f.name}" of "${u}"`);return}const c=this.mainDetails;if(!c||r.endCC>c.endCC||c.expired){this.cachedTrackLoadedData=t,this.state!==Ce.STOPPED&&(this.state=Ce.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${a} "${f.name}" of "${u}" loaded [${r.startSN},${r.endSN}]${r.lastPartSn?`[part-${r.lastPartSn}-${r.lastPartIndex}]`:""},duration:${r.totalduration}`);const d=s[a];let p=0;if(r.live||(n=d.details)!=null&&n.live){if(this.checkLiveUpdate(r),r.deltaUpdateFailed)return;if(d.details){var m;p=this.alignPlaylists(r,d.details,(m=this.levelLastLoaded)==null?void 0:m.details)}r.alignedSliding||(Fb(r,c),r.alignedSliding||Pd(r,c),p=r.fragmentStart)}d.details=r,this.levelLastLoaded=d,this.startFragRequested||this.setStartPosition(c,p),this.hls.trigger(P.AUDIO_TRACK_UPDATED,{details:r,id:a,groupId:t.groupId}),this.state===Ce.WAITING_TRACK&&!this.waitForCdnTuneIn(r)&&(this.state=Ce.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:s,payload:r}=e,{config:a,trackId:u,levels:f}=this;if(!f){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const c=f[u];if(!c){this.warn("Audio track is undefined on fragment load progress");return}const d=c.details;if(!d){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(n.start);return}const p=a.defaultAudioCodec||c.audioCodec||"mp4a.40.2";let m=this.transmuxer;m||(m=this.transmuxer=new iM(this.hls,et.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const y=this.initPTS[n.cc],E=(t=n.initSegment)==null?void 0:t.data;if(y!==void 0){const S=s?s.index:-1,x=S!==-1,M=new Y0(n.level,n.sn,n.stats.chunkCount,r.byteLength,S,x);m.push(r,E,p,"",n,s,d.totalduration,!1,M,y)}else{this.log(`Unknown video PTS for cc ${n.cc}, waiting for video PTS before demuxing audio frag ${n.sn} of [${d.startSN} ,${d.endSN}],track ${u}`);const{cache:A}=this.waitingData=this.waitingData||{frag:n,part:s,cache:new kb,complete:!1};A.push(new Uint8Array(r)),this.state!==Ce.STOPPED&&(this.state=Ce.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const n=t.tracks.audio;n&&(this.mediaBuffer=n.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===et.MAIN&&Nn(t.frag)&&(this.mainFragLoading=t,this.state===Ce.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:n,part:s}=t;if(n.type!==et.AUDIO){!this.audioOnly&&n.type===et.MAIN&&!n.elementaryStreams.video&&!n.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${s?" p: "+s.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(Nn(n)){this.fragPrevious=n;const r=this.switchingTrack;r&&(this.bufferedTrack=r,this.switchingTrack=null,this.hls.trigger(P.AUDIO_TRACK_SWITCHED,on({},r)))}this.fragBufferedComplete(n,s),this.media&&this.tick()}onError(e,t){var n;if(t.fatal){this.state=Ce.ERROR;return}switch(t.details){case ce.FRAG_GAP:case ce.FRAG_PARSING_ERROR:case ce.FRAG_DECRYPT_ERROR:case ce.FRAG_LOAD_ERROR:case ce.FRAG_LOAD_TIMEOUT:case ce.KEY_LOAD_ERROR:case ce.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(et.AUDIO,t);break;case ce.AUDIO_TRACK_LOAD_ERROR:case ce.AUDIO_TRACK_LOAD_TIMEOUT:case ce.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===Ce.WAITING_TRACK&&((n=t.context)==null?void 0:n.type)===Nt.AUDIO_TRACK&&(this.state=Ce.IDLE);break;case ce.BUFFER_ADD_CODEC_ERROR:case ce.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case ce.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case ce.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==vn.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==vn.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===Ce.ENDED&&(this.state=Ce.IDLE);const n=this.mediaBuffer||this.media;n&&(this.afterBufferFlushed(n,t,et.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const n="audio",{hls:s}=this,{remuxResult:r,chunkMeta:a}=e,u=this.getCurrentContext(a);if(!u){this.resetWhenMissingContext(a);return}const{frag:f,part:c,level:d}=u,{details:p}=d,{audio:m,text:y,id3:E,initSegment:A}=r;if(this.fragContextChanged(f)||!p){this.fragmentTracker.removeFragment(f);return}if(this.state=Ce.PARSING,this.switchingTrack&&m&&this.completeAudioSwitch(this.switchingTrack),A!=null&&A.tracks){const S=f.initSegment||f;if(this.unhandledEncryptionError(A,f))return;this._bufferInitSegment(d,A.tracks,S,a),s.trigger(P.FRAG_PARSING_INIT_SEGMENT,{frag:S,id:n,tracks:A.tracks})}if(m){const{startPTS:S,endPTS:x,startDTS:M,endDTS:b}=m;c&&(c.elementaryStreams[vn.AUDIO]={startPTS:S,endPTS:x,startDTS:M,endDTS:b}),f.setElementaryStreamInfo(vn.AUDIO,S,x,M,b),this.bufferFragmentData(m,f,c,a)}if(E!=null&&(t=E.samples)!=null&&t.length){const S=pn({id:n,frag:f,details:p},E);s.trigger(P.FRAG_PARSING_METADATA,S)}if(y){const S=pn({id:n,frag:f,details:p},y);s.trigger(P.FRAG_PARSING_USERDATA,S)}}_bufferInitSegment(e,t,n,s){if(this.state!==Ce.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const r=t.audio;r.id=et.AUDIO;const a=e.audioCodec;this.log(`Init audio buffer, container:${r.container}, codecs[level/parsed]=[${a}/${r.codec}]`),a&&a.split(",").length===1&&(r.levelCodec=a),this.hls.trigger(P.BUFFER_CODECS,t);const u=r.initSegment;if(u!=null&&u.byteLength){const f={type:"audio",frag:n,part:null,chunkMeta:s,parent:n.type,data:u};this.hls.trigger(P.BUFFER_APPENDING,f)}this.tickImmediate()}loadFragment(e,t,n){const s=this.fragmentTracker.getState(e);if(this.switchingTrack||s===Xn.NOT_LOADED||s===Xn.PARTIAL){var r;if(!Nn(e))this._loadInitSegment(e,t);else if((r=t.details)!=null&&r.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=Ce.WAITING_INIT_PTS;const a=this.mainDetails;a&&a.fragmentStart!==t.details.fragmentStart&&Pd(t.details,a)}else super.loadFragment(e,t,n)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:n,assocLang:s,characteristics:r,audioCodec:a,channels:u}=this.bufferedTrack;na({name:t,lang:n,assocLang:s,characteristics:r,audioCodec:a,channels:u},e,Xo)||(Cd(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(P.AUDIO_TRACK_SWITCHED,on({},e))}}class rv extends ms{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,n){const s=t==null?void 0:t.renditionReports;if(s){let r=-1;for(let a=0;a<s.length;a++){const u=s[a];let f;try{f=new self.URL(u.URI,t.url).href}catch(c){this.warn(`Could not construct new URL for Rendition Report: ${c}`),f=u.URI||""}if(f===e){r=a;break}else f===e.substring(0,f.length)&&(r=a)}if(r!==-1){const a=s[r],u=parseInt(a["LAST-MSN"])||t.lastPartSn;let f=parseInt(a["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const d=Math.min(t.age-t.partTarget,t.targetduration);f>=0&&d>t.partTarget&&(f+=1)}const c=n&&ex(n);return new tx(u,f>=0?f:void 0,c)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(n){this.warn(`Could not construct new URL with HLS Delivery Directives: ${n}`)}return e}playlistLoaded(e,t,n){const{details:s,stats:r}=t,a=self.performance.now(),u=r.loading.first?Math.max(0,a-r.loading.first):0;s.advancedDateTime=Date.now()-u;const f=this.hls.config.timelineOffset;if(f!==s.appliedTimelineOffset){const d=Math.max(f||0,0);s.appliedTimelineOffset=d,s.fragments.forEach(p=>{p.setStart(p.playlistOffset+d)})}if(s.live||n!=null&&n.live){const d="levelInfo"in t?t.levelInfo:t.track;if(s.reloaded(n),n&&s.fragments.length>0){h2(n,s,this);const M=s.playlistParsingError;if(M){this.warn(M);const b=this.hls;if(!b.config.ignorePlaylistParsingErrors){var c;const{networkDetails:C}=t;b.trigger(P.ERROR,{type:lt.NETWORK_ERROR,details:ce.LEVEL_PARSING_ERROR,fatal:!1,url:s.url,error:M,reason:M.message,level:t.level||void 0,parent:(c=s.fragments[0])==null?void 0:c.type,networkDetails:C,stats:r});return}s.playlistParsingError=null}}s.requestScheduled===-1&&(s.requestScheduled=r.loading.start);const p=this.hls.mainForwardBufferInfo,m=p?p.end-p.len:0,y=(s.edge-m)*1e3,E=wb(s,y);if(s.requestScheduled+E<a?s.requestScheduled=a:s.requestScheduled+=E,this.log(`live playlist ${e} ${s.advanced?"REFRESHED "+s.lastPartSn+"-"+s.lastPartIndex:s.updated?"UPDATED":"MISSED"}`),!this.canLoad||!s.live)return;let A,S,x;if(s.canBlockReload&&s.endSN&&s.advanced){const M=this.hls.config.lowLatencyMode,b=s.lastPartSn,C=s.endSN,N=s.lastPartIndex,U=N!==-1,w=b===C;U?w?(S=C+1,x=M?0:N):(S=b,x=M?N+1:s.maxPartIndex):S=C+1;const O=s.age,L=O+s.ageHeader;let I=Math.min(L-s.partTarget,s.targetduration*1.5);if(I>0){if(L>s.targetduration*3)this.log(`Playlist last advanced ${O.toFixed(2)}s ago. Omitting segment and part directives.`),S=void 0,x=void 0;else if(n!=null&&n.tuneInGoal&&L-s.partTarget>n.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${n.tuneInGoal} to: ${I} with playlist age: ${s.age}`),I=0;else{const F=Math.floor(I/s.targetduration);if(S+=F,x!==void 0){const X=Math.round(I%s.targetduration/s.partTarget);x+=X}this.log(`CDN Tune-in age: ${s.ageHeader}s last advanced ${O.toFixed(2)}s goal: ${I} skip sn ${F} to part ${x}`)}s.tuneInGoal=I}if(A=this.getDeliveryDirectives(s,t.deliveryDirectives,S,x),M||!w){s.requestScheduled=a,this.loadingPlaylist(d,A);return}}else(s.canBlockReload||s.canSkipUntil)&&(A=this.getDeliveryDirectives(s,t.deliveryDirectives,S,x));A&&S!==void 0&&s.canBlockReload&&(s.requestScheduled=r.loading.first+Math.max(E-u*2,E/2)),this.scheduleLoading(d,A,s)}else this.clearTimer()}scheduleLoading(e,t,n){const s=n||e.details;if(!s){this.loadingPlaylist(e,t);return}const r=self.performance.now(),a=s.requestScheduled;if(r>=a){this.loadingPlaylist(e,t);return}const u=a-r;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(u)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),u)}getDeliveryDirectives(e,t,n,s){let r=ex(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(n=t.msn,s=t.part,r=od.No),new tx(n,s,r)}checkRetry(e){const t=e.details,n=Id(e),s=e.errorAction,{action:r,retryCount:a=0,retryConfig:u}=s||{},f=!!s&&!!u&&(r===li.RetryRequest||!s.resolved&&r===li.SendAlternateToPenaltyBox);if(f){var c;if(a>=u.maxNumRetry)return!1;if(n&&(c=e.context)!=null&&c.deliveryDirectives)this.warn(`Retrying playlist loading ${a+1}/${u.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const d=W0(u,a);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),d),this.warn(`Retrying playlist loading ${a+1}/${u.maxNumRetry} after "${t}" in ${d}ms`)}e.levelRetry=!0,s.resolved=!0}return f}}function sM(i,e){if(i.length!==e.length)return!1;for(let t=0;t<i.length;t++)if(!Xu(i[t].attrs,e[t].attrs))return!1;return!0}function Xu(i,e,t){const n=i["STABLE-RENDITION-ID"];return n&&!t?n===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(s=>i[s]!==e[s])}function Og(i,e){return e.label.toLowerCase()===i.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(i.lang||"").toLowerCase())}class Tk extends rv{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(P.MANIFEST_LOADING,this.onManifestLoading,this),e.on(P.MANIFEST_PARSED,this.onManifestParsed,this),e.on(P.LEVEL_LOADING,this.onLevelLoading,this),e.on(P.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(P.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(P.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(P.MANIFEST_LOADING,this.onManifestLoading,this),e.off(P.MANIFEST_PARSED,this.onManifestParsed,this),e.off(P.LEVEL_LOADING,this.onLevelLoading,this),e.off(P.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(P.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(P.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:n,groupId:s,details:r}=t,a=this.tracksInGroup[n];if(!a||a.groupId!==s){this.warn(`Audio track with id:${n} and group:${s} not found in active group ${a==null?void 0:a.groupId}`);return}const u=a.details;a.details=t.details,this.log(`Audio track ${n} "${a.name}" lang:${a.lang} group:${s} loaded [${r.startSN}-${r.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,u)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.audioGroups||null,s=this.groupIds;let r=this.currentTrack;if(!n||(s==null?void 0:s.length)!==(n==null?void 0:n.length)||n!=null&&n.some(u=>(s==null?void 0:s.indexOf(u))===-1)){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const u=this.tracks.filter(m=>!n||n.indexOf(m.groupId)!==-1);if(u.length)this.selectDefaultTrack&&!u.some(m=>m.default)&&(this.selectDefaultTrack=!1),u.forEach((m,y)=>{m.id=y});else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=u;const f=this.hls.config.audioPreference;if(!r&&f){const m=Gs(f,u,Xo);if(m>-1)r=u[m];else{const y=Gs(f,this.tracks);r=this.tracks[y]}}let c=this.findTrackId(r);c===-1&&r&&(c=this.findTrackId(null));const d={audioTracks:u};this.log(`Updating audio tracks, ${u.length} track(s) found in group(s): ${n==null?void 0:n.join(",")}`),this.hls.trigger(P.AUDIO_TRACKS_UPDATED,d);const p=this.trackId;if(c!==-1&&p===-1)this.setAudioTrack(c);else if(u.length&&p===-1){var a;const m=new Error(`No audio track selected for current audio group-ID(s): ${(a=this.groupIds)==null?void 0:a.join(",")} track count: ${u.length}`);this.warn(m.message),this.hls.trigger(P.ERROR,{type:lt.MEDIA_ERROR,details:ce.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:m})}}}onError(e,t){t.fatal||!t.context||t.context.type===Nt.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const n=this.allAudioTracks;if(this.selectDefaultTrack=!1,n.length){const s=this.currentTrack;if(s&&na(e,s,Xo))return s;const r=Gs(e,this.tracksInGroup,Xo);if(r>-1){const a=this.tracksInGroup[r];return this.setAudioTrack(r),a}else if(s){let a=t.loadLevel;a===-1&&(a=t.firstAutoLevel);const u=NF(e,t.levels,n,a,Xo);if(u===-1)return null;t.nextLoadLevel=u}if(e.channels||e.audioCodec){const a=Gs(e,n);if(a>-1)return n[a]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const n=this.currentTrack,s=t[e],r=s.details&&!s.details.live;if(e===this.trackId&&s===n&&r||(this.log(`Switching to audio-track ${e} "${s.name}" lang:${s.lang} group:${s.groupId} channels:${s.channels}`),this.trackId=e,this.currentTrack=s,this.hls.trigger(P.AUDIO_TRACK_SWITCHING,on({},s)),r))return;const a=this.switchParams(s.url,n==null?void 0:n.details,s.details);this.loadPlaylist(a)}findTrackId(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const s=t[n];if(!(this.selectDefaultTrack&&!s.default)&&(!e||na(e,s,Xo)))return n}if(e){const{name:n,lang:s,assocLang:r,characteristics:a,audioCodec:u,channels:f}=e;for(let c=0;c<t.length;c++){const d=t[c];if(na({name:n,lang:s,assocLang:r,characteristics:a,audioCodec:u,channels:f},d,Xo))return c}for(let c=0;c<t.length;c++){const d=t[c];if(Xu(e.attrs,d.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return c}for(let c=0;c<t.length;c++){const d=t[c];if(Xu(e.attrs,d.attrs,["LANGUAGE"]))return c}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&Cd(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,s=e.groupId,r=this.getUrlWithDirectives(e.url,t),a=e.details,u=a==null?void 0:a.age;this.log(`Loading audio-track ${n} "${e.name}" lang:${e.lang} group:${s}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${u&&a.live?" age "+u.toFixed(1)+(a.type&&" "+a.type||""):""} ${r}`),this.hls.trigger(P.AUDIO_TRACK_LOADING,{url:r,id:n,groupId:s,deliveryDirectives:t||null,track:e})}}class xk{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,n){if(this.queues===null||this.tracks===null)return;const s=this.queues[t];s.push(e),s.length===1&&!n&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const n={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(n,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const n={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(n)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const n=(t=e[0])==null?void 0:t.label;(n==="async-blocker"||n==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const s=t[0];try{s.execute()}catch(r){var n;if(s.onError(r),this.queues===null||this.tracks===null)return;const a=(n=this.tracks[e])==null?void 0:n.buffer;a!=null&&a.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,n;return(t=this.queues)!=null&&t[e]||(n=this.tracks)!=null&&n[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const n=(t=this.tracks)==null?void 0:t[e],s=n==null?void 0:n.buffer;return s?`SourceBuffer${s.updating?" updating":""}${n.ended?" ended":""}${n.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(n=>n.label).join(", "))||""}}const Gx=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,rM="HlsJsTrackRemovedError";class Ak extends Error{constructor(e){super(e),this.name=rM}}class Rk extends ms{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=n=>{var s;this.hls&&((s=this.mediaSource)==null?void 0:s.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=n=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=n=>{const{media:s,mediaSource:r}=this;n&&this.log("Media source opened"),!(!s||!r)&&(r.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(P.MEDIA_ATTACHED,{media:s,mediaSource:r}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:n,_objectUrl:s}=this;n!==s&&this.error(`Media element src was set while attaching MediaSource (${s} > ${n})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=KO(go(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(P.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(P.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(P.MANIFEST_LOADING,this.onManifestLoading,this),e.on(P.MANIFEST_PARSED,this.onManifestParsed,this),e.on(P.BUFFER_RESET,this.onBufferReset,this),e.on(P.BUFFER_APPENDING,this.onBufferAppending,this),e.on(P.BUFFER_CODECS,this.onBufferCodecs,this),e.on(P.BUFFER_EOS,this.onBufferEos,this),e.on(P.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(P.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(P.FRAG_PARSED,this.onFragParsed,this),e.on(P.FRAG_CHANGED,this.onFragChanged,this),e.on(P.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(P.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(P.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(P.MANIFEST_LOADING,this.onManifestLoading,this),e.off(P.MANIFEST_PARSED,this.onManifestParsed,this),e.off(P.BUFFER_RESET,this.onBufferReset,this),e.off(P.BUFFER_APPENDING,this.onBufferAppending,this),e.off(P.BUFFER_CODECS,this.onBufferCodecs,this),e.off(P.BUFFER_EOS,this.onBufferEos,this),e.off(P.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(P.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(P.FRAG_PARSED,this.onFragParsed,this),e.off(P.FRAG_CHANGED,this.onFragChanged,this),e.off(P.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const n={};if(this.operationQueue){const r=this.isUpdating();r||this.operationQueue.removeBlockers();const a=this.isQueued();(r||a)&&this.warn(`Transfering MediaSource with${a?" operations in queue":""}${r?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const s=this.transferData;return!this.sourceBufferCount&&s&&s.mediaSource===t?pn(n,s.tracks):this.sourceBuffers.forEach(r=>{const[a]=r;a&&(n[a]=pn({},this.tracks[a]),this.removeBuffer(a)),r[0]=r[1]=null}),{media:e,mediaSource:t,tracks:n}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var n;let s=2;(t.audio&&!t.video||!t.altAudio)&&(s=1),this.bufferCodecEventsTotal=s,this.log(`${s} bufferCodec event(s) expected.`),(n=this.transferData)!=null&&n.mediaSource&&this.sourceBufferCount&&s&&this.bufferCreated()}onMediaAttaching(e,t){const n=this.media=t.media;this.transferData=this.overrides=void 0;const s=go(this.appendSource);if(s){const r=!!t.mediaSource;(r||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const a=this.mediaSource=t.mediaSource||new s;if(this.assignMediaSource(a),r)this._objectUrl=n.src,this.attachTransferred();else{const u=this._objectUrl=self.URL.createObjectURL(a);if(this.appendSource)try{n.removeAttribute("src");const f=self.ManagedMediaSource;n.disableRemotePlayback=n.disableRemotePlayback||f&&a instanceof f,Vx(n),bk(n,u),n.load()}catch{n.src=u}else n.src=u}n.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,n;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(n=e.constructor)==null?void 0:n.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const n=this.tracks,s=t.tracks,r=s?Object.keys(s):null,a=r?r.length:0,u=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(s&&r&&a){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${yn(n,(f,c)=>f==="initSegment"?void 0:c)};
transfer tracks: ${yn(s,(f,c)=>f==="initSegment"?void 0:c)}}`),!tb(s,n)){t.mediaSource=null,t.tracks=void 0;const f=e.currentTime,c=this.details,d=Math.max(f,(c==null?void 0:c.fragments[0].start)||0);if(d-f>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${f} -> ${d}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(s)}"->"${Object.keys(n)}") start time: ${d} currentTime: ${f}`),this.onMediaDetaching(P.MEDIA_DETACHING,{}),this.onMediaAttaching(P.MEDIA_ATTACHING,t),e.currentTime=d;return}this.transferData=void 0,r.forEach(f=>{const c=f,d=s[c];if(d){const p=d.buffer;if(p){const m=this.fragmentTracker,y=d.id;if(m.hasFragments(y)||m.hasParts(y)){const S=xt.getBuffered(p);m.detectEvictedFragments(c,S,y,null,!0)}const E=Am(c),A=[c,p];this.sourceBuffers[E]=A,p.updating&&this.operationQueue&&this.operationQueue.prependBlocker(c),this.trackSourceBuffer(c,d)}}}),u(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),u()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const n=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:s,mediaSource:r,_objectUrl:a}=this;if(r){if(this.log(`media source ${n?"transferring":"detaching"}`),n)this.sourceBuffers.forEach(([u])=>{u&&this.removeBuffer(u)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const u=r.readyState==="open";try{const f=r.sourceBuffers;for(let c=f.length;c--;)u&&f[c].abort(),r.removeSourceBuffer(f[c]);u&&r.endOfStream()}catch(f){this.warn(`onMediaDetaching: ${f.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}r.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("sourceended",this._onMediaSourceEnded),r.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(r.removeEventListener("startstreaming",this._onStartStreaming),r.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}s&&(s.removeEventListener("emptied",this._onMediaEmptied),n||(a&&self.URL.revokeObjectURL(a),this.mediaSrc===a?(s.removeAttribute("src"),this.appendSource&&Vx(s),s.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(P.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const n=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),n)try{var s;(s=this.mediaSource)!=null&&s.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(n)}catch(r){this.warn(`onBufferReset ${e}`,r)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[Am(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new xk(this.tracks)}onBufferCodecs(e,t){var n;const s=this.tracks,r=Object.keys(t);this.log(`BUFFER_CODECS: "${r}" (current SB count ${this.sourceBufferCount})`);const a="audiovideo"in t&&(s.audio||s.video)||s.audiovideo&&("audio"in t||"video"in t),u=!a&&this.sourceBufferCount&&this.media&&r.some(f=>!s[f]);if(a||u){this.warn(`Unsupported transition between "${Object.keys(s)}" and "${r}" SourceBuffers`);return}r.forEach(f=>{var c,d;const p=t[f],{id:m,codec:y,levelCodec:E,container:A,metadata:S,supplemental:x}=p;let M=s[f];const b=(c=this.transferData)==null||(c=c.tracks)==null?void 0:c[f],C=b!=null&&b.buffer?b:M,N=(C==null?void 0:C.pendingCodec)||(C==null?void 0:C.codec),U=C==null?void 0:C.levelCodec;M||(M=s[f]={buffer:void 0,listeners:[],codec:y,supplemental:x,container:A,levelCodec:E,metadata:S,id:m});const w=rd(N,U),O=w==null?void 0:w.replace(Gx,"$1");let L=rd(y,E);const I=(d=L)==null?void 0:d.replace(Gx,"$1");L&&w&&O!==I&&(f.slice(0,5)==="audio"&&(L=bd(L,this.appendSource)),this.log(`switching codec ${N} to ${L}`),L!==(M.pendingCodec||M.codec)&&(M.pendingCodec=L),M.container=A,this.appendChangeType(f,A,L))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((n=t.audio)==null?void 0:n.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const n=this.tracks[t];return e[t]={id:n.id,container:n.container,codec:n.codec,levelCodec:n.levelCodec},e},{})}appendChangeType(e,t,n){const s=`${t};codecs=${n}`,r={label:`change-type=${s}`,execute:()=>{const a=this.tracks[e];if(a){const u=a.buffer;u!=null&&u.changeType&&(this.log(`changing ${e} sourceBuffer type to ${s}`),u.changeType(s),a.codec=n,a.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:a=>{this.warn(`Failed to change ${e} SourceBuffer type`,a)}};this.append(r,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const n=e.start,s=n+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(n,et.MAIN))==null?void 0:t.gap)===!0)return;const a={label:"block-audio",execute:()=>{var u;const f=this.tracks.video;(this.lastVideoAppendEnd>s||f!=null&&f.buffer&&xt.isBuffered(f.buffer,s)||((u=this.fragmentTracker.getAppendedFrag(s,et.MAIN))==null?void 0:u.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:u=>{this.warn("Error executing block-audio operation",u)}};this.blockedAudioAppend={op:a,frag:e},this.append(a,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:n}=this,{data:s,type:r,parent:a,frag:u,part:f,chunkMeta:c,offset:d}=t,p=c.buffering[r],{sn:m,cc:y}=u,E=self.performance.now();p.start=E;const A=u.stats.buffering,S=f?f.stats.buffering:null;A.start===0&&(A.start=E),S&&S.start===0&&(S.start=E);const x=n.audio;let M=!1;r==="audio"&&(x==null?void 0:x.container)==="audio/mpeg"&&(M=!this.lastMpegAudioChunk||c.id===1||this.lastMpegAudioChunk.sn!==c.sn,this.lastMpegAudioChunk=c);const b=n.video,C=b==null?void 0:b.buffer;if(C&&m!=="initSegment"){const w=f||u,O=this.blockedAudioAppend;if(r==="audio"&&a!=="main"&&!this.blockedAudioAppend&&!(b.ending||b.ended)){const I=w.start+w.duration*.05,F=C.buffered,X=this.currentOp("video");!F.length&&!X?this.blockAudio(w):!X&&!xt.isBuffered(C,I)&&this.lastVideoAppendEnd<I&&this.blockAudio(w)}else if(r==="video"){const L=w.end;if(O){const I=O.frag.start;(L>I||L<this.lastVideoAppendEnd||xt.isBuffered(C,I))&&this.unblockAudio()}this.lastVideoAppendEnd=L}}const N=(f||u).start,U={label:`append-${r}`,execute:()=>{var w;p.executeStart=self.performance.now();const O=(w=this.tracks[r])==null?void 0:w.buffer;O&&(M?this.updateTimestampOffset(O,N,.1,r,m,y):d!==void 0&&Ye(d)&&this.updateTimestampOffset(O,d,1e-6,r,m,y)),this.appendExecutor(s,r)},onStart:()=>{},onComplete:()=>{const w=self.performance.now();p.executeEnd=p.end=w,A.first===0&&(A.first=w),S&&S.first===0&&(S.first=w);const O={};this.sourceBuffers.forEach(([L,I])=>{L&&(O[L]=xt.getBuffered(I))}),this.appendErrors[r]=0,r==="audio"||r==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(P.BUFFER_APPENDED,{type:r,frag:u,part:f,chunkMeta:c,parent:u.type,timeRanges:O})},onError:w=>{var O;const L={type:lt.MEDIA_ERROR,parent:u.type,details:ce.BUFFER_APPEND_ERROR,sourceBufferName:r,frag:u,part:f,chunkMeta:c,error:w,err:w,fatal:!1},I=(O=this.media)==null?void 0:O.error;if(w.code===DOMException.QUOTA_EXCEEDED_ERR||w.name=="QuotaExceededError"||"quota"in w)L.details=ce.BUFFER_FULL_ERROR;else if(w.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!I)L.errorAction=ml(!0);else if(w.name===rM&&this.sourceBufferCount===0)L.errorAction=ml(!0);else{const F=++this.appendErrors[r];this.warn(`Failed ${F}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${r}" sourceBuffer (${I||"no media error"})`),(F>=this.hls.config.appendErrorMaxRetry||I)&&(L.fatal=!0)}this.hls.trigger(P.ERROR,L)}};this.log(`queuing "${r}" append sn: ${m}${f?" p: "+f.index:""} of ${u.type===et.MAIN?"level":"track"} ${u.level} cc: ${y}`),this.append(U,r,this.isPending(this.tracks[r]))}getFlushOp(e,t,n){return this.log(`queuing "${e}" remove ${t}-${n}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,n)},onStart:()=>{},onComplete:()=>{this.hls.trigger(P.BUFFER_FLUSHED,{type:e})},onError:s=>{this.warn(`Failed to remove ${t}-${n} from "${e}" SourceBuffer`,s)}}}onBufferFlushing(e,t){const{type:n,startOffset:s,endOffset:r}=t;n?this.append(this.getFlushOp(n,s,r),n):this.sourceBuffers.forEach(([a])=>{a&&this.append(this.getFlushOp(a,s,r),a)})}onFragParsed(e,t){const{frag:n,part:s}=t,r=[],a=s?s.elementaryStreams:n.elementaryStreams;a[vn.AUDIOVIDEO]?r.push("audiovideo"):(a[vn.AUDIO]&&r.push("audio"),a[vn.VIDEO]&&r.push("video"));const u=()=>{const f=self.performance.now();n.stats.buffering.end=f,s&&(s.stats.buffering.end=f);const c=s?s.stats:n.stats;this.hls.trigger(P.FRAG_BUFFERED,{frag:n,part:s,stats:c,id:n.type})};r.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${n.type} level: ${n.level} sn: ${n.sn}`),this.blockBuffers(u,r).catch(f=>{this.warn(`Fragment buffered callback ${f}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var n;this.sourceBuffers.forEach(([a])=>{if(a){const u=this.tracks[a];(!t.type||t.type===a)&&(u.ending=!0,u.ended||(u.ended=!0,this.log(`${a} buffer reached EOS`)))}});const s=((n=this.overrides)==null?void 0:n.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([a])=>{var u;return a&&!((u=this.tracks[a])!=null&&u.ended)})?s?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:a}=this;if(!a||a.readyState!=="open"){a&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${a.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),a.endOfStream(),this.hls.trigger(P.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(P.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===ce.BUFFER_APPEND_ERROR&&t.frag){var n;const s=(n=t.errorAction)==null?void 0:n.nextAutoLevel;Ye(s)&&s!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:n}=this;if(!n||t===null||!this.sourceBufferCount)return;const s=e.config,r=n.currentTime,a=t.levelTargetDuration,u=t.live&&s.liveBackBufferLength!==null?s.liveBackBufferLength:s.backBufferLength;if(Ye(u)&&u>=0){const c=Math.max(u,a),d=Math.floor(r/a)*a-c;this.flushBackBuffer(r,a,d)}const f=s.frontBufferFlushThreshold;if(Ye(f)&&f>0){const c=Math.max(s.maxBufferLength,f),d=Math.max(c,a),p=Math.floor(r/a)*a+d;this.flushFrontBuffer(r,a,p)}}flushBackBuffer(e,t,n){this.sourceBuffers.forEach(([s,r])=>{if(r){const u=xt.getBuffered(r);if(u.length>0&&n>u.start(0)){var a;this.hls.trigger(P.BACK_BUFFER_REACHED,{bufferEnd:n});const f=this.tracks[s];if((a=this.details)!=null&&a.live)this.hls.trigger(P.LIVE_BACK_BUFFER_REACHED,{bufferEnd:n});else if(f!=null&&f.ended){this.log(`Cannot flush ${s} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(P.BUFFER_FLUSHING,{startOffset:0,endOffset:n,type:s})}}})}flushFrontBuffer(e,t,n){this.sourceBuffers.forEach(([s,r])=>{if(r){const a=xt.getBuffered(r),u=a.length;if(u<2)return;const f=a.start(u-1),c=a.end(u-1);if(n>f||e>=f&&e<=c)return;this.hls.trigger(P.BUFFER_FLUSHING,{startOffset:f,endOffset:1/0,type:s})}})}getDurationAndRange(){var e;const{details:t,mediaSource:n}=this;if(!t||!this.media||(n==null?void 0:n.readyState)!=="open")return null;const s=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&n.setLiveSeekableRange){const c=Math.max(0,t.fragmentStart),d=Math.max(c,s);return{duration:1/0,start:c,end:d}}return{duration:1/0}}const r=(e=this.overrides)==null?void 0:e.duration;if(r)return Ye(r)?{duration:r}:null;const a=this.media.duration,u=Ye(n.duration)?n.duration:0;return s>u&&s>a||!Ye(a)?{duration:s}:null}updateMediaSource({duration:e,start:t,end:n}){const s=this.mediaSource;!this.media||!s||s.readyState!=="open"||(s.duration!==e&&(Ye(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),s.duration=e),t!==void 0&&n!==void 0&&(this.log(`MediaSource duration is set to ${s.duration}. Setting seekable range to ${t}-${n}.`),s.setLiveSeekableRange(t,n)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:n}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${yn(n)}`),this.tracksReady){var s;const r=(s=this.transferData)==null?void 0:s.tracks;r&&Object.keys(r).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,n])=>{if(t){const s=this.tracks[t];e[t]={buffer:n,container:s.container,codec:s.codec,supplemental:s.supplemental,levelCodec:s.levelCodec,id:s.id,metadata:s.metadata}}}),this.hls.trigger(P.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(P.ERROR,{type:lt.MEDIA_ERROR,details:ce.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:n}=this;if(!n)throw new Error("createSourceBuffers called when mediaSource was null");for(const r in e){const a=r,u=e[a];if(this.isPending(u)){const f=this.getTrackCodec(u,a),c=`${u.container};codecs=${f}`;u.codec=f,this.log(`creating sourceBuffer(${c})${this.currentOp(a)?" Queued":""} ${yn(u)}`);try{const d=n.addSourceBuffer(c),p=Am(a),m=[a,d];t[p]=m,u.buffer=d}catch(d){var s;this.error(`error while trying to add sourceBuffer: ${d.message}`),this.shiftAndExecuteNext(a),(s=this.operationQueue)==null||s.removeBlockers(),delete this.tracks[a],this.hls.trigger(P.ERROR,{type:lt.MEDIA_ERROR,details:ce.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:d,sourceBufferName:a,mimeType:c,parent:u.id});return}this.trackSourceBuffer(a,u)}}this.bufferCreated()}getTrackCodec(e,t){const n=e.supplemental;let s=e.codec;n&&(t==="video"||t==="audiovideo")&&zu(n,"video")&&(s=mF(s,n));const r=rd(s,e.levelCodec);return r?t.slice(0,5)==="audio"?bd(r,this.appendSource):r:""}trackSourceBuffer(e,t){const n=t.buffer;if(!n)return;const s=this.getTrackCodec(t,e);this.tracks[e]={buffer:n,codec:s,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(r,a)=>{const u=a.removedRanges;u!=null&&u.length&&this.hls.trigger(P.BUFFER_FLUSHED,{type:r})})}get mediaSrc(){var e,t;const n=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return n==null?void 0:n.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const n=this.currentOp(e);n&&(n.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var n;const s=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(n=this.mediaSource)==null?void 0:n.readyState}`);this.error(`${s}`,t),this.hls.trigger(P.ERROR,{type:lt.MEDIA_ERROR,details:ce.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:s,fatal:!1});const r=this.currentOp(e);r&&r.onError(s)}updateTimestampOffset(e,t,n,s,r,a){const u=t-e.timestampOffset;Math.abs(u)>=n&&(this.log(`Updating ${s} SourceBuffer timestampOffset to ${t} (sn: ${r} cc: ${a})`),e.timestampOffset=t)}removeExecutor(e,t,n){const{media:s,mediaSource:r}=this,a=this.tracks[e],u=a==null?void 0:a.buffer;if(!s||!r||!u){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const f=Ye(s.duration)?s.duration:1/0,c=Ye(r.duration)?r.duration:1/0,d=Math.max(0,t),p=Math.min(n,f,c);p>d&&(!a.ending||a.ended)?(a.ended=!1,this.log(`Removing [${d},${p}] from the ${e} SourceBuffer`),u.remove(d,p)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const n=this.tracks[t],s=n==null?void 0:n.buffer;if(!s)throw new Ak(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);n.ending=!1,n.ended=!1,s.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:n}=this,s=t.map(a=>this.appendBlocker(a));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(s).then(a=>{n===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var n;const s=(n=this.tracks[t])==null?void 0:n.buffer;!s||s.updating||this.shiftAndExecuteNext(t)})}append(e,t,n){this.operationQueue&&this.operationQueue.append(e,t,n)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,n){const s=this.tracks[e];if(!s)return;const r=s.buffer;if(!r)return;const a=n.bind(this,e);s.listeners.push({event:t,listener:a}),r.addEventListener(t,a)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const n=t.buffer;n&&(t.listeners.forEach(s=>{n.removeEventListener(s.event,s.listener)}),t.listeners.length=0)}}function Vx(i){const e=i.querySelectorAll("source");[].slice.call(e).forEach(t=>{i.removeChild(t)})}function bk(i,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,i.appendChild(t)}function Am(i){return i==="audio"?1:0}class ov{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(P.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(P.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(P.MANIFEST_PARSED,this.onManifestParsed,this),e.on(P.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(P.BUFFER_CODECS,this.onBufferCodecs,this),e.on(P.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(P.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(P.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(P.MANIFEST_PARSED,this.onManifestParsed,this),e.off(P.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(P.BUFFER_CODECS,this.onBufferCodecs,this),e.off(P.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const n=this.hls.levels[t.droppedLevel];this.isLevelAllowed(n)&&this.restrictedLevels.push({bitrate:n.bitrate,height:n.height,width:n.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const n=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,n.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&Ye(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,n=this.getMaxLevel(e.length-1);n!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${n}: ${e[n].height}p@${e[n].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=n,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const n=t.filter((s,r)=>this.isLevelAllowed(s)&&r<=e);return this.clientRect=null,ov.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const n=e.getBoundingClientRect();t.width=n.width,t.height=n.height,!t.width&&!t.height&&(t.width=n.right-n.left||e.width||0,t.height=n.bottom-n.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(n=>e.bitrate===n.bitrate&&e.width===n.width&&e.height===n.height)}static getMaxLevelByMediaSize(e,t,n){if(!(e!=null&&e.length))return-1;const s=(u,f)=>f?u.width!==f.width||u.height!==f.height:!0;let r=e.length-1;const a=Math.max(t,n);for(let u=0;u<e.length;u+=1){const f=e[u];if((f.width>=a||f.height>=a)&&s(f,e[u+1])){r=u;break}}return r}}const Mk={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Ni=Mk,Ck={HLS:"h"},Ik=Ck;class qs{constructor(e,t){Array.isArray(e)&&(e=e.map(n=>n instanceof qs?n:new qs(n))),this.value=e,this.params=t}}const Lk="Dict";function Dk(i){return Array.isArray(i)?JSON.stringify(i):i instanceof Map?"Map{}":i instanceof Set?"Set{}":typeof i=="object"?JSON.stringify(i):String(i)}function wk(i,e,t,n){return new Error(`failed to ${i} "${Dk(e)}" as ${t}`,{cause:n})}function Ws(i,e,t){return wk("serialize",i,e,t)}class oM{constructor(e){this.description=e}}const Hx="Bare Item",Pk="Boolean";function Nk(i){if(typeof i!="boolean")throw Ws(i,Pk);return i?"?1":"?0"}function Uk(i){return btoa(String.fromCharCode(...i))}const Ok="Byte Sequence";function Fk(i){if(ArrayBuffer.isView(i)===!1)throw Ws(i,Ok);return`:${Uk(i)}:`}const kk="Integer";function Bk(i){return i<-999999999999999||999999999999999<i}function aM(i){if(Bk(i))throw Ws(i,kk);return i.toString()}function Gk(i){return`@${aM(i.getTime()/1e3)}`}function lM(i,e){if(i<0)return-lM(-i,e);const t=Math.pow(10,e);if(Math.abs(i*t%1-.5)<Number.EPSILON){const s=Math.floor(i*t);return(s%2===0?s:s+1)/t}else return Math.round(i*t)/t}const Vk="Decimal";function Hk(i){const e=lM(i,3);if(Math.floor(Math.abs(e)).toString().length>12)throw Ws(i,Vk);const t=e.toString();return t.includes(".")?t:`${t}.0`}const zk="String",$k=/[\x00-\x1f\x7f]+/;function qk(i){if($k.test(i))throw Ws(i,zk);return`"${i.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function Wk(i){return i.description||i.toString().slice(7,-1)}const Kk="Token";function zx(i){const e=Wk(i);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw Ws(e,Kk);return e}function Fg(i){switch(typeof i){case"number":if(!Ye(i))throw Ws(i,Hx);return Number.isInteger(i)?aM(i):Hk(i);case"string":return qk(i);case"symbol":return zx(i);case"boolean":return Nk(i);case"object":if(i instanceof Date)return Gk(i);if(i instanceof Uint8Array)return Fk(i);if(i instanceof oM)return zx(i);default:throw Ws(i,Hx)}}const Yk="Key";function kg(i){if(/^[a-z*][a-z0-9\-_.*]*$/.test(i)===!1)throw Ws(i,Yk);return i}function av(i){return i==null?"":Object.entries(i).map(([e,t])=>t===!0?`;${kg(e)}`:`;${kg(e)}=${Fg(t)}`).join("")}function uM(i){return i instanceof qs?`${Fg(i.value)}${av(i.params)}`:Fg(i)}function Xk(i){return`(${i.value.map(uM).join(" ")})${av(i.params)}`}function Jk(i,e={whitespace:!0}){if(typeof i!="object"||i==null)throw Ws(i,Lk);const t=i instanceof Map?i.entries():Object.entries(i),n=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([s,r])=>{r instanceof qs||(r=new qs(r));let a=kg(s);return r.value===!0?a+=av(r.params):(a+="=",Array.isArray(r.value)?a+=Xk(r):a+=uM(r)),a}).join(`,${n}`)}function cM(i,e){return Jk(i,e)}const Os="CMCD-Object",Ln="CMCD-Request",Go="CMCD-Session",no="CMCD-Status",Qk={br:Os,ab:Os,d:Os,ot:Os,tb:Os,tpb:Os,lb:Os,tab:Os,lab:Os,url:Os,pb:Ln,bl:Ln,tbl:Ln,dl:Ln,ltc:Ln,mtp:Ln,nor:Ln,nrr:Ln,rc:Ln,sn:Ln,sta:Ln,su:Ln,ttfb:Ln,ttfbb:Ln,ttlb:Ln,cmsdd:Ln,cmsds:Ln,smrt:Ln,df:Ln,cs:Ln,ts:Ln,cid:Go,pr:Go,sf:Go,sid:Go,st:Go,v:Go,msd:Go,bs:no,bsd:no,cdn:no,rtp:no,bg:no,pt:no,ec:no,e:no},Zk={REQUEST:Ln};function jk(i){return Object.keys(i).reduce((e,t)=>{var n;return(n=i[t])===null||n===void 0||n.forEach(s=>e[s]=t),e},{})}function eB(i,e){const t={};if(!i)return t;const n=Object.keys(i),s=e?jk(e):{};return n.reduce((r,a)=>{var u;const f=Qk[a]||s[a]||Zk.REQUEST,c=(u=r[f])!==null&&u!==void 0?u:r[f]={};return c[a]=i[a],r},t)}function tB(i){return["ot","sf","st","e","sta"].includes(i)}function nB(i){return typeof i=="number"?Ye(i):i!=null&&i!==""&&i!==!1}const fM="event";function iB(i,e){const t=new URL(i),n=new URL(e);if(t.origin!==n.origin)return i;const s=t.pathname.split("/").slice(1),r=n.pathname.split("/").slice(1,-1);for(;s[0]===r[0];)s.shift(),r.shift();for(;r.length;)r.shift(),s.unshift("..");return s.join("/")+t.search+t.hash}const cd=i=>Math.round(i),Bg=(i,e)=>Array.isArray(i)?i.map(t=>Bg(t,e)):i instanceof qs&&typeof i.value=="string"?new qs(Bg(i.value,e),i.params):(e.baseUrl&&(i=iB(i,e.baseUrl)),e.version===1?encodeURIComponent(i):i),bf=i=>cd(i/100)*100,sB=(i,e)=>{let t=i;return e.version>=2&&(i instanceof qs&&typeof i.value=="string"?t=new qs([i]):typeof i=="string"&&(t=[i])),Bg(t,e)},rB={br:cd,d:cd,bl:bf,dl:bf,mtp:bf,nor:sB,rtp:bf,tb:cd},dM="request",hM="response",lv=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],oB=["e"],aB=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function Xd(i){return aB.test(i)}function lB(i){return lv.includes(i)||oB.includes(i)||Xd(i)}const pM=["d","dl","nor","ot","rtp","su"];function uB(i){return lv.includes(i)||pM.includes(i)||Xd(i)}const cB=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function fB(i){return lv.includes(i)||pM.includes(i)||cB.includes(i)||Xd(i)}const dB=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function hB(i){return dB.includes(i)||Xd(i)}const pB={[hM]:fB,[fM]:lB,[dM]:uB};function mM(i,e={}){const t={};if(i==null||typeof i!="object")return t;const n=e.version||i.v||1,s=e.reportingMode||dM,r=n===1?hB:pB[s];let a=Object.keys(i).filter(r);const u=e.filter;typeof u=="function"&&(a=a.filter(u));const f=s===hM||s===fM;f&&!a.includes("ts")&&a.push("ts"),n>1&&!a.includes("v")&&a.push("v");const c=pn({},rB,e.formatters),d={version:n,reportingMode:s,baseUrl:e.baseUrl};return a.sort().forEach(p=>{let m=i[p];const y=c[p];if(typeof y=="function"&&(m=y(m,d)),p==="v"){if(n===1)return;m=n}p=="pr"&&m===1||(f&&p==="ts"&&!Ye(m)&&(m=Date.now()),nB(m)&&(tB(p)&&typeof m=="string"&&(m=new oM(m)),t[p]=m))}),t}function mB(i,e={}){const t={};if(!i)return t;const n=mM(i,e),s=eB(n,e==null?void 0:e.customHeaderMap);return Object.entries(s).reduce((r,[a,u])=>{const f=cM(u,{whitespace:!1});return f&&(r[a]=f),r},t)}function gB(i,e,t){return pn(i,mB(e,t))}const vB="CMCD";function yB(i,e={}){return i?cM(mM(i,e),{whitespace:!1}):""}function _B(i,e={}){if(!i)return"";const t=yB(i,e);return encodeURIComponent(t)}function EB(i,e={}){if(!i)return"";const t=_B(i,e);return`${vB}=${t}`}const $x=/CMCD=[^&#]+/;function SB(i,e,t){const n=EB(e,t);if(!n)return i;if($x.test(i))return i.replace($x,n);const s=i.includes("?")?"&":"?";return`${i}${s}${n}`}class TB{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=s=>{try{this.apply(s,{ot:Ni.MANIFEST,su:!this.initialized})}catch(r){this.hls.logger.warn("Could not generate manifest CMCD data.",r)}},this.applyFragmentData=s=>{try{const{frag:r,part:a}=s,u=this.hls.levels[r.level],f=this.getObjectType(r),c={d:(a||r).duration*1e3,ot:f};(f===Ni.VIDEO||f===Ni.AUDIO||f==Ni.MUXED)&&(c.br=u.bitrate/1e3,c.tb=this.getTopBandwidth(f)/1e3,c.bl=this.getBufferLength(f));const d=a?this.getNextPart(a):this.getNextFrag(r);d!=null&&d.url&&d.url!==r.url&&(c.nor=d.url),this.apply(s,c)}catch(r){this.hls.logger.warn("Could not generate segment CMCD data.",r)}},this.hls=e;const t=this.config=e.config,{cmcd:n}=t;n!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=n.sessionId||e.sessionId,this.cid=n.contentId,this.useHeaders=n.useHeaders===!0,this.includeKeys=n.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(P.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(P.MEDIA_DETACHED,this.onMediaDetached,this),e.on(P.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(P.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(P.MEDIA_DETACHED,this.onMediaDetached,this),e.off(P.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var n,s;this.audioBuffer=(n=t.tracks.audio)==null?void 0:n.buffer,this.videoBuffer=(s=t.tracks.video)==null?void 0:s.buffer}createData(){var e;return{v:1,sf:Ik.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){pn(t,this.createData());const n=t.ot===Ni.INIT||t.ot===Ni.VIDEO||t.ot===Ni.MUXED;this.starved&&n&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:s}=this;s&&(t=Object.keys(t).reduce((a,u)=>(s.includes(u)&&(a[u]=t[u]),a),{}));const r={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),gB(e.headers,t,r)):e.url=SB(e.url,t,r)}getNextFrag(e){var t;const n=(t=this.hls.levels[e.level])==null?void 0:t.details;if(n){const s=e.sn-n.startSN;return n.fragments[s+1]}}getNextPart(e){var t;const{index:n,fragment:s}=e,r=(t=this.hls.levels[s.level])==null||(t=t.details)==null?void 0:t.partList;if(r){const{sn:a}=s;for(let u=r.length-1;u>=0;u--){const f=r[u];if(f.index===n&&f.fragment.sn===a)return r[u+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return Ni.TIMED_TEXT;if(e.sn==="initSegment")return Ni.INIT;if(t==="audio")return Ni.AUDIO;if(t==="main")return this.hls.audioTracks.length?Ni.VIDEO:Ni.MUXED}getTopBandwidth(e){let t=0,n;const s=this.hls;if(e===Ni.AUDIO)n=s.audioTracks;else{const r=s.maxAutoLevel,a=r>-1?r+1:s.levels.length;n=s.levels.slice(0,a)}return n.forEach(r=>{r.bitrate>t&&(t=r.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,n=e===Ni.AUDIO?this.audioBuffer:this.videoBuffer;return!n||!t?NaN:xt.bufferInfo(n,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,n=e||this.config.loader;return class{constructor(r){this.loader=void 0,this.loader=new n(r)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(r,a,u){t(r),this.loader.load(r,a,u)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,n=e||this.config.loader;return class{constructor(r){this.loader=void 0,this.loader=new n(r)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(r,a,u){t(r),this.loader.load(r,a,u)}}}}const xB=3e5;class AB extends ms{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(P.MANIFEST_LOADING,this.onManifestLoading,this),e.on(P.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(P.MANIFEST_PARSED,this.onManifestParsed,this),e.on(P.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(P.MANIFEST_LOADING,this.onManifestLoading,this),e.off(P.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(P.MANIFEST_PARSED,this.onManifestParsed,this),e.off(P.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(n=>n!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:n}=t;n!==null&&(this.pathwayId=n.pathwayId,this.uri=n.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:n}=t;if((n==null?void 0:n.action)===li.SendAlternateToPenaltyBox&&n.flags===Xi.MoveAllAlternatesMatchingHost){const s=this.levels;let r=this._pathwayPriority,a=this.pathwayId;if(t.context){const{groupId:u,pathwayId:f,type:c}=t.context;u&&s?a=this.getPathwayForGroupId(u,c,a):f&&(a=f)}a in this.penalizedPathways||(this.penalizedPathways[a]=performance.now()),!r&&s&&(r=this.pathways()),r&&r.length>1&&(this.updatePathwayPriority(r),n.resolved=this.pathwayId!==a),t.details===ce.BUFFER_APPEND_ERROR&&!t.fatal?n.resolved=!0:n.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${a} levels: ${s&&s.length} priorities: ${yn(r)} penalized: ${yn(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const n=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${n}"`),t=this.getLevelsForPathway(n),this.pathwayId=n}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const n=this.penalizedPathways,s=performance.now();Object.keys(n).forEach(r=>{s-n[r]>xB&&delete n[r]});for(let r=0;r<e.length;r++){const a=e[r];if(a in n)continue;if(a===this.pathwayId)return;const u=this.hls.nextLoadLevel,f=this.hls.levels[u];if(t=this.getLevelsForPathway(a),t.length>0){this.log(`Setting Pathway to "${a}"`),this.pathwayId=a,Ub(t),this.hls.trigger(P.LEVELS_UPDATED,{levels:t});const c=this.hls.levels[u];f&&c&&this.levels&&(c.attrs["STABLE-VARIANT-ID"]!==f.attrs["STABLE-VARIANT-ID"]&&c.bitrate!==f.bitrate&&this.log(`Unstable Pathways change from bitrate ${f.bitrate} to ${c.bitrate}`),this.hls.nextLoadLevel=u);break}}}getPathwayForGroupId(e,t,n){const s=this.getLevelsForPathway(n).concat(this.levels||[]);for(let r=0;r<s.length;r++)if(t===Nt.AUDIO_TRACK&&s[r].hasAudioGroup(e)||t===Nt.SUBTITLE_TRACK&&s[r].hasSubtitleGroup(e))return s[r].pathwayId;return n}clonePathways(e){const t=this.levels;if(!t)return;const n={},s={};e.forEach(r=>{const{ID:a,"BASE-ID":u,"URI-REPLACEMENT":f}=r;if(t.some(d=>d.pathwayId===a))return;const c=this.getLevelsForPathway(u).map(d=>{const p=new Rn(d.attrs);p["PATHWAY-ID"]=a;const m=p.AUDIO&&`${p.AUDIO}_clone_${a}`,y=p.SUBTITLES&&`${p.SUBTITLES}_clone_${a}`;m&&(n[p.AUDIO]=m,p.AUDIO=m),y&&(s[p.SUBTITLES]=y,p.SUBTITLES=y);const E=gM(d.uri,p["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",f),A=new qu({attrs:p,audioCodec:d.audioCodec,bitrate:d.bitrate,height:d.height,name:d.name,url:E,videoCodec:d.videoCodec,width:d.width});if(d.audioGroups)for(let S=1;S<d.audioGroups.length;S++)A.addGroupId("audio",`${d.audioGroups[S]}_clone_${a}`);if(d.subtitleGroups)for(let S=1;S<d.subtitleGroups.length;S++)A.addGroupId("text",`${d.subtitleGroups[S]}_clone_${a}`);return A});t.push(...c),qx(this.audioTracks,n,f,a),qx(this.subtitleTracks,s,f,a)})}loadSteeringManifest(e){const t=this.hls.config,n=t.loader;this.loader&&this.loader.destroy(),this.loader=new n(t);let s;try{s=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(s.protocol!=="data:"){const d=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;s.searchParams.set("_HLS_pathway",this.pathwayId),s.searchParams.set("_HLS_throughput",""+d)}const r={responseType:"json",url:s.href},a=t.steeringManifestLoadPolicy.default,u=a.errorRetry||a.timeoutRetry||{},f={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:u.maxNumRetry||0,retryDelay:u.retryDelayMs||0,maxRetryDelay:u.maxRetryDelayMs||0},c={onSuccess:(d,p,m,y)=>{this.log(`Loaded steering manifest: "${s}"`);const E=d.data;if((E==null?void 0:E.VERSION)!==1){this.log(`Steering VERSION ${E.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=E.TTL;const{"RELOAD-URI":A,"PATHWAY-CLONES":S,"PATHWAY-PRIORITY":x}=E;if(A)try{this.uri=new self.URL(A,s).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${A}`);return}this.scheduleRefresh(this.uri||m.url),S&&this.clonePathways(S);const M={steeringManifest:E,url:s.toString()};this.hls.trigger(P.STEERING_MANIFEST_LOADED,M),x&&this.updatePathwayPriority(x)},onError:(d,p,m,y)=>{if(this.log(`Error loading steering manifest: ${d.code} ${d.text} (${p.url})`),this.stopLoad(),d.code===410){this.enabled=!1,this.log(`Steering manifest ${p.url} no longer available`);return}let E=this.timeToLoad*1e3;if(d.code===429){const A=this.loader;if(typeof(A==null?void 0:A.getResponseHeader)=="function"){const S=A.getResponseHeader("Retry-After");S&&(E=parseFloat(S)*1e3)}this.log(`Steering manifest ${p.url} rate limited`);return}this.scheduleRefresh(this.uri||p.url,E)},onTimeout:(d,p,m)=>{this.log(`Timeout loading steering manifest (${p.url})`),this.scheduleRefresh(this.uri||p.url)}};this.log(`Requesting steering manifest: ${s}`),this.loader.load(r,f,c)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var n;const s=(n=this.hls)==null?void 0:n.media;if(s&&!s.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function qx(i,e,t,n){i&&Object.keys(e).forEach(s=>{const r=i.filter(a=>a.groupId===s).map(a=>{const u=pn({},a);return u.details=void 0,u.attrs=new Rn(u.attrs),u.url=u.attrs.URI=gM(a.url,a.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),u.groupId=u.attrs["GROUP-ID"]=e[s],u.attrs["PATHWAY-ID"]=n,u});i.push(...r)})}function gM(i,e,t,n){const{HOST:s,PARAMS:r,[t]:a}=n;let u;e&&(u=a==null?void 0:a[e],u&&(i=u));const f=new self.URL(i);return s&&!u&&(f.host=s),r&&Object.keys(r).sort().forEach(c=>{c&&f.searchParams.set(c,r[c])}),f.href}class vl extends ms{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=vl.CDMCleanupPromise?[vl.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:n,initData:s}=t,r=`"${t.type}" event: init data type: "${n}"`;if(this.debug(r),s!==null){if(!this.keyFormatPromise){let a=Object.keys(this.keySystemAccessPromises);a.length||(a=Uu(this.config));const u=a.map(gm).filter(f=>!!f);this.keyFormatPromise=this.getKeyFormatPromise(u)}this.keyFormatPromise.then(a=>{const u=ad(a);if(n!=="sinf"||u!==bn.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${n}" for selected key-system ${u}`);return}let f;try{const y=Yn(new Uint8Array(s)),E=J0(JSON.parse(y).sinf),A=cb(E);if(!A)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");f=new Uint8Array(A.subarray(8,24))}catch(y){this.warn(`${r} Failed to parse sinf: ${y}`);return}const c=ui(f),{keyIdToKeySessionPromise:d,mediaKeySessions:p}=this;let m=d[c];for(let y=0;y<p.length;y++){const E=p[y],A=E.decryptdata;if(!A.keyId)continue;const S=ui(A.keyId);if(Dd(f,A.keyId)||A.uri.replace(/-/g,"").indexOf(c)!==-1){if(m=d[S],!m)continue;if(A.pssh)break;delete d[S],A.pssh=new Uint8Array(s),A.keyId=f,m=d[c]=m.then(()=>this.generateRequestWithPreferredKeySession(E,n,s,"encrypted-event-key-match")),m.catch(x=>this.handleError(x));break}}m||this.handleError(new Error(`Key ID ${c} not encountered in playlist. Key-system sessions ${p.length}.`))}).catch(a=>this.handleError(a))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(P.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(P.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(P.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(P.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(P.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(P.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(P.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(P.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(P.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(P.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:n}=this.config,s=t==null?void 0:t[e];if(s)return s.licenseUrl;if(e===bn.WIDEVINE&&n)return n}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,n=t==null?void 0:t[e];if(n)return n.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,n=(a,u,f)=>!!a&&f.indexOf(a)===u,s=t.map(a=>a.audioCodec).filter(n),r=t.map(a=>a.videoCodec).filter(n);return s.length+r.length===0&&r.push("avc1.42e01e"),new Promise((a,u)=>{const f=c=>{const d=c.shift();this.getMediaKeysPromise(d,s,r).then(p=>a({keySystem:d,mediaKeys:p})).catch(p=>{c.length?f(c):p instanceof Yi?u(p):u(new Yi({type:lt.KEY_SYSTEM_ERROR,details:ce.KEY_SYSTEM_NO_ACCESS,error:p,fatal:!0},p.message))})};f(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:n}=this.config;if(typeof n!="function"){let s=`Configured requestMediaKeySystemAccess is not a function ${n}`;return Mb===null&&self.location.protocol==="http:"&&(s=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(s))}return n(e,t)}getMediaKeysPromise(e,t,n){var s;const r=s2(e,t,n,this.config.drmSystemOptions||{});let a=this.keySystemAccessPromises[e],u=(s=a)==null?void 0:s.keySystemAccess;if(!u){this.log(`Requesting encrypted media "${e}" key-system access with config: ${yn(r)}`),u=this.requestMediaKeySystemAccess(e,r);const f=a=this.keySystemAccessPromises[e]={keySystemAccess:u};return u.catch(c=>{this.log(`Failed to obtain access to key-system "${e}": ${c}`)}),u.then(c=>{this.log(`Access for key-system "${c.keySystem}" obtained`);const d=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const p=f.mediaKeys=c.createMediaKeys().then(m=>(this.log(`Media-keys created for "${e}"`),f.hasMediaKeys=!0,d.then(y=>y?this.setMediaKeysServerCertificate(m,e,y):m)));return p.catch(m=>{this.error(`Failed to create media-keys for "${e}"}: ${m}`)}),p})}return u.then(()=>a.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:n}){this.log(`Creating key-system session "${t}" keyId: ${ui(e.keyId||[])} keyUri: ${e.uri}`);const s=n.createSession(),r={decryptdata:e,keySystem:t,mediaKeys:n,mediaKeysSession:s,keyStatus:"status-pending"};return this.mediaKeySessions.push(r),r}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const n=this.createMediaKeySessionContext(e),s=Mf(t),r="cenc";this.keyIdToKeySessionPromise[s]=this.generateRequestWithPreferredKeySession(n,r,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const n=e.mediaKeysSession;return this.log(`Updating key-session "${n.sessionId}" for keyId ${ui(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),n.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>gm(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:n})=>this.attemptSetMediaKeys(t,n))}selectKeySystem(e){return new Promise((t,n)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:s})=>{const r=gm(s);r?t(r):n(new Error(`Unable to find format for key-system "${s}"`))}).catch(n)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=Uu(this.config),n=e.map(ad).filter(s=>!!s&&t.indexOf(s)!==-1);return this.selectKeySystem(n)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let n=0;n<t.length;n++){const s=RB(e,t[n]);if(s)return s}}loadKey(e){const t=e.keyInfo.decryptdata,n=Mf(t),s=this.bannedKeyIds[n];if(s||this.getKeyStatus(t)==="internal-error"){const u=Wx(s||"internal-error",t);return this.handleError(u,e.frag),Promise.reject(u)}const r=`(keyId: ${n} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${r}`);const a=this.keyIdToKeySessionPromise[n];if(!a){const u=this.getKeySystemForKeyPromise(t).then(({keySystem:f,mediaKeys:c})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${r}`),this.attemptSetMediaKeys(f,c).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:f,mediaKeys:c,decryptdata:t}))))).then(f=>{const c="cenc",d=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(f,c,d,"playlist-key")});return u.catch(f=>this.handleError(f,e.frag)),this.keyIdToKeySessionPromise[n]=u,u}return a.catch(u=>{if(u instanceof Yi){const f=on({},u.data);this.getKeyStatus(t)==="internal-error"&&(f.decryptdata=t);const c=new Yi(f,u.message);this.handleError(c,e.frag)}}),a}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof Yi){t&&(e.data.frag=t);const n=e.data.decryptdata;this.error(`${e.message}${n?` (${ui(n.keyId||[])})`:""}`),this.hls.trigger(P.ERROR,e.data)}else this.error(e.message),this.hls.trigger(P.ERROR,{type:lt.KEY_SYSTEM_ERROR,details:ce.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=Mf(e),n=this.keyIdToKeySessionPromise[t];if(!n){const s=ad(e.keyFormat),r=s?[s]:Uu(this.config);return this.attemptKeySystemAccess(r)}return n}getKeySystemSelectionPromise(e){if(e.length||(e=Uu(this.config)),e.length===0)throw new Yi({type:lt.KEY_SYSTEM_ERROR,details:ce.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${yn({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const n=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const s=Promise.all(n).then(()=>this.media?this.media.setMediaKeys(t):new Promise((r,a)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return a(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(r).catch(a)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(s),s.then(()=>{this.log(`Media-keys set for "${e}"`),n.push(s),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(r=>n.indexOf(r)===-1)})}generateRequestWithPreferredKeySession(e,t,n,s){var r;const a=(r=this.config.drmSystems)==null||(r=r[e.keySystem])==null?void 0:r.generateRequest;if(a)try{const E=a.call(this.hls,t,n,e);if(!E)throw new Error("Invalid response from configured generateRequest filter");t=E.initDataType,n=E.initData?E.initData:null,e.decryptdata.pssh=n?new Uint8Array(n):null}catch(E){if(this.warn(E.message),this.hls&&this.hls.config.debug)throw E}if(n===null)return this.log(`Skipping key-session request for "${s}" (no initData)`),Promise.resolve(e);const u=Mf(e.decryptdata),f=e.decryptdata.uri;this.log(`Generating key-session request for "${s}" keyId: ${u} URI: ${f} (init data type: ${t} length: ${n.byteLength})`);const c=new Z0,d=e._onmessage=E=>{const A=e.mediaKeysSession;if(!A){c.emit("error",new Error("invalid state"));return}const{messageType:S,message:x}=E;this.log(`"${S}" message event for session "${A.sessionId}" message size: ${x.byteLength}`),S==="license-request"||S==="license-renewal"?this.renewLicense(e,x).catch(M=>{c.eventNames().length?c.emit("error",M):this.handleError(M)}):S==="license-release"?e.keySystem===bn.FAIRPLAY&&this.updateKeySession(e,Dg("acknowledged")).then(()=>this.removeSession(e)).catch(M=>this.handleError(M)):this.warn(`unhandled media key message type "${S}"`)},p=(E,A)=>{A.keyStatus=E;let S;E.startsWith("usable")?c.emit("resolved"):E==="internal-error"||E==="output-restricted"||E==="output-downscaled"?S=Wx(E,A.decryptdata):E==="expired"?S=new Error(`key expired (keyId: ${u})`):E==="released"?S=new Error("key released"):E==="status-pending"||this.warn(`unhandled key status change "${E}" (keyId: ${u})`),S&&(c.eventNames().length?c.emit("error",S):this.handleError(S))},m=e._onkeystatuseschange=E=>{if(!e.mediaKeysSession){c.emit("error",new Error("invalid state"));return}const S=this.getKeyStatuses(e);if(!Object.keys(S).some(C=>S[C]!=="status-pending"))return;if(S[u]==="expired"){this.log(`Expired key ${yn(S)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let M=S[u];if(M)p(M,e);else{var b;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(b=e.keyStatusTimeouts)[u]||(b[u]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const N=this.getKeyStatus(e.decryptdata);if(N&&N!=="status-pending")return this.log(`No status for keyId ${u} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${N} from other session.`),p(N,e);this.log(`key status for ${u} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),M="internal-error",p(M,e)},1e3)),this.log(`No status for keyId ${u} (${yn(S)}).`)}};Ti(e.mediaKeysSession,"message",d),Ti(e.mediaKeysSession,"keystatuseschange",m);const y=new Promise((E,A)=>{c.on("error",A),c.on("resolved",E)});return e.mediaKeysSession.generateRequest(t,n).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${u} URI: ${f}`)}).catch(E=>{throw new Yi({type:lt.KEY_SYSTEM_ERROR,details:ce.KEY_SYSTEM_NO_SESSION,error:E,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${E}`)}).then(()=>y).catch(E=>(c.removeAllListeners(),this.removeSession(e).then(()=>{throw E}))).then(()=>(c.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((n,s)=>{if(typeof s=="string"&&typeof n=="object"){const u=s;s=n,n=u}const r="buffer"in s?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):new Uint8Array(s);if(e.keySystem===bn.PLAYREADY&&r.length===16){const u=ui(r);t[u]=n,Rb(r)}const a=ui(r);n==="internal-error"&&(this.bannedKeyIds[a]=n),this.log(`key status change "${n}" for keyStatuses keyId: ${a} key-session "${e.mediaKeysSession.sessionId}"`),t[a]=n}),t}fetchServerCertificate(e){const t=this.config,n=t.loader,s=new n(t),r=this.getServerCertificateUrl(e);return r?(this.log(`Fetching server certificate for "${e}"`),new Promise((a,u)=>{const f={responseType:"arraybuffer",url:r},c=t.certLoadPolicy.default,d={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(m,y,E,A)=>{a(m.data)},onError:(m,y,E,A)=>{u(new Yi({type:lt.KEY_SYSTEM_ERROR,details:ce.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:E,response:on({url:f.url,data:void 0},m)},`"${e}" certificate request failed (${r}). Status: ${m.code} (${m.text})`))},onTimeout:(m,y,E)=>{u(new Yi({type:lt.KEY_SYSTEM_ERROR,details:ce.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:E,response:{url:f.url,data:void 0}},`"${e}" certificate request timed out (${r})`))},onAbort:(m,y,E)=>{u(new Error("aborted"))}};s.load(f,d,p)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,n){return new Promise((s,r)=>{e.setServerCertificate(n).then(a=>{this.log(`setServerCertificate ${a?"success":"not supported by CDM"} (${n.byteLength}) on "${t}"`),s(e)}).catch(a=>{r(new Yi({type:lt.KEY_SYSTEM_ERROR,details:ce.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:a,fatal:!0},a.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(n=>this.updateKeySession(e,new Uint8Array(n)).catch(s=>{throw new Yi({type:lt.KEY_SYSTEM_ERROR,details:ce.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:s,fatal:!1},s.message)}))}unpackPlayReadyKeyMessage(e,t){const n=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!n.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const s=new DOMParser().parseFromString(n,"application/xml"),r=s.querySelectorAll("HttpHeader");if(r.length>0){let d;for(let p=0,m=r.length;p<m;p++){var a,u;d=r[p];const y=(a=d.querySelector("name"))==null?void 0:a.textContent,E=(u=d.querySelector("value"))==null?void 0:u.textContent;y&&E&&e.setRequestHeader(y,E)}}const f=s.querySelector("Challenge"),c=f==null?void 0:f.textContent;if(!c)throw new Error("Cannot find <Challenge> in key message");return Dg(atob(c))}setupLicenseXHR(e,t,n,s){const r=this.config.licenseXhrSetup;return r?Promise.resolve().then(()=>{if(!n.decryptdata)throw new Error("Key removed");return r.call(this.hls,e,t,n,s)}).catch(a=>{if(!n.decryptdata)throw a;return e.open("POST",t,!0),r.call(this.hls,e,t,n,s)}).then(a=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:a||s})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:s}))}requestLicense(e,t){const n=this.config.keyLoadPolicy.default;return new Promise((s,r)=>{const a=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${a}`);const u=new XMLHttpRequest;u.responseType="arraybuffer",u.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return r(new Error("invalid state"));if(u.readyState===4)if(u.status===200){this._requestLicenseFailureCount=0;let f=u.response;this.log(`License received ${f instanceof ArrayBuffer?f.byteLength:f}`);const c=this.config.licenseResponseCallback;if(c)try{f=c.call(this.hls,u,a,e)}catch(d){this.error(d)}s(f)}else{const f=n.errorRetry,c=f?f.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>c||u.status>=400&&u.status<500)r(new Yi({type:lt.KEY_SYSTEM_ERROR,details:ce.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:u,response:{url:a,data:void 0,code:u.status,text:u.statusText}},`License Request XHR failed (${a}). Status: ${u.status} (${u.statusText})`));else{const d=c-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${d} attempts left`),this.requestLicense(e,t).then(s,r)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=u,this.setupLicenseXHR(u,a,e,t).then(({xhr:f,licenseChallenge:c})=>{e.keySystem==bn.PLAYREADY&&(c=this.unpackPlayReadyKeyMessage(f,c)),f.send(c)}).catch(r)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const n=t.media;this.media=n,Ti(n,"encrypted",this.onMediaEncrypted),Ti(n,"waitingforkey",this.onWaitingForKey);const s=this.mediaResolved;s?s():this.mediaKeys=n.mediaKeys}onMediaDetached(){const e=this.media;e&&(Ui(e,"encrypted",this.onMediaEncrypted),Ui(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const n=this.media,s=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,ho.clearKeyUriToKeyIdMap();const r=s.length;vl.CDMCleanupPromise=Promise.all(s.map(a=>this.removeSession(a)).concat((n==null||(e=n.setMediaKeys(null))==null?void 0:e.catch(a=>{this.log(`Could not clear media keys: ${a}`),this.hls&&this.hls.trigger(P.ERROR,{type:lt.OTHER_ERROR,details:ce.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${a}`)})}))||Promise.resolve())).catch(a=>{this.log(`Could not close sessions and clear media keys: ${a}`),this.hls&&this.hls.trigger(P.ERROR,{type:lt.OTHER_ERROR,details:ce.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${a}`)})}).then(()=>{r&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const n=t.reduce((s,r)=>(s.indexOf(r.keyFormat)===-1&&s.push(r.keyFormat),s),[]);this.log(`Selecting key-system from session-keys ${n.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(n)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:n,decryptdata:s}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${ui((s==null?void 0:s.keyId)||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),n&&n.readyState!==XMLHttpRequest.DONE&&n.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const r=this.mediaKeySessions.indexOf(e);r>-1&&this.mediaKeySessions.splice(r,1);const{keyStatusTimeouts:a}=e;a&&Object.keys(a).forEach(c=>self.clearTimeout(a[c]));const{drmSystemOptions:u}=this.config;return(o2(u)?new Promise((c,d)=>{self.setTimeout(()=>d(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(c).catch(d)}):Promise.resolve()).catch(c=>{this.log(`Could not remove session: ${c}`),this.hls&&this.hls.trigger(P.ERROR,{type:lt.OTHER_ERROR,details:ce.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${c}`)})}).then(()=>t.close()).catch(c=>{this.log(`Could not close session: ${c}`),this.hls&&this.hls.trigger(P.ERROR,{type:lt.OTHER_ERROR,details:ce.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${c}`)})})}return Promise.resolve()}}vl.CDMCleanupPromise=void 0;function Mf(i){if(!i)throw new Error("Could not read keyId of undefined decryptdata");if(i.keyId===null)throw new Error("keyId is null");return ui(i.keyId)}function RB(i,e){if(i.keyId&&e.mediaKeysSession.keyStatuses.has(i.keyId))return e.mediaKeysSession.keyStatuses.get(i.keyId);if(i.matches(e.decryptdata))return e.keyStatus}class Yi extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function Wx(i,e){const t=i==="output-restricted",n=t?ce.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:ce.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new Yi({type:lt.KEY_SYSTEM_ERROR,details:n,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${i}"`)}class bB{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(P.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(P.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(P.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(P.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const n=this.hls.config;if(n.capLevelOnFPSDrop){const s=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=s,s&&typeof s.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),n.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,n){const s=performance.now();if(t){if(this.lastTime){const r=s-this.lastTime,a=n-this.lastDroppedFrames,u=t-this.lastDecodedFrames,f=1e3*a/r,c=this.hls;if(c.trigger(P.FPS_DROP,{currentDropped:a,currentDecoded:u,totalDroppedFrames:n}),f>0&&a>c.config.fpsDroppedMonitoringThreshold*u){let d=c.currentLevel;c.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+d),d>0&&(c.autoLevelCapping===-1||c.autoLevelCapping>=d)&&(d=d-1,c.trigger(P.FPS_DROP_LEVEL_CAPPING,{level:d,droppedLevel:c.currentLevel}),c.autoLevelCapping=d,this.streamController.nextLevelSwitch())}}this.lastTime=s,this.lastDroppedFrames=n,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function vM(i,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=i,e.dispatchEvent(t)}function yM(i,e){const t=i.mode;if(t==="disabled"&&(i.mode="hidden"),i.cues&&!i.cues.getCueById(e.id))try{if(i.addCue(e),!i.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(n){an.debug(`[texttrack-utils]: ${n}`);try{const s=new self.TextTrackCue(e.startTime,e.endTime,e.text);s.id=e.id,i.addCue(s)}catch(s){an.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${s}`)}}t==="disabled"&&(i.mode=t)}function fl(i,e){const t=i.mode;if(t==="disabled"&&(i.mode="hidden"),i.cues)for(let n=i.cues.length;n--;)e&&i.cues[n].removeEventListener("enter",e),i.removeCue(i.cues[n]);t==="disabled"&&(i.mode=t)}function Gg(i,e,t,n){const s=i.mode;if(s==="disabled"&&(i.mode="hidden"),i.cues&&i.cues.length>0){const r=CB(i.cues,e,t);for(let a=0;a<r.length;a++)(!n||n(r[a]))&&i.removeCue(r[a])}s==="disabled"&&(i.mode=s)}function MB(i,e){if(e<=i[0].startTime)return 0;const t=i.length-1;if(e>i[t].endTime)return-1;let n=0,s=t,r;for(;n<=s;)if(r=Math.floor((s+n)/2),e<i[r].startTime)s=r-1;else if(e>i[r].startTime&&n<t)n=r+1;else return r;return i[n].startTime-e<e-i[s].startTime?n:s}function CB(i,e,t){const n=[],s=MB(i,e);if(s>-1)for(let r=s,a=i.length;r<a;r++){const u=i[r];if(u.startTime>=e&&u.endTime<=t)n.push(u);else if(u.startTime>t)return n}return n}function fd(i){const e=[];for(let t=0;t<i.length;t++){const n=i[t];(n.kind==="subtitles"||n.kind==="captions")&&n.label&&e.push(i[t])}return e}class IB extends rv{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const n=fd(this.media.textTracks);for(let r=0;r<n.length;r++)if(n[r].mode==="hidden")t=n[r];else if(n[r].mode==="showing"){t=n[r];break}const s=this.findTrackForTextTrack(t);this.subtitleTrack!==s&&this.setSubtitleTrack(s)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(P.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(P.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(P.MANIFEST_LOADING,this.onManifestLoading,this),e.on(P.MANIFEST_PARSED,this.onManifestParsed,this),e.on(P.LEVEL_LOADING,this.onLevelLoading,this),e.on(P.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(P.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(P.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(P.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(P.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(P.MANIFEST_LOADING,this.onManifestLoading,this),e.off(P.MANIFEST_PARSED,this.onManifestParsed,this),e.off(P.LEVEL_LOADING,this.onLevelLoading,this),e.off(P.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(P.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(P.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const n=this.media;if(!n)return;const s=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||n.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,s)return;fd(n.textTracks).forEach(a=>{fl(a)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:n,groupId:s,details:r}=t,a=this.tracksInGroup[n];if(!a||a.groupId!==s){this.warn(`Subtitle track with id:${n} and group:${s} not found in active group ${a==null?void 0:a.groupId}`);return}const u=a.details;a.details=t.details,this.log(`Subtitle track ${n} "${a.name}" lang:${a.lang} group:${s} loaded [${r.startSN}-${r.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,u)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.subtitleGroups||null,s=this.groupIds;let r=this.currentTrack;if(!n||(s==null?void 0:s.length)!==(n==null?void 0:n.length)||n!=null&&n.some(a=>(s==null?void 0:s.indexOf(a))===-1)){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(d=>!n||n.indexOf(d.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(d=>d.default)&&(this.selectDefaultTrack=!1),a.forEach((d,p)=>{d.id=p});else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const u=this.hls.config.subtitlePreference;if(!r&&u){this.selectDefaultTrack=!1;const d=Gs(u,a);if(d>-1)r=a[d];else{const p=Gs(u,this.tracks);r=this.tracks[p]}}let f=this.findTrackId(r);f===-1&&r&&(f=this.findTrackId(null));const c={subtitleTracks:a};this.log(`Updating subtitle tracks, ${a.length} track(s) found in "${n==null?void 0:n.join(",")}" group-id`),this.hls.trigger(P.SUBTITLE_TRACKS_UPDATED,c),f!==-1&&this.trackId===-1&&this.setSubtitleTrack(f)}}findTrackId(e){const t=this.tracksInGroup,n=this.selectDefaultTrack;for(let s=0;s<t.length;s++){const r=t[s];if(!(n&&!r.default||!n&&!e)&&(!e||na(r,e)))return s}if(e){for(let s=0;s<t.length;s++){const r=t[s];if(Xu(e.attrs,r.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return s}for(let s=0;s<t.length;s++){const r=t[s];if(Xu(e.attrs,r.attrs,["LANGUAGE"]))return s}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const s=t[n];if(Og(s,e))return n}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===Nt.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const n=this.currentTrack;if(n&&na(e,n))return n;const s=Gs(e,this.tracksInGroup);if(s>-1){const r=this.tracksInGroup[s];return this.setSubtitleTrack(s),r}else{if(n)return null;{const r=Gs(e,t);if(r>-1)return t[r]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,s=e.groupId,r=this.getUrlWithDirectives(e.url,t),a=e.details,u=a==null?void 0:a.age;this.log(`Loading subtitle ${n} "${e.name}" lang:${e.lang} group:${s}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${u&&a.live?" age "+u.toFixed(1)+(a.type&&" "+a.type||""):""} ${r}`),this.hls.trigger(P.SUBTITLE_TRACK_LOADING,{url:r,id:n,groupId:s,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=fd(e.textTracks),n=this.currentTrack;let s;if(n&&(s=t.filter(r=>Og(n,r))[0],s||this.warn(`Unable to find subtitle TextTrack with name "${n.name}" and language "${n.lang}"`)),[].slice.call(t).forEach(r=>{r.mode!=="disabled"&&r!==s&&(r.mode="disabled")}),s){const r=this.subtitleDisplay?"showing":"hidden";s.mode!==r&&(s.mode=r)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!Ye(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const n=this.currentTrack,s=t[e]||null;if(this.trackId=e,this.currentTrack=s,this.toggleTrackModes(),!s){this.hls.trigger(P.SUBTITLE_TRACK_SWITCH,{id:e});return}const r=!!s.details&&!s.details.live;if(e===this.trackId&&s===n&&r)return;this.log(`Switching to subtitle-track ${e}`+(s?` "${s.name}" lang:${s.lang} group:${s.groupId}`:""));const{id:a,groupId:u="",name:f,type:c,url:d}=s;this.hls.trigger(P.SUBTITLE_TRACK_SWITCH,{id:a,groupId:u,name:f,type:c,url:d});const p=this.switchParams(s.url,n==null?void 0:n.details,s.details);this.loadPlaylist(p)}}function LB(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{const r=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(s=="x"?r:r&3|8).toString(16)})}}}function Bu(i){let e=5381,t=i.length;for(;t;)e=e*33^i.charCodeAt(--t);return(e>>>0).toString()}const yl=.025;let Ud=(function(i){return i[i.Point=0]="Point",i[i.Range=1]="Range",i})({});function DB(i,e,t){return`${i.identifier}-${t+1}-${Bu(e)}`}class wB{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const n=this.playoutLimit;return e<=0||isNaN(n)?!1:n===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>n}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return Rm(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,n=Rm(t,e);return t-n<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=Ye(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return Rm(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<yl))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?Ud.Range:Ud.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return PB(this)}}function Rm(i,e){return i-e.start<e.duration/2&&!(Math.abs(i-(e.start+e.duration))<yl)?e.start:e.start+e.duration}function _M(i,e,t){const n=new self.URL(i,t);return n.protocol!=="data:"&&n.searchParams.set("_HLS_primary_id",e),n}function bm(i,e){for(;(t=i.assetList[++e])!=null&&t.error;)var t;return e}function PB(i){return`["${i.identifier}" ${i.cue.pre?"<pre>":i.cue.post?"<post>":""}${i.timelineStart.toFixed(2)}-${i.resumeTime.toFixed(2)}]`}function ol(i){const e=i.timelineStart,t=i.duration||0;return`["${i.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class NB{constructor(e,t,n,s){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(P.PLAYOUT_LIMIT_REACHED,{})};const r=this.hls=new e(t);this.interstitial=n,this.assetItem=s;const a=()=>{this.hasDetails=!0};r.once(P.LEVEL_LOADED,a),r.once(P.AUDIO_TRACK_LOADED,a),r.once(P.SUBTITLE_TRACK_LOADED,a),r.on(P.MEDIA_ATTACHING,(u,{media:f})=>{this.removeMediaListeners(),this.mediaAttached=f,this.interstitial.playoutLimit&&(f.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&r.on(P.BUFFER_APPENDED,()=>{const d=this.bufferedEnd;this.reachedPlayout(d)&&(this._bufferedEosTime=d,r.trigger(P.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=_M(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const n=Math.min(this._bufferedEosTime||1/0,this.duration),s=this.timelineOffset,r=xt.bufferInfo(e,s,0);return this.getAssetTime(r.end)>=n-.02}reachedPlayout(e){const n=this.interstitial.playoutLimit;return this.startOffset+e>=n}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=xt.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const n=t-this.startOffset;if(n>0&&n<e)return n}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const n=e-t;if(Math.abs(n)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,n=this.duration;return Math.min(Math.max(0,e-t),n)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=n=>delete n.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,n){var s;(s=this.hls)==null||s.on(e,t)}once(e,t,n){var s;(s=this.hls)==null||s.once(e,t)}off(e,t,n){var s;(s=this.hls)==null||s.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${ol(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const Kx=.033;class UB extends ms{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((n,s)=>e<=s.startOffset&&t>s.startOffset?(delete s.error,n+1):n,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let n=-1;e.nextEvent?n=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(n=this.findEventIndex(e.previousEvent.identifier)+1);const s=this.items;if(s)for(s[n]||(t===void 0&&(t=e.start),n=this.findItemIndexAtTime(t));n>=0&&(r=s[n])!=null&&r.event;){var r;n--}return n}findItemIndexAtTime(e,t){const n=this.items;if(n)for(let s=0;s<n.length;s++){let r=n[s];if(t&&t!=="primary"&&(r=r[t]),e===r.start||e>r.start&&e<r.end)return s}return-1}findJumpRestrictedIndex(e,t){const n=this.items;if(n)for(let s=e;s<=t&&n[s];s++){const r=n[s].event;if(r!=null&&r.restrictions.jump&&!r.appendInPlace)return s}return-1}findEventIndex(e){const t=this.items;if(t)for(let s=t.length;s--;){var n;if(((n=t[s].event)==null?void 0:n.identifier)===e)return s}return-1}findAssetIndex(e,t){const n=e.assetList,s=n.length;if(s>1)for(let r=0;r<s;r++){const a=n[r];if(!a.error){const u=a.timelineStart;if(t===u||t>u&&(t<u+(a.duration||0)||r===s-1))return r}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const n=t.assetList,s=n[n.length-1];if(s)return s.identifier}return null}parseInterstitialDateRanges(e,t){const n=e.main.details,{dateRanges:s}=n,r=this.events,a=this.parseDateRanges(s,{url:n.url},t),u=Object.keys(s),f=r?r.filter(c=>!u.includes(c.identifier)):[];a.length&&a.sort((c,d)=>{const p=c.cue.pre,m=c.cue.post,y=d.cue.pre,E=d.cue.post;if(p&&!y)return-1;if(y&&!p||m&&!E)return 1;if(E&&!m)return-1;if(!p&&!y&&!m&&!E){const A=c.startTime,S=d.startTime;if(A!==S)return A-S}return c.dateRange.tagOrder-d.dateRange.tagOrder}),this.events=a,f.forEach(c=>{this.removeEvent(c)}),this.updateSchedule(e,f)}updateSchedule(e,t=[],n=!1){const s=this.events||[];if(s.length||t.length||this.length<2){const r=this.items,a=this.parseSchedule(s,e);(n||t.length||(r==null?void 0:r.length)!==a.length||a.some((f,c)=>Math.abs(f.playout.start-r[c].playout.start)>.005||Math.abs(f.playout.end-r[c].playout.end)>.005))&&(this.items=a,this.onScheduleUpdate(t,r))}}parseDateRanges(e,t,n){const s=[],r=Object.keys(e);for(let a=0;a<r.length;a++){const u=r[a],f=e[u];if(f.isInterstitial){let c=this.eventMap[u];c?c.setDateRange(f):(c=new wB(f,t),this.eventMap[u]=c,n===!1&&(c.appendInPlace=n)),s.push(c)}}return s}parseSchedule(e,t){const n=[],s=t.main.details,r=s.live?1/0:s.edge;let a=0;if(e=e.filter(f=>!f.error&&!(f.cue.once&&f.hasPlayed)),e.length){this.resolveOffsets(e,t);let f=0,c=0;if(e.forEach((d,p)=>{const m=d.cue.pre,y=d.cue.post,E=e[p-1]||null,A=d.appendInPlace,S=y?r:d.startOffset,x=d.duration,M=d.timelineOccupancy===Ud.Range?x:0,b=d.resumptionOffset,C=(E==null?void 0:E.startTime)===S,N=S+d.cumulativeDuration;let U=A?N+x:S+b;if(m||!y&&S<=0){const O=c;c+=M,d.timelineStart=N;const L=a;a+=x,n.push({event:d,start:N,end:U,playout:{start:L,end:a},integrated:{start:O,end:c}})}else if(S<=r){if(!C){const I=S-f;if(I>Kx){const F=f,X=c;c+=I;const Y=a;a+=I;const ee={previousEvent:e[p-1]||null,nextEvent:d,start:F,end:F+I,playout:{start:Y,end:a},integrated:{start:X,end:c}};n.push(ee)}else I>0&&E&&(E.cumulativeDuration+=I,n[n.length-1].end=S)}y&&(U=N),d.timelineStart=N;const O=c;c+=M;const L=a;a+=x,n.push({event:d,start:N,end:U,playout:{start:L,end:a},integrated:{start:O,end:c}})}else return;const w=d.resumeTime;y||w>r?f=r:f=w}),f<r){var u;const d=f,p=c,m=r-f;c+=m;const y=a;a+=m,n.push({previousEvent:((u=n[n.length-1])==null?void 0:u.event)||null,nextEvent:null,start:f,end:d+m,playout:{start:y,end:a},integrated:{start:p,end:c}})}this.setDurations(r,a,c)}else n.push({previousEvent:null,nextEvent:null,start:0,end:r,playout:{start:0,end:r},integrated:{start:0,end:r}}),this.setDurations(r,r,r);return n}setDurations(e,t,n){this.durations={primary:e,playout:t,integrated:n}}resolveOffsets(e,t){const n=t.main.details,s=n.live?1/0:n.edge;let r=0,a=-1;e.forEach((u,f)=>{const c=u.cue.pre,d=u.cue.post,p=c?0:d?s:u.startTime;this.updateAssetDurations(u),a===p?u.cumulativeDuration=r:(r=0,a=p),!d&&u.snapOptions.in&&(u.resumeAnchor=ia(null,n.fragments,u.startOffset+u.resumptionOffset,0,0)||void 0),u.appendInPlace&&!u.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(u,t)||(u.appendInPlace=!1)),!u.appendInPlace&&f+1<e.length&&e[f+1].startTime-e[f].resumeTime<Kx&&(e[f+1].appendInPlace=!1,e[f+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${u}`));const y=Ye(u.resumeOffset)?u.resumeOffset:u.duration;r+=y})}primaryCanResumeInPlaceAt(e,t){const n=e.resumeTime,s=e.startTime+e.resumptionOffset;return Math.abs(n-s)>yl?(this.log(`"${e.identifier}" resumption ${n} not aligned with estimated timeline end ${s}`),!1):!Object.keys(t).some(a=>{const u=t[a].details,f=u.edge;if(n>=f)return this.log(`"${e.identifier}" resumption ${n} past ${a} playlist end ${f}`),!1;const c=ia(null,u.fragments,n);if(!c)return this.log(`"${e.identifier}" resumption ${n} does not align with any fragments in ${a} playlist (${u.fragStart}-${u.fragmentEnd})`),!0;const d=a==="audio"?.175:0;return Math.abs(c.start-n)<yl+d||Math.abs(c.end-n)<yl+d?!1:(this.log(`"${e.identifier}" resumption ${n} not aligned with ${a} fragment bounds (${c.start}-${c.end} sn: ${c.sn} cc: ${c.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let n=0,s=!1,r=!1;for(let a=0;a<e.assetList.length;a++){const u=e.assetList[a],f=t+n;u.startOffset=n,u.timelineStart=f,s||(s=u.duration===null),r||(r=!!u.error);const c=u.error?0:u.duration||0;n+=c}s&&!r?e.duration=Math.max(n,e.duration):e.duration=n}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function Es(i){return`[${i.event?'"'+i.event.identifier+'"':"primary"}: ${i.start.toFixed(2)}-${i.end.toFixed(2)}]`}class OB{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const n=e.assetListUrl;let s;try{s=_M(n,this.hls.sessionId,e.baseUrl)}catch(m){const y=this.assignAssetListError(e,ce.ASSET_LIST_LOAD_ERROR,m,n);this.hls.trigger(P.ERROR,y);return}t&&s.protocol!=="data:"&&s.searchParams.set("_HLS_start_offset",""+t);const r=this.hls.config,a=r.loader,u=new a(r),f={responseType:"json",url:s.href},c=r.interstitialAssetListLoadPolicy.default,d={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(m,y,E,A)=>{const S=m.data,x=S==null?void 0:S.ASSETS;if(!Array.isArray(x)){const M=this.assignAssetListError(e,ce.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),E.url,y,A);this.hls.trigger(P.ERROR,M);return}e.assetListResponse=S,this.hls.trigger(P.ASSET_LIST_LOADED,{event:e,assetListResponse:S,networkDetails:A})},onError:(m,y,E,A)=>{const S=this.assignAssetListError(e,ce.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${m.code} ${m.text} (${y.url})`),y.url,A,E);this.hls.trigger(P.ERROR,S)},onTimeout:(m,y,E)=>{const A=this.assignAssetListError(e,ce.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${y.url})`),y.url,m,E);this.hls.trigger(P.ERROR,A)}};return u.load(f,d,p),this.hls.trigger(P.ASSET_LIST_LOADING,{event:e}),u}assignAssetListError(e,t,n,s,r,a){return e.error=n,{type:lt.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:s,error:n,networkDetails:a,stats:r}}}function Yx(i){var e;i==null||(e=i.play())==null||e.catch(()=>{})}function Cf(i,e){return`[${i}] Advancing timeline position to ${e}`}class FB extends ms{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const n=this.currentTime;if(n===void 0||this.playbackDisabled||!this.schedule)return;const s=n-this.timelinePos;if(Math.abs(s)<1/7056e5)return;const a=s<=-.01;this.timelinePos=n,this.bufferedPos=n;const u=this.playingItem;if(!u){this.checkBuffer();return}if(a&&this.schedule.resetErrorsInRange(n,n-s)&&this.updateSchedule(!0),this.checkBuffer(),a&&n<u.start||n>=u.end){var f;const y=this.findItemIndex(u);let E=this.schedule.findItemIndexAtTime(n);if(E===-1&&(E=y+(a?-1:1),this.log(`seeked ${a?"back ":""}to position not covered by schedule ${n} (resolving from ${y} to ${E})`)),!this.isInterstitial(u)&&(f=this.media)!=null&&f.paused&&(this.shouldPlay=!1),!a&&E>y){const A=this.schedule.findJumpRestrictedIndex(y+1,E);if(A>y){this.setSchedulePosition(A);return}}this.setSchedulePosition(E);return}const c=this.playingAsset;if(!c){if(this.playingLastItem&&this.isInterstitial(u)){const y=u.event.assetList[0];y&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(n,y))}return}const d=c.timelineStart,p=c.duration||0;if(a&&n<d||n>=d+p){var m;(m=u.event)!=null&&m.appendInPlace&&(this.clearAssetPlayers(u.event,u),this.flushFrontBuffer(n)),this.setScheduleToAssetAtTime(n,c)}},this.onTimeupdate=()=>{const n=this.currentTime;if(n===void 0||this.playbackDisabled)return;if(n>this.timelinePos)this.timelinePos=n,n>this.bufferedPos&&this.checkBuffer();else return;const s=this.playingItem;if(!s||this.playingLastItem)return;if(n>=s.end){this.timelinePos=s.end;const u=this.findItemIndex(s);this.setSchedulePosition(u+1)}const r=this.playingAsset;if(!r)return;const a=r.timelineStart+(r.duration||0);n>=a&&this.setScheduleToAssetAtTime(n,r)},this.onScheduleUpdate=(n,s)=>{const r=this.schedule;if(!r)return;const a=this.playingItem,u=r.events||[],f=r.items||[],c=r.durations,d=n.map(A=>A.identifier),p=!!(u.length||d.length);(p||s)&&this.log(`INTERSTITIALS_UPDATED (${u.length}): ${u}
Schedule: ${f.map(A=>Es(A))} pos: ${this.timelinePos}`),d.length&&this.log(`Removed events ${d}`);let m=null,y=null;a&&(m=this.updateItem(a,this.timelinePos),this.itemsMatch(a,m)?this.playingItem=m:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const E=this.bufferingItem;if(E&&(y=this.updateItem(E,this.bufferedPos),this.itemsMatch(E,y)?this.bufferingItem=y:E.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(E.event,null))),n.forEach(A=>{A.assetList.forEach(S=>{this.clearAssetPlayer(S.identifier,null)})}),this.playerQueue.forEach(A=>{if(A.interstitial.appendInPlace){const S=A.assetItem.timelineStart,x=A.timelineOffset-S;if(x)try{A.timelineOffset=S}catch(M){Math.abs(x)>yl&&this.warn(`${M} ("${A.assetId}" ${A.timelineOffset}->${S})`)}}}),p||s){if(this.hls.trigger(P.INTERSTITIALS_UPDATED,{events:u.slice(0),schedule:f.slice(0),durations:c,removedIds:d}),this.isInterstitial(a)&&d.includes(a.event.identifier)){this.warn(`Interstitial "${a.event.identifier}" removed while playing`),this.primaryFallback(a.event);return}a&&this.trimInPlace(m,a),E&&y!==m&&this.trimInPlace(y,E),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new OB(e),this.schedule=new UB(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(P.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(P.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(P.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(P.MANIFEST_LOADING,this.onManifestLoading,this),e.on(P.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(P.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(P.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(P.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(P.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(P.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(P.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(P.BUFFER_APPENDED,this.onBufferAppended,this),e.on(P.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(P.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(P.MEDIA_ENDED,this.onMediaEnded,this),e.on(P.ERROR,this.onError,this),e.on(P.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(P.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(P.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(P.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(P.MANIFEST_LOADING,this.onManifestLoading,this),e.off(P.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(P.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(P.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(P.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(P.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(P.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(P.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(P.BUFFER_CODECS,this.onBufferCodecs,this),e.off(P.BUFFER_APPENDED,this.onBufferAppended,this),e.off(P.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(P.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(P.MEDIA_ENDED,this.onMediaEnded,this),e.off(P.ERROR,this.onError,this),e.off(P.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){Ui(e,"play",this.onPlay),Ui(e,"pause",this.onPause),Ui(e,"seeking",this.onSeeking),Ui(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const n=this.media=t.media;Ti(n,"seeking",this.onSeeking),Ti(n,"timeupdate",this.onTimeupdate),Ti(n,"play",this.onPlay),Ti(n,"pause",this.onPause)}onMediaAttached(e,t){const n=this.effectivePlayingItem,s=this.detachedData;if(this.detachedData=null,n===null)this.checkStart();else if(!s){this.clearScheduleState();const r=this.findItemIndex(n);this.setSchedulePosition(r)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const n=!!t.transferMedia,s=this.media;if(this.media=null,!n&&(s&&this.removeMediaListeners(s),this.detachedData)){const r=this.getBufferingPlayer();r&&(this.log(`Removing schedule state for detachedData and ${r}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,r.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,n=p=>p&&e.getAssetPlayer(p.identifier),s=(p,m,y,E,A)=>{if(p){let S=p[m].start;const x=p.event;if(x){if(m==="playout"||x.timelineOccupancy!==Ud.Point){const M=n(y);(M==null?void 0:M.interstitial)===x&&(S+=M.assetItem.startOffset+M[A])}}else{const M=E==="bufferedPos"?a():e[E];S+=M-p.start}return S}return 0},r=(p,m)=>{var y;if(p!==0&&m!=="primary"&&(y=e.schedule)!=null&&y.length){var E;const A=e.schedule.findItemIndexAtTime(p),S=(E=e.schedule.items)==null?void 0:E[A];if(S){const x=S[m].start-S.start;return p+x}}return p},a=()=>{const p=e.bufferedPos;return p===Number.MAX_VALUE?u("primary"):Math.max(p,0)},u=p=>{var m,y;return(m=e.primaryDetails)!=null&&m.live?e.primaryDetails.edge:((y=e.schedule)==null?void 0:y.durations[p])||0},f=(p,m)=>{var y,E;const A=e.effectivePlayingItem;if(A!=null&&(y=A.event)!=null&&y.restrictions.skip||!e.schedule)return;e.log(`seek to ${p} "${m}"`);const S=e.effectivePlayingItem,x=e.schedule.findItemIndexAtTime(p,m),M=(E=e.schedule.items)==null?void 0:E[x],b=e.getBufferingPlayer(),C=b==null?void 0:b.interstitial,N=C==null?void 0:C.appendInPlace,U=S&&e.itemsMatch(S,M);if(S&&(N||U)){const w=n(e.playingAsset),O=(w==null?void 0:w.media)||e.primaryMedia;if(O){const L=m==="primary"?O.currentTime:s(S,m,e.playingAsset,"timelinePos","currentTime"),I=p-L,F=(N?L:O.currentTime)+I;if(F>=0&&(!w||N||F<=w.duration)){O.currentTime=F;return}}}if(M){let w=p;if(m!=="primary"){const L=M[m].start,I=p-L;w=M.start+I}const O=!e.isInterstitial(M);if((!e.isInterstitial(S)||S.event.appendInPlace)&&(O||M.event.appendInPlace)){const L=e.media||(N?b==null?void 0:b.media:null);L&&(L.currentTime=w)}else if(S){const L=e.findItemIndex(S);if(x>L){const F=e.schedule.findJumpRestrictedIndex(L+1,x);if(F>L){e.setSchedulePosition(F);return}}let I=0;if(O)e.timelinePos=w,e.checkBuffer();else{const F=M.event.assetList,X=p-(M[m]||M).start;for(let Y=F.length;Y--;){const ee=F[Y];if(ee.duration&&X>=ee.startOffset&&X<ee.startOffset+ee.duration){I=Y;break}}}e.setSchedulePosition(x,I)}}},c=()=>{const p=e.effectivePlayingItem;if(e.isInterstitial(p))return p;const m=t();return e.isInterstitial(m)?m:null},d={get bufferedEnd(){const p=t(),m=e.bufferingItem;if(m&&m===p){var y;return s(m,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-m.playout.start||((y=e.bufferingAsset)==null?void 0:y.startOffset)||0}return 0},get currentTime(){const p=c(),m=e.effectivePlayingItem;return m&&m===p?s(m,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-m.playout.start:0},set currentTime(p){const m=c(),y=e.effectivePlayingItem;y&&y===m&&f(p+y.playout.start,"playout")},get duration(){const p=c();return p?p.playout.end-p.playout.start:0},get assetPlayers(){var p;const m=(p=c())==null?void 0:p.event.assetList;return m?m.map(y=>e.getAssetPlayer(y.identifier)):[]},get playingIndex(){var p;const m=(p=c())==null?void 0:p.event;return m&&e.effectivePlayingAsset?m.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return c()}};return this.manager={get events(){var p;return((p=e.schedule)==null||(p=p.events)==null?void 0:p.slice(0))||[]},get schedule(){var p;return((p=e.schedule)==null||(p=p.items)==null?void 0:p.slice(0))||[]},get interstitialPlayer(){return c()?d:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const p=t();return e.findItemIndex(p)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const p=e.effectivePlayingItem;return e.findItemIndex(p)},primary:{get bufferedEnd(){return a()},get currentTime(){const p=e.timelinePos;return p>0?p:0},set currentTime(p){f(p,"primary")},get duration(){return u("primary")},get seekableStart(){var p;return((p=e.primaryDetails)==null?void 0:p.fragmentStart)||0}},integrated:{get bufferedEnd(){return s(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return s(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(p){f(p,"integrated")},get duration(){return u("integrated")},get seekableStart(){var p;return r(((p=e.primaryDetails)==null?void 0:p.fragmentStart)||0,"integrated")}},skip:()=>{const p=e.effectivePlayingItem,m=p==null?void 0:p.event;if(m&&!m.restrictions.skip){const y=e.findItemIndex(p);if(m.appendInPlace){const E=p.playout.start+p.event.duration;f(E+.001,"playout")}else e.advanceAfterAssetEnded(m,y,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,n=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!n?!1:this.findItemIndex(t)===n.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const n=this.waitingItem||this.playingItem;if(this.isInterstitial(n)&&!n.event.appendInPlace)return;let s=this.media;!s&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(s=this.primaryMedia);const r=(t=s)==null?void 0:t.currentTime;if(!(r===void 0||!Ye(r)))return r}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const n=this.getAssetPlayer(e);n&&this.transferMediaFromPlayer(n,t)}transferMediaFromPlayer(e,t){const n=e.interstitial.appendInPlace,s=e.media;if(n&&s===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&s){this.detachedData={media:s};return}const r=e.transferMedia();this.log(`transfer MediaSource from ${e} ${yn(r)}`),this.detachedData=r}else t&&s&&(this.shouldPlay||(this.shouldPlay=!s.paused))}transferMediaTo(e,t){var n,s;if(e.media===t)return;let r=null;const a=this.hls,u=e!==a,f=u&&e.interstitial.appendInPlace,c=(n=this.detachedData)==null?void 0:n.mediaSource;let d;if(a.media)f&&(r=a.transferMedia(),this.detachedData=r),d="Primary";else if(c){const E=this.getBufferingPlayer();E?(r=E.transferMedia(),d=`${E}`):d="detached MediaSource"}else d="detached media";if(!r){if(c)r=this.detachedData,this.log(`using detachedData: MediaSource ${yn(r)}`);else if(!this.detachedData||a.media===t){const E=this.playerQueue;E.length>1&&E.forEach(A=>{if(u&&A.interstitial.appendInPlace!==f){const S=A.interstitial;this.clearInterstitial(A.interstitial,null),S.appendInPlace=!1,S.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${S}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const p=r&&"mediaSource"in r&&((s=r.mediaSource)==null?void 0:s.readyState)!=="closed",m=p&&r?r:t;this.log(`${p?"transfering MediaSource":"attaching media"} to ${u?e:"Primary"} from ${d} (media.currentTime: ${t.currentTime})`);const y=this.schedule;if(m===r&&y){const E=u&&e.assetId===y.assetIdAtEnd;m.overrides={duration:y.duration,endOfStream:!u||E,cueRemoval:!u}}e.attachMedia(m)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e==null?void 0:e.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const n=this.timelinePos,s=this.effectivePlayingItem;if(n===-1){const r=this.hls.startPosition;if(this.log(Cf("checkStart",r)),this.timelinePos=r,t.length&&t[0].cue.pre){const a=e.findEventIndex(t[0].identifier);this.setSchedulePosition(a)}else if(r>=0||!this.primaryLive){const a=this.timelinePos=r>0?r:0,u=e.findItemIndexAtTime(a);this.setSchedulePosition(u)}}else if(s&&!this.playingItem){const r=e.findItemIndex(s);this.setSchedulePosition(r)}}advanceAssetBuffering(e,t){const n=e.event,s=n.findAssetIndex(t),r=bm(n,s);if(!n.isAssetPastPlayoutLimit(r))this.bufferedToEvent(e,r);else if(this.schedule){var a;const u=(a=this.schedule.items)==null?void 0:a[this.findItemIndex(e)+1];u&&this.bufferedToItem(u)}}advanceAfterAssetEnded(e,t,n){const s=bm(e,n);if(e.isAssetPastPlayoutLimit(s)){if(this.schedule){const r=this.schedule.items;if(r){const a=t+1,u=r.length;if(a>=u){this.setSchedulePosition(-1);return}const f=e.resumeTime;this.timelinePos<f&&(this.log(Cf("advanceAfterAssetEnded",f)),this.timelinePos=f,e.appendInPlace&&this.advanceInPlace(f),this.checkBuffer(this.bufferedPos<f)),this.setSchedulePosition(a)}}}else{if(e.appendInPlace){const r=e.assetList[s];r&&this.advanceInPlace(r.timelineStart)}this.setSchedulePosition(t,s)}}setScheduleToAssetAtTime(e,t){const n=this.schedule;if(!n)return;const s=t.parentIdentifier,r=n.getEvent(s);if(r){const a=n.findEventIndex(s),u=n.findAssetIndex(r,e);this.advanceAfterAssetEnded(r,a,u-1)}}setSchedulePosition(e,t){var n;const s=(n=this.schedule)==null?void 0:n.items;if(!s||this.playbackDisabled)return;const r=e>=0?s[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${r&&Es(r)}) pos: ${this.timelinePos}`);const a=this.waitingItem||this.playingItem,u=this.playingLastItem;if(this.isInterstitial(a)){const d=a.event,p=this.playingAsset,m=p==null?void 0:p.identifier,y=m?this.getAssetPlayer(m):null;if(y&&m&&(!this.eventItemsMatch(a,r)||t!==void 0&&m!==d.assetList[t].identifier)){var f;const E=d.findAssetIndex(p);if(this.log(`INTERSTITIAL_ASSET_ENDED ${E+1}/${d.assetList.length} ${ol(p)}`),this.endedAsset=p,this.playingAsset=null,this.hls.trigger(P.INTERSTITIAL_ASSET_ENDED,{asset:p,assetListIndex:E,event:d,schedule:s.slice(0),scheduleIndex:e,player:y}),a!==this.playingItem){this.itemsMatch(a,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(d,this.findItemIndex(this.playingItem),E);return}this.retreiveMediaSource(m,r),y.media&&!((f=this.detachedData)!=null&&f.mediaSource)&&y.detachMedia()}if(!this.eventItemsMatch(a,r)&&(this.endedItem=a,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${d} ${Es(a)}`),d.hasPlayed=!0,this.hls.trigger(P.INTERSTITIAL_ENDED,{event:d,schedule:s.slice(0),scheduleIndex:e}),d.cue.once)){var c;this.updateSchedule();const E=(c=this.schedule)==null?void 0:c.items;if(r&&E){const A=this.findItemIndex(r);this.advanceSchedule(A,E,t,a,u)}return}}this.advanceSchedule(e,s,t,a,u)}advanceSchedule(e,t,n,s,r){const a=this.schedule;if(!a)return;const u=t[e]||null,f=this.primaryMedia,c=this.playerQueue;if(c.length&&c.forEach(d=>{const p=d.interstitial,m=a.findEventIndex(p.identifier);(m<e||m>e+1)&&this.clearInterstitial(p,u)}),this.isInterstitial(u)){this.timelinePos=Math.min(Math.max(this.timelinePos,u.start),u.end);const d=u.event;if(n===void 0){n=a.findAssetIndex(d,this.timelinePos);const E=bm(d,n-1);if(d.isAssetPastPlayoutLimit(E)||d.appendInPlace&&this.timelinePos===u.end){this.advanceAfterAssetEnded(d,e,n);return}n=E}const p=this.waitingItem;this.assetsBuffered(u,f)||this.setBufferingItem(u);let m=this.preloadAssets(d,n);if(this.eventItemsMatch(u,p||s)||(this.waitingItem=u,this.log(`INTERSTITIAL_STARTED ${Es(u)} ${d.appendInPlace?"append in place":""}`),this.hls.trigger(P.INTERSTITIAL_STARTED,{event:d,schedule:t.slice(0),scheduleIndex:e})),!d.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${d}`);return}if(d.assetListLoader&&(d.assetListLoader.destroy(),d.assetListLoader=void 0),!f){this.log(`Waiting for attachMedia to start Interstitial ${d}`);return}this.waitingItem=this.endedItem=null,this.playingItem=u;const y=d.assetList[n];if(!y){this.advanceAfterAssetEnded(d,e,n||0);return}if(m||(m=this.getAssetPlayer(y.identifier)),m===null||m.destroyed){const E=d.assetList.length;this.warn(`asset ${n+1}/${E} player destroyed ${d}`),m=this.createAssetPlayer(d,y,n),m.loadSource()}if(!this.eventItemsMatch(u,this.bufferingItem)&&d.appendInPlace&&this.isAssetBuffered(y))return;this.startAssetPlayer(m,n,t,e,f),this.shouldPlay&&Yx(m.media)}else u?(this.resumePrimary(u,e,s),this.shouldPlay&&Yx(this.hls.media)):r&&this.isInterstitial(s)&&(this.endedItem=null,this.playingItem=s,s.event.appendInPlace||this.attachPrimary(a.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,n){var s,r;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${Es(e)}`),!((s=this.detachedData)!=null&&s.mediaSource)){let u=this.timelinePos;(u<e.start||u>=e.end)&&(u=this.getPrimaryResumption(e,t),this.log(Cf("resumePrimary",u)),this.timelinePos=u),this.attachPrimary(u,e)}if(!n)return;const a=(r=this.schedule)==null?void 0:r.items;a&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${Es(e)}`),this.hls.trigger(P.INTERSTITIALS_PRIMARY_RESUMED,{schedule:a.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const n=e.start;if(this.primaryLive){const s=this.primaryDetails;if(t===0)return this.hls.startPosition;if(s&&(n<s.fragmentStart||n>s.edge))return this.hls.liveSyncPosition||-1}return n}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:xt.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,n){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const s=this.primaryMedia;if(!s)return;const r=this.hls;r.media?this.checkBuffer():(this.transferMediaTo(r,s),n&&this.startLoadingPrimaryAt(e,n)),n||(this.log(Cf("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,n))}startLoadingPrimaryAt(e,t){var n;const s=this.hls;!s.loadingEnabled||!s.media||Math.abs((((n=s.mainForwardBufferInfo)==null?void 0:n.start)||s.media.currentTime)-e)>.5?s.startLoad(e,t):s.bufferingEnabled||s.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(P.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(P.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const n=this.hls.levels[t.level];if(!n.details)return;const s=on(on({},this.mediaSelection||this.altSelection),{},{main:n});this.mediaSelection=s,this.schedule.parseInterstitialDateRanges(s,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const n=this.hls.audioTracks[t.id],s=this.mediaSelection;if(!s){this.altSelection=on(on({},this.altSelection),{},{audio:n});return}const r=on(on({},s),{},{audio:n});this.mediaSelection=r}onSubtitleTrackUpdated(e,t){const n=this.hls.subtitleTracks[t.id],s=this.mediaSelection;if(!s){this.altSelection=on(on({},this.altSelection),{},{subtitles:n});return}const r=on(on({},s),{},{subtitles:n});this.mediaSelection=r}onAudioTrackSwitching(e,t){const n=ix(t);this.playerQueue.forEach(({hls:s})=>s&&(s.setAudioOption(t)||s.setAudioOption(n)))}onSubtitleTrackSwitch(e,t){const n=ix(t);this.playerQueue.forEach(({hls:s})=>s&&(s.setSubtitleOption(t)||t.id!==-1&&s.setSubtitleOption(n)))}onBufferCodecs(e,t){const n=t.tracks;n&&(this.requiredTracks=n)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const n=this.playingItem;if(n&&!this.itemsMatch(n,this.bufferingItem)&&!this.isInterstitial(n)){const s=this.timelinePos;this.bufferedPos=s,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let s=0;s<t.length;s++){const r=t[s];if(r.cue.post){var n;const a=this.schedule.findEventIndex(r.identifier),u=(n=this.schedule.items)==null?void 0:n[a];this.isInterstitial(u)&&this.eventItemsMatch(u,this.bufferingItem)&&this.bufferedToItem(u,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const n=this.findItemIndex(t);this.setSchedulePosition(n+1)}else this.shouldPlay=!1}updateItem(e,t){var n;const s=(n=this.schedule)==null?void 0:n.items;if(e&&s){const r=this.findItemIndex(e,t);return s[r]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((r,a)=>{e.event.isAssetPastPlayoutLimit(a)&&this.clearAssetPlayer(r.identifier,null)});const n=e.end+.25,s=xt.bufferInfo(this.primaryMedia,n,0);(s.end>n||(s.nextStart||0)>n)&&(this.log(`trim buffered interstitial ${Es(e)} (was ${Es(t)})`),this.attachPrimary(n,null,!0),this.flushFrontBuffer(n))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var n;return!!t&&(e===t||e.event.identifier===((n=t.event)==null?void 0:n.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const n=this.mediaSelection;n&&((t=this.schedule)==null||t.updateSchedule(n,[],e))}checkBuffer(e){var t;const n=(t=this.schedule)==null?void 0:t.items;if(!n)return;const s=xt.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=s.len<1),this.updateBufferedPos(s.end,n,e)}updateBufferedPos(e,t,n){const s=this.schedule,r=this.bufferingItem;if(this.bufferedPos>e||!s)return;if(t.length===1&&this.itemsMatch(t[0],r)){this.bufferedPos=e;return}const a=this.playingItem,u=this.findItemIndex(a);let f=s.findItemIndexAtTime(e);if(this.bufferedPos<e){var c;const d=this.findItemIndex(r),p=Math.min(d+1,t.length-1),m=t[p];if((f===-1&&r&&e>=r.end||(c=m.event)!=null&&c.appendInPlace&&e+.01>=m.start)&&(f=p),this.isInterstitial(r)){const y=r.event;if(p-u>1&&y.appendInPlace===!1||y.assetList.length===0&&y.assetListLoader)return}if(this.bufferedPos=e,f>d&&f>u)this.bufferedToItem(m);else{const y=this.primaryDetails;this.primaryLive&&y&&e>y.edge-y.targetduration&&m.start<y.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(m)&&this.preloadAssets(m.event,0)}}else n&&a&&!this.itemsMatch(a,r)&&(f===u?this.bufferedToItem(a):f===u+1&&this.bufferedToItem(t[f]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(s=>{const r=this.getAssetPlayer(s.identifier);return!(r!=null&&r.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,n=this.schedule;if(!this.itemsMatch(e,t)&&n){const{items:s,events:r}=n;if(!s||!r)return t;const a=this.isInterstitial(e),u=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const f=u?u.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${Es(e)}`+(t?` (${f.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(a){const c=n.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((d,p)=>{const m=this.getAssetPlayer(d.identifier);m&&(p===c&&m.loadSource(),m.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(c=>c.pauseBuffering());this.hls.trigger(P.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:r.slice(0),schedule:s.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const n=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(n!==null){this.bufferingAsset=null;const s=this.detachedData;s?s.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),n=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(n)}bufferedToEvent(e,t){const n=e.event,s=n.assetList.length===0&&!n.assetListLoader,r=n.cue.once;if(s||!r){const a=this.preloadAssets(n,t);if(a!=null&&a.interstitial.appendInPlace){const u=this.primaryMedia;u&&this.bufferAssetPlayer(a,u)}}}preloadAssets(e,t){const n=e.assetUrl,s=e.assetList.length,r=s===0&&!e.assetListLoader,a=e.cue.once;if(r){const f=e.timelineStart;if(e.appendInPlace){var u;const m=this.playingItem;!this.isInterstitial(m)&&(m==null||(u=m.nextEvent)==null?void 0:u.identifier)===e.identifier&&this.flushFrontBuffer(f+.25)}let c,d=0;if(!this.playingItem&&this.primaryLive&&(d=this.hls.startPosition,d===-1&&(d=this.hls.liveSyncPosition||0)),d&&!(e.cue.pre||e.cue.post)){const m=d-f;m>0&&(c=Math.round(m*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${n?1:s} ${e}${c?` live-start: ${d} start-offset: ${c}`:""}`),n)return this.createAsset(e,0,0,f,e.duration,n);const p=this.assetListLoader.loadAssetList(e,c);p&&(e.assetListLoader=p)}else if(!a&&s){for(let c=t;c<s;c++){const d=e.assetList[c],p=this.getAssetPlayerQueueIndex(d.identifier);(p===-1||this.playerQueue[p].destroyed)&&!d.error&&this.createAssetPlayer(e,d,c)}const f=e.assetList[t];if(f){const c=this.getAssetPlayer(f.identifier);return c&&c.loadSource(),c}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(s=>{this.hls.trigger(P.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:s})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let n=0;n<t.length;n++)if(e===t[n].assetId)return n;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let n=0;n<e.length;n++)if(e[n].media===t)return e[n]}return null}createAsset(e,t,n,s,r,a){const u={parentIdentifier:e.identifier,identifier:DB(e,a,t),duration:r,startOffset:n,timelineStart:s,uri:a};return this.createAssetPlayer(e,u,t)}createAssetPlayer(e,t,n){const s=this.hls,r=s.userConfig;let a=r.videoPreference;const u=s.loadLevelObj||s.levels[s.currentLevel];(a||u)&&(a=pn({},a),u.videoCodec&&(a.videoCodec=u.videoCodec),u.videoRange&&(a.allowedVideoRanges=[u.videoRange]));const f=s.audioTracks[s.audioTrack],c=s.subtitleTracks[s.subtitleTrack];let d=0;if(this.primaryLive||e.appendInPlace){const C=this.timelinePos-t.timelineStart;if(C>1){const N=t.duration;N&&C<N&&(d=C)}}const p=t.identifier,m=on(on({},r),{},{maxMaxBufferLength:Math.min(180,s.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:s.sessionId,assetPlayerId:p,abrEwmaDefaultEstimate:s.bandwidthEstimate,interstitialsController:void 0,startPosition:d,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:a,audioPreference:f||r.audioPreference,subtitlePreference:c||r.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(m.timelineOffset=t.timelineStart));const y=m.cmcd;y!=null&&y.sessionId&&y.contentId&&(m.cmcd=pn({},y,{contentId:Bu(t.uri)})),this.getAssetPlayer(p)&&this.warn(`Duplicate date range identifier ${e} and asset ${p}`);const E=new NB(this.HlsPlayerClass,m,e,t);this.playerQueue.push(E),e.assetList[n]=t;let A=!0;const S=C=>{if(C.live){var N;const O=new Error(`Interstitials MUST be VOD assets ${e}`),L={fatal:!0,type:lt.OTHER_ERROR,details:ce.INTERSTITIAL_ASSET_ITEM_ERROR,error:O},I=((N=this.schedule)==null?void 0:N.findEventIndex(e.identifier))||-1;this.handleAssetItemError(L,e,I,n,O.message);return}const U=C.edge-C.fragmentStart,w=t.duration;(A||w===null||U>w)&&(A=!1,this.log(`Interstitial asset "${p}" duration change ${w} > ${U}`),t.duration=U,this.updateSchedule())};E.on(P.LEVEL_UPDATED,(C,{details:N})=>S(N)),E.on(P.LEVEL_PTS_UPDATED,(C,{details:N})=>S(N)),E.on(P.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const x=(C,N)=>{const U=this.getAssetPlayer(p);if(U&&N.tracks){U.off(P.BUFFER_CODECS,x),U.tracks=N.tracks;const w=this.primaryMedia;this.bufferingAsset===U.assetItem&&w&&!U.media&&this.bufferAssetPlayer(U,w)}};E.on(P.BUFFER_CODECS,x);const M=()=>{var C;const N=this.getAssetPlayer(p);if(this.log(`buffered to end of asset ${N}`),!N||!this.schedule)return;const U=this.schedule.findEventIndex(e.identifier),w=(C=this.schedule.items)==null?void 0:C[U];this.isInterstitial(w)&&this.advanceAssetBuffering(w,t)};E.on(P.BUFFERED_TO_END,M);const b=C=>()=>{if(!this.getAssetPlayer(p)||!this.schedule)return;this.shouldPlay=!0;const U=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,U,C)};return E.once(P.MEDIA_ENDED,b(n)),E.once(P.PLAYOUT_LIMIT_REACHED,b(1/0)),E.on(P.ERROR,(C,N)=>{if(!this.schedule)return;const U=this.getAssetPlayer(p);if(N.details===ce.BUFFER_STALLED_ERROR){if(U!=null&&U.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(N,e,this.schedule.findEventIndex(e.identifier),n,`Asset player error ${N.error} ${e}`)}),E.on(P.DESTROYING,()=>{if(!this.getAssetPlayer(p)||!this.schedule)return;const N=new Error(`Asset player destroyed unexpectedly ${p}`),U={fatal:!0,type:lt.OTHER_ERROR,details:ce.INTERSTITIAL_ASSET_ITEM_ERROR,error:N};this.handleAssetItemError(U,e,this.schedule.findEventIndex(e.identifier),n,N.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${ol(t)}`),this.hls.trigger(P.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:n,event:e,player:E}),E}clearInterstitial(e,t){this.clearAssetPlayers(e,t),e.reset()}clearAssetPlayers(e,t){e.assetList.forEach(n=>{this.clearAssetPlayer(n.identifier,t)})}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const n=this.playerQueue[t];this.transferMediaFromPlayer(n,null),n.resetDetails()}}clearAssetPlayer(e,t){const n=this.getAssetPlayerQueueIndex(e);if(n!==-1){const s=this.playerQueue[n];this.log(`clear ${s} toSegment: ${t&&Es(t)}`),this.transferMediaFromPlayer(s,t),this.playerQueue.splice(n,1),s.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,n,s,r){const{interstitial:a,assetItem:u,assetId:f}=e,c=a.assetList.length,d=this.playingAsset;this.endedAsset=null,this.playingAsset=u,(!d||d.identifier!==f)&&(d&&(this.clearAssetPlayer(d.identifier,n[s]),delete d.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${c} ${ol(u)}`),this.hls.trigger(P.INTERSTITIAL_ASSET_STARTED,{asset:u,assetListIndex:t,event:a,schedule:n.slice(0),scheduleIndex:s,player:e})),this.bufferAssetPlayer(e,r)}bufferAssetPlayer(e,t){var n,s;if(!this.schedule)return;const{interstitial:r,assetItem:a}=e,u=this.schedule.findEventIndex(r.identifier),f=(n=this.schedule.items)==null?void 0:n[u];if(!f)return;e.loadSource(),this.setBufferingItem(f),this.bufferingAsset=a;const c=this.getBufferingPlayer();if(c===e)return;const d=r.appendInPlace;if(d&&(c==null?void 0:c.interstitial.appendInPlace)===!1)return;const p=(c==null?void 0:c.tracks)||((s=this.detachedData)==null?void 0:s.tracks)||this.requiredTracks;if(d&&a!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(p&&!tb(p,e.tracks)){const m=new Error(`Asset ${ol(a)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(p)}')`),y={fatal:!0,type:lt.OTHER_ERROR,details:ce.INTERSTITIAL_ASSET_ITEM_ERROR,error:m},E=r.findAssetIndex(a);this.handleAssetItemError(y,r,u,E,m.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,n=this.primaryMedia;if(!t||!n)return;const s=n.currentTime,r=t.findAssetIndex(e,s),a=e.assetList[r];if(a){const u=this.getAssetPlayer(a.identifier);if(u){const f=u.currentTime||s-a.timelineStart,c=u.duration-f;if(this.warn(`Stalled at ${f} of ${f+c} in ${u} ${e} (media.currentTime: ${s})`),f&&(c/n.playbackRate<.5||u.bufferedInPlaceToEnd(n))&&u.hls){const d=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,d,r)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,n,s,r){if(e.details===ce.BUFFER_STALLED_ERROR)return;const a=t.assetList[s]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${a&&ol(a)} ${e.error}`),!this.schedule)return;const u=(a==null?void 0:a.identifier)||"",f=this.getAssetPlayerQueueIndex(u),c=this.playerQueue[f]||null,d=this.schedule.items,p=pn({},e,{fatal:!1,errorAction:ml(!0),asset:a,assetListIndex:s,event:t,schedule:d,scheduleIndex:n,player:c});if(this.hls.trigger(P.INTERSTITIAL_ASSET_ERROR,p),!e.fatal)return;const m=this.playingAsset,y=this.bufferingAsset,E=new Error(r);if(a&&(this.clearAssetPlayer(u,null),a.error=E),!t.assetList.some(A=>!A.error))t.error=E;else for(let A=s;A<t.assetList.length;A++)this.resetAssetPlayer(t.assetList[A].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):m&&m.identifier===u?this.advanceAfterAssetEnded(t,n,s):y&&y.identifier===u&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,y)}primaryFallback(e){const t=e.timelineStart,n=this.effectivePlayingItem;let s=this.timelinePos;if(n){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${s} playing: ${Es(n)} error: ${e.error}`),s===-1&&(s=this.hls.startPosition);const a=this.updateItem(n,s);this.itemsMatch(n,a)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t))}else if(s===-1){this.checkStart();return}if(!this.schedule)return;const r=this.schedule.findItemIndexAtTime(s);this.setSchedulePosition(r)}onAssetListLoaded(e,t){var n,s;const r=t.event,a=r.identifier,u=t.assetListResponse.ASSETS;if(!((n=this.schedule)!=null&&n.hasEvent(a)))return;const f=r.timelineStart,c=r.duration;let d=0;u.forEach((A,S)=>{const x=parseFloat(A.DURATION);this.createAsset(r,S,d,f+d,x,A.URI),d+=x}),r.duration=d,this.log(`Loaded asset-list with duration: ${d} (was: ${c}) ${r}`);const p=this.waitingItem,m=(p==null?void 0:p.event.identifier)===a;this.updateSchedule();const y=(s=this.bufferingItem)==null?void 0:s.event;if(m){var E;const A=this.schedule.findEventIndex(a),S=(E=this.schedule.items)==null?void 0:E[A];if(S){if(!this.playingItem&&this.timelinePos>S.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==A){r.error=new Error(`Interstitial ${u.length?"no longer within playback range":"asset-list is empty"} ${this.timelinePos} ${r}`),this.log(r.error.message),this.updateSchedule(!0),this.primaryFallback(r);return}this.setBufferingItem(S)}this.setSchedulePosition(A)}else if((y==null?void 0:y.identifier)===a){const A=r.assetList[0];if(A){const S=this.getAssetPlayer(A.identifier);if(y.appendInPlace){const x=this.primaryMedia;S&&x&&this.bufferAssetPlayer(S,x)}else S&&S.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case ce.ASSET_LIST_PARSING_ERROR:case ce.ASSET_LIST_LOAD_ERROR:case ce.ASSET_LIST_LOAD_TIMEOUT:{const n=t.interstitial;n&&(this.updateSchedule(!0),this.primaryFallback(n));break}case ce.BUFFER_STALLED_ERROR:{const n=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(n)&&n.event.appendInPlace){this.handleInPlaceStall(n.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const Xx=500;class kB extends Q0{constructor(e,t,n){super(e,t,n,"subtitle-stream-controller",et.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(P.LEVEL_LOADED,this.onLevelLoaded,this),e.on(P.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(P.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(P.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(P.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(P.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(P.LEVEL_LOADED,this.onLevelLoaded,this),e.off(P.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(P.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(P.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(P.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(P.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=Ce.IDLE,this.setInterval(Xx),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:n,success:s}=t;if(this.fragContextChanged(n)||(Nn(n)&&(this.fragPrevious=n),this.state=Ce.IDLE),!s)return;const r=this.tracksBuffered[this.currentTrackId];if(!r)return;let a;const u=n.start;for(let c=0;c<r.length;c++)if(u>=r[c].start&&u<=r[c].end){a=r[c];break}const f=n.start+n.duration;a?a.end=f:(a={start:u,end:f},r.push(a)),this.fragmentTracker.fragBuffered(n),this.fragBufferedComplete(n,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:n,endOffset:s}=t;if(n===0&&s!==Number.POSITIVE_INFINITY){const r=s-1;if(r<=0)return;t.endOffsetSubtitles=Math.max(0,r),this.tracksBuffered.forEach(a=>{for(let u=0;u<a.length;){if(a[u].end<=r){a.shift();continue}else if(a[u].start<r)a[u].start=r;else break;u++}}),this.fragmentTracker.removeFragmentsInRange(n,r,et.SUBTITLE)}}onError(e,t){const n=t.frag;(n==null?void 0:n.type)===et.SUBTITLE&&(t.details===ce.FRAG_GAP&&this.fragmentTracker.fragBuffered(n,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==Ce.STOPPED&&(this.state=Ce.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&sM(this.levels,t)){this.levels=t.map(n=>new qu(n));return}this.tracksBuffered=[],this.levels=t.map(n=>{const s=new qu(n);return this.tracksBuffered[s.id]=[],s}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,et.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var n;if(this.currentTrackId=t.id,!((n=this.levels)!=null&&n.length)||this.currentTrackId===-1){this.clearInterval();return}const s=this.levels[this.currentTrackId];s!=null&&s.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,s&&this.state!==Ce.STOPPED&&this.setInterval(Xx)}onSubtitleTrackLoaded(e,t){var n;const{currentTrackId:s,levels:r}=this,{details:a,id:u}=t;if(!r){this.warn(`Subtitle tracks were reset while loading level ${u}`);return}const f=r[u];if(u>=r.length||!f)return;this.log(`Subtitle track ${u} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let c=0;if(a.live||(n=f.details)!=null&&n.live){if(a.deltaUpdateFailed)return;const p=this.mainDetails;if(!p){this.startFragRequested=!1;return}const m=p.fragments[0];if(!f.details)a.hasProgramDateTime&&p.hasProgramDateTime?(Pd(a,p),c=a.fragmentStart):m&&(c=m.start,Pg(a,c));else{var d;c=this.alignPlaylists(a,f.details,(d=this.levelLastLoaded)==null?void 0:d.details),c===0&&m&&(c=m.start,Pg(a,c))}p&&!this.startFragRequested&&this.setStartPosition(p,c)}f.details=a,this.levelLastLoaded=f,u===s&&(this.hls.trigger(P.SUBTITLE_TRACK_UPDATED,{details:a,id:u,groupId:t.groupId}),this.tick(),a.live&&!this.fragCurrent&&this.media&&this.state===Ce.IDLE&&(ia(null,a.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),f.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:n}=e,s=t.decryptdata,r=this.hls;if(!this.fragContextChanged(t)&&n&&n.byteLength>0&&s!=null&&s.key&&s.iv&&gl(s.method)){const a=performance.now();this.decrypter.decrypt(new Uint8Array(n),s.key.buffer,s.iv.buffer,X0(s.method)).catch(u=>{throw r.trigger(P.ERROR,{type:lt.MEDIA_ERROR,details:ce.FRAG_DECRYPT_ERROR,fatal:!1,error:u,reason:u.message,frag:t}),u}).then(u=>{const f=performance.now();r.trigger(P.FRAG_DECRYPTED,{frag:t,payload:u,stats:{tstart:a,tdecrypt:f}})}).catch(u=>{this.warn(`${u.name}: ${u.message}`),this.state=Ce.IDLE})}}doTick(){if(!this.media){this.state=Ce.IDLE;return}if(this.state===Ce.IDLE){const{currentTrackId:e,levels:t}=this,n=t==null?void 0:t[e];if(!n||!t.length||!n.details||this.waitForLive(n))return;const{config:s}=this,r=this.getLoadPosition(),a=xt.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],r,s.maxBufferHole),{end:u,len:f}=a,c=n.details,d=this.hls.maxBufferLength+c.levelTargetDuration;if(f>d)return;const p=c.fragments,m=p.length,y=c.edge;let E=null;const A=this.fragPrevious;if(u<y){const M=s.maxFragLookUpTolerance,b=u>y-M?0:M;E=ia(A,p,Math.max(p[0].start,u),b),!E&&A&&A.start<p[0].start&&(E=p[0])}else E=p[m-1];if(E=this.filterReplacedPrimary(E,n.details),!E)return;const S=E.sn-c.startSN,x=p[S-1];if(x&&x.cc===E.cc&&this.fragmentTracker.getState(x)===Xn.NOT_LOADED&&(E=x),this.fragmentTracker.getState(E)===Xn.NOT_LOADED){const M=this.mapToInitFragWhenRequired(E);M&&this.loadFragment(M,n,u)}}}loadFragment(e,t,n){Nn(e)?super.loadFragment(e,t,n):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new BB(this.tracksBuffered[this.currentTrackId]||[])}}class BB{constructor(e){this.buffered=void 0;const t=(n,s,r)=>{if(s=s>>>0,s>r-1)throw new DOMException(`Failed to execute '${n}' on 'TimeRanges': The index provided (${s}) is greater than the maximum bound (${r})`);return e[s][n]};this.buffered={get length(){return e.length},end(n){return t("end",n,e.length)},start(n){return t("start",n,e.length)}}}}const GB={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},EM=i=>String.fromCharCode(GB[i]||i),As=15,dr=100,VB={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},HB={17:2,18:4,21:6,22:8,23:10,19:13,20:15},zB={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},$B={25:2,26:4,29:6,30:8,31:10,27:13,28:15},qB=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class WB{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const n=typeof t=="function"?t():t;an.log(`${this.time} [${e}] ${n}`)}}}const Vo=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].toString(16));return t};class SM{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let n=0;n<t.length;n++){const s=t[n];e.hasOwnProperty(s)&&(this[s]=e[s])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class KB{constructor(){this.uchar=" ",this.penState=new SM}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class YB{constructor(e){this.chars=[],this.pos=0,this.currPenState=new SM,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<dr;t++)this.chars.push(new KB);this.logger=e}equals(e){for(let t=0;t<dr;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<dr;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<dr;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>dr&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=dr)}moveCursor(e){const t=this.pos+e;if(e>1)for(let n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=EM(e);if(this.pos>=dr){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<dr;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let n=0;n<dr;n++){const s=this.chars[n].uchar;s!==" "&&(t=!1),e.push(s)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class Mm{constructor(e){this.rows=[],this.currRow=As-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<As;t++)this.rows.push(new YB(e));this.logger=e}reset(){for(let e=0;e<As;e++)this.rows[e].clear();this.currRow=As-1}equals(e){let t=!0;for(let n=0;n<As;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t}copy(e){for(let t=0;t<As;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<As;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+yn(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let u=0;u<As;u++)this.rows[u].clear();const r=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){const u=a.rows[r].cueStartTime,f=this.logger.time;if(u!==null&&f!==null&&u<f)for(let c=0;c<this.nrRollUpRows;c++)this.rows[t-this.nrRollUpRows+c+1].copy(a.rows[r+c])}}this.currRow=t;const n=this.rows[this.currRow];if(e.indent!==null){const r=e.indent,a=Math.max(r-1,0);n.setCursor(e.indent),e.color=n.chars[a].penState.foreground}const s={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(s)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+yn(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let n="",s=-1;for(let r=0;r<As;r++){const a=this.rows[r].getTextString();a&&(s=r+1,e?t.push("Row "+s+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(e?n="["+t.join(" | ")+"]":n=t.join(`
`)),n}getTextAndFormat(){return this.rows}}class Jx{constructor(e,t,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Mm(n),this.nonDisplayedMemory=new Mm(n),this.lastOutputScreen=new Mm(n),this.currRollUpRow=this.displayedMemory.rows[As-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[As-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let n=0;n<e.length;n++)this.writeScreen.insertChar(e[n]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const n=Math.floor(e/2)-16,s=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=s[n]}this.logger.log(2,"MIDROW: "+yn(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class Qx{constructor(e,t,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory=JB(),this.logger=void 0;const s=this.logger=new WB;this.channels=[null,new Jx(e,t,s),new Jx(e+1,n,s)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let n=0;n<t.length;n+=2){const s=t[n]&127,r=t[n+1]&127;let a=!1,u=null;if(s===0&&r===0)continue;this.logger.log(3,()=>"["+Vo([t[n],t[n+1]])+"] -> ("+Vo([s,r])+")");const f=this.cmdHistory;if(s>=16&&s<=31){if(XB(s,r,f)){If(null,null,f),this.logger.log(3,()=>"Repeated command ("+Vo([s,r])+") is dropped");continue}If(s,r,this.cmdHistory),a=this.parseCmd(s,r),a||(a=this.parseMidrow(s,r)),a||(a=this.parsePAC(s,r)),a||(a=this.parseBackgroundAttributes(s,r))}else If(null,null,f);if(!a&&(u=this.parseChars(s,r),u)){const d=this.currentChannel;d&&d>0?this.channels[d].insertChars(u):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!a&&!u&&this.logger.log(2,()=>"Couldn't parse cleaned data "+Vo([s,r])+" orig: "+Vo([t[n],t[n+1]]))}}parseCmd(e,t){const n=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=33&&t<=35;if(!(n||s))return!1;const r=e===20||e===21||e===23?1:2,a=this.channels[r];return e===20||e===21||e===28||e===29?t===32?a.ccRCL():t===33?a.ccBS():t===34?a.ccAOF():t===35?a.ccAON():t===36?a.ccDER():t===37?a.ccRU(2):t===38?a.ccRU(3):t===39?a.ccRU(4):t===40?a.ccFON():t===41?a.ccRDC():t===42?a.ccTR():t===43?a.ccRTD():t===44?a.ccEDM():t===45?a.ccCR():t===46?a.ccENM():t===47&&a.ccEOC():a.ccTO(t-32),this.currentChannel=r,!0}parseMidrow(e,t){let n=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?n=1:n=2,n!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const s=this.channels[n];return s?(s.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+Vo([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let n;const s=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,r=(e===16||e===24)&&t>=64&&t<=95;if(!(s||r))return!1;const a=e<=23?1:2;t>=64&&t<=95?n=a===1?VB[e]:zB[e]:n=a===1?HB[e]:$B[e];const u=this.channels[a];return u?(u.setPAC(this.interpretPAC(n,t)),this.currentChannel=a,!0):!1}interpretPAC(e,t){let n;const s={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?n=t-96:n=t-64,s.underline=(n&1)===1,n<=13?s.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(s.italics=!0,s.color="white"):s.indent=Math.floor((n-16)/2)*4,s}parseChars(e,t){let n,s=null,r=null;if(e>=25?(n=2,r=e-8):(n=1,r=e),r>=17&&r<=19){let a;r===17?a=t+80:r===18?a=t+112:a=t+144,this.logger.log(2,()=>"Special char '"+EM(a)+"' in channel "+n),s=[a]}else e>=32&&e<=127&&(s=t===0?[e]:[e,t]);return s&&this.logger.log(3,()=>"Char codes =  "+Vo(s).join(",")),s}parseBackgroundAttributes(e,t){const n=(e===16||e===24)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=45&&t<=47;if(!(n||s))return!1;let r;const a={};e===16||e===24?(r=Math.floor((t-32)/2),a.background=qB[r],t%2===1&&(a.background=a.background+"_semi")):t===45?a.background="transparent":(a.foreground="black",t===47&&(a.underline=!0));const u=e<=23?1:2;return this.channels[u].setBkgData(a),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}If(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const n=this.channels[t];n&&n.cueSplitAtTime(e)}}}function If(i,e,t){t.a=i,t.b=e}function XB(i,e,t){return t.a===i&&t.b===e}function JB(){return{a:null,b:null}}var uv=(function(){if(wd!=null&&wd.VTTCue)return self.VTTCue;const i=["","lr","rl"],e=["start","middle","end","left","right"];function t(u,f){if(typeof f!="string"||!Array.isArray(u))return!1;const c=f.toLowerCase();return~u.indexOf(c)?c:!1}function n(u){return t(i,u)}function s(u){return t(e,u)}function r(u,...f){let c=1;for(;c<arguments.length;c++){const d=arguments[c];for(const p in d)u[p]=d[p]}return u}function a(u,f,c){const d=this,p={enumerable:!0};d.hasBeenReset=!1;let m="",y=!1,E=u,A=f,S=c,x=null,M="",b=!0,C="auto",N="start",U=50,w="middle",O=50,L="middle";Object.defineProperty(d,"id",r({},p,{get:function(){return m},set:function(I){m=""+I}})),Object.defineProperty(d,"pauseOnExit",r({},p,{get:function(){return y},set:function(I){y=!!I}})),Object.defineProperty(d,"startTime",r({},p,{get:function(){return E},set:function(I){if(typeof I!="number")throw new TypeError("Start time must be set to a number.");E=I,this.hasBeenReset=!0}})),Object.defineProperty(d,"endTime",r({},p,{get:function(){return A},set:function(I){if(typeof I!="number")throw new TypeError("End time must be set to a number.");A=I,this.hasBeenReset=!0}})),Object.defineProperty(d,"text",r({},p,{get:function(){return S},set:function(I){S=""+I,this.hasBeenReset=!0}})),Object.defineProperty(d,"region",r({},p,{get:function(){return x},set:function(I){x=I,this.hasBeenReset=!0}})),Object.defineProperty(d,"vertical",r({},p,{get:function(){return M},set:function(I){const F=n(I);if(F===!1)throw new SyntaxError("An invalid or illegal string was specified.");M=F,this.hasBeenReset=!0}})),Object.defineProperty(d,"snapToLines",r({},p,{get:function(){return b},set:function(I){b=!!I,this.hasBeenReset=!0}})),Object.defineProperty(d,"line",r({},p,{get:function(){return C},set:function(I){if(typeof I!="number"&&I!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");C=I,this.hasBeenReset=!0}})),Object.defineProperty(d,"lineAlign",r({},p,{get:function(){return N},set:function(I){const F=s(I);if(!F)throw new SyntaxError("An invalid or illegal string was specified.");N=F,this.hasBeenReset=!0}})),Object.defineProperty(d,"position",r({},p,{get:function(){return U},set:function(I){if(I<0||I>100)throw new Error("Position must be between 0 and 100.");U=I,this.hasBeenReset=!0}})),Object.defineProperty(d,"positionAlign",r({},p,{get:function(){return w},set:function(I){const F=s(I);if(!F)throw new SyntaxError("An invalid or illegal string was specified.");w=F,this.hasBeenReset=!0}})),Object.defineProperty(d,"size",r({},p,{get:function(){return O},set:function(I){if(I<0||I>100)throw new Error("Size must be between 0 and 100.");O=I,this.hasBeenReset=!0}})),Object.defineProperty(d,"align",r({},p,{get:function(){return L},set:function(I){const F=s(I);if(!F)throw new SyntaxError("An invalid or illegal string was specified.");L=F,this.hasBeenReset=!0}})),d.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a})();class QB{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function TM(i){function e(n,s,r,a){return(n|0)*3600+(s|0)*60+(r|0)+parseFloat(a||0)}const t=i.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class ZB{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,n){for(let s=0;s<n.length;++s)if(t===n[s]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const n=parseFloat(t);if(n>=0&&n<=100)return this.set(e,n),!0}return!1}}function xM(i,e,t,n){const s=n?i.split(n):[i];for(const r in s){if(typeof s[r]!="string")continue;const a=s[r].split(t);if(a.length!==2)continue;const u=a[0],f=a[1];e(u,f)}}const Vg=new uv(0,0,""),Lf=Vg.align==="middle"?"middle":"center";function jB(i,e,t){const n=i;function s(){const u=TM(i);if(u===null)throw new Error("Malformed timestamp: "+n);return i=i.replace(/^[^\sa-zA-Z-]+/,""),u}function r(u,f){const c=new ZB;xM(u,function(m,y){let E;switch(m){case"region":for(let A=t.length-1;A>=0;A--)if(t[A].id===y){c.set(m,t[A].region);break}break;case"vertical":c.alt(m,y,["rl","lr"]);break;case"line":E=y.split(","),c.integer(m,E[0]),c.percent(m,E[0])&&c.set("snapToLines",!1),c.alt(m,E[0],["auto"]),E.length===2&&c.alt("lineAlign",E[1],["start",Lf,"end"]);break;case"position":E=y.split(","),c.percent(m,E[0]),E.length===2&&c.alt("positionAlign",E[1],["start",Lf,"end","line-left","line-right","auto"]);break;case"size":c.percent(m,y);break;case"align":c.alt(m,y,["start",Lf,"end","left","right"]);break}},/:/,/\s/),f.region=c.get("region",null),f.vertical=c.get("vertical","");let d=c.get("line","auto");d==="auto"&&Vg.line===-1&&(d=-1),f.line=d,f.lineAlign=c.get("lineAlign","start"),f.snapToLines=c.get("snapToLines",!0),f.size=c.get("size",100),f.align=c.get("align",Lf);let p=c.get("position","auto");p==="auto"&&Vg.position===50&&(p=f.align==="start"||f.align==="left"?0:f.align==="end"||f.align==="right"?100:50),f.position=p}function a(){i=i.replace(/^\s+/,"")}if(a(),e.startTime=s(),a(),i.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+n);i=i.slice(3),a(),e.endTime=s(),a(),r(i,e)}function AM(i){return i.replace(/<br(?: \/)?>/gi,`
`)}class e3{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new QB,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function n(){let r=t.buffer,a=0;for(r=AM(r);a<r.length&&r[a]!=="\r"&&r[a]!==`
`;)++a;const u=r.slice(0,a);return r[a]==="\r"&&++a,r[a]===`
`&&++a,t.buffer=r.slice(a),u}function s(r){xM(r,function(a,u){},/:/)}try{let r="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;r=n();const u=r.match(/^()?WEBVTT([ \t].*)?$/);if(!(u!=null&&u[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let a=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(a?a=!1:r=n(),t.state){case"HEADER":/:/.test(r)?s(r):r||(t.state="ID");continue;case"NOTE":r||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(r)){t.state="NOTE";break}if(!r)continue;if(t.cue=new uv(0,0,""),t.state="CUE",r.indexOf("-->")===-1){t.cue.id=r;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{jB(r,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const u=r.indexOf("-->")!==-1;if(!r||u&&(a=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=r}continue;case"BADCUE":r||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const t3=/\r\n|\n\r|\n|\r/g,Cm=function(e,t,n=0){return e.slice(n,n+t.length)===t},n3=function(e){let t=parseInt(e.slice(-3));const n=parseInt(e.slice(-6,-4)),s=parseInt(e.slice(-9,-7)),r=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!Ye(t)||!Ye(n)||!Ye(s)||!Ye(r))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*n,t+=60*1e3*s,t+=3600*1e3*r,t};function cv(i,e,t){return Bu(i.toString())+Bu(e.toString())+Bu(t)}const i3=function(e,t,n){let s=e[t],r=e[s.prevCC];if(!r||!r.new&&s.new){e.ccOffset=e.presentationOffset=s.start,s.new=!1;return}for(;(a=r)!=null&&a.new;){var a;e.ccOffset+=s.start-r.start,s.new=!1,s=r,r=e[s.prevCC]}e.presentationOffset=n};function s3(i,e,t,n,s,r,a){const u=new e3,f=es(new Uint8Array(i)).trim().replace(t3,`
`).split(`
`),c=[],d=e?ck(e.baseTime,e.timescale):0;let p="00:00.000",m=0,y=0,E,A=!0;u.oncue=function(S){const x=t[n];let M=t.ccOffset;const b=(m-d)/9e4;if(x!=null&&x.new&&(y!==void 0?M=t.ccOffset=x.start:i3(t,n,b)),b){if(!e){E=new Error("Missing initPTS for VTT MPEGTS");return}M=b-t.presentationOffset}const C=S.endTime-S.startTime,N=Ji((S.startTime+M-y)*9e4,s*9e4)/9e4;S.startTime=Math.max(N,0),S.endTime=Math.max(N+C,0);const U=S.text.trim();S.text=decodeURIComponent(encodeURIComponent(U)),S.id||(S.id=cv(S.startTime,S.endTime,U)),S.endTime>0&&c.push(S)},u.onparsingerror=function(S){E=S},u.onflush=function(){if(E){a(E);return}r(c)},f.forEach(S=>{if(A)if(Cm(S,"X-TIMESTAMP-MAP=")){A=!1,S.slice(16).split(",").forEach(x=>{Cm(x,"LOCAL:")?p=x.slice(6):Cm(x,"MPEGTS:")&&(m=parseInt(x.slice(7)))});try{y=n3(p)/1e3}catch(x){E=x}return}else S===""&&(A=!1);u.parse(S+`
`)}),u.flush()}const Im="stpp.ttml.im1t",RM=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,bM=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,r3={left:"start",center:"center",right:"end",start:"start",end:"end"};function Zx(i,e,t,n){const s=Pt(new Uint8Array(i),["mdat"]);if(s.length===0){n(new Error("Could not parse IMSC1 mdat"));return}const r=s.map(u=>es(u)),a=uk(e.baseTime,1,e.timescale);try{r.forEach(u=>t(o3(u,a)))}catch(u){n(u)}}function o3(i,e){const s=new DOMParser().parseFromString(i,"text/xml").getElementsByTagName("tt")[0];if(!s)throw new Error("Invalid ttml");const r={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},a=Object.keys(r).reduce((p,m)=>(p[m]=s.getAttribute(`ttp:${m}`)||r[m],p),{}),u=s.getAttribute("xml:space")!=="preserve",f=jx(Lm(s,"styling","style")),c=jx(Lm(s,"layout","region")),d=Lm(s,"body","[begin]");return[].map.call(d,p=>{const m=MM(p,u);if(!m||!p.hasAttribute("begin"))return null;const y=wm(p.getAttribute("begin"),a),E=wm(p.getAttribute("dur"),a);let A=wm(p.getAttribute("end"),a);if(y===null)throw eA(p);if(A===null){if(E===null)throw eA(p);A=y+E}const S=new uv(y-e,A-e,m);S.id=cv(S.startTime,S.endTime,S.text);const x=c[p.getAttribute("region")],M=f[p.getAttribute("style")],b=a3(x,M,f),{textAlign:C}=b;if(C){const N=r3[C];N&&(S.lineAlign=N),S.align=C}return pn(S,b),S}).filter(p=>p!==null)}function Lm(i,e,t){const n=i.getElementsByTagName(e)[0];return n?[].slice.call(n.querySelectorAll(t)):[]}function jx(i){return i.reduce((e,t)=>{const n=t.getAttribute("xml:id");return n&&(e[n]=t),e},{})}function MM(i,e){return[].slice.call(i.childNodes).reduce((t,n,s)=>{var r;return n.nodeName==="br"&&s?t+`
`:(r=n.childNodes)!=null&&r.length?MM(n,e):e?t+n.textContent.trim().replace(/\s+/g," "):t+n.textContent},"")}function a3(i,e,t){const n="http://www.w3.org/ns/ttml#styling";let s=null;const r=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=i!=null&&i.hasAttribute("style")?i.getAttribute("style"):null;return a&&t.hasOwnProperty(a)&&(s=t[a]),r.reduce((u,f)=>{const c=Dm(e,n,f)||Dm(i,n,f)||Dm(s,n,f);return c&&(u[f]=c),u},{})}function Dm(i,e,t){return i&&i.hasAttributeNS(e,t)?i.getAttributeNS(e,t):null}function eA(i){return new Error(`Could not parse ttml timestamp ${i}`)}function wm(i,e){if(!i)return null;let t=TM(i);return t===null&&(RM.test(i)?t=l3(i,e):bM.test(i)&&(t=u3(i,e))),t}function l3(i,e){const t=RM.exec(i),n=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+n/e.frameRate}function u3(i,e){const t=bM.exec(i),n=Number(t[1]);switch(t[2]){case"h":return n*3600;case"m":return n*60;case"ms":return n*1e3;case"f":return n/e.frameRate;case"t":return n/e.tickRate}return n}class Df{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,n){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class c3{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=nA(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(P.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(P.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(P.MANIFEST_LOADING,this.onManifestLoading,this),e.on(P.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(P.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(P.FRAG_LOADING,this.onFragLoading,this),e.on(P.FRAG_LOADED,this.onFragLoaded,this),e.on(P.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(P.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(P.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(P.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(P.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(P.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(P.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(P.MANIFEST_LOADING,this.onManifestLoading,this),e.off(P.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(P.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(P.FRAG_LOADING,this.onFragLoading,this),e.off(P.FRAG_LOADED,this.onFragLoaded,this),e.off(P.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(P.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(P.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(P.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(P.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new Df(this,"textTrack1"),t=new Df(this,"textTrack2"),n=new Df(this,"textTrack3"),s=new Df(this,"textTrack4");this.cea608Parser1=new Qx(1,e,t),this.cea608Parser2=new Qx(3,n,s)}addCues(e,t,n,s,r){let a=!1;for(let u=r.length;u--;){const f=r[u],c=f3(f[0],f[1],t,n);if(c>=0&&(f[0]=Math.min(f[0],t),f[1]=Math.max(f[1],n),a=!0,c/(n-t)>.5))return}if(a||r.push([t,n]),this.config.renderTextTracksNatively){const u=this.captionsTracks[e];this.Cues.newCue(u,t,n,s)}else{const u=this.Cues.newCue(null,t,n,s);this.hls.trigger(P.CUES_PARSED,{type:"captions",cues:u,track:e})}}onInitPtsFound(e,{frag:t,id:n,initPTS:s,timescale:r,trackId:a}){const{unparsedVttFrags:u}=this;n===et.MAIN&&(this.initPTS[t.cc]={baseTime:s,timescale:r,trackId:a}),u.length&&(this.unparsedVttFrags=[],u.forEach(f=>{this.initPTS[f.frag.cc]?this.onFragLoaded(P.FRAG_LOADED,f):this.hls.trigger(P.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:f.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:n}=this;if(n)for(let s=0;s<n.textTracks.length;s++){const r=n.textTracks[s];if(tA(r,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return r}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:n,media:s}=this,{label:r,languageCode:a}=t[e],u=this.getExistingTrack(r,a);if(u)n[e]=u,fl(n[e]),vM(n[e],s);else{const f=this.createTextTrack("captions",r,a);f&&(f[e]=!0,n[e]=f)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const n=t.label,s={_id:e,label:n,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=s,this.hls.trigger(P.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[s]})}createTextTrack(e,t,n){const s=this.media;if(s)return s.addTextTrack(e,t,n)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const n=!!t.transferMedia;if(this.media=null,n)return;const{captionsTracks:s}=this;Object.keys(s).forEach(r=>{fl(s[r]),delete s[r]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=nA(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let n=0;n<t.length;n++)fl(t[n])}onSubtitleTracksUpdated(e,t){const n=t.subtitleTracks||[],s=n.some(r=>r.textCodec===Im);if(this.config.enableWebVTT||s&&this.config.enableIMSC1){if(sM(this.tracks,n)){this.tracks=n;return}if(this.textTracks=[],this.tracks=n,this.config.renderTextTracksNatively){const a=this.media,u=a?fd(a.textTracks):null;if(this.tracks.forEach((f,c)=>{let d;if(u){let p=null;for(let m=0;m<u.length;m++)if(u[m]&&tA(u[m],f)){p=u[m],u[m]=null;break}p&&(d=p)}if(d)fl(d);else{const p=CM(f);d=this.createTextTrack(p,f.name,f.lang),d&&(d.mode="disabled")}d&&this.textTracks.push(d)}),u!=null&&u.length){const f=u.filter(c=>c!==null).map(c=>c.label);f.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${f.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const a=this.tracks.map(u=>({label:u.name,kind:u.type.toLowerCase(),default:u.default,subtitleTrack:u}));this.hls.trigger(P.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:a})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(n=>{const s=/(?:CC|SERVICE)([1-4])/.exec(n.instreamId);if(!s)return;const r=`textTrack${s[1]}`,a=this.captionsProperties[r];a&&(a.label=n.name,n.lang&&(a.languageCode=n.lang),a.media=n)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===et.MAIN){var n,s;const{cea608Parser1:r,cea608Parser2:a,lastSn:u}=this,{cc:f,sn:c}=t.frag,d=(n=(s=t.part)==null?void 0:s.index)!=null?n:-1;r&&a&&(c!==u+1||c===u&&d!==this.lastPartIndex+1||f!==this.lastCc)&&(r.reset(),a.reset()),this.lastCc=f,this.lastSn=c,this.lastPartIndex=d}}onFragLoaded(e,t){const{frag:n,payload:s}=t;if(n.type===et.SUBTITLE)if(s.byteLength){const r=n.decryptdata,a="stats"in t;if(r==null||!r.encrypted||a){const u=this.tracks[n.level],f=this.vttCCs;f[n.cc]||(f[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),u&&u.textCodec===Im?this._parseIMSC1(n,s):this._parseVTTs(t)}}else this.hls.trigger(P.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const n=this.hls;Zx(t,this.initPTS[e.cc],s=>{this._appendCues(s,e.level),n.trigger(P.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},s=>{n.logger.log(`Failed to parse IMSC1: ${s}`),n.trigger(P.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:s})})}_parseVTTs(e){var t;const{frag:n,payload:s}=e,{initPTS:r,unparsedVttFrags:a}=this,u=r.length-1;if(!r[n.cc]&&u===-1){a.push(e);return}const f=this.hls,c=(t=n.initSegment)!=null&&t.data?ps(n.initSegment.data,new Uint8Array(s)).buffer:s;s3(c,this.initPTS[n.cc],this.vttCCs,n.cc,n.start,d=>{this._appendCues(d,n.level),f.trigger(P.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:n})},d=>{const p=d.message==="Missing initPTS for VTT MPEGTS";p?a.push(e):this._fallbackToIMSC1(n,s),f.logger.log(`Failed to parse VTT cue: ${d}`),!(p&&u>n.cc)&&f.trigger(P.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:d})})}_fallbackToIMSC1(e,t){const n=this.tracks[e.level];n.textCodec||Zx(t,this.initPTS[e.cc],()=>{n.textCodec=Im,this._parseIMSC1(e,t)},()=>{n.textCodec="wvtt"})}_appendCues(e,t){const n=this.hls;if(this.config.renderTextTracksNatively){const s=this.textTracks[t];if(!s||s.mode==="disabled")return;e.forEach(r=>yM(s,r))}else{const s=this.tracks[t];if(!s)return;const r=s.default?"default":"subtitles"+t;n.trigger(P.CUES_PARSED,{type:"subtitles",cues:e,track:r})}}onFragDecrypted(e,t){const{frag:n}=t;n.type===et.SUBTITLE&&this.onFragLoaded(P.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:n,samples:s}=t;if(!(n.type===et.MAIN&&this.closedCaptionsForLevel(n)==="NONE"))for(let r=0;r<s.length;r++){const a=s[r].bytes;if(a){this.cea608Parser1||this.initCea608Parsers();const u=this.extractCea608Data(a);this.cea608Parser1.addData(s[r].pts,u[0]),this.cea608Parser2.addData(s[r].pts,u[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:n,endOffsetSubtitles:s,type:r}){const{media:a}=this;if(!(!a||a.currentTime<n)){if(!r||r==="video"){const{captionsTracks:u}=this;Object.keys(u).forEach(f=>Gg(u[f],t,n))}if(this.config.renderTextTracksNatively&&t===0&&s!==void 0){const{textTracks:u}=this;Object.keys(u).forEach(f=>Gg(u[f],t,s))}}}extractCea608Data(e){const t=[[],[]],n=e[0]&31;let s=2;for(let r=0;r<n;r++){const a=e[s++],u=127&e[s++],f=127&e[s++];if(u===0&&f===0)continue;if((4&a)!==0){const d=3&a;(d===0||d===1)&&(t[d].push(u),t[d].push(f))}}return t}}function CM(i){return i.characteristics&&/transcribes-spoken-dialog/gi.test(i.characteristics)&&/describes-music-and-sound/gi.test(i.characteristics)?"captions":"subtitles"}function tA(i,e){return!!i&&i.kind===CM(e)&&Og(e,i)}function f3(i,e,t,n){return Math.min(e,n)-Math.max(i,t)}function nA(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const d3=/\s/,h3={newCue(i,e,t,n){const s=[];let r,a,u,f,c;const d=self.VTTCue||self.TextTrackCue;for(let m=0;m<n.rows.length;m++)if(r=n.rows[m],u=!0,f=0,c="",!r.isEmpty()){var p;for(let A=0;A<r.chars.length;A++)d3.test(r.chars[A].uchar)&&u?f++:(c+=r.chars[A].uchar,u=!1);r.cueStartTime=e,e===t&&(t+=1e-4),f>=16?f--:f++;const y=AM(c.trim()),E=cv(e,t,y);i!=null&&(p=i.cues)!=null&&p.getCueById(E)||(a=new d(e,t,y),a.id=E,a.line=m+1,a.align="left",a.position=10+Math.min(80,Math.floor(f*8/32)*10),s.push(a))}return i&&s.length&&(s.sort((m,y)=>m.line==="auto"||y.line==="auto"?0:m.line>8&&y.line>8?y.line-m.line:m.line-y.line),s.forEach(m=>yM(i,m))),s}};function p3(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const m3=/(\d+)-(\d+)\/(\d+)/;class iA{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||_3,this.controller=new self.AbortController,this.stats=new H0}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,n){const s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();const r=g3(e,this.controller.signal),a=e.responseType==="arraybuffer",u=a?"byteLength":"length",{maxTimeToFirstByteMs:f,maxLoadTimeMs:c}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=n,this.request=this.fetchSetup(e,r),self.clearTimeout(this.requestTimeout),t.timeout=f&&Ye(f)?f:c,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(s,e,this.response))},t.timeout),(Yu(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(p=>{var m;this.response=this.loader=p;const y=Math.max(self.performance.now(),s.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=c,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(s,e,this.response))},c-(y-s.loading.start)),!p.ok){const{status:A,statusText:S}=p;throw new E3(S||"fetch, bad network response",A,p)}s.loading.first=y,s.total=y3(p.headers)||s.total;const E=(m=this.callbacks)==null?void 0:m.onProgress;return E&&Ye(t.highWaterMark)?this.loadProgressively(p,s,e,t.highWaterMark,E):a?p.arrayBuffer():e.responseType==="json"?p.json():p.text()}).then(p=>{var m,y;const E=this.response;if(!E)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first);const A=p[u];A&&(s.loaded=s.total=A);const S={url:E.url,data:p,code:E.status},x=(m=this.callbacks)==null?void 0:m.onProgress;x&&!Ye(t.highWaterMark)&&x(s,e,p,E),(y=this.callbacks)==null||y.onSuccess(S,s,e,E)}).catch(p=>{var m;if(self.clearTimeout(this.requestTimeout),s.aborted)return;const y=p&&p.code||0,E=p?p.message:null;(m=this.callbacks)==null||m.onError({code:y,text:E},e,p?p.details:null,s)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,n,s=0,r){const a=new kb,u=e.body.getReader(),f=()=>u.read().then(c=>{if(c.done)return a.dataLength&&r(t,n,a.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const d=c.value,p=d.length;return t.loaded+=p,p<s||a.dataLength?(a.push(d),a.dataLength>=s&&r(t,n,a.flush().buffer,e)):r(t,n,d.buffer,e),f()}).catch(()=>Promise.reject());return f()}}function g3(i,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(pn({},i.headers))};return i.rangeEnd&&t.headers.set("Range","bytes="+i.rangeStart+"-"+String(i.rangeEnd-1)),t}function v3(i){const e=m3.exec(i);if(e)return parseInt(e[2])-parseInt(e[1])+1}function y3(i){const e=i.get("Content-Range");if(e){const n=v3(e);if(Ye(n))return n}const t=i.get("Content-Length");if(t)return parseInt(t)}function _3(i,e){return new self.Request(i.url,e)}class E3 extends Error{constructor(e,t,n){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=n}}const S3=/^age:\s*[\d.]+\s*$/im;class IM{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new H0,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,n){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=n,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const n=this.loader=new self.XMLHttpRequest,s=this.stats;s.loading.first=0,s.loaded=0,s.aborted=!1;const r=this.xhrSetup;r?Promise.resolve().then(()=>{if(!(this.loader!==n||this.stats.aborted))return r(n,t.url)}).catch(a=>{if(!(this.loader!==n||this.stats.aborted))return n.open("GET",t.url,!0),r(n,t.url)}).then(()=>{this.loader!==n||this.stats.aborted||this.openAndSendXhr(n,t,e)}).catch(a=>{var u;(u=this.callbacks)==null||u.onError({code:n.status,text:a.message},t,n,s)}):this.openAndSendXhr(n,t,e)}openAndSendXhr(e,t,n){e.readyState||e.open("GET",t.url,!0);const s=t.headers,{maxTimeToFirstByteMs:r,maxLoadTimeMs:a}=n.loadPolicy;if(s)for(const u in s)e.setRequestHeader(u,s[u]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),n.timeout=r&&Ye(r)?r:a,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:n}=this;if(!e||!t)return;const s=t.readyState,r=this.config;if(!n.aborted&&s>=2&&(n.loading.first===0&&(n.loading.first=Math.max(self.performance.now(),n.loading.start),r.timeout!==r.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),r.timeout=r.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.loadPolicy.maxLoadTimeMs-(n.loading.first-n.loading.start)))),s===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const c=t.status,d=t.responseType==="text"?t.responseText:null;if(c>=200&&c<300){const E=d??t.response;if(E!=null){var a,u;n.loading.end=Math.max(self.performance.now(),n.loading.first);const A=t.responseType==="arraybuffer"?E.byteLength:E.length;n.loaded=n.total=A,n.bwEstimate=n.total*8e3/(n.loading.end-n.loading.first);const S=(a=this.callbacks)==null?void 0:a.onProgress;S&&S(n,e,E,t);const x={url:t.responseURL,data:E,code:c};(u=this.callbacks)==null||u.onSuccess(x,n,e,t);return}}const p=r.loadPolicy.errorRetry,m=n.retry,y={url:e.url,data:void 0,code:c};if(Ld(p,m,!1,y))this.retry(p);else{var f;an.error(`${c} while loading ${e.url}`),(f=this.callbacks)==null||f.onError({code:c,text:t.statusText},e,t,n)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(Ld(e,t,!0))this.retry(e);else{var n;an.warn(`timeout while loading ${(n=this.context)==null?void 0:n.url}`);const s=this.callbacks;s&&(this.abortInternal(),s.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:n}=this;this.retryDelay=W0(e,n.retry),n.retry++,an.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${n.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&S3.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const T3={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},x3=on(on({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:IM,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:UF,bufferController:Rk,capLevelController:ov,errorController:GF,fpsController:bB,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:Mb,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:T3},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},A3()),{},{subtitleStreamController:kB,subtitleTrackController:IB,timelineController:c3,audioStreamController:Sk,audioTrackController:Tk,emeController:vl,cmcdController:TB,contentSteeringController:AB,interstitialsController:FB});function A3(){return{cueHandler:h3,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function R3(i,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const n=Hg(i),s=["manifest","level","frag"],r=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return s.forEach(a=>{const u=`${a==="level"?"playlist":a}LoadPolicy`,f=e[u]===void 0,c=[];r.forEach(d=>{const p=`${a}Loading${d}`,m=e[p];if(m!==void 0&&f){c.push(p);const y=n[u].default;switch(e[u]={default:y},d){case"TimeOut":y.maxLoadTimeMs=m,y.maxTimeToFirstByteMs=m;break;case"MaxRetry":y.errorRetry.maxNumRetry=m,y.timeoutRetry.maxNumRetry=m;break;case"RetryDelay":y.errorRetry.retryDelayMs=m,y.timeoutRetry.retryDelayMs=m;break;case"MaxRetryTimeout":y.errorRetry.maxRetryDelayMs=m,y.timeoutRetry.maxRetryDelayMs=m;break}}}),c.length&&t.warn(`hls.js config: "${c.join('", "')}" setting(s) are deprecated, use "${u}": ${yn(e[u])}`)}),on(on({},n),e)}function Hg(i){return i&&typeof i=="object"?Array.isArray(i)?i.map(Hg):Object.keys(i).reduce((e,t)=>(e[t]=Hg(i[t]),e),{}):i}function b3(i,e){const t=i.loader;t!==iA&&t!==IM?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),i.progressive=!1):p3()&&(i.loader=iA,i.progressive=!0,i.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const dd=2,M3=.1,C3=.05,I3=100;class L3 extends Tb{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var n;(n=this.media)!=null&&n.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var n;this.ended=((n=this.media)==null?void 0:n.currentTime)||1,this.hls.trigger(P.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(P.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(P.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(P.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(P.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(P.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(P.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(I3),this.mediaSource=t.mediaSource;const n=this.media=t.media;Ti(n,"playing",this.onMediaPlaying),Ti(n,"waiting",this.onMediaWaiting),Ti(n,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:n}=this;n&&(Ui(n,"playing",this.onMediaPlaying),Ui(n,"waiting",this.onMediaWaiting),Ui(n,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var n,s;const r=(n=this.hls)==null?void 0:n.config;if(!r)return;const a=this.media;if(!a)return;const{seeking:u}=a,f=this.seeking&&!u,c=!this.seeking&&u,d=a.paused&&!u||a.ended||a.playbackRate===0;if(this.seeking=u,e!==t){t&&(this.ended=0),this.moved=!0,u||(this.nudgeRetry=0,r.nudgeOnVideoHole&&!d&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(c||f){f&&this.stallResolved(e);return}if(d){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&a.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(P.MEDIA_ENDED,{stalled:!1}));return}if(!xt.getBuffered(a).length){this.nudgeRetry=0;return}const p=xt.bufferInfo(a,e,0),m=p.nextStart||0,y=this.fragmentTracker;if(u&&y&&this.hls){const U=sA(this.hls.inFlightFragments,e),w=p.len>dd,O=!m||U||m-e>dd&&!y.getPartialFragment(e);if(w||O)return;this.moved=!1}const E=(s=this.hls)==null?void 0:s.latestLevelDetails;if(!this.moved&&this.stalled!==null&&y){if(!(p.len>0)&&!m)return;const w=Math.max(m,p.start||0)-e,L=!!(E!=null&&E.live)?E.targetduration*2:dd,I=wf(e,y);if(w>0&&(w<=L||I)){a.paused||this._trySkipBufferHole(I);return}}const A=r.detectStallWithCurrentTimeMs,S=self.performance.now(),x=this.waiting;let M=this.stalled;if(M===null)if(x>0&&S-x<A)M=this.stalled=x;else{this.stalled=S;return}const b=S-M;if(!u&&(b>=A||x)&&this.hls){var C;if(((C=this.mediaSource)==null?void 0:C.readyState)==="ended"&&!(E!=null&&E.live)&&Math.abs(e-((E==null?void 0:E.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(P.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(p),!this.media||!this.hls)return}const N=xt.bufferInfo(a,e,r.maxBufferHole);this._tryFixBufferStall(N,b,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const n=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(n)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(P.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var n;const s=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(n=this.buffered.audio)!=null&&n.length&&s&&s.length>1&&e>s.end(0)){const r=xt.bufferedInfo(xt.timeRangesToArray(this.buffered.audio),e,0);if(r.len>1&&t>=r.start){const a=xt.timeRangesToArray(s),u=xt.bufferedInfo(a,t,0).bufferedIndex;if(u>-1&&u<a.length-1){const f=xt.bufferedInfo(a,e,0).bufferedIndex,c=a[u].end,d=a[u+1].start;if((f===-1||f>u)&&d-c<1&&e-c<2){const p=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${c} -> ${d} buffered index: ${f}`);this.warn(p.message),this.media.currentTime+=1e-6;let m=wf(e,this.fragmentTracker);m&&"fragment"in m?m=m.fragment:m||(m=void 0);const y=xt.bufferInfo(this.media,e,0);this.hls.trigger(P.ERROR,{type:lt.MEDIA_ERROR,details:ce.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:p,reason:p.message,frag:m,buffer:y.len,bufferInfo:y})}}}}}_tryFixBufferStall(e,t,n){var s,r;const{fragmentTracker:a,media:u}=this,f=(s=this.hls)==null?void 0:s.config;if(!u||!a||!f)return;const c=(r=this.hls)==null?void 0:r.latestLevelDetails,d=wf(n,a);if((d||c!=null&&c.live&&n<c.fragmentStart)&&(this._trySkipBufferHole(d)||!this.media))return;const p=e.buffered,m=this.adjacentTraversal(e,n);(p&&p.length>1&&e.len>f.maxBufferHole||e.nextStart&&(e.nextStart-n<f.maxBufferHole||m))&&(t>f.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const n=this.fragmentTracker,s=e.nextStart;if(n&&s){const r=n.getFragAtPos(t,et.MAIN),a=n.getFragAtPos(s,et.MAIN);if(r&&a)return a.sn-r.sn<2}return!1}_reportStall(e){const{hls:t,media:n,stallReported:s,stalled:r}=this;if(!s&&r!==null&&n&&t){this.stallReported=!0;const a=new Error(`Playback stalling at @${n.currentTime} due to low buffer (${yn(e)})`);this.warn(a.message),t.trigger(P.ERROR,{type:lt.MEDIA_ERROR,details:ce.BUFFER_STALLED_ERROR,fatal:!1,error:a,buffer:e.len,bufferInfo:e,stalled:{start:r}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:n,media:s}=this,r=(t=this.hls)==null?void 0:t.config;if(!s||!n||!r)return 0;const a=s.currentTime,u=xt.bufferInfo(s,a,0),f=a<u.start?u.start:u.nextStart;if(f&&this.hls){const d=u.len<=r.maxBufferHole,p=u.len>0&&u.len<1&&s.readyState<3,m=f-a;if(m>0&&(d||p)){if(m>r.maxBufferHole){let E=!1;if(a===0){const A=n.getAppendedFrag(0,et.MAIN);A&&f<A.end&&(E=!0)}if(!E&&e){var c;if(!((c=this.hls.loadLevelObj)!=null&&c.details)||sA(this.hls.inFlightFragments,f))return 0;let S=!1,x=e.end;for(;x<f;){const M=wf(x,n);if(M)x+=M.duration;else{S=!0;break}}if(S)return 0}}const y=Math.max(f+C3,a+M3);if(this.warn(`skipping hole, adjusting currentTime from ${a} to ${y}`),this.moved=!0,s.currentTime=y,!(e!=null&&e.gap)){const E=new Error(`fragment loaded with buffer holes, seeking from ${a} to ${y}`),A={type:lt.MEDIA_ERROR,details:ce.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:E,reason:E.message,buffer:u.len,bufferInfo:u};e&&("fragment"in e?A.part=e:A.frag=e),this.hls.trigger(P.ERROR,A)}return y}}return 0}_tryNudgeBuffer(e){const{hls:t,media:n,nudgeRetry:s}=this,r=t==null?void 0:t.config;if(!n||!r)return 0;const a=n.currentTime;if(this.nudgeRetry++,s<r.nudgeMaxRetry){const u=a+(s+1)*r.nudgeOffset,f=new Error(`Nudging 'currentTime' from ${a} to ${u}`);this.warn(f.message),n.currentTime=u,t.trigger(P.ERROR,{type:lt.MEDIA_ERROR,details:ce.BUFFER_NUDGE_ON_STALL,error:f,fatal:!1,buffer:e.len,bufferInfo:e})}else{const u=new Error(`Playhead still not moving while enough data buffered @${a} after ${r.nudgeMaxRetry} nudges`);this.error(u.message),t.trigger(P.ERROR,{type:lt.MEDIA_ERROR,details:ce.BUFFER_STALLED_ERROR,error:u,fatal:!0,buffer:e.len,bufferInfo:e})}}}function sA(i,e){const t=rA(i.main);if(t&&t.start<=e)return t;const n=rA(i.audio);return n&&n.start<=e?n:null}function rA(i){if(!i)return null;switch(i.state){case Ce.IDLE:case Ce.STOPPED:case Ce.ENDED:case Ce.ERROR:return null}return i.frag}function wf(i,e){return e.getAppendedFrag(i,et.MAIN)||e.getPartialFragment(i)}const D3=.25;function zg(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function Pm(i,e,t,n,s){let r=new i(e,t,"");try{r.value=n,s&&(r.type=s)}catch{r=new i(e,t,yn(s?on({type:s},n):n))}return r}const Pf=(()=>{const i=zg();try{i&&new i(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class w3{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(P.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(P.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(P.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(P.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(P.MANIFEST_LOADING,this.onManifestLoading,this),e.on(P.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(P.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(P.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(P.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(P.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(P.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(P.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(P.MANIFEST_LOADING,this.onManifestLoading,this),e.off(P.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(P.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(P.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(P.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var n;this.media=t.media,((n=t.overrides)==null?void 0:n.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&fl(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const n=e[t];if(n.kind==="metadata"&&n.label==="id3")return vM(n,this.media),n}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:n,enableID3MetadataCues:s}=this.hls.config;if(!n&&!s)return;const{samples:r}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const a=zg();if(a)for(let u=0;u<r.length;u++){const f=r[u].type;if(f===Zi.emsg&&!n||!s)continue;const c=qb(r[u].data),d=r[u].pts;let p=d+r[u].duration;p>Pf&&(p=Pf),p-d<=0&&(p=d+D3);for(let y=0;y<c.length;y++){const E=c[y];if(!Wb(E)){this.updateId3CueEnds(d,f);const A=Pm(a,d,p,E,f);A&&this.id3Track.addCue(A)}}}}updateId3CueEnds(e,t){var n;const s=(n=this.id3Track)==null?void 0:n.cues;if(s)for(let r=s.length;r--;){const a=s[r];a.type===t&&a.startTime<e&&a.endTime===Pf&&(a.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:n,type:s}){const{id3Track:r,hls:a}=this;if(!a)return;const{config:{enableEmsgMetadataCues:u,enableID3MetadataCues:f}}=a;if(r&&(u||f)){let c;s==="audio"?c=d=>d.type===Zi.audioId3&&f:s==="video"?c=d=>d.type===Zi.emsg&&u:c=d=>d.type===Zi.audioId3&&f||d.type===Zi.emsg&&u,Gg(r,t,n,c)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:n,timelineOffset:s,enableDateRangeMetadataCues:r,interstitialsController:a}=this.hls.config;if(!r)return;const u=zg();if(n&&s&&!a){const{fragmentStart:A,fragmentEnd:S}=e;let x=this.assetCue;x?(x.startTime=A,x.endTime=S):u&&(x=this.assetCue=Pm(u,A,S,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),x&&(x.id=n,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(x),x.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:f}=this,{dateRanges:c}=e,d=Object.keys(c);let p=this.dateRangeCuesAppended;if(f&&t){var m;if((m=f.cues)!=null&&m.length){const A=Object.keys(p).filter(S=>!d.includes(S));for(let S=A.length;S--;){var y;const x=A[S],M=(y=p[x])==null?void 0:y.cues;delete p[x],M&&Object.keys(M).forEach(b=>{const C=M[b];if(C){C.removeEventListener("enter",this.onEventCueEnter);try{f.removeCue(C)}catch{}}})}}else p=this.dateRangeCuesAppended={}}const E=e.fragments[e.fragments.length-1];if(!(d.length===0||!Ye(E==null?void 0:E.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let A=0;A<d.length;A++){const S=d[A],x=c[S],M=x.startTime,b=p[S],C=(b==null?void 0:b.cues)||{};let N=(b==null?void 0:b.durationKnown)||!1,U=Pf;const{duration:w,endDate:O}=x;if(O&&w!==null)U=M+w,N=!0;else if(x.endOnNext&&!N){const I=d.reduce((F,X)=>{if(X!==x.id){const Y=c[X];if(Y.class===x.class&&Y.startDate>x.startDate&&(!F||x.startDate<F.startDate))return Y}return F},null);I&&(U=I.startTime,N=!0)}const L=Object.keys(x.attr);for(let I=0;I<L.length;I++){const F=L[I];if(!jF(F))continue;const X=C[F];if(X)N&&!(b!=null&&b.durationKnown)?X.endTime=U:Math.abs(X.startTime-M)>.01&&(X.startTime=M,X.endTime=U);else if(u){let Y=x.attr[F];e2(F)&&(Y=nb(Y));const ne=Pm(u,M,U,{key:F,data:Y},Zi.dateRange);ne&&(ne.id=S,this.id3Track.addCue(ne),C[F]=ne,a&&(F==="X-ASSET-LIST"||F==="X-ASSET-URL")&&ne.addEventListener("enter",this.onEventCueEnter))}}p[S]={cues:C,dateRange:x,durationKnown:N}}}}}class P3{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,n=this.levelDetails;if(!t||!n)return;this.currentTime=t.currentTime;const s=this.computeLatency();if(s===null)return;this._latency=s;const{lowLatencyMode:r,maxLiveSyncPlaybackRate:a}=this.config;if(!r||a===1||!n.live)return;const u=this.targetLatency;if(u===null)return;const f=s-u,c=Math.min(this.maxLatency,u+n.targetduration);if(f<c&&f>.05&&this.forwardBufferLength>1){const p=Math.min(2,Math.max(1,a)),m=Math.round(2/(1+Math.exp(-.75*f-this.edgeStalled))*20)/20,y=Math.min(p,Math.max(1,m));this.changeMediaPlaybackRate(t,y)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:n,targetduration:s}=e,{liveSyncDuration:r,liveSyncDurationCount:a,lowLatencyMode:u}=this.config,f=this.hls.userConfig;let c=u&&n||t;(this._targetLatencyUpdated||f.liveSyncDuration||f.liveSyncDurationCount||c===0)&&(c=r!==void 0?r:a*s);const d=s;return c+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,d)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const n=this.levelDetails;if(n===null)return null;const s=n.edge,r=e-t-this.edgeStalled,a=s-n.totalduration,u=s-(this.config.lowLatencyMode&&n.partTarget||n.targetduration);return Math.min(Math.max(a,r),u)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const n=e.buffered.length;return(n?e.buffered.end(n-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(P.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(P.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(P.MANIFEST_LOADING,this.onManifestLoading,this),e.on(P.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(P.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(P.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(P.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(P.MANIFEST_LOADING,this.onManifestLoading,this),e.off(P.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(P.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var n;t.details===ce.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(n=this.levelDetails)!=null&&n.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var n,s;e.playbackRate!==t&&((n=this.hls)==null||n.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(s=this.targetLatency)==null?void 0:s.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class N3 extends rv{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(P.MANIFEST_LOADING,this.onManifestLoading,this),e.on(P.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(P.LEVEL_LOADED,this.onLevelLoaded,this),e.on(P.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(P.FRAG_BUFFERED,this.onFragBuffered,this),e.on(P.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(P.MANIFEST_LOADING,this.onManifestLoading,this),e.off(P.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(P.LEVEL_LOADED,this.onLevelLoaded,this),e.off(P.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(P.FRAG_BUFFERED,this.onFragBuffered,this),e.off(P.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const n=this.hls.config.preferManagedMediaSource,s=[],r={},a={};let u=!1,f=!1,c=!1;t.levels.forEach(d=>{const p=d.attrs;let{audioCodec:m,videoCodec:y}=d;m&&(d.audioCodec=m=bd(m,n)||void 0),y&&(y=d.videoCodec=gF(y));const{width:E,height:A,unknownCodecs:S}=d,x=(S==null?void 0:S.length)||0;if(u||(u=!!(E&&A)),f||(f=!!y),c||(c=!!m),x||m&&!this.isAudioSupported(m)||y&&!this.isVideoSupported(y)){this.log(`Some or all CODECS not supported "${p.CODECS}"`);return}const{CODECS:M,"FRAME-RATE":b,"HDCP-LEVEL":C,"PATHWAY-ID":N,RESOLUTION:U,"VIDEO-RANGE":w}=p,L=`${`${N||"."}-`}${d.bitrate}-${U}-${b}-${M}-${w}-${C}`;if(r[L])if(r[L].uri!==d.url&&!d.attrs["PATHWAY-ID"]){const I=a[L]+=1;d.attrs["PATHWAY-ID"]=new Array(I+1).join(".");const F=this.createLevel(d);r[L]=F,s.push(F)}else r[L].addGroupId("audio",p.AUDIO),r[L].addGroupId("text",p.SUBTITLES);else{const I=this.createLevel(d);r[L]=I,a[L]=1,s.push(I)}}),this.filterAndSortMediaOptions(s,t,u,f,c)}createLevel(e){const t=new qu(e),n=e.supplemental;if(n!=null&&n.videoCodec&&!this.isVideoSupported(n.videoCodec)){const s=new Error(`SUPPLEMENTAL-CODECS not supported "${n.videoCodec}"`);this.log(s.message),t.supportedResult=pb(s,[])}return t}isAudioSupported(e){return zu(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return zu(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,n,s,r){var a;let u=[],f=[],c=e;const d=((a=t.stats)==null?void 0:a.parsing)||{};if((n||s)&&r&&(c=c.filter(({videoCodec:M,videoRange:b,width:C,height:N})=>(!!M||!!(C&&N))&&bF(b))),c.length===0){Promise.resolve().then(()=>{if(this.hls){let M="no level with compatible codecs found in manifest",b=M;t.levels.length&&(b=`one or more CODECS in variant not supported: ${yn(t.levels.map(N=>N.attrs.CODECS).filter((N,U,w)=>w.indexOf(N)===U))}`,this.warn(b),M+=` (${b})`);const C=new Error(M);this.hls.trigger(P.ERROR,{type:lt.MEDIA_ERROR,details:ce.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:C,reason:b})}}),d.end=performance.now();return}t.audioTracks&&(u=t.audioTracks.filter(M=>!M.audioCodec||this.isAudioSupported(M.audioCodec)),oA(u)),t.subtitles&&(f=t.subtitles,oA(f));const p=c.slice(0);c.sort((M,b)=>{if(M.attrs["HDCP-LEVEL"]!==b.attrs["HDCP-LEVEL"])return(M.attrs["HDCP-LEVEL"]||"")>(b.attrs["HDCP-LEVEL"]||"")?1:-1;if(n&&M.height!==b.height)return M.height-b.height;if(M.frameRate!==b.frameRate)return M.frameRate-b.frameRate;if(M.videoRange!==b.videoRange)return Md.indexOf(M.videoRange)-Md.indexOf(b.videoRange);if(M.videoCodec!==b.videoCodec){const C=QT(M.videoCodec),N=QT(b.videoCodec);if(C!==N)return N-C}if(M.uri===b.uri&&M.codecSet!==b.codecSet){const C=Rd(M.codecSet),N=Rd(b.codecSet);if(C!==N)return N-C}return M.averageBitrate!==b.averageBitrate?M.averageBitrate-b.averageBitrate:0});let m=p[0];if(this.steering&&(c=this.steering.filterParsedLevels(c),c.length!==p.length)){for(let M=0;M<p.length;M++)if(p[M].pathwayId===c[0].pathwayId){m=p[M];break}}this._levels=c;for(let M=0;M<c.length;M++)if(c[M]===m){var y;this._firstLevel=M;const b=m.bitrate,C=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${c.length} level(s) found, first bitrate: ${b}`),((y=this.hls.userConfig)==null?void 0:y.abrEwmaDefaultEstimate)===void 0){const N=Math.min(b,this.hls.config.abrEwmaDefaultEstimateMax);N>C&&C===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=N)}break}const E=r&&!s,A=this.hls.config,S=!!(A.audioStreamController&&A.audioTrackController),x={levels:c,audioTracks:u,subtitleTracks:f,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:r,video:s,altAudio:S&&!E&&u.some(M=>!!M.url)};d.end=performance.now(),this.hls.trigger(P.MANIFEST_PARSED,x)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const d=new Error("invalid level idx"),p=e<0;if(this.hls.trigger(P.ERROR,{type:lt.OTHER_ERROR,details:ce.LEVEL_SWITCH_ERROR,level:e,fatal:p,error:d,reason:d.message}),p)return;e=Math.min(e,t.length-1)}const n=this.currentLevelIndex,s=this.currentLevel,r=s?s.attrs["PATHWAY-ID"]:void 0,a=t[e],u=a.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=a,n===e&&s&&r===u)return;this.log(`Switching to level ${e} (${a.height?a.height+"p ":""}${a.videoRange?a.videoRange+" ":""}${a.codecSet?a.codecSet+" ":""}@${a.bitrate})${u?" with Pathway "+u:""} from level ${n}${r?" with Pathway "+r:""}`);const f={level:e,attrs:a.attrs,details:a.details,bitrate:a.bitrate,averageBitrate:a.averageBitrate,maxBitrate:a.maxBitrate,realBitrate:a.realBitrate,width:a.width,height:a.height,codecSet:a.codecSet,audioCodec:a.audioCodec,videoCodec:a.videoCodec,audioGroups:a.audioGroups,subtitleGroups:a.subtitleGroups,loaded:a.loaded,loadError:a.loadError,fragmentError:a.fragmentError,name:a.name,id:a.id,uri:a.uri,url:a.url,urlId:0,audioGroupIds:a.audioGroupIds,textGroupIds:a.textGroupIds};this.hls.trigger(P.LEVEL_SWITCHING,f);const c=a.details;if(!c||c.live){const d=this.switchParams(a.uri,s==null?void 0:s.details,c);this.loadPlaylist(d)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),n=e.filter(s=>t.indexOf(s)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=n}}onError(e,t){t.fatal||!t.context||t.context.type===Nt.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===et.MAIN){const n=t.elementaryStreams;if(!Object.keys(n).some(r=>!!n[r]))return;const s=this._levels[t.level];s!=null&&s.loadError&&(this.log(`Resetting level error count of ${s.loadError} on frag buffered`),s.loadError=0)}}onLevelLoaded(e,t){var n;const{level:s,details:r}=t,a=t.levelInfo;if(!a){var u;this.warn(`Invalid level index ${s}`),(u=t.deliveryDirectives)!=null&&u.skip&&(r.deltaUpdateFailed=!0);return}if(a===this.currentLevel||t.withoutMultiVariant){a.fragmentError===0&&(a.loadError=0);let f=a.details;f===t.details&&f.advanced&&(f=void 0),this.playlistLoaded(s,t,f)}else(n=t.deliveryDirectives)!=null&&n.skip&&(r.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=this.getUrlWithDirectives(e.uri,t),s=this.currentLevelIndex,r=e.attrs["PATHWAY-ID"],a=e.details,u=a==null?void 0:a.age;this.log(`Loading level index ${s}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${r?" Pathway "+r:""}${u&&a.live?" age "+u.toFixed(1)+(a.type&&" "+a.type||""):""} ${n}`),this.hls.trigger(P.LEVEL_LOADING,{url:n,level:s,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const n=this._levels.filter((r,a)=>a!==e?!0:(this.steering&&this.steering.removeLevel(r),r===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,r.details&&r.details.fragments.forEach(u=>u.level=-1)),!1));Ub(n),this._levels=n,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const s=n.length-1;this._firstLevel=Math.min(this._firstLevel,s),this._startLevel&&(this._startLevel=Math.min(this._startLevel,s)),this.hls.trigger(P.LEVELS_UPDATED,{levels:n})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:n}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(P.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:n}))}}function oA(i){const e={};i.forEach(t=>{const n=t.groupId||"";t.id=e[n]=e[n]||0,e[n]++})}function LM(){return self.SourceBuffer||self.WebKitSourceBuffer}function DM(){if(!go())return!1;const e=LM();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function U3(){if(!DM())return!1;const i=go();return typeof(i==null?void 0:i.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>i.isTypeSupported($u(e,"video")))||["mp4a.40.2","fLaC"].some(e=>i.isTypeSupported($u(e,"audio"))))}function O3(){var i;const e=LM();return typeof(e==null||(i=e.prototype)==null?void 0:i.changeType)=="function"}const F3=100;class k3 extends Q0{constructor(e,t,n){super(e,t,n,"stream-controller",et.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const s=this.media,r=s?s.currentTime:null;if(r===null||!Ye(r)||(this.log(`Media seeked to ${r.toFixed(3)}`),!this.getBufferedFrag(r)))return;const a=this.getFwdBufferInfoAtPos(s,r,et.MAIN,0);if(a===null||a.len===0){this.warn(`Main forward buffer length at ${r} on "seeked" event ${a?a.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(P.MANIFEST_PARSED,this.onManifestParsed,this),e.on(P.LEVEL_LOADING,this.onLevelLoading,this),e.on(P.LEVEL_LOADED,this.onLevelLoaded,this),e.on(P.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(P.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(P.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(P.BUFFER_CREATED,this.onBufferCreated,this),e.on(P.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(P.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(P.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(P.MANIFEST_PARSED,this.onManifestParsed,this),e.off(P.LEVEL_LOADED,this.onLevelLoaded,this),e.off(P.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(P.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(P.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(P.BUFFER_CREATED,this.onBufferCreated,this),e.off(P.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(P.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(P.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:n,hls:s}=this;if(this.stopLoad(),this.setInterval(F3),this.level=-1,!this.startFragRequested){let r=s.startLevel;r===-1&&(s.config.testBandwidth&&this.levels.length>1?(r=0,this.bitrateTest=!0):r=s.firstAutoLevel),s.nextLoadLevel=r,this.level=s.loadLevel,this._hasEnoughToStart=!!t}n>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${n.toFixed(3)}`),e=n),this.state=Ce.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=Ce.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case Ce.WAITING_LEVEL:{const{levels:e,level:t}=this,n=e==null?void 0:e[t],s=n==null?void 0:n.details;if(s&&(!s.live||this.levelLastLoaded===n&&!this.waitForLive(n))){if(this.waitForCdnTuneIn(s))break;this.state=Ce.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=Ce.IDLE;break}break}case Ce.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===Ce.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:n,media:s}=this;if(t===null||!s&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const r=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(n!=null&&n[r]))return;const a=n[r],u=this.getMainFwdBufferInfo();if(u===null)return;const f=this.getLevelDetails();if(f&&this._streamEnded(u,f)){const A={};this.altAudio===2&&(A.type="video"),this.hls.trigger(P.BUFFER_EOS,A),this.state=Ce.ENDED;return}if(!this.buffering)return;e.loadLevel!==r&&e.manualLevel===-1&&this.log(`Adapting to level ${r} from level ${this.level}`),this.level=e.nextLoadLevel=r;const c=a.details;if(!c||this.state===Ce.WAITING_LEVEL||this.waitForLive(a)){this.level=r,this.state=Ce.WAITING_LEVEL,this.startFragRequested=!1;return}const d=u.len,p=this.getMaxBufferLength(a.maxBitrate);if(d>=p)return;this.backtrackFragment&&this.backtrackFragment.start>u.end&&(this.backtrackFragment=null);const m=this.backtrackFragment?this.backtrackFragment.start:u.end;let y=this.getNextFragment(m,c);if(this.couldBacktrack&&!this.fragPrevious&&y&&Nn(y)&&this.fragmentTracker.getState(y)!==Xn.OK){var E;const S=((E=this.backtrackFragment)!=null?E:y).sn-c.startSN,x=c.fragments[S-1];x&&y.cc===x.cc&&(y=x,this.fragmentTracker.removeFragment(x))}else this.backtrackFragment&&u.len&&(this.backtrackFragment=null);if(y&&this.isLoopLoading(y,m)){if(!y.gap){const S=this.audioOnly&&!this.altAudio?vn.AUDIO:vn.VIDEO,x=(S===vn.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;x&&this.afterBufferFlushed(x,S,et.MAIN)}y=this.getNextFragmentLoopLoading(y,c,u,et.MAIN,p)}y&&(y.initSegment&&!y.initSegment.data&&!this.bitrateTest&&(y=y.initSegment),this.loadFragment(y,a,m))}loadFragment(e,t,n){const s=this.fragmentTracker.getState(e);s===Xn.NOT_LOADED||s===Xn.PARTIAL?Nn(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,n):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,et.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let n;const s=this.getAppendedFrag(t.currentTime);s&&s.start>1&&this.flushMainBuffer(0,s.start-1);const r=this.getLevelDetails();if(r!=null&&r.live){const u=this.getMainFwdBufferInfo();if(!u||u.len<r.targetduration*2)return}if(!t.paused&&e){const u=this.hls.nextLoadLevel,f=e[u],c=this.fragLastKbps;c&&this.fragCurrent?n=this.fragCurrent.duration*f.maxBitrate/(1e3*c)+1:n=0}else n=0;const a=this.getBufferedFrag(t.currentTime+n);if(a){const u=this.followingBufferedFrag(a);if(u){this.abortCurrentFrag();const f=u.maxStartPTS?u.maxStartPTS:u.start,c=u.duration,d=Math.max(a.end,f+Math.min(Math.max(c-this.config.maxFragLookUpTolerance,c*(this.couldBacktrack?.5:.125)),c*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(d,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case Ce.KEY_LOADING:case Ce.FRAG_LOADING:case Ce.FRAG_LOADING_WAITING_RETRY:case Ce.PARSING:case Ce.PARSED:this.state=Ce.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const n=t.media;Ti(n,"playing",this.onMediaPlaying),Ti(n,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:n}=this;n&&(Ui(n,"playing",this.onMediaPlaying),Ui(n,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(P.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let n=!1,s=!1;for(let r=0;r<t.levels.length;r++){const a=t.levels[r].audioCodec;a&&(n=n||a.indexOf("mp4a.40.2")!==-1,s=s||a.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=n&&s&&!O3(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:n}=this;if(!n||this.state!==Ce.IDLE)return;const s=t.levelInfo;(!s.details||s.details.live&&(this.levelLastLoaded!==s||s.details.expired)||this.waitForCdnTuneIn(s.details))&&(this.state=Ce.WAITING_LEVEL)}onLevelLoaded(e,t){var n;const{levels:s,startFragRequested:r}=this,a=t.level,u=t.details,f=u.totalduration;if(!s){this.warn(`Levels were reset while loading level ${a}`);return}this.log(`Level ${a} loaded [${u.startSN},${u.endSN}]${u.lastPartSn?`[part-${u.lastPartSn}-${u.lastPartIndex}]`:""}, cc [${u.startCC}, ${u.endCC}] duration:${f}`);const c=t.levelInfo,d=this.fragCurrent;d&&(this.state===Ce.FRAG_LOADING||this.state===Ce.FRAG_LOADING_WAITING_RETRY)&&d.level!==t.level&&d.loader&&this.abortCurrentFrag();let p=0;if(u.live||(n=c.details)!=null&&n.live){var m;if(this.checkLiveUpdate(u),u.deltaUpdateFailed)return;p=this.alignPlaylists(u,c.details,(m=this.levelLastLoaded)==null?void 0:m.details)}if(c.details=u,this.levelLastLoaded=c,r||this.setStartPosition(u,p),this.hls.trigger(P.LEVEL_UPDATED,{details:u,level:a}),this.state===Ce.WAITING_LEVEL){if(this.waitForCdnTuneIn(u))return;this.state=Ce.IDLE}r&&u.live&&this.synchronizeToLiveEdge(u),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:n}=this;if(!n)return;const s=this.hls.liveSyncPosition,r=this.getLoadPosition(),a=e.fragmentStart,u=e.edge,f=r>=a-t.maxFragLookUpTolerance&&r<=u;if(s!==null&&n.duration>s&&(r<s||!f)){const d=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!f&&n.readyState<4||r<u-d)&&(this._hasEnoughToStart||(this.nextLoadPosition=s),n.readyState))if(this.warn(`Playback: ${r.toFixed(3)} is located too far from the end of live sliding playlist: ${u}, reset currentTime to : ${s.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var c;const p=xt.bufferInfo(n,s,0);if(!((c=p.buffered)!=null&&c.length)){n.currentTime=s;return}if(p.start<=r){n.currentTime=s;return}const{nextStart:y}=xt.bufferedInfo(p.buffered,r,0);y&&(n.currentTime=y)}else n.currentTime=s}}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:s,payload:r}=e,{levels:a}=this;if(!a){this.warn(`Levels were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const u=a[n.level];if(!u){this.warn(`Level ${n.level} not found on progress`);return}const f=u.details;if(!f){this.warn(`Dropping fragment ${n.sn} of level ${n.level} after level details were reset`),this.fragmentTracker.removeFragment(n);return}const c=u.videoCodec,d=f.PTSKnown||!f.live,p=(t=n.initSegment)==null?void 0:t.data,m=this._getAudioCodec(u),y=this.transmuxer=this.transmuxer||new iM(this.hls,et.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),E=s?s.index:-1,A=E!==-1,S=new Y0(n.level,n.sn,n.stats.chunkCount,r.byteLength,E,A),x=this.initPTS[n.cc];y.push(r,p,m,c,n,s,f.totalduration,d,S,x)}onAudioTrackSwitching(e,t){const n=this.hls,s=this.altAudio!==0;if(Cd(t.url,n))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const a=this.fragCurrent;a&&(this.log("Switching to main audio track, cancel main fragment load"),a.abortRequests(),this.fragmentTracker.removeFragment(a)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(s){this.altAudio=0,this.fragmentTracker.removeAllFragments(),n.once(P.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(P.AUDIO_TRACK_SWITCHED,t)}),n.trigger(P.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}n.trigger(P.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const n=Cd(t.url,this.hls);if(n){const s=this.videoBuffer;s&&this.mediaBuffer!==s&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=s)}this.altAudio=n?2:0,this.tick()}onBufferCreated(e,t){const n=t.tracks;let s,r,a=!1;for(const u in n){const f=n[u];if(f.id==="main"){if(r=u,s=f,u==="video"){const c=n[u];c&&(this.videoBuffer=c.buffer)}}else a=!0}a&&s?(this.log(`Alternate track found, use ${r}.buffered to schedule main fragment loading`),this.mediaBuffer=s.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:n,part:s}=t,r=n.type===et.MAIN;if(r){if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${s?" p: "+s.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}`),this.state===Ce.PARSED&&(this.state=Ce.IDLE);return}const u=s?s.stats:n.stats;this.fragLastKbps=Math.round(8*u.total/(u.buffering.end-u.loading.first)),Nn(n)&&(this.fragPrevious=n),this.fragBufferedComplete(n,s)}const a=this.media;a&&(!this._hasEnoughToStart&&xt.getBuffered(a).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),r&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var n;if(t.fatal){this.state=Ce.ERROR;return}switch(t.details){case ce.FRAG_GAP:case ce.FRAG_PARSING_ERROR:case ce.FRAG_DECRYPT_ERROR:case ce.FRAG_LOAD_ERROR:case ce.FRAG_LOAD_TIMEOUT:case ce.KEY_LOAD_ERROR:case ce.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(et.MAIN,t);break;case ce.LEVEL_LOAD_ERROR:case ce.LEVEL_LOAD_TIMEOUT:case ce.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===Ce.WAITING_LEVEL&&((n=t.context)==null?void 0:n.type)===Nt.LEVEL&&(this.state=Ce.IDLE);break;case ce.BUFFER_ADD_CODEC_ERROR:case ce.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case ce.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case ce.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=Ce.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==vn.AUDIO||!this.altAudio){const n=(t===vn.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;n&&(this.afterBufferFlushed(n,t,et.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let n=this.startPosition;if(n>=0&&t<n){if(e.seeking){this.log(`could not seek to ${n}, already seeking at ${t}`);return}const s=this.timelineOffset;s&&n&&(n+=s);const r=this.getLevelDetails(),a=xt.getBuffered(e),u=a.length?a.start(0):0,f=u-n,c=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||f>0&&(f<c||this.loadingParts&&f<2*((r==null?void 0:r.partTarget)||0)))&&(this.log(`adjusting start position by ${f} to match buffer start`),n+=f,this.startPosition=n),t<n&&(this.log(`seek to target start position ${n} from current time ${t} buffer start ${u}`),e.currentTime=n)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(n=>{const{hls:s}=this,r=n==null?void 0:n.frag;if(!r||this.fragContextChanged(r))return;t.fragmentError=0,this.state=Ce.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const a=r.stats;a.parsing.start=a.parsing.end=a.buffering.start=a.buffering.end=self.performance.now(),s.trigger(P.FRAG_LOADED,n),r.bitrateTest=!1}).catch(n=>{this.state===Ce.STOPPED||this.state===Ce.ERROR||(this.warn(n),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:n}=this,{remuxResult:s,chunkMeta:r}=e,a=this.getCurrentContext(r);if(!a){this.resetWhenMissingContext(r);return}const{frag:u,part:f,level:c}=a,{video:d,text:p,id3:m,initSegment:y}=s,{details:E}=c,A=this.altAudio?void 0:s.audio;if(this.fragContextChanged(u)){this.fragmentTracker.removeFragment(u);return}if(this.state=Ce.PARSING,y){const S=y.tracks;if(S){const C=u.initSegment||u;if(this.unhandledEncryptionError(y,u))return;this._bufferInitSegment(c,S,C,r),n.trigger(P.FRAG_PARSING_INIT_SEGMENT,{frag:C,id:t,tracks:S})}const x=y.initPTS,M=y.timescale,b=this.initPTS[u.cc];if(Ye(x)&&(!b||b.baseTime!==x||b.timescale!==M)){const C=y.trackId;this.initPTS[u.cc]={baseTime:x,timescale:M,trackId:C},n.trigger(P.INIT_PTS_FOUND,{frag:u,id:t,initPTS:x,timescale:M,trackId:C})}}if(d&&E){A&&d.type==="audiovideo"&&this.logMuxedErr(u);const S=E.fragments[u.sn-1-E.startSN],x=u.sn===E.startSN,M=!S||u.cc>S.cc;if(s.independent!==!1){const{startPTS:b,endPTS:C,startDTS:N,endDTS:U}=d;if(f)f.elementaryStreams[d.type]={startPTS:b,endPTS:C,startDTS:N,endDTS:U};else if(d.firstKeyFrame&&d.independent&&r.id===1&&!M&&(this.couldBacktrack=!0),d.dropped&&d.independent){const w=this.getMainFwdBufferInfo(),O=(w?w.end:this.getLoadPosition())+this.config.maxBufferHole,L=d.firstKeyFramePTS?d.firstKeyFramePTS:b;if(!x&&O<L-this.config.maxBufferHole&&!M){this.backtrack(u);return}else M&&(u.gap=!0);u.setElementaryStreamInfo(d.type,u.start,C,u.start,U,!0)}else x&&b-(E.appliedTimelineOffset||0)>dd&&(u.gap=!0);u.setElementaryStreamInfo(d.type,b,C,N,U),this.backtrackFragment&&(this.backtrackFragment=u),this.bufferFragmentData(d,u,f,r,x||M)}else if(x||M)u.gap=!0;else{this.backtrack(u);return}}if(A){const{startPTS:S,endPTS:x,startDTS:M,endDTS:b}=A;f&&(f.elementaryStreams[vn.AUDIO]={startPTS:S,endPTS:x,startDTS:M,endDTS:b}),u.setElementaryStreamInfo(vn.AUDIO,S,x,M,b),this.bufferFragmentData(A,u,f,r)}if(E&&m!=null&&m.samples.length){const S={id:t,frag:u,details:E,samples:m.samples};n.trigger(P.FRAG_PARSING_METADATA,S)}if(E&&p){const S={id:t,frag:u,details:E,samples:p.samples};n.trigger(P.FRAG_PARSING_USERDATA,S)}}logMuxedErr(e){this.warn(`${Nn(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,n,s){if(this.state!==Ce.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(n));const{audio:r,video:a,audiovideo:u}=t;if(r){const c=e.audioCodec;let d=rd(r.codec,c);d==="mp4a"&&(d="mp4a.40.5");const p=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){d&&(d.indexOf("mp4a.40.5")!==-1?d="mp4a.40.2":d="mp4a.40.5");const m=r.metadata;m&&"channelCount"in m&&(m.channelCount||1)!==1&&p.indexOf("firefox")===-1&&(d="mp4a.40.5")}d&&d.indexOf("mp4a.40.5")!==-1&&p.indexOf("android")!==-1&&r.container!=="audio/mpeg"&&(d="mp4a.40.2",this.log(`Android: force audio codec to ${d}`)),c&&c!==d&&this.log(`Swapping manifest audio codec "${c}" for "${d}"`),r.levelCodec=d,r.id=et.MAIN,this.log(`Init audio buffer, container:${r.container}, codecs[selected/level/parsed]=[${d||""}/${c||""}/${r.codec}]`),delete t.audiovideo}if(a){a.levelCodec=e.videoCodec,a.id=et.MAIN;const c=a.codec;if((c==null?void 0:c.length)===4)switch(c){case"hvc1":case"hev1":a.codec="hvc1.1.6.L120.90";break;case"av01":a.codec="av01.0.04M.08";break;case"avc1":a.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${a.container}, codecs[level/parsed]=[${e.videoCodec||""}/${c}]${a.codec!==c?" parsed-corrected="+a.codec:""}${a.supplemental?" supplemental="+a.supplemental:""}`),delete t.audiovideo}u&&(this.log(`Init audiovideo buffer, container:${u.container}, codecs[level/parsed]=[${e.codecs}/${u.codec}]`),delete t.video,delete t.audio);const f=Object.keys(t);if(f.length){if(this.hls.trigger(P.BUFFER_CODECS,t),!this.hls)return;f.forEach(c=>{const p=t[c].initSegment;p!=null&&p.byteLength&&this.hls.trigger(P.BUFFER_APPENDING,{type:c,data:p,frag:n,part:null,chunkMeta:s,parent:n.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,et.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,n=e==null?void 0:e[t];return n?this.getMaxBufferLength(n.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=Ce.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const n=e.currentTime;if(xt.isBuffered(e,n)?t=this.getAppendedFrag(n):xt.isBuffered(e,n+.1)&&(t=this.getAppendedFrag(n+.1)),t){this.backtrackFragment=null;const s=this.fragPlaying,r=t.level;(!s||t.sn!==s.sn||s.level!==r)&&(this.fragPlaying=t,this.hls.trigger(P.FRAG_CHANGED,{frag:t}),(!s||s.level!==r)&&this.hls.trigger(P.LEVEL_SWITCHED,{level:r}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return Ye(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(Ye(t)){const n=this.getLevelDetails(),s=this.currentFrag||(n?ia(null,n.fragments,t):null);if(s){const r=s.programDateTime;if(r!==null){const a=r+(t-s.start)*1e3;return new Date(a)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class B3 extends ms{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const n in this.keyIdToKeyInfo){const s=this.keyIdToKeyInfo[n].loader;if(s){var t;if(e&&e!==((t=s.context)==null?void 0:t.frag.type))return;s.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=ce.KEY_LOAD_ERROR,n,s,r){return new _r({type:lt.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:r,error:n,networkDetails:s})}loadClear(e,t,n){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let s=0,r=t.length;s<r;s++){const a=t[s];if(e.cc<=a.cc&&(!Nn(e)||!Nn(a)||e.sn<a.sn)||!n&&s==r-1)return this.emeController.selectKeySystemFormat(a).then(u=>{if(!this.emeController)return;a.setKeyFormat(u);const f=ad(u);if(f)return this.emeController.getKeySystemAccess([f])})}if(this.config.requireKeySystemAccessOnStart){const s=Uu(this.config);if(s.length)return this.emeController.getKeySystemAccess(s)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var n,s;t&&e.setKeyFormat(t);const r=e.decryptdata;if(!r){const c=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,ce.KEY_LOAD_ERROR,c))}const a=r.uri;if(!a)return Promise.reject(this.createKeyLoadError(e,ce.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${a}"`)));const u=Nm(r);let f=this.keyIdToKeyInfo[u];if((n=f)!=null&&n.decryptdata.key)return r.key=f.decryptdata.key,Promise.resolve({frag:e,keyInfo:f});if(this.emeController&&(s=f)!=null&&s.keyLoadPromise)switch(this.emeController.getKeyStatus(f.decryptdata)){case"usable":case"usable-in-future":return f.keyLoadPromise.then(d=>{const{keyInfo:p}=d;return r.key=p.decryptdata.key,{frag:e,keyInfo:p}})}switch(this.log(`${this.keyIdToKeyInfo[u]?"Rel":"L"}oading${r.keyId?" keyId: "+ui(r.keyId):""} URI: ${r.uri} from ${e.type} ${e.level}`),f=this.keyIdToKeyInfo[u]={decryptdata:r,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},r.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return r.keyFormat==="identity"?this.loadKeyHTTP(f,e):this.loadKeyEME(f,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(f,e);default:return Promise.reject(this.createKeyLoadError(e,ce.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${r.method}"`)))}}loadKeyEME(e,t){const n={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var s;if(!e.decryptdata.keyId&&(s=t.initSegment)!=null&&s.data){const a=sF(t.initSegment.data);if(a.length){let u=a[0];u.some(f=>f!==0)?(this.log(`Using keyId found in init segment ${ui(u)}`),ho.setKeyIdForUri(e.decryptdata.uri,u)):(u=ho.addKeyIdForUri(e.decryptdata.uri),this.log(`Generating keyId to patch media ${ui(u)}`)),e.decryptdata.keyId=u}}if(!e.decryptdata.keyId&&!Nn(t))return Promise.resolve(n);const r=this.emeController.loadKey(n);return(e.keyLoadPromise=r.then(a=>(e.mediaKeySessionContext=a,n))).catch(a=>{throw e.keyLoadPromise=null,"data"in a&&(a.data.frag=t),a})}return Promise.resolve(n)}loadKeyHTTP(e,t){const n=this.config,s=n.loader,r=new s(n);return t.keyLoader=e.loader=r,e.keyLoadPromise=new Promise((a,u)=>{const f={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},c=n.keyLoadPolicy.default,d={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(m,y,E,A)=>{const{frag:S,keyInfo:x}=E,M=Nm(x.decryptdata);if(!S.decryptdata||x!==this.keyIdToKeyInfo[M])return u(this.createKeyLoadError(S,ce.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),A));x.decryptdata.key=S.decryptdata.key=new Uint8Array(m.data),S.keyLoader=null,x.loader=null,a({frag:S,keyInfo:x})},onError:(m,y,E,A)=>{this.resetLoader(y),u(this.createKeyLoadError(t,ce.KEY_LOAD_ERROR,new Error(`HTTP Error ${m.code} loading key ${m.text}`),E,on({url:f.url,data:void 0},m)))},onTimeout:(m,y,E)=>{this.resetLoader(y),u(this.createKeyLoadError(t,ce.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),E))},onAbort:(m,y,E)=>{this.resetLoader(y),u(this.createKeyLoadError(t,ce.INTERNAL_ABORTED,new Error("key loading aborted"),E))}};r.load(f,d,p)})}resetLoader(e){const{frag:t,keyInfo:n,url:s}=e,r=n.loader;t.keyLoader===r&&(t.keyLoader=null,n.loader=null);const a=Nm(n.decryptdata)||s;delete this.keyIdToKeyInfo[a],r&&r.destroy()}}function Nm(i){if(i.keyFormat!==ci.FAIRPLAY){const e=i.keyId;if(e)return ui(e)}return i.uri}function aA(i){const{type:e}=i;switch(e){case Nt.AUDIO_TRACK:return et.AUDIO;case Nt.SUBTITLE_TRACK:return et.SUBTITLE;default:return et.MAIN}}function Um(i,e){let t=i.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class G3{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(P.MANIFEST_LOADING,this.onManifestLoading,this),e.on(P.LEVEL_LOADING,this.onLevelLoading,this),e.on(P.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(P.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(P.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(P.MANIFEST_LOADING,this.onManifestLoading,this),e.off(P.LEVEL_LOADING,this.onLevelLoading,this),e.off(P.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(P.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(P.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,n=t.pLoader,s=t.loader,r=n||s,a=new r(t);return this.loaders[e.type]=a,a}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:n}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Nt.MANIFEST,url:n,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:n,level:s,pathwayId:r,url:a,deliveryDirectives:u,levelInfo:f}=t;this.load({id:n,level:s,pathwayId:r,responseType:"text",type:Nt.LEVEL,url:a,deliveryDirectives:u,levelOrTrack:f})}onAudioTrackLoading(e,t){const{id:n,groupId:s,url:r,deliveryDirectives:a,track:u}=t;this.load({id:n,groupId:s,level:null,responseType:"text",type:Nt.AUDIO_TRACK,url:r,deliveryDirectives:a,levelOrTrack:u})}onSubtitleTrackLoading(e,t){const{id:n,groupId:s,url:r,deliveryDirectives:a,track:u}=t;this.load({id:n,groupId:s,level:null,responseType:"text",type:Nt.SUBTITLE_TRACK,url:r,deliveryDirectives:a,levelOrTrack:u})}onLevelsUpdated(e,t){const n=this.loaders[Nt.LEVEL];if(n){const s=n.context;s&&!t.levels.some(r=>r===s.levelOrTrack)&&(n.abort(),delete this.loaders[Nt.LEVEL])}}load(e){var t;const n=this.hls.config;let s=this.getInternalLoader(e);if(s){const c=this.hls.logger,d=s.context;if(d&&d.levelOrTrack===e.levelOrTrack&&(d.url===e.url||d.deliveryDirectives&&!e.deliveryDirectives)){d.url===e.url?c.log(`[playlist-loader]: ignore ${e.url} ongoing request`):c.log(`[playlist-loader]: ignore ${e.url} in favor of ${d.url}`);return}c.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),s.abort()}let r;if(e.type===Nt.MANIFEST?r=n.manifestLoadPolicy.default:r=pn({},n.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),s=this.createInternalLoader(e),Ye((t=e.deliveryDirectives)==null?void 0:t.part)){let c;if(e.type===Nt.LEVEL&&e.level!==null?c=this.hls.levels[e.level].details:e.type===Nt.AUDIO_TRACK&&e.id!==null?c=this.hls.audioTracks[e.id].details:e.type===Nt.SUBTITLE_TRACK&&e.id!==null&&(c=this.hls.subtitleTracks[e.id].details),c){const d=c.partTarget,p=c.targetduration;if(d&&p){const m=Math.max(d*3,p*.8)*1e3;r=pn({},r,{maxTimeToFirstByteMs:Math.min(m,r.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(m,r.maxTimeToFirstByteMs)})}}}const a=r.errorRetry||r.timeoutRetry||{},u={loadPolicy:r,timeout:r.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},f={onSuccess:(c,d,p,m)=>{const y=this.getInternalLoader(p);this.resetInternalLoader(p.type);const E=c.data;d.parsing.start=performance.now(),Vs.isMediaPlaylist(E)||p.type!==Nt.MANIFEST?this.handleTrackOrLevelPlaylist(c,d,p,m||null,y):this.handleMasterPlaylist(c,d,p,m)},onError:(c,d,p,m)=>{this.handleNetworkError(d,p,!1,c,m)},onTimeout:(c,d,p)=>{this.handleNetworkError(d,p,!0,void 0,c)}};s.load(e,u,f)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:n}=this.hls;(e||n)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,n,s){const r=this.hls,a=e.data,u=Um(e,n),f=Vs.parseMasterPlaylist(a,u);if(f.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,n,f.playlistParsingError,s,t);return}const{contentSteering:c,levels:d,sessionData:p,sessionKeys:m,startTimeOffset:y,variableList:E}=f;this.variableList=E,d.forEach(M=>{const{unknownCodecs:b}=M;if(b){const{preferManagedMediaSource:C}=this.hls.config;let{audioCodec:N,videoCodec:U}=M;for(let w=b.length;w--;){const O=b[w];zu(O,"audio",C)?(M.audioCodec=N=N?`${N},${O}`:O,Tl.audio[N.substring(0,4)]=2,b.splice(w,1)):zu(O,"video",C)&&(M.videoCodec=U=U?`${U},${O}`:O,Tl.video[U.substring(0,4)]=2,b.splice(w,1))}}});const{AUDIO:A=[],SUBTITLES:S,"CLOSED-CAPTIONS":x}=Vs.parseMasterPlaylistMedia(a,u,f);A.length&&!A.some(b=>!b.url)&&d[0].audioCodec&&!d[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),A.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Rn({}),bitrate:0,url:""})),r.trigger(P.MANIFEST_LOADED,{levels:d,audioTracks:A,subtitles:S,captions:x,contentSteering:c,url:u,stats:t,networkDetails:s,sessionData:p,sessionKeys:m,startTimeOffset:y,variableList:E})}handleTrackOrLevelPlaylist(e,t,n,s,r){const a=this.hls,{id:u,level:f,type:c}=n,d=Um(e,n),p=Ye(f)?f:Ye(u)?u:0,m=aA(n),y=Vs.parseLevelPlaylist(e.data,d,p,m,0,this.variableList);if(c===Nt.MANIFEST){const E={attrs:new Rn({}),bitrate:0,details:y,name:"",url:d};y.requestScheduled=t.loading.start+wb(y,0),a.trigger(P.MANIFEST_LOADED,{levels:[E],audioTracks:[],url:d,stats:t,networkDetails:s,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),n.levelDetails=y,this.handlePlaylistLoaded(y,e,t,n,s,r)}handleManifestParsingError(e,t,n,s,r){this.hls.trigger(P.ERROR,{type:lt.NETWORK_ERROR,details:ce.MANIFEST_PARSING_ERROR,fatal:t.type===Nt.MANIFEST,url:e.url,err:n,error:n,reason:n.message,response:e,context:t,networkDetails:s,stats:r})}handleNetworkError(e,t,n=!1,s,r){let a=`A network ${n?"timeout":"error"+(s?" (status "+s.code+")":"")} occurred while loading ${e.type}`;e.type===Nt.LEVEL?a+=`: ${e.level} id: ${e.id}`:(e.type===Nt.AUDIO_TRACK||e.type===Nt.SUBTITLE_TRACK)&&(a+=` id: ${e.id} group-id: "${e.groupId}"`);const u=new Error(a);this.hls.logger.warn(`[playlist-loader]: ${a}`);let f=ce.UNKNOWN,c=!1;const d=this.getInternalLoader(e);switch(e.type){case Nt.MANIFEST:f=n?ce.MANIFEST_LOAD_TIMEOUT:ce.MANIFEST_LOAD_ERROR,c=!0;break;case Nt.LEVEL:f=n?ce.LEVEL_LOAD_TIMEOUT:ce.LEVEL_LOAD_ERROR,c=!1;break;case Nt.AUDIO_TRACK:f=n?ce.AUDIO_TRACK_LOAD_TIMEOUT:ce.AUDIO_TRACK_LOAD_ERROR,c=!1;break;case Nt.SUBTITLE_TRACK:f=n?ce.SUBTITLE_TRACK_LOAD_TIMEOUT:ce.SUBTITLE_LOAD_ERROR,c=!1;break}d&&this.resetInternalLoader(e.type);const p={type:lt.NETWORK_ERROR,details:f,fatal:c,url:e.url,loader:d,context:e,error:u,networkDetails:t,stats:r};if(s){const m=(t==null?void 0:t.url)||e.url;p.response=on({url:m,data:void 0},s)}this.hls.trigger(P.ERROR,p)}handlePlaylistLoaded(e,t,n,s,r,a){const u=this.hls,{type:f,level:c,levelOrTrack:d,id:p,groupId:m,deliveryDirectives:y}=s,E=Um(t,s),A=aA(s);let S=typeof s.level=="number"&&A===et.MAIN?c:void 0;const x=e.playlistParsingError;if(x){if(this.hls.logger.warn(`${x} ${e.url}`),!u.config.ignorePlaylistParsingErrors){u.trigger(P.ERROR,{type:lt.NETWORK_ERROR,details:ce.LEVEL_PARSING_ERROR,fatal:!1,url:E,error:x,reason:x.message,response:t,context:s,level:S,parent:A,networkDetails:r,stats:n});return}e.playlistParsingError=null}if(!e.fragments.length){const M=e.playlistParsingError=new Error("No Segments found in Playlist");u.trigger(P.ERROR,{type:lt.NETWORK_ERROR,details:ce.LEVEL_EMPTY_ERROR,fatal:!1,url:E,error:M,reason:M.message,response:t,context:s,level:S,parent:A,networkDetails:r,stats:n});return}switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),(!a.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),f){case Nt.MANIFEST:case Nt.LEVEL:if(S){if(!d)S=0;else if(d!==u.levels[S]){const M=u.levels.indexOf(d);M>-1&&(S=M)}}u.trigger(P.LEVEL_LOADED,{details:e,levelInfo:d||u.levels[0],level:S||0,id:p||0,stats:n,networkDetails:r,deliveryDirectives:y,withoutMultiVariant:f===Nt.MANIFEST});break;case Nt.AUDIO_TRACK:u.trigger(P.AUDIO_TRACK_LOADED,{details:e,track:d,id:p||0,groupId:m||"",stats:n,networkDetails:r,deliveryDirectives:y});break;case Nt.SUBTITLE_TRACK:u.trigger(P.SUBTITLE_TRACK_LOADED,{details:e,track:d,id:p||0,groupId:m||"",stats:n,networkDetails:r,deliveryDirectives:y});break}}}class Sr{static get version(){return Wu}static isMSESupported(){return DM()}static isSupported(){return U3()}static getMediaSource(){return go()}static get Events(){return P}static get MetadataSchema(){return Zi}static get ErrorTypes(){return lt}static get ErrorDetails(){return ce}static get DefaultConfig(){return Sr.defaultConfig?Sr.defaultConfig:x3}static set DefaultConfig(e){Sr.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Z0,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=WO(e.debug||!1,"Hls instance",e.assetPlayerId),n=this.config=R3(Sr.DefaultConfig,e,t);this.userConfig=e,n.progressive&&b3(n,t);const{abrController:s,bufferController:r,capLevelController:a,errorController:u,fpsController:f}=n,c=new u(this),d=this.abrController=new s(this),p=new VF(this),m=n.interstitialsController,y=m?this.interstitialsController=new m(this,Sr):null,E=this.bufferController=new r(this,p),A=this.capLevelController=new a(this),S=new f(this),x=new G3(this),M=n.contentSteeringController,b=M?new M(this):null,C=this.levelController=new N3(this,b),N=new w3(this),U=new B3(this.config,this.logger),w=this.streamController=new k3(this,p,U),O=this.gapController=new L3(this,p);A.setStreamController(w),S.setStreamController(w);const L=[x,C,w];y&&L.splice(1,0,y),b&&L.splice(1,0,b),this.networkControllers=L;const I=[d,E,O,A,S,N,p];this.audioTrackController=this.createController(n.audioTrackController,L);const F=n.audioStreamController;F&&L.push(this.audioStreamController=new F(this,p,U)),this.subtitleTrackController=this.createController(n.subtitleTrackController,L);const X=n.subtitleStreamController;X&&L.push(this.subtititleStreamController=new X(this,p,U)),this.createController(n.timelineController,I),U.emeController=this.emeController=this.createController(n.emeController,I),this.cmcdController=this.createController(n.cmcdController,I),this.latencyController=this.createController(P3,I),this.coreComponents=I,L.push(c);const Y=c.onErrorOut;typeof Y=="function"&&this.on(P.ERROR,Y,c),this.on(P.MANIFEST_LOADED,x.onManifestLoaded,x)}createController(e,t){if(e){const n=new e(this);return t&&t.push(n),n}return null}on(e,t,n=this){this._emitter.on(e,t,n)}once(e,t,n=this){this._emitter.once(e,t,n)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,n=this,s){this._emitter.off(e,t,n,s)}listeners(e){return this._emitter.listeners(e)}emit(e,t,n){return this._emitter.emit(e,t,n)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(n){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+n.message+'". Here is a stacktrace:',n),!this.triggeringException){this.triggeringException=!0;const s=e===P.ERROR;this.trigger(P.ERROR,{type:lt.OTHER_ERROR,details:ce.INTERNAL_EXCEPTION,fatal:s,event:e,error:n}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(P.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const r=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(P.ERROR,{type:lt.OTHER_ERROR,details:ce.ATTACH_MEDIA_ERROR,fatal:!0,error:r});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,n=t?e.media:e,s=t?e:{media:n};this._media=n,this.trigger(P.MEDIA_ATTACHING,s)}detachMedia(){this.logger.log("detachMedia"),this.trigger(P.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(P.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,n=this._url,s=this._url=V0.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${s}`),t&&n&&(n!==s||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(P.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let n=0;n<this.networkControllers.length&&(this.networkControllers[n].startLoad(e,t),!(!this.started||!this.networkControllers));n++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[et.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[et.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[et.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e==null?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=LB()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){RF(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const n=e.length;for(let s=0;s<n;s++)if(e[s].maxBitrate>=t)return s;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:n}=this;let s;if(t===-1&&e!=null&&e.length?s=e.length-1:s=t,n)for(let r=s;r--;){const a=e[r].attrs["HDCP-LEVEL"];if(a&&a<=n)return r}return s}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const n=vb(t);return mb(e,n,navigator.mediaCapabilities)}}Sr.defaultConfig=void 0;const V3=({currentCue:i,eyePrefix:e})=>i?z.jsx("div",{className:"absolute bottom-[20%] w-full text-center px-8 pointer-events-auto transform translate-z-20",children:z.jsx("div",{className:"inline-block px-6 py-4 rounded-2xl",children:z.jsx("p",{className:"text-3xl md:text-4xl font-bold leading-relaxed text-yellow-300 tracking-wide font-sans",children:i.parsedWords.map((t,n)=>{const s=t.replace(/[.,/#!$%^&*;:{}=\-_`~()]/g,""),r=`${e}-word-${n}`;return z.jsx("span",{id:r,className:"mx-1 px-1.5 py-0.5 rounded-md transition-all duration-150 hover:bg-white/20 hover:text-white hover:scale-110 cursor-crosshair inline-block",style:{textShadow:"2px 2px 0 #000, -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000",WebkitTextStroke:"1px black"},"data-word":s,"data-sentence":i.text,children:t},n)})})})}):null,H3=25,lA=-1e3,z3=-50,$3=100,q3=120,W3=240,K3=15,Y3=({mediaRef:i,isPlaying:e,hitObjectsRef:t})=>{const[n,s]=ke.useState([]),r=ke.useRef(null),a=ke.useRef(null),u=ke.useRef(null),f=ke.useRef(null),c=ke.useRef(0),d=ke.useRef([]),p=ke.useRef(0),m=ke.useRef(0);ke.useEffect(()=>{if(!(!i.current||r.current)){try{const A=window.AudioContext||window.webkitAudioContext,S=new A,x=S.createAnalyser();x.fftSize=256;const M=S.createMediaElementSource(i.current);M.connect(x),x.connect(S.destination),r.current=S,a.current=x,u.current=M,f.current=new Uint8Array(x.frequencyBinCount)}catch(A){console.warn("Audio Context setup failed (likely CORS or user interaction required):",A)}return()=>{}}},[i]),ke.useEffect(()=>{var A;e&&((A=r.current)==null?void 0:A.state)==="suspended"&&r.current.resume()},[e]);const y=ke.useCallback(()=>{if(!e){c.current=requestAnimationFrame(y);return}if(m.current++,a.current&&f.current){a.current.getByteFrequencyData(f.current);let S=0;for(let M=0;M<5;M++)S+=f.current[M];if(S/5>W3&&m.current-p.current>K3){const M=Math.floor(Math.random()*4),b={id:`note-${Date.now()}-${Math.random()}`,lane:M,spawnTime:Date.now(),z:lA,isHit:!1};d.current.push(b),p.current=m.current}}const A=[];d.current.forEach(S=>{S.z+=H3,t.current.has(S.id)&&(S.isHit=!0),S.z<$3&&!S.isHit&&A.push(S)}),d.current=A,s([...d.current]),c.current=requestAnimationFrame(y)},[e,t]);ke.useEffect(()=>(c.current=requestAnimationFrame(y),()=>{c.current&&cancelAnimationFrame(c.current)}),[y]);const E=A=>(A-1.5)*q3;return z.jsxs("div",{className:"absolute inset-0 pointer-events-none",style:{transformStyle:"preserve-3d"},children:[z.jsx("div",{className:"absolute inset-0 flex items-center justify-center",style:{transform:"rotateX(90deg) translateZ(-150px)"},children:z.jsxs("div",{className:"relative w-[500px] h-[2000px] bg-gradient-to-b from-indigo-900/40 to-black/0",children:[[0,1,2,3,4].map(A=>z.jsx("div",{className:"absolute h-full w-[2px] bg-indigo-500/30",style:{left:`${A*25}%`}},A)),z.jsx("div",{className:"absolute w-full h-[4px] bg-emerald-400 box-shadow-[0_0_15px_#34d399]",style:{top:"80%"}})," "]})}),z.jsx("div",{className:"absolute inset-0 flex items-center justify-center",style:{transform:`translateZ(${z3}px)`},children:z.jsx("div",{className:"w-[500px] h-[150px] border-x-4 border-emerald-500/10 rounded-xl"})}),n.map(A=>(Math.min(1,Math.max(0,1-Math.abs(A.z-lA)/200)),z.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-auto",style:{transform:`translate3d(${E(A.lane)}px, 0, ${A.z}px)`},children:z.jsx("div",{id:A.id,className:"w-20 h-20 rounded-xl border-2 border-white/50 cursor-crosshair group relative transition-transform",style:{backgroundColor:A.lane%2===0?"rgba(6, 182, 212, 0.6)":"rgba(236, 72, 153, 0.6)",boxShadow:A.lane%2===0?"0 0 20px cyan":"0 0 20px hotpink"},"data-note-id":A.id,"data-game-note":"true",children:z.jsx("div",{className:"absolute inset-2 bg-white/80 rounded-lg animate-pulse"})})},A.id)))]})},Zu={zh:{appTitle:"VR ",appDesc:" VR ",addVideo:"",addLink:" (m3u8/mp4)",addSubs:"",subsLoaded:"",settings:"",language:" / Language",displayMode:"",magicWindow:"",magicWindowDesc:" 360 ",vrHeadset:"VR ",vrHeadsetDesc:"Cardboard / ",screenType:"",cinema:"",cinemaDesc:"",imax:"IMAX ",imaxDesc:"",videoFormat:"",format2D:"2D ",format3DSBS:"3D ",format3DTB:"3D ",formatVR180:"VR 180 ()",formatVR360:"VR 360 ()",formatHint:" VR  3D ",vrCalibration:"VR ",profile:"",custom:"...",ipd:" (IPD) ",vertical:"",scale:"",cancel:"",launch:"",playbackSettings:"",configExperience:" VR ",translating:"...",unknown:"",error:"",usage:"",close:"",instructions:" VR ",demoVideo:"Big Buck Bunny ()",defaultProfile:" ()",cardboardV1:"Cardboard V1 ()",cardboardV2:"Cardboard V2 ()",boxLarge:" VR ",boxSmall:" VR ",recenter:"",urlPlaceholder:" .m3u8, .mp4 ",linkTitle:"",calibrationMode:"",calibrationInstruct:"",play:"",pause:"",controlsHelp:" ",gameMode:"",gameModeDesc:"",score:"",combo:"",mediaType:"",audioVisualizer:"",gamepadSettings:"",actionClick:" / ",actionRecenter:"",actionPlayPause:" / ",actionSeekBack:" 5",actionSeekFwd:" 5",actionMoveLeft:"",actionMoveRight:"",actionMoveUp:"",actionMoveDown:"",actionVolUp:" +",actionVolDown:" -",pressButton:"...",waitingForInput:"...",button:"",resetDefaults:"",delete:"",viewMode:"",viewNormal:"",viewVR:"VR ",fov:"",stereoMode:"3D ",stereoNone:"2D ()",stereoSBS:" (SBS)",stereoTB:" (TB)",controlMode:"",controlSensor:" ()",controlTouch:" ()",sourceLocal:"",sourceNetwork:"",edit:"",editItem:"",save:"",replaceFile:"",enterVR:" VR ",enterVRDesc:"",thumbnail:"",downloadCover:"",uploadCover:"",dragAxis:"",dragFree:" ()",dragHorizontal:" ()",fullscreen:"",libraryView:"",dataManagement:"",exportData:"",importData:"",clearData:"",exitVR:" VR",dataImported:"",dataCleared:"",typeAudio:"",typeVideo:"",ccLoaded:"",addCC:""},en:{appTitle:"VR LinguaGlance",appDesc:"Immersive Language Learning Player",addVideo:"Local Media",addLink:"Web Link (m3u8/mp4)",addSubs:"Upload SRT",subsLoaded:"SRT Loaded",settings:"Settings",language:"Language / ",displayMode:"Display Mode",magicWindow:"Magic Window",magicWindowDesc:"Handheld 360",vrHeadset:"VR Headset",vrHeadsetDesc:"Cardboard / Box",screenType:"Screen Type",cinema:"Cinema",cinemaDesc:"Standard Flat",imax:"IMAX",imaxDesc:"Immersive Large",videoFormat:"Video Format",format2D:"2D Standard",format3DSBS:"3D Side-by-Side",format3DTB:"3D Top-Bottom",formatVR180:"VR 180",formatVR360:"VR 360",formatHint:"Select 3D format if playing native VR video file.",vrCalibration:"Headset Calibration",profile:"Phone / Viewer Profile",custom:"Custom Configuration...",ipd:"IPD (Horizontal Shift)",vertical:"Vertical Offset",scale:"Screen Scale (Zoom)",cancel:"Cancel",launch:"Launch",playbackSettings:"Playback Settings",configExperience:"Configure your VR experience",translating:"Translating...",unknown:"Unknown",error:"Error",usage:"Context",close:"Close",instructions:"Gaze at words to translate in VR mode.",demoVideo:"Big Buck Bunny (Demo)",defaultProfile:"Default (Balanced)",cardboardV1:"Cardboard V1 (Small)",cardboardV2:"Cardboard V2 (Large)",boxLarge:"Large VR Box",boxSmall:"Small VR Box",recenter:"Recenter View",urlPlaceholder:"Enter .m3u8, .mp4 or video URL",linkTitle:"Link Title",calibrationMode:"Calibration Mode",calibrationInstruct:"Position head comfortably forward, then press CONFIRM/A or TAP SCREEN.",play:"Play",pause:"Pause",controlsHelp:" Configure Bluetooth Gamepad in Settings",gameMode:"Rhythm Game",gameModeDesc:"Words fly at you. Gaze to catch them!",score:"Score",combo:"Combo",mediaType:"Media Type",audioVisualizer:"Audio Visualizer",gamepadSettings:"Bluetooth Controller",actionClick:"Confirm / Click",actionRecenter:"Recenter View",actionPlayPause:"Play / Pause",actionSeekBack:"Seek Back 5s",actionSeekFwd:"Seek Fwd 5s",actionMoveLeft:"Look Left",actionMoveRight:"Look Right",actionMoveUp:"Look Up",actionMoveDown:"Look Down",actionVolUp:"Volume +",actionVolDown:"Volume -",pressButton:"Press Button...",waitingForInput:"Listening...",button:"Button",resetDefaults:"Reset Defaults",delete:"Delete",viewMode:"View Mode",viewNormal:"Standard Flat",viewVR:"VR Immersive",fov:"Field of View",stereoMode:"3D Format",stereoNone:"2D (None)",stereoSBS:"Side-by-Side",stereoTB:"Top-Bottom",controlMode:"Control Method",controlSensor:"Gyroscope (Sensor)",controlTouch:"Touch Swipe (Manual)",sourceLocal:"Local",sourceNetwork:"Web",edit:"Edit",editItem:"Edit Item",save:"Save",replaceFile:"Replace Video File",enterVR:"Enter VR Mode",enterVRDesc:"Switch to Landscape Stereo",thumbnail:"Thumbnail",downloadCover:"Download Cover",uploadCover:"Upload Cover",dragAxis:"Drag Axis",dragFree:"Free (All Directions)",dragHorizontal:"Horizontal Only",fullscreen:"Fullscreen",libraryView:"Library View",dataManagement:"Data Management",exportData:"Export Config",importData:"Import Config",clearData:"Clear All Data",exitVR:"Exit VR",dataImported:"Data Imported",dataCleared:"Data Cleared",typeAudio:"Audio",typeVideo:"Video",ccLoaded:"CC Loaded",addCC:"+ Subtitles"}},X3=({definition:i,isLoading:e,language:t})=>{const n=Zu[t];return!i&&!e?null:z.jsx("div",{className:"absolute top-1/4 left-1/2 transform -translate-x-1/2 w-3/4 md:w-1/2 bg-slate-900/90 border border-emerald-500/50 text-white p-4 rounded-xl shadow-2xl backdrop-blur-md z-40 transition-all duration-300 animate-in fade-in slide-in-from-bottom-4",children:e?z.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[z.jsx("div",{className:"w-5 h-5 border-2 border-emerald-400 border-t-transparent rounded-full animate-spin"}),z.jsx("span",{className:"text-emerald-400 font-mono text-sm",children:n.translating})]}):i&&z.jsxs("div",{className:"text-center",children:[z.jsxs("h3",{className:"text-xl font-bold text-emerald-400 capitalize mb-1",children:[i.word,z.jsx("span",{className:"text-xs text-slate-400 ml-2 font-normal border border-slate-600 rounded px-1",children:i.type})]}),z.jsxs("p",{className:"text-slate-300 italic text-sm mb-2",children:["/",i.pronunciation,"/"]}),z.jsx("p",{className:"text-lg font-medium mb-2",children:i.translation}),i.contextUsage&&z.jsxs("p",{className:"text-xs text-slate-400 border-t border-slate-700 pt-2 mt-2",children:['"',i.contextUsage,'"']})]})})},J3=({isHovering:i,progress:e})=>{const r=17*Math.PI,a=r-e*r;return z.jsxs("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 pointer-events-none z-50 flex items-center justify-center",children:[z.jsxs("svg",{width:20,height:20,className:`transition-all duration-200 ${i?"scale-150":"scale-100"}`,children:[z.jsx("circle",{stroke:"rgba(255,255,255,0.3)",strokeWidth:3,fill:"transparent",r:8.5,cx:20/2,cy:20/2}),z.jsx("circle",{stroke:"#10b981",strokeWidth:3,fill:"transparent",r:8.5,cx:20/2,cy:20/2,strokeDasharray:`${r} ${r}`,strokeDashoffset:a,className:"transition-all duration-75",transform:`rotate(-90 ${20/2} ${20/2})`})]}),z.jsx("div",{className:`absolute bg-white rounded-full transition-all duration-200 ${i?"w-1 h-1":"w-2 h-2"}`})]})};/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const fv="173",Q3=0,uA=1,Z3=2,wM=1,j3=2,yr=3,yo=0,Fi=1,Tr=2,po=0,_l=1,cA=2,fA=3,dA=4,eG=5,Zo=100,tG=101,nG=102,iG=103,sG=104,rG=200,oG=201,aG=202,lG=203,$g=204,qg=205,uG=206,cG=207,fG=208,dG=209,hG=210,pG=211,mG=212,gG=213,vG=214,Wg=0,Kg=1,Yg=2,Al=3,Xg=4,Jg=5,Qg=6,Zg=7,PM=0,yG=1,_G=2,mo=0,EG=1,SG=2,TG=3,xG=4,AG=5,RG=6,bG=7,NM=300,Rl=301,bl=302,jg=303,e0=304,Jd=306,t0=1e3,ea=1001,n0=1002,Is=1003,MG=1004,Nf=1005,Oi=1006,Om=1007,ta=1008,Mr=1009,UM=1010,OM=1011,Ju=1012,dv=1013,sa=1014,xr=1015,ju=1016,hv=1017,pv=1018,Ml=1020,FM=35902,kM=1021,BM=1022,bs=1023,GM=1024,VM=1025,El=1026,Cl=1027,HM=1028,mv=1029,zM=1030,gv=1031,vv=1033,hd=33776,pd=33777,md=33778,gd=33779,i0=35840,s0=35841,r0=35842,o0=35843,a0=36196,l0=37492,u0=37496,c0=37808,f0=37809,d0=37810,h0=37811,p0=37812,m0=37813,g0=37814,v0=37815,y0=37816,_0=37817,E0=37818,S0=37819,T0=37820,x0=37821,vd=36492,A0=36494,R0=36495,$M=36283,b0=36284,M0=36285,C0=36286,CG=3200,IG=3201,LG=0,DG=1,fo="",Qi="srgb",Il="srgb-linear",Od="linear",dn="srgb",qa=7680,hA=519,wG=512,PG=513,NG=514,qM=515,UG=516,OG=517,FG=518,kG=519,pA=35044,mA="300 es",Ar=2e3,Fd=2001;class Nl{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){const n=this._listeners;return n===void 0?!1:n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){const n=this._listeners;if(n===void 0)return;const s=n[e];if(s!==void 0){const r=s.indexOf(t);r!==-1&&s.splice(r,1)}}dispatchEvent(e){const t=this._listeners;if(t===void 0)return;const n=t[e.type];if(n!==void 0){e.target=this;const s=n.slice(0);for(let r=0,a=s.length;r<a;r++)s[r].call(this,e);e.target=null}}}const hi=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let gA=1234567;const Gu=Math.PI/180,Qu=180/Math.PI;function Ul(){const i=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(hi[i&255]+hi[i>>8&255]+hi[i>>16&255]+hi[i>>24&255]+"-"+hi[e&255]+hi[e>>8&255]+"-"+hi[e>>16&15|64]+hi[e>>24&255]+"-"+hi[t&63|128]+hi[t>>8&255]+"-"+hi[t>>16&255]+hi[t>>24&255]+hi[n&255]+hi[n>>8&255]+hi[n>>16&255]+hi[n>>24&255]).toLowerCase()}function Vt(i,e,t){return Math.max(e,Math.min(t,i))}function yv(i,e){return(i%e+e)%e}function BG(i,e,t,n,s){return n+(i-e)*(s-n)/(t-e)}function GG(i,e,t){return i!==e?(t-i)/(e-i):0}function Vu(i,e,t){return(1-t)*i+t*e}function VG(i,e,t,n){return Vu(i,e,1-Math.exp(-t*n))}function HG(i,e=1){return e-Math.abs(yv(i,e*2)-e)}function zG(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e),i*i*(3-2*i))}function $G(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e),i*i*i*(i*(i*6-15)+10))}function qG(i,e){return i+Math.floor(Math.random()*(e-i+1))}function WG(i,e){return i+Math.random()*(e-i)}function KG(i){return i*(.5-Math.random())}function YG(i){i!==void 0&&(gA=i);let e=gA+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function XG(i){return i*Gu}function JG(i){return i*Qu}function QG(i){return(i&i-1)===0&&i!==0}function ZG(i){return Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function jG(i){return Math.pow(2,Math.floor(Math.log(i)/Math.LN2))}function eV(i,e,t,n,s){const r=Math.cos,a=Math.sin,u=r(t/2),f=a(t/2),c=r((e+n)/2),d=a((e+n)/2),p=r((e-n)/2),m=a((e-n)/2),y=r((n-e)/2),E=a((n-e)/2);switch(s){case"XYX":i.set(u*d,f*p,f*m,u*c);break;case"YZY":i.set(f*m,u*d,f*p,u*c);break;case"ZXZ":i.set(f*p,f*m,u*d,u*c);break;case"XZX":i.set(u*d,f*E,f*y,u*c);break;case"YXY":i.set(f*y,u*d,f*E,u*c);break;case"ZYZ":i.set(f*E,f*y,u*d,u*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function al(i,e){switch(e.constructor){case Float32Array:return i;case Uint32Array:return i/4294967295;case Uint16Array:return i/65535;case Uint8Array:return i/255;case Int32Array:return Math.max(i/2147483647,-1);case Int16Array:return Math.max(i/32767,-1);case Int8Array:return Math.max(i/127,-1);default:throw new Error("Invalid component type.")}}function _i(i,e){switch(e.constructor){case Float32Array:return i;case Uint32Array:return Math.round(i*4294967295);case Uint16Array:return Math.round(i*65535);case Uint8Array:return Math.round(i*255);case Int32Array:return Math.round(i*2147483647);case Int16Array:return Math.round(i*32767);case Int8Array:return Math.round(i*127);default:throw new Error("Invalid component type.")}}const vA={DEG2RAD:Gu,RAD2DEG:Qu,generateUUID:Ul,clamp:Vt,euclideanModulo:yv,mapLinear:BG,inverseLerp:GG,lerp:Vu,damp:VG,pingpong:HG,smoothstep:zG,smootherstep:$G,randInt:qG,randFloat:WG,randFloatSpread:KG,seededRandom:YG,degToRad:XG,radToDeg:JG,isPowerOfTwo:QG,ceilPowerOfTwo:ZG,floorPowerOfTwo:jG,setQuaternionFromProperEuler:eV,normalize:_i,denormalize:al};class _n{constructor(e=0,t=0){_n.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,s=e.elements;return this.x=s[0]*t+s[3]*n+s[6],this.y=s[1]*t+s[4]*n+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Vt(this.x,e.x,t.x),this.y=Vt(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=Vt(this.x,e,t),this.y=Vt(this.y,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Vt(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Vt(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),s=Math.sin(t),r=this.x-e.x,a=this.y-e.y;return this.x=r*n-a*s+e.x,this.y=r*s+a*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Lt{constructor(e,t,n,s,r,a,u,f,c){Lt.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,n,s,r,a,u,f,c)}set(e,t,n,s,r,a,u,f,c){const d=this.elements;return d[0]=e,d[1]=s,d[2]=u,d[3]=t,d[4]=r,d[5]=f,d[6]=n,d[7]=a,d[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,s=t.elements,r=this.elements,a=n[0],u=n[3],f=n[6],c=n[1],d=n[4],p=n[7],m=n[2],y=n[5],E=n[8],A=s[0],S=s[3],x=s[6],M=s[1],b=s[4],C=s[7],N=s[2],U=s[5],w=s[8];return r[0]=a*A+u*M+f*N,r[3]=a*S+u*b+f*U,r[6]=a*x+u*C+f*w,r[1]=c*A+d*M+p*N,r[4]=c*S+d*b+p*U,r[7]=c*x+d*C+p*w,r[2]=m*A+y*M+E*N,r[5]=m*S+y*b+E*U,r[8]=m*x+y*C+E*w,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],s=e[2],r=e[3],a=e[4],u=e[5],f=e[6],c=e[7],d=e[8];return t*a*d-t*u*c-n*r*d+n*u*f+s*r*c-s*a*f}invert(){const e=this.elements,t=e[0],n=e[1],s=e[2],r=e[3],a=e[4],u=e[5],f=e[6],c=e[7],d=e[8],p=d*a-u*c,m=u*f-d*r,y=c*r-a*f,E=t*p+n*m+s*y;if(E===0)return this.set(0,0,0,0,0,0,0,0,0);const A=1/E;return e[0]=p*A,e[1]=(s*c-d*n)*A,e[2]=(u*n-s*a)*A,e[3]=m*A,e[4]=(d*t-s*f)*A,e[5]=(s*r-u*t)*A,e[6]=y*A,e[7]=(n*f-c*t)*A,e[8]=(a*t-n*r)*A,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,s,r,a,u){const f=Math.cos(r),c=Math.sin(r);return this.set(n*f,n*c,-n*(f*a+c*u)+a+e,-s*c,s*f,-s*(-c*a+f*u)+u+t,0,0,1),this}scale(e,t){return this.premultiply(Fm.makeScale(e,t)),this}rotate(e){return this.premultiply(Fm.makeRotation(-e)),this}translate(e,t){return this.premultiply(Fm.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let s=0;s<9;s++)if(t[s]!==n[s])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const Fm=new Lt;function WM(i){for(let e=i.length-1;e>=0;--e)if(i[e]>=65535)return!0;return!1}function kd(i){return document.createElementNS("http://www.w3.org/1999/xhtml",i)}function tV(){const i=kd("canvas");return i.style.display="block",i}const yA={};function ll(i){i in yA||(yA[i]=!0,console.warn(i))}function nV(i,e,t){return new Promise(function(n,s){function r(){switch(i.clientWaitSync(e,i.SYNC_FLUSH_COMMANDS_BIT,0)){case i.WAIT_FAILED:s();break;case i.TIMEOUT_EXPIRED:setTimeout(r,t);break;default:n()}}setTimeout(r,t)})}function iV(i){const e=i.elements;e[2]=.5*e[2]+.5*e[3],e[6]=.5*e[6]+.5*e[7],e[10]=.5*e[10]+.5*e[11],e[14]=.5*e[14]+.5*e[15]}function sV(i){const e=i.elements;e[11]===-1?(e[10]=-e[10]-1,e[14]=-e[14]):(e[10]=-e[10],e[14]=-e[14]+1)}const _A=new Lt().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),EA=new Lt().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function rV(){const i={enabled:!0,workingColorSpace:Il,spaces:{},convert:function(s,r,a){return this.enabled===!1||r===a||!r||!a||(this.spaces[r].transfer===dn&&(s.r=Rr(s.r),s.g=Rr(s.g),s.b=Rr(s.b)),this.spaces[r].primaries!==this.spaces[a].primaries&&(s.applyMatrix3(this.spaces[r].toXYZ),s.applyMatrix3(this.spaces[a].fromXYZ)),this.spaces[a].transfer===dn&&(s.r=Sl(s.r),s.g=Sl(s.g),s.b=Sl(s.b))),s},fromWorkingColorSpace:function(s,r){return this.convert(s,this.workingColorSpace,r)},toWorkingColorSpace:function(s,r){return this.convert(s,r,this.workingColorSpace)},getPrimaries:function(s){return this.spaces[s].primaries},getTransfer:function(s){return s===fo?Od:this.spaces[s].transfer},getLuminanceCoefficients:function(s,r=this.workingColorSpace){return s.fromArray(this.spaces[r].luminanceCoefficients)},define:function(s){Object.assign(this.spaces,s)},_getMatrix:function(s,r,a){return s.copy(this.spaces[r].toXYZ).multiply(this.spaces[a].fromXYZ)},_getDrawingBufferColorSpace:function(s){return this.spaces[s].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(s=this.workingColorSpace){return this.spaces[s].workingColorSpaceConfig.unpackColorSpace}},e=[.64,.33,.3,.6,.15,.06],t=[.2126,.7152,.0722],n=[.3127,.329];return i.define({[Il]:{primaries:e,whitePoint:n,transfer:Od,toXYZ:_A,fromXYZ:EA,luminanceCoefficients:t,workingColorSpaceConfig:{unpackColorSpace:Qi},outputColorSpaceConfig:{drawingBufferColorSpace:Qi}},[Qi]:{primaries:e,whitePoint:n,transfer:dn,toXYZ:_A,fromXYZ:EA,luminanceCoefficients:t,outputColorSpaceConfig:{drawingBufferColorSpace:Qi}}}),i}const Qt=rV();function Rr(i){return i<.04045?i*.0773993808:Math.pow(i*.9478672986+.0521327014,2.4)}function Sl(i){return i<.0031308?i*12.92:1.055*Math.pow(i,.41666)-.055}let Wa;class oV{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{Wa===void 0&&(Wa=kd("canvas")),Wa.width=e.width,Wa.height=e.height;const n=Wa.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=Wa}return t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=kd("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const s=n.getImageData(0,0,e.width,e.height),r=s.data;for(let a=0;a<r.length;a++)r[a]=Rr(r[a]/255)*255;return n.putImageData(s,0,0),t}else if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(Rr(t[n]/255)*255):t[n]=Rr(t[n]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let aV=0;class KM{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:aV++}),this.uuid=Ul(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},s=this.data;if(s!==null){let r;if(Array.isArray(s)){r=[];for(let a=0,u=s.length;a<u;a++)s[a].isDataTexture?r.push(km(s[a].image)):r.push(km(s[a]))}else r=km(s);n.url=r}return t||(e.images[this.uuid]=n),n}}function km(i){return typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&i instanceof ImageBitmap?oV.getDataURL(i):i.data?{data:Array.from(i.data),width:i.width,height:i.height,type:i.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let lV=0;class xi extends Nl{constructor(e=xi.DEFAULT_IMAGE,t=xi.DEFAULT_MAPPING,n=ea,s=ea,r=Oi,a=ta,u=bs,f=Mr,c=xi.DEFAULT_ANISOTROPY,d=fo){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:lV++}),this.uuid=Ul(),this.name="",this.source=new KM(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=s,this.magFilter=r,this.minFilter=a,this.anisotropy=c,this.format=u,this.internalFormat=null,this.type=f,this.offset=new _n(0,0),this.repeat=new _n(1,1),this.center=new _n(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Lt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=d,this.userData={},this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==NM)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case t0:e.x=e.x-Math.floor(e.x);break;case ea:e.x=e.x<0?0:1;break;case n0:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case t0:e.y=e.y-Math.floor(e.y);break;case ea:e.y=e.y<0?0:1;break;case n0:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}xi.DEFAULT_IMAGE=null;xi.DEFAULT_MAPPING=NM;xi.DEFAULT_ANISOTROPY=1;class Un{constructor(e=0,t=0,n=0,s=1){Un.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,s){return this.x=e,this.y=t,this.z=n,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,s=this.z,r=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*s+a[12]*r,this.y=a[1]*t+a[5]*n+a[9]*s+a[13]*r,this.z=a[2]*t+a[6]*n+a[10]*s+a[14]*r,this.w=a[3]*t+a[7]*n+a[11]*s+a[15]*r,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,s,r;const f=e.elements,c=f[0],d=f[4],p=f[8],m=f[1],y=f[5],E=f[9],A=f[2],S=f[6],x=f[10];if(Math.abs(d-m)<.01&&Math.abs(p-A)<.01&&Math.abs(E-S)<.01){if(Math.abs(d+m)<.1&&Math.abs(p+A)<.1&&Math.abs(E+S)<.1&&Math.abs(c+y+x-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const b=(c+1)/2,C=(y+1)/2,N=(x+1)/2,U=(d+m)/4,w=(p+A)/4,O=(E+S)/4;return b>C&&b>N?b<.01?(n=0,s=.707106781,r=.707106781):(n=Math.sqrt(b),s=U/n,r=w/n):C>N?C<.01?(n=.707106781,s=0,r=.707106781):(s=Math.sqrt(C),n=U/s,r=O/s):N<.01?(n=.707106781,s=.707106781,r=0):(r=Math.sqrt(N),n=w/r,s=O/r),this.set(n,s,r,t),this}let M=Math.sqrt((S-E)*(S-E)+(p-A)*(p-A)+(m-d)*(m-d));return Math.abs(M)<.001&&(M=1),this.x=(S-E)/M,this.y=(p-A)/M,this.z=(m-d)/M,this.w=Math.acos((c+y+x-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Vt(this.x,e.x,t.x),this.y=Vt(this.y,e.y,t.y),this.z=Vt(this.z,e.z,t.z),this.w=Vt(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=Vt(this.x,e,t),this.y=Vt(this.y,e,t),this.z=Vt(this.z,e,t),this.w=Vt(this.w,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Vt(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class uV extends Nl{constructor(e=1,t=1,n={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Un(0,0,e,t),this.scissorTest=!1,this.viewport=new Un(0,0,e,t);const s={width:e,height:t,depth:1};n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Oi,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},n);const r=new xi(s,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace);r.flipY=!1,r.generateMipmaps=n.generateMipmaps,r.internalFormat=n.internalFormat,this.textures=[];const a=n.count;for(let u=0;u<a;u++)this.textures[u]=r.clone(),this.textures[u].isRenderTargetTexture=!0,this.textures[u].renderTarget=this;this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=n.depthTexture,this.samples=n.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let s=0,r=this.textures.length;s<r;s++)this.textures[s].image.width=e,this.textures[s].image.height=t,this.textures[s].image.depth=n;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let n=0,s=e.textures.length;n<s;n++)this.textures[n]=e.textures[n].clone(),this.textures[n].isRenderTargetTexture=!0,this.textures[n].renderTarget=this;const t=Object.assign({},e.texture.image);return this.texture.source=new KM(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class ra extends uV{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}}class YM extends xi{constructor(e=null,t=1,n=1,s=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:s},this.magFilter=Is,this.minFilter=Is,this.wrapR=ea,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class cV extends xi{constructor(e=null,t=1,n=1,s=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:s},this.magFilter=Is,this.minFilter=Is,this.wrapR=ea,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class ec{constructor(e=0,t=0,n=0,s=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=s}static slerpFlat(e,t,n,s,r,a,u){let f=n[s+0],c=n[s+1],d=n[s+2],p=n[s+3];const m=r[a+0],y=r[a+1],E=r[a+2],A=r[a+3];if(u===0){e[t+0]=f,e[t+1]=c,e[t+2]=d,e[t+3]=p;return}if(u===1){e[t+0]=m,e[t+1]=y,e[t+2]=E,e[t+3]=A;return}if(p!==A||f!==m||c!==y||d!==E){let S=1-u;const x=f*m+c*y+d*E+p*A,M=x>=0?1:-1,b=1-x*x;if(b>Number.EPSILON){const N=Math.sqrt(b),U=Math.atan2(N,x*M);S=Math.sin(S*U)/N,u=Math.sin(u*U)/N}const C=u*M;if(f=f*S+m*C,c=c*S+y*C,d=d*S+E*C,p=p*S+A*C,S===1-u){const N=1/Math.sqrt(f*f+c*c+d*d+p*p);f*=N,c*=N,d*=N,p*=N}}e[t]=f,e[t+1]=c,e[t+2]=d,e[t+3]=p}static multiplyQuaternionsFlat(e,t,n,s,r,a){const u=n[s],f=n[s+1],c=n[s+2],d=n[s+3],p=r[a],m=r[a+1],y=r[a+2],E=r[a+3];return e[t]=u*E+d*p+f*y-c*m,e[t+1]=f*E+d*m+c*p-u*y,e[t+2]=c*E+d*y+u*m-f*p,e[t+3]=d*E-u*p-f*m-c*y,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,s){return this._x=e,this._y=t,this._z=n,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const n=e._x,s=e._y,r=e._z,a=e._order,u=Math.cos,f=Math.sin,c=u(n/2),d=u(s/2),p=u(r/2),m=f(n/2),y=f(s/2),E=f(r/2);switch(a){case"XYZ":this._x=m*d*p+c*y*E,this._y=c*y*p-m*d*E,this._z=c*d*E+m*y*p,this._w=c*d*p-m*y*E;break;case"YXZ":this._x=m*d*p+c*y*E,this._y=c*y*p-m*d*E,this._z=c*d*E-m*y*p,this._w=c*d*p+m*y*E;break;case"ZXY":this._x=m*d*p-c*y*E,this._y=c*y*p+m*d*E,this._z=c*d*E+m*y*p,this._w=c*d*p-m*y*E;break;case"ZYX":this._x=m*d*p-c*y*E,this._y=c*y*p+m*d*E,this._z=c*d*E-m*y*p,this._w=c*d*p+m*y*E;break;case"YZX":this._x=m*d*p+c*y*E,this._y=c*y*p+m*d*E,this._z=c*d*E-m*y*p,this._w=c*d*p-m*y*E;break;case"XZY":this._x=m*d*p-c*y*E,this._y=c*y*p-m*d*E,this._z=c*d*E+m*y*p,this._w=c*d*p+m*y*E;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,s=Math.sin(n);return this._x=e.x*s,this._y=e.y*s,this._z=e.z*s,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],s=t[4],r=t[8],a=t[1],u=t[5],f=t[9],c=t[2],d=t[6],p=t[10],m=n+u+p;if(m>0){const y=.5/Math.sqrt(m+1);this._w=.25/y,this._x=(d-f)*y,this._y=(r-c)*y,this._z=(a-s)*y}else if(n>u&&n>p){const y=2*Math.sqrt(1+n-u-p);this._w=(d-f)/y,this._x=.25*y,this._y=(s+a)/y,this._z=(r+c)/y}else if(u>p){const y=2*Math.sqrt(1+u-n-p);this._w=(r-c)/y,this._x=(s+a)/y,this._y=.25*y,this._z=(f+d)/y}else{const y=2*Math.sqrt(1+p-n-u);this._w=(a-s)/y,this._x=(r+c)/y,this._y=(f+d)/y,this._z=.25*y}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Vt(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const s=Math.min(1,t/n);return this.slerp(e,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,s=e._y,r=e._z,a=e._w,u=t._x,f=t._y,c=t._z,d=t._w;return this._x=n*d+a*u+s*c-r*f,this._y=s*d+a*f+r*u-n*c,this._z=r*d+a*c+n*f-s*u,this._w=a*d-n*u-s*f-r*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const n=this._x,s=this._y,r=this._z,a=this._w;let u=a*e._w+n*e._x+s*e._y+r*e._z;if(u<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,u=-u):this.copy(e),u>=1)return this._w=a,this._x=n,this._y=s,this._z=r,this;const f=1-u*u;if(f<=Number.EPSILON){const y=1-t;return this._w=y*a+t*this._w,this._x=y*n+t*this._x,this._y=y*s+t*this._y,this._z=y*r+t*this._z,this.normalize(),this}const c=Math.sqrt(f),d=Math.atan2(c,u),p=Math.sin((1-t)*d)/c,m=Math.sin(t*d)/c;return this._w=a*p+this._w*m,this._x=n*p+this._x*m,this._y=s*p+this._y*m,this._z=r*p+this._z*m,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),s=Math.sqrt(1-n),r=Math.sqrt(n);return this.set(s*Math.sin(e),s*Math.cos(e),r*Math.sin(t),r*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class xe{constructor(e=0,t=0,n=0){xe.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(SA.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(SA.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,s=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*s,this.y=r[1]*t+r[4]*n+r[7]*s,this.z=r[2]*t+r[5]*n+r[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,s=this.z,r=e.elements,a=1/(r[3]*t+r[7]*n+r[11]*s+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*s+r[12])*a,this.y=(r[1]*t+r[5]*n+r[9]*s+r[13])*a,this.z=(r[2]*t+r[6]*n+r[10]*s+r[14])*a,this}applyQuaternion(e){const t=this.x,n=this.y,s=this.z,r=e.x,a=e.y,u=e.z,f=e.w,c=2*(a*s-u*n),d=2*(u*t-r*s),p=2*(r*n-a*t);return this.x=t+f*c+a*p-u*d,this.y=n+f*d+u*c-r*p,this.z=s+f*p+r*d-a*c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,s=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*s,this.y=r[1]*t+r[5]*n+r[9]*s,this.z=r[2]*t+r[6]*n+r[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Vt(this.x,e.x,t.x),this.y=Vt(this.y,e.y,t.y),this.z=Vt(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=Vt(this.x,e,t),this.y=Vt(this.y,e,t),this.z=Vt(this.z,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Vt(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,s=e.y,r=e.z,a=t.x,u=t.y,f=t.z;return this.x=s*f-r*u,this.y=r*a-n*f,this.z=n*u-s*a,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return Bm.copy(this).projectOnVector(e),this.sub(Bm)}reflect(e){return this.sub(Bm.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Vt(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,s=this.z-e.z;return t*t+n*n+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const s=Math.sin(t)*e;return this.x=s*Math.sin(n),this.y=Math.cos(t)*e,this.z=s*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=s,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Bm=new xe,SA=new ec;class tc{constructor(e=new xe(1/0,1/0,1/0),t=new xe(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(Ss.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(Ss.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Ss.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(n!==void 0){const r=n.getAttribute("position");if(t===!0&&r!==void 0&&e.isInstancedMesh!==!0)for(let a=0,u=r.count;a<u;a++)e.isMesh===!0?e.getVertexPosition(a,Ss):Ss.fromBufferAttribute(r,a),Ss.applyMatrix4(e.matrixWorld),this.expandByPoint(Ss);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),Uf.copy(e.boundingBox)):(n.boundingBox===null&&n.computeBoundingBox(),Uf.copy(n.boundingBox)),Uf.applyMatrix4(e.matrixWorld),this.union(Uf)}const s=e.children;for(let r=0,a=s.length;r<a;r++)this.expandByObject(s[r],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,Ss),Ss.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Lu),Of.subVectors(this.max,Lu),Ka.subVectors(e.a,Lu),Ya.subVectors(e.b,Lu),Xa.subVectors(e.c,Lu),io.subVectors(Ya,Ka),so.subVectors(Xa,Ya),Ho.subVectors(Ka,Xa);let t=[0,-io.z,io.y,0,-so.z,so.y,0,-Ho.z,Ho.y,io.z,0,-io.x,so.z,0,-so.x,Ho.z,0,-Ho.x,-io.y,io.x,0,-so.y,so.x,0,-Ho.y,Ho.x,0];return!Gm(t,Ka,Ya,Xa,Of)||(t=[1,0,0,0,1,0,0,0,1],!Gm(t,Ka,Ya,Xa,Of))?!1:(Ff.crossVectors(io,so),t=[Ff.x,Ff.y,Ff.z],Gm(t,Ka,Ya,Xa,Of))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Ss).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Ss).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(hr[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),hr[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),hr[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),hr[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),hr[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),hr[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),hr[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),hr[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(hr),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const hr=[new xe,new xe,new xe,new xe,new xe,new xe,new xe,new xe],Ss=new xe,Uf=new tc,Ka=new xe,Ya=new xe,Xa=new xe,io=new xe,so=new xe,Ho=new xe,Lu=new xe,Of=new xe,Ff=new xe,zo=new xe;function Gm(i,e,t,n,s){for(let r=0,a=i.length-3;r<=a;r+=3){zo.fromArray(i,r);const u=s.x*Math.abs(zo.x)+s.y*Math.abs(zo.y)+s.z*Math.abs(zo.z),f=e.dot(zo),c=t.dot(zo),d=n.dot(zo);if(Math.max(-Math.max(f,c,d),Math.min(f,c,d))>u)return!1}return!0}const fV=new tc,Du=new xe,Vm=new xe;class _v{constructor(e=new xe,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;t!==void 0?n.copy(t):fV.setFromPoints(e).getCenter(n);let s=0;for(let r=0,a=e.length;r<a;r++)s=Math.max(s,n.distanceToSquared(e[r]));return this.radius=Math.sqrt(s),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Du.subVectors(e,this.center);const t=Du.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),s=(n-this.radius)*.5;this.center.addScaledVector(Du,s/n),this.radius+=s}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(Vm.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Du.copy(e.center).add(Vm)),this.expandByPoint(Du.copy(e.center).sub(Vm))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const pr=new xe,Hm=new xe,kf=new xe,ro=new xe,zm=new xe,Bf=new xe,$m=new xe;class dV{constructor(e=new xe,t=new xe(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,pr)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=pr.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(pr.copy(this.origin).addScaledVector(this.direction,t),pr.distanceToSquared(e))}distanceSqToSegment(e,t,n,s){Hm.copy(e).add(t).multiplyScalar(.5),kf.copy(t).sub(e).normalize(),ro.copy(this.origin).sub(Hm);const r=e.distanceTo(t)*.5,a=-this.direction.dot(kf),u=ro.dot(this.direction),f=-ro.dot(kf),c=ro.lengthSq(),d=Math.abs(1-a*a);let p,m,y,E;if(d>0)if(p=a*f-u,m=a*u-f,E=r*d,p>=0)if(m>=-E)if(m<=E){const A=1/d;p*=A,m*=A,y=p*(p+a*m+2*u)+m*(a*p+m+2*f)+c}else m=r,p=Math.max(0,-(a*m+u)),y=-p*p+m*(m+2*f)+c;else m=-r,p=Math.max(0,-(a*m+u)),y=-p*p+m*(m+2*f)+c;else m<=-E?(p=Math.max(0,-(-a*r+u)),m=p>0?-r:Math.min(Math.max(-r,-f),r),y=-p*p+m*(m+2*f)+c):m<=E?(p=0,m=Math.min(Math.max(-r,-f),r),y=m*(m+2*f)+c):(p=Math.max(0,-(a*r+u)),m=p>0?r:Math.min(Math.max(-r,-f),r),y=-p*p+m*(m+2*f)+c);else m=a>0?-r:r,p=Math.max(0,-(a*m+u)),y=-p*p+m*(m+2*f)+c;return n&&n.copy(this.origin).addScaledVector(this.direction,p),s&&s.copy(Hm).addScaledVector(kf,m),y}intersectSphere(e,t){pr.subVectors(e.center,this.origin);const n=pr.dot(this.direction),s=pr.dot(pr)-n*n,r=e.radius*e.radius;if(s>r)return null;const a=Math.sqrt(r-s),u=n-a,f=n+a;return f<0?null:u<0?this.at(f,t):this.at(u,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,s,r,a,u,f;const c=1/this.direction.x,d=1/this.direction.y,p=1/this.direction.z,m=this.origin;return c>=0?(n=(e.min.x-m.x)*c,s=(e.max.x-m.x)*c):(n=(e.max.x-m.x)*c,s=(e.min.x-m.x)*c),d>=0?(r=(e.min.y-m.y)*d,a=(e.max.y-m.y)*d):(r=(e.max.y-m.y)*d,a=(e.min.y-m.y)*d),n>a||r>s||((r>n||isNaN(n))&&(n=r),(a<s||isNaN(s))&&(s=a),p>=0?(u=(e.min.z-m.z)*p,f=(e.max.z-m.z)*p):(u=(e.max.z-m.z)*p,f=(e.min.z-m.z)*p),n>f||u>s)||((u>n||n!==n)&&(n=u),(f<s||s!==s)&&(s=f),s<0)?null:this.at(n>=0?n:s,t)}intersectsBox(e){return this.intersectBox(e,pr)!==null}intersectTriangle(e,t,n,s,r){zm.subVectors(t,e),Bf.subVectors(n,e),$m.crossVectors(zm,Bf);let a=this.direction.dot($m),u;if(a>0){if(s)return null;u=1}else if(a<0)u=-1,a=-a;else return null;ro.subVectors(this.origin,e);const f=u*this.direction.dot(Bf.crossVectors(ro,Bf));if(f<0)return null;const c=u*this.direction.dot(zm.cross(ro));if(c<0||f+c>a)return null;const d=-u*ro.dot($m);return d<0?null:this.at(d/a,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Hn{constructor(e,t,n,s,r,a,u,f,c,d,p,m,y,E,A,S){Hn.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,n,s,r,a,u,f,c,d,p,m,y,E,A,S)}set(e,t,n,s,r,a,u,f,c,d,p,m,y,E,A,S){const x=this.elements;return x[0]=e,x[4]=t,x[8]=n,x[12]=s,x[1]=r,x[5]=a,x[9]=u,x[13]=f,x[2]=c,x[6]=d,x[10]=p,x[14]=m,x[3]=y,x[7]=E,x[11]=A,x[15]=S,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Hn().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,s=1/Ja.setFromMatrixColumn(e,0).length(),r=1/Ja.setFromMatrixColumn(e,1).length(),a=1/Ja.setFromMatrixColumn(e,2).length();return t[0]=n[0]*s,t[1]=n[1]*s,t[2]=n[2]*s,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,s=e.y,r=e.z,a=Math.cos(n),u=Math.sin(n),f=Math.cos(s),c=Math.sin(s),d=Math.cos(r),p=Math.sin(r);if(e.order==="XYZ"){const m=a*d,y=a*p,E=u*d,A=u*p;t[0]=f*d,t[4]=-f*p,t[8]=c,t[1]=y+E*c,t[5]=m-A*c,t[9]=-u*f,t[2]=A-m*c,t[6]=E+y*c,t[10]=a*f}else if(e.order==="YXZ"){const m=f*d,y=f*p,E=c*d,A=c*p;t[0]=m+A*u,t[4]=E*u-y,t[8]=a*c,t[1]=a*p,t[5]=a*d,t[9]=-u,t[2]=y*u-E,t[6]=A+m*u,t[10]=a*f}else if(e.order==="ZXY"){const m=f*d,y=f*p,E=c*d,A=c*p;t[0]=m-A*u,t[4]=-a*p,t[8]=E+y*u,t[1]=y+E*u,t[5]=a*d,t[9]=A-m*u,t[2]=-a*c,t[6]=u,t[10]=a*f}else if(e.order==="ZYX"){const m=a*d,y=a*p,E=u*d,A=u*p;t[0]=f*d,t[4]=E*c-y,t[8]=m*c+A,t[1]=f*p,t[5]=A*c+m,t[9]=y*c-E,t[2]=-c,t[6]=u*f,t[10]=a*f}else if(e.order==="YZX"){const m=a*f,y=a*c,E=u*f,A=u*c;t[0]=f*d,t[4]=A-m*p,t[8]=E*p+y,t[1]=p,t[5]=a*d,t[9]=-u*d,t[2]=-c*d,t[6]=y*p+E,t[10]=m-A*p}else if(e.order==="XZY"){const m=a*f,y=a*c,E=u*f,A=u*c;t[0]=f*d,t[4]=-p,t[8]=c*d,t[1]=m*p+A,t[5]=a*d,t[9]=y*p-E,t[2]=E*p-y,t[6]=u*d,t[10]=A*p+m}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(hV,e,pV)}lookAt(e,t,n){const s=this.elements;return Wi.subVectors(e,t),Wi.lengthSq()===0&&(Wi.z=1),Wi.normalize(),oo.crossVectors(n,Wi),oo.lengthSq()===0&&(Math.abs(n.z)===1?Wi.x+=1e-4:Wi.z+=1e-4,Wi.normalize(),oo.crossVectors(n,Wi)),oo.normalize(),Gf.crossVectors(Wi,oo),s[0]=oo.x,s[4]=Gf.x,s[8]=Wi.x,s[1]=oo.y,s[5]=Gf.y,s[9]=Wi.y,s[2]=oo.z,s[6]=Gf.z,s[10]=Wi.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,s=t.elements,r=this.elements,a=n[0],u=n[4],f=n[8],c=n[12],d=n[1],p=n[5],m=n[9],y=n[13],E=n[2],A=n[6],S=n[10],x=n[14],M=n[3],b=n[7],C=n[11],N=n[15],U=s[0],w=s[4],O=s[8],L=s[12],I=s[1],F=s[5],X=s[9],Y=s[13],ee=s[2],ne=s[6],V=s[10],W=s[14],q=s[3],oe=s[7],he=s[11],G=s[15];return r[0]=a*U+u*I+f*ee+c*q,r[4]=a*w+u*F+f*ne+c*oe,r[8]=a*O+u*X+f*V+c*he,r[12]=a*L+u*Y+f*W+c*G,r[1]=d*U+p*I+m*ee+y*q,r[5]=d*w+p*F+m*ne+y*oe,r[9]=d*O+p*X+m*V+y*he,r[13]=d*L+p*Y+m*W+y*G,r[2]=E*U+A*I+S*ee+x*q,r[6]=E*w+A*F+S*ne+x*oe,r[10]=E*O+A*X+S*V+x*he,r[14]=E*L+A*Y+S*W+x*G,r[3]=M*U+b*I+C*ee+N*q,r[7]=M*w+b*F+C*ne+N*oe,r[11]=M*O+b*X+C*V+N*he,r[15]=M*L+b*Y+C*W+N*G,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],s=e[8],r=e[12],a=e[1],u=e[5],f=e[9],c=e[13],d=e[2],p=e[6],m=e[10],y=e[14],E=e[3],A=e[7],S=e[11],x=e[15];return E*(+r*f*p-s*c*p-r*u*m+n*c*m+s*u*y-n*f*y)+A*(+t*f*y-t*c*m+r*a*m-s*a*y+s*c*d-r*f*d)+S*(+t*c*p-t*u*y-r*a*p+n*a*y+r*u*d-n*c*d)+x*(-s*u*d-t*f*p+t*u*m+s*a*p-n*a*m+n*f*d)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=t,s[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],s=e[2],r=e[3],a=e[4],u=e[5],f=e[6],c=e[7],d=e[8],p=e[9],m=e[10],y=e[11],E=e[12],A=e[13],S=e[14],x=e[15],M=p*S*c-A*m*c+A*f*y-u*S*y-p*f*x+u*m*x,b=E*m*c-d*S*c-E*f*y+a*S*y+d*f*x-a*m*x,C=d*A*c-E*p*c+E*u*y-a*A*y-d*u*x+a*p*x,N=E*p*f-d*A*f-E*u*m+a*A*m+d*u*S-a*p*S,U=t*M+n*b+s*C+r*N;if(U===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/U;return e[0]=M*w,e[1]=(A*m*r-p*S*r-A*s*y+n*S*y+p*s*x-n*m*x)*w,e[2]=(u*S*r-A*f*r+A*s*c-n*S*c-u*s*x+n*f*x)*w,e[3]=(p*f*r-u*m*r-p*s*c+n*m*c+u*s*y-n*f*y)*w,e[4]=b*w,e[5]=(d*S*r-E*m*r+E*s*y-t*S*y-d*s*x+t*m*x)*w,e[6]=(E*f*r-a*S*r-E*s*c+t*S*c+a*s*x-t*f*x)*w,e[7]=(a*m*r-d*f*r+d*s*c-t*m*c-a*s*y+t*f*y)*w,e[8]=C*w,e[9]=(E*p*r-d*A*r-E*n*y+t*A*y+d*n*x-t*p*x)*w,e[10]=(a*A*r-E*u*r+E*n*c-t*A*c-a*n*x+t*u*x)*w,e[11]=(d*u*r-a*p*r-d*n*c+t*p*c+a*n*y-t*u*y)*w,e[12]=N*w,e[13]=(d*A*s-E*p*s+E*n*m-t*A*m-d*n*S+t*p*S)*w,e[14]=(E*u*s-a*A*s-E*n*f+t*A*f+a*n*S-t*u*S)*w,e[15]=(a*p*s-d*u*s+d*n*f-t*p*f-a*n*m+t*u*m)*w,this}scale(e){const t=this.elements,n=e.x,s=e.y,r=e.z;return t[0]*=n,t[4]*=s,t[8]*=r,t[1]*=n,t[5]*=s,t[9]*=r,t[2]*=n,t[6]*=s,t[10]*=r,t[3]*=n,t[7]*=s,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,s))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),s=Math.sin(t),r=1-n,a=e.x,u=e.y,f=e.z,c=r*a,d=r*u;return this.set(c*a+n,c*u-s*f,c*f+s*u,0,c*u+s*f,d*u+n,d*f-s*a,0,c*f-s*u,d*f+s*a,r*f*f+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,s,r,a){return this.set(1,n,r,0,e,1,a,0,t,s,1,0,0,0,0,1),this}compose(e,t,n){const s=this.elements,r=t._x,a=t._y,u=t._z,f=t._w,c=r+r,d=a+a,p=u+u,m=r*c,y=r*d,E=r*p,A=a*d,S=a*p,x=u*p,M=f*c,b=f*d,C=f*p,N=n.x,U=n.y,w=n.z;return s[0]=(1-(A+x))*N,s[1]=(y+C)*N,s[2]=(E-b)*N,s[3]=0,s[4]=(y-C)*U,s[5]=(1-(m+x))*U,s[6]=(S+M)*U,s[7]=0,s[8]=(E+b)*w,s[9]=(S-M)*w,s[10]=(1-(m+A))*w,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,t,n){const s=this.elements;let r=Ja.set(s[0],s[1],s[2]).length();const a=Ja.set(s[4],s[5],s[6]).length(),u=Ja.set(s[8],s[9],s[10]).length();this.determinant()<0&&(r=-r),e.x=s[12],e.y=s[13],e.z=s[14],Ts.copy(this);const c=1/r,d=1/a,p=1/u;return Ts.elements[0]*=c,Ts.elements[1]*=c,Ts.elements[2]*=c,Ts.elements[4]*=d,Ts.elements[5]*=d,Ts.elements[6]*=d,Ts.elements[8]*=p,Ts.elements[9]*=p,Ts.elements[10]*=p,t.setFromRotationMatrix(Ts),n.x=r,n.y=a,n.z=u,this}makePerspective(e,t,n,s,r,a,u=Ar){const f=this.elements,c=2*r/(t-e),d=2*r/(n-s),p=(t+e)/(t-e),m=(n+s)/(n-s);let y,E;if(u===Ar)y=-(a+r)/(a-r),E=-2*a*r/(a-r);else if(u===Fd)y=-a/(a-r),E=-a*r/(a-r);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+u);return f[0]=c,f[4]=0,f[8]=p,f[12]=0,f[1]=0,f[5]=d,f[9]=m,f[13]=0,f[2]=0,f[6]=0,f[10]=y,f[14]=E,f[3]=0,f[7]=0,f[11]=-1,f[15]=0,this}makeOrthographic(e,t,n,s,r,a,u=Ar){const f=this.elements,c=1/(t-e),d=1/(n-s),p=1/(a-r),m=(t+e)*c,y=(n+s)*d;let E,A;if(u===Ar)E=(a+r)*p,A=-2*p;else if(u===Fd)E=r*p,A=-1*p;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+u);return f[0]=2*c,f[4]=0,f[8]=0,f[12]=-m,f[1]=0,f[5]=2*d,f[9]=0,f[13]=-y,f[2]=0,f[6]=0,f[10]=A,f[14]=-E,f[3]=0,f[7]=0,f[11]=0,f[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let s=0;s<16;s++)if(t[s]!==n[s])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const Ja=new xe,Ts=new Hn,hV=new xe(0,0,0),pV=new xe(1,1,1),oo=new xe,Gf=new xe,Wi=new xe,TA=new Hn,xA=new ec;class Cr{constructor(e=0,t=0,n=0,s=Cr.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,s=this._order){return this._x=e,this._y=t,this._z=n,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const s=e.elements,r=s[0],a=s[4],u=s[8],f=s[1],c=s[5],d=s[9],p=s[2],m=s[6],y=s[10];switch(t){case"XYZ":this._y=Math.asin(Vt(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(-d,y),this._z=Math.atan2(-a,r)):(this._x=Math.atan2(m,c),this._z=0);break;case"YXZ":this._x=Math.asin(-Vt(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(u,y),this._z=Math.atan2(f,c)):(this._y=Math.atan2(-p,r),this._z=0);break;case"ZXY":this._x=Math.asin(Vt(m,-1,1)),Math.abs(m)<.9999999?(this._y=Math.atan2(-p,y),this._z=Math.atan2(-a,c)):(this._y=0,this._z=Math.atan2(f,r));break;case"ZYX":this._y=Math.asin(-Vt(p,-1,1)),Math.abs(p)<.9999999?(this._x=Math.atan2(m,y),this._z=Math.atan2(f,r)):(this._x=0,this._z=Math.atan2(-a,c));break;case"YZX":this._z=Math.asin(Vt(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(-d,c),this._y=Math.atan2(-p,r)):(this._x=0,this._y=Math.atan2(u,y));break;case"XZY":this._z=Math.asin(-Vt(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(m,c),this._y=Math.atan2(u,r)):(this._x=Math.atan2(-d,y),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return TA.makeRotationFromQuaternion(e),this.setFromRotationMatrix(TA,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return xA.setFromEuler(this),this.setFromQuaternion(xA,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Cr.DEFAULT_ORDER="XYZ";class XM{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let mV=0;const AA=new xe,Qa=new ec,mr=new Hn,Vf=new xe,wu=new xe,gV=new xe,vV=new ec,RA=new xe(1,0,0),bA=new xe(0,1,0),MA=new xe(0,0,1),CA={type:"added"},yV={type:"removed"},Za={type:"childadded",child:null},qm={type:"childremoved",child:null};class ts extends Nl{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:mV++}),this.uuid=Ul(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ts.DEFAULT_UP.clone();const e=new xe,t=new Cr,n=new ec,s=new xe(1,1,1);function r(){n.setFromEuler(t,!1)}function a(){t.setFromQuaternion(n,void 0,!1)}t._onChange(r),n._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new Hn},normalMatrix:{value:new Lt}}),this.matrix=new Hn,this.matrixWorld=new Hn,this.matrixAutoUpdate=ts.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=ts.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new XM,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Qa.setFromAxisAngle(e,t),this.quaternion.multiply(Qa),this}rotateOnWorldAxis(e,t){return Qa.setFromAxisAngle(e,t),this.quaternion.premultiply(Qa),this}rotateX(e){return this.rotateOnAxis(RA,e)}rotateY(e){return this.rotateOnAxis(bA,e)}rotateZ(e){return this.rotateOnAxis(MA,e)}translateOnAxis(e,t){return AA.copy(e).applyQuaternion(this.quaternion),this.position.add(AA.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(RA,e)}translateY(e){return this.translateOnAxis(bA,e)}translateZ(e){return this.translateOnAxis(MA,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(mr.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?Vf.copy(e):Vf.set(e,t,n);const s=this.parent;this.updateWorldMatrix(!0,!1),wu.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?mr.lookAt(wu,Vf,this.up):mr.lookAt(Vf,wu,this.up),this.quaternion.setFromRotationMatrix(mr),s&&(mr.extractRotation(s.matrixWorld),Qa.setFromRotationMatrix(mr),this.quaternion.premultiply(Qa.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(CA),Za.child=e,this.dispatchEvent(Za),Za.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(yV),qm.child=e,this.dispatchEvent(qm),qm.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),mr.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),mr.multiply(e.parent.matrixWorld)),e.applyMatrix4(mr),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(CA),Za.child=e,this.dispatchEvent(Za),Za.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,s=this.children.length;n<s;n++){const a=this.children[n].getObjectByProperty(e,t);if(a!==void 0)return a}}getObjectsByProperty(e,t,n=[]){this[e]===t&&n.push(this);const s=this.children;for(let r=0,a=s.length;r<a;r++)s[r].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(wu,e,gV),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(wu,vV,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,s=t.length;n<s;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,s=t.length;n<s;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,s=t.length;n<s;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){const n=this.parent;if(e===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const s=this.children;for(let r=0,a=s.length;r<a;r++)s[r].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(s.type="BatchedMesh",s.perObjectFrustumCulled=this.perObjectFrustumCulled,s.sortObjects=this.sortObjects,s.drawRanges=this._drawRanges,s.reservedRanges=this._reservedRanges,s.visibility=this._visibility,s.active=this._active,s.bounds=this._bounds.map(u=>({boxInitialized:u.boxInitialized,boxMin:u.box.min.toArray(),boxMax:u.box.max.toArray(),sphereInitialized:u.sphereInitialized,sphereRadius:u.sphere.radius,sphereCenter:u.sphere.center.toArray()})),s.maxInstanceCount=this._maxInstanceCount,s.maxVertexCount=this._maxVertexCount,s.maxIndexCount=this._maxIndexCount,s.geometryInitialized=this._geometryInitialized,s.geometryCount=this._geometryCount,s.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(s.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(s.boundingSphere={center:s.boundingSphere.center.toArray(),radius:s.boundingSphere.radius}),this.boundingBox!==null&&(s.boundingBox={min:s.boundingBox.min.toArray(),max:s.boundingBox.max.toArray()}));function r(u,f){return u[f.uuid]===void 0&&(u[f.uuid]=f.toJSON(e)),f.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=r(e.geometries,this.geometry);const u=this.geometry.parameters;if(u!==void 0&&u.shapes!==void 0){const f=u.shapes;if(Array.isArray(f))for(let c=0,d=f.length;c<d;c++){const p=f[c];r(e.shapes,p)}else r(e.shapes,f)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(e.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const u=[];for(let f=0,c=this.material.length;f<c;f++)u.push(r(e.materials,this.material[f]));s.material=u}else s.material=r(e.materials,this.material);if(this.children.length>0){s.children=[];for(let u=0;u<this.children.length;u++)s.children.push(this.children[u].toJSON(e).object)}if(this.animations.length>0){s.animations=[];for(let u=0;u<this.animations.length;u++){const f=this.animations[u];s.animations.push(r(e.animations,f))}}if(t){const u=a(e.geometries),f=a(e.materials),c=a(e.textures),d=a(e.images),p=a(e.shapes),m=a(e.skeletons),y=a(e.animations),E=a(e.nodes);u.length>0&&(n.geometries=u),f.length>0&&(n.materials=f),c.length>0&&(n.textures=c),d.length>0&&(n.images=d),p.length>0&&(n.shapes=p),m.length>0&&(n.skeletons=m),y.length>0&&(n.animations=y),E.length>0&&(n.nodes=E)}return n.object=s,n;function a(u){const f=[];for(const c in u){const d=u[c];delete d.metadata,f.push(d)}return f}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){const s=e.children[n];this.add(s.clone())}return this}}ts.DEFAULT_UP=new xe(0,1,0);ts.DEFAULT_MATRIX_AUTO_UPDATE=!0;ts.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const xs=new xe,gr=new xe,Wm=new xe,vr=new xe,ja=new xe,el=new xe,IA=new xe,Km=new xe,Ym=new xe,Xm=new xe,Jm=new Un,Qm=new Un,Zm=new Un;class Rs{constructor(e=new xe,t=new xe,n=new xe){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,s){s.subVectors(n,t),xs.subVectors(e,t),s.cross(xs);const r=s.lengthSq();return r>0?s.multiplyScalar(1/Math.sqrt(r)):s.set(0,0,0)}static getBarycoord(e,t,n,s,r){xs.subVectors(s,t),gr.subVectors(n,t),Wm.subVectors(e,t);const a=xs.dot(xs),u=xs.dot(gr),f=xs.dot(Wm),c=gr.dot(gr),d=gr.dot(Wm),p=a*c-u*u;if(p===0)return r.set(0,0,0),null;const m=1/p,y=(c*f-u*d)*m,E=(a*d-u*f)*m;return r.set(1-y-E,E,y)}static containsPoint(e,t,n,s){return this.getBarycoord(e,t,n,s,vr)===null?!1:vr.x>=0&&vr.y>=0&&vr.x+vr.y<=1}static getInterpolation(e,t,n,s,r,a,u,f){return this.getBarycoord(e,t,n,s,vr)===null?(f.x=0,f.y=0,"z"in f&&(f.z=0),"w"in f&&(f.w=0),null):(f.setScalar(0),f.addScaledVector(r,vr.x),f.addScaledVector(a,vr.y),f.addScaledVector(u,vr.z),f)}static getInterpolatedAttribute(e,t,n,s,r,a){return Jm.setScalar(0),Qm.setScalar(0),Zm.setScalar(0),Jm.fromBufferAttribute(e,t),Qm.fromBufferAttribute(e,n),Zm.fromBufferAttribute(e,s),a.setScalar(0),a.addScaledVector(Jm,r.x),a.addScaledVector(Qm,r.y),a.addScaledVector(Zm,r.z),a}static isFrontFacing(e,t,n,s){return xs.subVectors(n,t),gr.subVectors(e,t),xs.cross(gr).dot(s)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,s){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[s]),this}setFromAttributeAndIndices(e,t,n,s){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,s),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return xs.subVectors(this.c,this.b),gr.subVectors(this.a,this.b),xs.cross(gr).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Rs.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Rs.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,s,r){return Rs.getInterpolation(e,this.a,this.b,this.c,t,n,s,r)}containsPoint(e){return Rs.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Rs.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,s=this.b,r=this.c;let a,u;ja.subVectors(s,n),el.subVectors(r,n),Km.subVectors(e,n);const f=ja.dot(Km),c=el.dot(Km);if(f<=0&&c<=0)return t.copy(n);Ym.subVectors(e,s);const d=ja.dot(Ym),p=el.dot(Ym);if(d>=0&&p<=d)return t.copy(s);const m=f*p-d*c;if(m<=0&&f>=0&&d<=0)return a=f/(f-d),t.copy(n).addScaledVector(ja,a);Xm.subVectors(e,r);const y=ja.dot(Xm),E=el.dot(Xm);if(E>=0&&y<=E)return t.copy(r);const A=y*c-f*E;if(A<=0&&c>=0&&E<=0)return u=c/(c-E),t.copy(n).addScaledVector(el,u);const S=d*E-y*p;if(S<=0&&p-d>=0&&y-E>=0)return IA.subVectors(r,s),u=(p-d)/(p-d+(y-E)),t.copy(s).addScaledVector(IA,u);const x=1/(S+A+m);return a=A*x,u=m*x,t.copy(n).addScaledVector(ja,a).addScaledVector(el,u)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const JM={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ao={h:0,s:0,l:0},Hf={h:0,s:0,l:0};function jm(i,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?i+(e-i)*6*t:t<1/2?e:t<2/3?i+(e-i)*6*(2/3-t):i}class hn{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(t===void 0&&n===void 0){const s=e;s&&s.isColor?this.copy(s):typeof s=="number"?this.setHex(s):typeof s=="string"&&this.setStyle(s)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Qi){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Qt.toWorkingColorSpace(this,t),this}setRGB(e,t,n,s=Qt.workingColorSpace){return this.r=e,this.g=t,this.b=n,Qt.toWorkingColorSpace(this,s),this}setHSL(e,t,n,s=Qt.workingColorSpace){if(e=yv(e,1),t=Vt(t,0,1),n=Vt(n,0,1),t===0)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+t):n+t-n*t,a=2*n-r;this.r=jm(a,r,e+1/3),this.g=jm(a,r,e),this.b=jm(a,r,e-1/3)}return Qt.toWorkingColorSpace(this,s),this}setStyle(e,t=Qi){function n(r){r!==void 0&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let s;if(s=/^(\w+)\(([^\)]*)\)/.exec(e)){let r;const a=s[1],u=s[2];switch(a){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(u))return n(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,t);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(u))return n(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,t);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(u))return n(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(e)){const r=s[1],a=r.length;if(a===3)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,t);if(a===6)return this.setHex(parseInt(r,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Qi){const n=JM[e.toLowerCase()];return n!==void 0?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Rr(e.r),this.g=Rr(e.g),this.b=Rr(e.b),this}copyLinearToSRGB(e){return this.r=Sl(e.r),this.g=Sl(e.g),this.b=Sl(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Qi){return Qt.fromWorkingColorSpace(pi.copy(this),e),Math.round(Vt(pi.r*255,0,255))*65536+Math.round(Vt(pi.g*255,0,255))*256+Math.round(Vt(pi.b*255,0,255))}getHexString(e=Qi){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Qt.workingColorSpace){Qt.fromWorkingColorSpace(pi.copy(this),t);const n=pi.r,s=pi.g,r=pi.b,a=Math.max(n,s,r),u=Math.min(n,s,r);let f,c;const d=(u+a)/2;if(u===a)f=0,c=0;else{const p=a-u;switch(c=d<=.5?p/(a+u):p/(2-a-u),a){case n:f=(s-r)/p+(s<r?6:0);break;case s:f=(r-n)/p+2;break;case r:f=(n-s)/p+4;break}f/=6}return e.h=f,e.s=c,e.l=d,e}getRGB(e,t=Qt.workingColorSpace){return Qt.fromWorkingColorSpace(pi.copy(this),t),e.r=pi.r,e.g=pi.g,e.b=pi.b,e}getStyle(e=Qi){Qt.fromWorkingColorSpace(pi.copy(this),e);const t=pi.r,n=pi.g,s=pi.b;return e!==Qi?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${s.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(n*255)},${Math.round(s*255)})`}offsetHSL(e,t,n){return this.getHSL(ao),this.setHSL(ao.h+e,ao.s+t,ao.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(ao),e.getHSL(Hf);const n=Vu(ao.h,Hf.h,t),s=Vu(ao.s,Hf.s,t),r=Vu(ao.l,Hf.l,t);return this.setHSL(n,s,r),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,s=this.b,r=e.elements;return this.r=r[0]*t+r[3]*n+r[6]*s,this.g=r[1]*t+r[4]*n+r[7]*s,this.b=r[2]*t+r[5]*n+r[8]*s,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const pi=new hn;hn.NAMES=JM;let _V=0;class Qd extends Nl{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:_V++}),this.uuid=Ul(),this.name="",this.type="Material",this.blending=_l,this.side=yo,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=$g,this.blendDst=qg,this.blendEquation=Zo,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new hn(0,0,0),this.blendAlpha=0,this.depthFunc=Al,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=hA,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=qa,this.stencilZFail=qa,this.stencilZPass=qa,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const n=e[t];if(n===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const s=this[t];if(s===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}s&&s.isColor?s.set(n):s&&s.isVector3&&n&&n.isVector3?s.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(n.dispersion=this.dispersion),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapRotation!==void 0&&(n.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==_l&&(n.blending=this.blending),this.side!==yo&&(n.side=this.side),this.vertexColors===!0&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=!0),this.blendSrc!==$g&&(n.blendSrc=this.blendSrc),this.blendDst!==qg&&(n.blendDst=this.blendDst),this.blendEquation!==Zo&&(n.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(n.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(n.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==Al&&(n.depthFunc=this.depthFunc),this.depthTest===!1&&(n.depthTest=this.depthTest),this.depthWrite===!1&&(n.depthWrite=this.depthWrite),this.colorWrite===!1&&(n.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==hA&&(n.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(n.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==qa&&(n.stencilFail=this.stencilFail),this.stencilZFail!==qa&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==qa&&(n.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(n.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaHash===!0&&(n.alphaHash=!0),this.alphaToCoverage===!0&&(n.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=!0),this.forceSinglePass===!0&&(n.forceSinglePass=!0),this.wireframe===!0&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function s(r){const a=[];for(const u in r){const f=r[u];delete f.metadata,a.push(f)}return a}if(t){const r=s(e.textures),a=s(e.images);r.length>0&&(n.textures=r),a.length>0&&(n.images=a)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(t!==null){const s=t.length;n=new Array(s);for(let r=0;r!==s;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class Ev extends Qd{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new hn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Cr,this.combine=PM,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Vn=new xe,zf=new _n;let EV=0;class zs{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:EV++}),this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n,this.usage=pA,this.updateRanges=[],this.gpuType=xr,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let s=0,r=this.itemSize;s<r;s++)this.array[e+s]=t.array[n+s];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)zf.fromBufferAttribute(this,t),zf.applyMatrix3(e),this.setXY(t,zf.x,zf.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)Vn.fromBufferAttribute(this,t),Vn.applyMatrix3(e),this.setXYZ(t,Vn.x,Vn.y,Vn.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Vn.fromBufferAttribute(this,t),Vn.applyMatrix4(e),this.setXYZ(t,Vn.x,Vn.y,Vn.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Vn.fromBufferAttribute(this,t),Vn.applyNormalMatrix(e),this.setXYZ(t,Vn.x,Vn.y,Vn.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Vn.fromBufferAttribute(this,t),Vn.transformDirection(e),this.setXYZ(t,Vn.x,Vn.y,Vn.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=al(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=_i(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=al(t,this.array)),t}setX(e,t){return this.normalized&&(t=_i(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=al(t,this.array)),t}setY(e,t){return this.normalized&&(t=_i(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=al(t,this.array)),t}setZ(e,t){return this.normalized&&(t=_i(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=al(t,this.array)),t}setW(e,t){return this.normalized&&(t=_i(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=_i(t,this.array),n=_i(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,s){return e*=this.itemSize,this.normalized&&(t=_i(t,this.array),n=_i(n,this.array),s=_i(s,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=s,this}setXYZW(e,t,n,s,r){return e*=this.itemSize,this.normalized&&(t=_i(t,this.array),n=_i(n,this.array),s=_i(s,this.array),r=_i(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=s,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==pA&&(e.usage=this.usage),e}}class QM extends zs{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class ZM extends zs{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class $s extends zs{constructor(e,t,n){super(new Float32Array(e),t,n)}}let SV=0;const cs=new Hn,eg=new ts,tl=new xe,Ki=new tc,Pu=new tc,ti=new xe;class So extends Nl{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:SV++}),this.uuid=Ul(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(WM(e)?ZM:QM)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const r=new Lt().getNormalMatrix(e);n.applyNormalMatrix(r),n.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(e),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return cs.makeRotationFromQuaternion(e),this.applyMatrix4(cs),this}rotateX(e){return cs.makeRotationX(e),this.applyMatrix4(cs),this}rotateY(e){return cs.makeRotationY(e),this.applyMatrix4(cs),this}rotateZ(e){return cs.makeRotationZ(e),this.applyMatrix4(cs),this}translate(e,t,n){return cs.makeTranslation(e,t,n),this.applyMatrix4(cs),this}scale(e,t,n){return cs.makeScale(e,t,n),this.applyMatrix4(cs),this}lookAt(e){return eg.lookAt(e),eg.updateMatrix(),this.applyMatrix4(eg.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(tl).negate(),this.translate(tl.x,tl.y,tl.z),this}setFromPoints(e){const t=this.getAttribute("position");if(t===void 0){const n=[];for(let s=0,r=e.length;s<r;s++){const a=e[s];n.push(a.x,a.y,a.z||0)}this.setAttribute("position",new $s(n,3))}else{const n=Math.min(e.length,t.count);for(let s=0;s<n;s++){const r=e[s];t.setXYZ(s,r.x,r.y,r.z||0)}e.length>t.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new tc);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new xe(-1/0,-1/0,-1/0),new xe(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,s=t.length;n<s;n++){const r=t[n];Ki.setFromBufferAttribute(r),this.morphTargetsRelative?(ti.addVectors(this.boundingBox.min,Ki.min),this.boundingBox.expandByPoint(ti),ti.addVectors(this.boundingBox.max,Ki.max),this.boundingBox.expandByPoint(ti)):(this.boundingBox.expandByPoint(Ki.min),this.boundingBox.expandByPoint(Ki.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new _v);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new xe,1/0);return}if(e){const n=this.boundingSphere.center;if(Ki.setFromBufferAttribute(e),t)for(let r=0,a=t.length;r<a;r++){const u=t[r];Pu.setFromBufferAttribute(u),this.morphTargetsRelative?(ti.addVectors(Ki.min,Pu.min),Ki.expandByPoint(ti),ti.addVectors(Ki.max,Pu.max),Ki.expandByPoint(ti)):(Ki.expandByPoint(Pu.min),Ki.expandByPoint(Pu.max))}Ki.getCenter(n);let s=0;for(let r=0,a=e.count;r<a;r++)ti.fromBufferAttribute(e,r),s=Math.max(s,n.distanceToSquared(ti));if(t)for(let r=0,a=t.length;r<a;r++){const u=t[r],f=this.morphTargetsRelative;for(let c=0,d=u.count;c<d;c++)ti.fromBufferAttribute(u,c),f&&(tl.fromBufferAttribute(e,c),ti.add(tl)),s=Math.max(s,n.distanceToSquared(ti))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=t.position,s=t.normal,r=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new zs(new Float32Array(4*n.count),4));const a=this.getAttribute("tangent"),u=[],f=[];for(let O=0;O<n.count;O++)u[O]=new xe,f[O]=new xe;const c=new xe,d=new xe,p=new xe,m=new _n,y=new _n,E=new _n,A=new xe,S=new xe;function x(O,L,I){c.fromBufferAttribute(n,O),d.fromBufferAttribute(n,L),p.fromBufferAttribute(n,I),m.fromBufferAttribute(r,O),y.fromBufferAttribute(r,L),E.fromBufferAttribute(r,I),d.sub(c),p.sub(c),y.sub(m),E.sub(m);const F=1/(y.x*E.y-E.x*y.y);isFinite(F)&&(A.copy(d).multiplyScalar(E.y).addScaledVector(p,-y.y).multiplyScalar(F),S.copy(p).multiplyScalar(y.x).addScaledVector(d,-E.x).multiplyScalar(F),u[O].add(A),u[L].add(A),u[I].add(A),f[O].add(S),f[L].add(S),f[I].add(S))}let M=this.groups;M.length===0&&(M=[{start:0,count:e.count}]);for(let O=0,L=M.length;O<L;++O){const I=M[O],F=I.start,X=I.count;for(let Y=F,ee=F+X;Y<ee;Y+=3)x(e.getX(Y+0),e.getX(Y+1),e.getX(Y+2))}const b=new xe,C=new xe,N=new xe,U=new xe;function w(O){N.fromBufferAttribute(s,O),U.copy(N);const L=u[O];b.copy(L),b.sub(N.multiplyScalar(N.dot(L))).normalize(),C.crossVectors(U,L);const F=C.dot(f[O])<0?-1:1;a.setXYZW(O,b.x,b.y,b.z,F)}for(let O=0,L=M.length;O<L;++O){const I=M[O],F=I.start,X=I.count;for(let Y=F,ee=F+X;Y<ee;Y+=3)w(e.getX(Y+0)),w(e.getX(Y+1)),w(e.getX(Y+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new zs(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let m=0,y=n.count;m<y;m++)n.setXYZ(m,0,0,0);const s=new xe,r=new xe,a=new xe,u=new xe,f=new xe,c=new xe,d=new xe,p=new xe;if(e)for(let m=0,y=e.count;m<y;m+=3){const E=e.getX(m+0),A=e.getX(m+1),S=e.getX(m+2);s.fromBufferAttribute(t,E),r.fromBufferAttribute(t,A),a.fromBufferAttribute(t,S),d.subVectors(a,r),p.subVectors(s,r),d.cross(p),u.fromBufferAttribute(n,E),f.fromBufferAttribute(n,A),c.fromBufferAttribute(n,S),u.add(d),f.add(d),c.add(d),n.setXYZ(E,u.x,u.y,u.z),n.setXYZ(A,f.x,f.y,f.z),n.setXYZ(S,c.x,c.y,c.z)}else for(let m=0,y=t.count;m<y;m+=3)s.fromBufferAttribute(t,m+0),r.fromBufferAttribute(t,m+1),a.fromBufferAttribute(t,m+2),d.subVectors(a,r),p.subVectors(s,r),d.cross(p),n.setXYZ(m+0,d.x,d.y,d.z),n.setXYZ(m+1,d.x,d.y,d.z),n.setXYZ(m+2,d.x,d.y,d.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)ti.fromBufferAttribute(e,t),ti.normalize(),e.setXYZ(t,ti.x,ti.y,ti.z)}toNonIndexed(){function e(u,f){const c=u.array,d=u.itemSize,p=u.normalized,m=new c.constructor(f.length*d);let y=0,E=0;for(let A=0,S=f.length;A<S;A++){u.isInterleavedBufferAttribute?y=f[A]*u.data.stride+u.offset:y=f[A]*d;for(let x=0;x<d;x++)m[E++]=c[y++]}return new zs(m,d,p)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new So,n=this.index.array,s=this.attributes;for(const u in s){const f=s[u],c=e(f,n);t.setAttribute(u,c)}const r=this.morphAttributes;for(const u in r){const f=[],c=r[u];for(let d=0,p=c.length;d<p;d++){const m=c[d],y=e(m,n);f.push(y)}t.morphAttributes[u]=f}t.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let u=0,f=a.length;u<f;u++){const c=a[u];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const f=this.parameters;for(const c in f)f[c]!==void 0&&(e[c]=f[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const f in n){const c=n[f];e.data.attributes[f]=c.toJSON(e.data)}const s={};let r=!1;for(const f in this.morphAttributes){const c=this.morphAttributes[f],d=[];for(let p=0,m=c.length;p<m;p++){const y=c[p];d.push(y.toJSON(e.data))}d.length>0&&(s[f]=d,r=!0)}r&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const u=this.boundingSphere;return u!==null&&(e.data.boundingSphere={center:u.center.toArray(),radius:u.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone(t));const s=e.attributes;for(const c in s){const d=s[c];this.setAttribute(c,d.clone(t))}const r=e.morphAttributes;for(const c in r){const d=[],p=r[c];for(let m=0,y=p.length;m<y;m++)d.push(p[m].clone(t));this.morphAttributes[c]=d}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let c=0,d=a.length;c<d;c++){const p=a[c];this.addGroup(p.start,p.count,p.materialIndex)}const u=e.boundingBox;u!==null&&(this.boundingBox=u.clone());const f=e.boundingSphere;return f!==null&&(this.boundingSphere=f.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const LA=new Hn,$o=new dV,$f=new _v,DA=new xe,qf=new xe,Wf=new xe,Kf=new xe,tg=new xe,Yf=new xe,wA=new xe,Xf=new xe;class Hs extends ts{constructor(e=new So,t=new Ev){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const s=t[n[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,a=s.length;r<a;r++){const u=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[u]=r}}}}getVertexPosition(e,t){const n=this.geometry,s=n.attributes.position,r=n.morphAttributes.position,a=n.morphTargetsRelative;t.fromBufferAttribute(s,e);const u=this.morphTargetInfluences;if(r&&u){Yf.set(0,0,0);for(let f=0,c=r.length;f<c;f++){const d=u[f],p=r[f];d!==0&&(tg.fromBufferAttribute(p,e),a?Yf.addScaledVector(tg,d):Yf.addScaledVector(tg.sub(t),d))}t.add(Yf)}return t}raycast(e,t){const n=this.geometry,s=this.material,r=this.matrixWorld;s!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),$f.copy(n.boundingSphere),$f.applyMatrix4(r),$o.copy(e.ray).recast(e.near),!($f.containsPoint($o.origin)===!1&&($o.intersectSphere($f,DA)===null||$o.origin.distanceToSquared(DA)>(e.far-e.near)**2))&&(LA.copy(r).invert(),$o.copy(e.ray).applyMatrix4(LA),!(n.boundingBox!==null&&$o.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(e,t,$o)))}_computeIntersections(e,t,n){let s;const r=this.geometry,a=this.material,u=r.index,f=r.attributes.position,c=r.attributes.uv,d=r.attributes.uv1,p=r.attributes.normal,m=r.groups,y=r.drawRange;if(u!==null)if(Array.isArray(a))for(let E=0,A=m.length;E<A;E++){const S=m[E],x=a[S.materialIndex],M=Math.max(S.start,y.start),b=Math.min(u.count,Math.min(S.start+S.count,y.start+y.count));for(let C=M,N=b;C<N;C+=3){const U=u.getX(C),w=u.getX(C+1),O=u.getX(C+2);s=Jf(this,x,e,n,c,d,p,U,w,O),s&&(s.faceIndex=Math.floor(C/3),s.face.materialIndex=S.materialIndex,t.push(s))}}else{const E=Math.max(0,y.start),A=Math.min(u.count,y.start+y.count);for(let S=E,x=A;S<x;S+=3){const M=u.getX(S),b=u.getX(S+1),C=u.getX(S+2);s=Jf(this,a,e,n,c,d,p,M,b,C),s&&(s.faceIndex=Math.floor(S/3),t.push(s))}}else if(f!==void 0)if(Array.isArray(a))for(let E=0,A=m.length;E<A;E++){const S=m[E],x=a[S.materialIndex],M=Math.max(S.start,y.start),b=Math.min(f.count,Math.min(S.start+S.count,y.start+y.count));for(let C=M,N=b;C<N;C+=3){const U=C,w=C+1,O=C+2;s=Jf(this,x,e,n,c,d,p,U,w,O),s&&(s.faceIndex=Math.floor(C/3),s.face.materialIndex=S.materialIndex,t.push(s))}}else{const E=Math.max(0,y.start),A=Math.min(f.count,y.start+y.count);for(let S=E,x=A;S<x;S+=3){const M=S,b=S+1,C=S+2;s=Jf(this,a,e,n,c,d,p,M,b,C),s&&(s.faceIndex=Math.floor(S/3),t.push(s))}}}}function TV(i,e,t,n,s,r,a,u){let f;if(e.side===Fi?f=n.intersectTriangle(a,r,s,!0,u):f=n.intersectTriangle(s,r,a,e.side===yo,u),f===null)return null;Xf.copy(u),Xf.applyMatrix4(i.matrixWorld);const c=t.ray.origin.distanceTo(Xf);return c<t.near||c>t.far?null:{distance:c,point:Xf.clone(),object:i}}function Jf(i,e,t,n,s,r,a,u,f,c){i.getVertexPosition(u,qf),i.getVertexPosition(f,Wf),i.getVertexPosition(c,Kf);const d=TV(i,e,t,n,qf,Wf,Kf,wA);if(d){const p=new xe;Rs.getBarycoord(wA,qf,Wf,Kf,p),s&&(d.uv=Rs.getInterpolatedAttribute(s,u,f,c,p,new _n)),r&&(d.uv1=Rs.getInterpolatedAttribute(r,u,f,c,p,new _n)),a&&(d.normal=Rs.getInterpolatedAttribute(a,u,f,c,p,new xe),d.normal.dot(n.direction)>0&&d.normal.multiplyScalar(-1));const m={a:u,b:f,c,normal:new xe,materialIndex:0};Rs.getNormal(qf,Wf,Kf,m.normal),d.face=m,d.barycoord=p}return d}class nc extends So{constructor(e=1,t=1,n=1,s=1,r=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:s,heightSegments:r,depthSegments:a};const u=this;s=Math.floor(s),r=Math.floor(r),a=Math.floor(a);const f=[],c=[],d=[],p=[];let m=0,y=0;E("z","y","x",-1,-1,n,t,e,a,r,0),E("z","y","x",1,-1,n,t,-e,a,r,1),E("x","z","y",1,1,e,n,t,s,a,2),E("x","z","y",1,-1,e,n,-t,s,a,3),E("x","y","z",1,-1,e,t,n,s,r,4),E("x","y","z",-1,-1,e,t,-n,s,r,5),this.setIndex(f),this.setAttribute("position",new $s(c,3)),this.setAttribute("normal",new $s(d,3)),this.setAttribute("uv",new $s(p,2));function E(A,S,x,M,b,C,N,U,w,O,L){const I=C/w,F=N/O,X=C/2,Y=N/2,ee=U/2,ne=w+1,V=O+1;let W=0,q=0;const oe=new xe;for(let he=0;he<V;he++){const G=he*F-Y;for(let K=0;K<ne;K++){const fe=K*I-X;oe[A]=fe*M,oe[S]=G*b,oe[x]=ee,c.push(oe.x,oe.y,oe.z),oe[A]=0,oe[S]=0,oe[x]=U>0?1:-1,d.push(oe.x,oe.y,oe.z),p.push(K/w),p.push(1-he/O),W+=1}}for(let he=0;he<O;he++)for(let G=0;G<w;G++){const K=m+G+ne*he,fe=m+G+ne*(he+1),Q=m+(G+1)+ne*(he+1),ue=m+(G+1)+ne*he;f.push(K,fe,ue),f.push(fe,Q,ue),q+=6}u.addGroup(y,q,L),y+=q,m+=W}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new nc(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Ll(i){const e={};for(const t in i){e[t]={};for(const n in i[t]){const s=i[t][n];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][n]=null):e[t][n]=s.clone():Array.isArray(s)?e[t][n]=s.slice():e[t][n]=s}}return e}function Ei(i){const e={};for(let t=0;t<i.length;t++){const n=Ll(i[t]);for(const s in n)e[s]=n[s]}return e}function xV(i){const e=[];for(let t=0;t<i.length;t++)e.push(i[t].clone());return e}function jM(i){const e=i.getRenderTarget();return e===null?i.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:Qt.workingColorSpace}const AV={clone:Ll,merge:Ei};var RV=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,bV=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class _o extends Qd{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=RV,this.fragmentShader=bV,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Ll(e.uniforms),this.uniformsGroups=xV(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const s in this.uniforms){const a=this.uniforms[s].value;a&&a.isTexture?t.uniforms[s]={type:"t",value:a.toJSON(e).uuid}:a&&a.isColor?t.uniforms[s]={type:"c",value:a.getHex()}:a&&a.isVector2?t.uniforms[s]={type:"v2",value:a.toArray()}:a&&a.isVector3?t.uniforms[s]={type:"v3",value:a.toArray()}:a&&a.isVector4?t.uniforms[s]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?t.uniforms[s]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?t.uniforms[s]={type:"m4",value:a.toArray()}:t.uniforms[s]={value:a}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const s in this.extensions)this.extensions[s]===!0&&(n[s]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class eC extends ts{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Hn,this.projectionMatrix=new Hn,this.projectionMatrixInverse=new Hn,this.coordinateSystem=Ar}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const lo=new xe,PA=new _n,NA=new _n;class fs extends eC{constructor(e=50,t=1,n=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=s,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=Qu*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Gu*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Qu*2*Math.atan(Math.tan(Gu*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){lo.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(lo.x,lo.y).multiplyScalar(-e/lo.z),lo.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(lo.x,lo.y).multiplyScalar(-e/lo.z)}getViewSize(e,t){return this.getViewBounds(e,PA,NA),t.subVectors(NA,PA)}setViewOffset(e,t,n,s,r,a){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=s,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Gu*.5*this.fov)/this.zoom,n=2*t,s=this.aspect*n,r=-.5*s;const a=this.view;if(this.view!==null&&this.view.enabled){const f=a.fullWidth,c=a.fullHeight;r+=a.offsetX*s/f,t-=a.offsetY*n/c,s*=a.width/f,n*=a.height/c}const u=this.filmOffset;u!==0&&(r+=e*u/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+s,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const nl=-90,il=1;class MV extends ts{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const s=new fs(nl,il,e,t);s.layers=this.layers,this.add(s);const r=new fs(nl,il,e,t);r.layers=this.layers,this.add(r);const a=new fs(nl,il,e,t);a.layers=this.layers,this.add(a);const u=new fs(nl,il,e,t);u.layers=this.layers,this.add(u);const f=new fs(nl,il,e,t);f.layers=this.layers,this.add(f);const c=new fs(nl,il,e,t);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,s,r,a,u,f]=t;for(const c of t)this.remove(c);if(e===Ar)n.up.set(0,1,0),n.lookAt(1,0,0),s.up.set(0,1,0),s.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),u.up.set(0,1,0),u.lookAt(0,0,1),f.up.set(0,1,0),f.lookAt(0,0,-1);else if(e===Fd)n.up.set(0,-1,0),n.lookAt(-1,0,0),s.up.set(0,-1,0),s.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),u.up.set(0,-1,0),u.lookAt(0,0,1),f.up.set(0,-1,0),f.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const c of t)this.add(c),c.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:s}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[r,a,u,f,c,d]=this.children,p=e.getRenderTarget(),m=e.getActiveCubeFace(),y=e.getActiveMipmapLevel(),E=e.xr.enabled;e.xr.enabled=!1;const A=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,s),e.render(t,r),e.setRenderTarget(n,1,s),e.render(t,a),e.setRenderTarget(n,2,s),e.render(t,u),e.setRenderTarget(n,3,s),e.render(t,f),e.setRenderTarget(n,4,s),e.render(t,c),n.texture.generateMipmaps=A,e.setRenderTarget(n,5,s),e.render(t,d),e.setRenderTarget(p,m,y),e.xr.enabled=E,n.texture.needsPMREMUpdate=!0}}class tC extends xi{constructor(e,t,n,s,r,a,u,f,c,d){e=e!==void 0?e:[],t=t!==void 0?t:Rl,super(e,t,n,s,r,a,u,f,c,d),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class CV extends ra{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},s=[n,n,n,n,n,n];this.texture=new tC(s,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Oi}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},s=new nc(5,5,5),r=new _o({name:"CubemapFromEquirect",uniforms:Ll(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:Fi,blending:po});r.uniforms.tEquirect.value=t;const a=new Hs(s,r),u=t.minFilter;return t.minFilter===ta&&(t.minFilter=Oi),new MV(1,10,this).update(e,a),t.minFilter=u,a.geometry.dispose(),a.material.dispose(),this}clear(e,t,n,s){const r=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,n,s);e.setRenderTarget(r)}}class Qf extends ts{constructor(){super(),this.isGroup=!0,this.type="Group"}}const IV={type:"move"};class ng{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Qf,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Qf,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new xe,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new xe),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Qf,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new xe,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new xe),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let s=null,r=null,a=null;const u=this._targetRay,f=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(c&&e.hand){a=!0;for(const A of e.hand.values()){const S=t.getJointPose(A,n),x=this._getHandJoint(c,A);S!==null&&(x.matrix.fromArray(S.transform.matrix),x.matrix.decompose(x.position,x.rotation,x.scale),x.matrixWorldNeedsUpdate=!0,x.jointRadius=S.radius),x.visible=S!==null}const d=c.joints["index-finger-tip"],p=c.joints["thumb-tip"],m=d.position.distanceTo(p.position),y=.02,E=.005;c.inputState.pinching&&m>y+E?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&m<=y-E&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else f!==null&&e.gripSpace&&(r=t.getPose(e.gripSpace,n),r!==null&&(f.matrix.fromArray(r.transform.matrix),f.matrix.decompose(f.position,f.rotation,f.scale),f.matrixWorldNeedsUpdate=!0,r.linearVelocity?(f.hasLinearVelocity=!0,f.linearVelocity.copy(r.linearVelocity)):f.hasLinearVelocity=!1,r.angularVelocity?(f.hasAngularVelocity=!0,f.angularVelocity.copy(r.angularVelocity)):f.hasAngularVelocity=!1));u!==null&&(s=t.getPose(e.targetRaySpace,n),s===null&&r!==null&&(s=r),s!==null&&(u.matrix.fromArray(s.transform.matrix),u.matrix.decompose(u.position,u.rotation,u.scale),u.matrixWorldNeedsUpdate=!0,s.linearVelocity?(u.hasLinearVelocity=!0,u.linearVelocity.copy(s.linearVelocity)):u.hasLinearVelocity=!1,s.angularVelocity?(u.hasAngularVelocity=!0,u.angularVelocity.copy(s.angularVelocity)):u.hasAngularVelocity=!1,this.dispatchEvent(IV)))}return u!==null&&(u.visible=s!==null),f!==null&&(f.visible=r!==null),c!==null&&(c.visible=a!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const n=new Qf;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class LV extends ts{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Cr,this.environmentIntensity=1,this.environmentRotation=new Cr,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}const ig=new xe,DV=new xe,wV=new Lt;class Jo{constructor(e=new xe(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,s){return this.normal.set(e,t,n),this.constant=s,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const s=ig.subVectors(n,t).cross(DV.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(s,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(ig),s=this.normal.dot(n);if(s===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/s;return r<0||r>1?null:t.copy(e.start).addScaledVector(n,r)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||wV.getNormalMatrix(e),s=this.coplanarPoint(ig).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-s.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const qo=new _v,Zf=new xe;class nC{constructor(e=new Jo,t=new Jo,n=new Jo,s=new Jo,r=new Jo,a=new Jo){this.planes=[e,t,n,s,r,a]}set(e,t,n,s,r,a){const u=this.planes;return u[0].copy(e),u[1].copy(t),u[2].copy(n),u[3].copy(s),u[4].copy(r),u[5].copy(a),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=Ar){const n=this.planes,s=e.elements,r=s[0],a=s[1],u=s[2],f=s[3],c=s[4],d=s[5],p=s[6],m=s[7],y=s[8],E=s[9],A=s[10],S=s[11],x=s[12],M=s[13],b=s[14],C=s[15];if(n[0].setComponents(f-r,m-c,S-y,C-x).normalize(),n[1].setComponents(f+r,m+c,S+y,C+x).normalize(),n[2].setComponents(f+a,m+d,S+E,C+M).normalize(),n[3].setComponents(f-a,m-d,S-E,C-M).normalize(),n[4].setComponents(f-u,m-p,S-A,C-b).normalize(),t===Ar)n[5].setComponents(f+u,m+p,S+A,C+b).normalize();else if(t===Fd)n[5].setComponents(u,p,A,b).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),qo.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),qo.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(qo)}intersectsSprite(e){return qo.center.set(0,0,0),qo.radius=.7071067811865476,qo.applyMatrix4(e.matrixWorld),this.intersectsSphere(qo)}intersectsSphere(e){const t=this.planes,n=e.center,s=-e.radius;for(let r=0;r<6;r++)if(t[r].distanceToPoint(n)<s)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const s=t[n];if(Zf.x=s.normal.x>0?e.max.x:e.min.x,Zf.y=s.normal.y>0?e.max.y:e.min.y,Zf.z=s.normal.z>0?e.max.z:e.min.z,s.distanceToPoint(Zf)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}class PV extends xi{constructor(e,t,n,s,r,a,u,f,c){super(e,t,n,s,r,a,u,f,c),this.isVideoTexture=!0,this.minFilter=a!==void 0?a:Oi,this.magFilter=r!==void 0?r:Oi,this.generateMipmaps=!1;const d=this;function p(){d.needsUpdate=!0,e.requestVideoFrameCallback(p)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(p)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class iC extends xi{constructor(e,t,n,s,r,a,u,f,c,d=El){if(d!==El&&d!==Cl)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&d===El&&(n=sa),n===void 0&&d===Cl&&(n=Ml),super(null,s,r,a,u,f,d,n,c),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=u!==void 0?u:Is,this.minFilter=f!==void 0?f:Is,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}class Zd extends So{constructor(e=1,t=1,n=1,s=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:s};const r=e/2,a=t/2,u=Math.floor(n),f=Math.floor(s),c=u+1,d=f+1,p=e/u,m=t/f,y=[],E=[],A=[],S=[];for(let x=0;x<d;x++){const M=x*m-a;for(let b=0;b<c;b++){const C=b*p-r;E.push(C,-M,0),A.push(0,0,1),S.push(b/u),S.push(1-x/f)}}for(let x=0;x<f;x++)for(let M=0;M<u;M++){const b=M+c*x,C=M+c*(x+1),N=M+1+c*(x+1),U=M+1+c*x;y.push(b,C,U),y.push(C,N,U)}this.setIndex(y),this.setAttribute("position",new $s(E,3)),this.setAttribute("normal",new $s(A,3)),this.setAttribute("uv",new $s(S,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Zd(e.width,e.height,e.widthSegments,e.heightSegments)}}class Bd extends So{constructor(e=1,t=32,n=16,s=0,r=Math.PI*2,a=0,u=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:s,phiLength:r,thetaStart:a,thetaLength:u},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const f=Math.min(a+u,Math.PI);let c=0;const d=[],p=new xe,m=new xe,y=[],E=[],A=[],S=[];for(let x=0;x<=n;x++){const M=[],b=x/n;let C=0;x===0&&a===0?C=.5/t:x===n&&f===Math.PI&&(C=-.5/t);for(let N=0;N<=t;N++){const U=N/t;p.x=-e*Math.cos(s+U*r)*Math.sin(a+b*u),p.y=e*Math.cos(a+b*u),p.z=e*Math.sin(s+U*r)*Math.sin(a+b*u),E.push(p.x,p.y,p.z),m.copy(p).normalize(),A.push(m.x,m.y,m.z),S.push(U+C,1-b),M.push(c++)}d.push(M)}for(let x=0;x<n;x++)for(let M=0;M<t;M++){const b=d[x][M+1],C=d[x][M],N=d[x+1][M],U=d[x+1][M+1];(x!==0||a>0)&&y.push(b,C,U),(x!==n-1||f<Math.PI)&&y.push(C,N,U)}this.setIndex(y),this.setAttribute("position",new $s(E,3)),this.setAttribute("normal",new $s(A,3)),this.setAttribute("uv",new $s(S,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Bd(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class NV extends Qd{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=CG,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class UV extends Qd{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class OV extends eC{constructor(e=-1,t=1,n=1,s=-1,r=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=s,this.near=r,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,s,r,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=s,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let r=n-e,a=n+e,u=s+t,f=s-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,d=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=c*this.view.offsetX,a=r+c*this.view.width,u-=d*this.view.offsetY,f=u-d*this.view.height}this.projectionMatrix.makeOrthographic(r,a,u,f,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}class FV extends fs{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e,this.index=0}}function UA(i,e,t,n){const s=kV(n);switch(t){case kM:return i*e;case GM:return i*e;case VM:return i*e*2;case HM:return i*e/s.components*s.byteLength;case mv:return i*e/s.components*s.byteLength;case zM:return i*e*2/s.components*s.byteLength;case gv:return i*e*2/s.components*s.byteLength;case BM:return i*e*3/s.components*s.byteLength;case bs:return i*e*4/s.components*s.byteLength;case vv:return i*e*4/s.components*s.byteLength;case hd:case pd:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*8;case md:case gd:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*16;case s0:case o0:return Math.max(i,16)*Math.max(e,8)/4;case i0:case r0:return Math.max(i,8)*Math.max(e,8)/2;case a0:case l0:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*8;case u0:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*16;case c0:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*16;case f0:return Math.floor((i+4)/5)*Math.floor((e+3)/4)*16;case d0:return Math.floor((i+4)/5)*Math.floor((e+4)/5)*16;case h0:return Math.floor((i+5)/6)*Math.floor((e+4)/5)*16;case p0:return Math.floor((i+5)/6)*Math.floor((e+5)/6)*16;case m0:return Math.floor((i+7)/8)*Math.floor((e+4)/5)*16;case g0:return Math.floor((i+7)/8)*Math.floor((e+5)/6)*16;case v0:return Math.floor((i+7)/8)*Math.floor((e+7)/8)*16;case y0:return Math.floor((i+9)/10)*Math.floor((e+4)/5)*16;case _0:return Math.floor((i+9)/10)*Math.floor((e+5)/6)*16;case E0:return Math.floor((i+9)/10)*Math.floor((e+7)/8)*16;case S0:return Math.floor((i+9)/10)*Math.floor((e+9)/10)*16;case T0:return Math.floor((i+11)/12)*Math.floor((e+9)/10)*16;case x0:return Math.floor((i+11)/12)*Math.floor((e+11)/12)*16;case vd:case A0:case R0:return Math.ceil(i/4)*Math.ceil(e/4)*16;case $M:case b0:return Math.ceil(i/4)*Math.ceil(e/4)*8;case M0:case C0:return Math.ceil(i/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function kV(i){switch(i){case Mr:case UM:return{byteLength:1,components:1};case Ju:case OM:case ju:return{byteLength:2,components:1};case hv:case pv:return{byteLength:2,components:4};case sa:case dv:case xr:return{byteLength:4,components:1};case FM:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${i}.`)}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:fv}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=fv);/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */function sC(){let i=null,e=!1,t=null,n=null;function s(r,a){t(r,a),n=i.requestAnimationFrame(s)}return{start:function(){e!==!0&&t!==null&&(n=i.requestAnimationFrame(s),e=!0)},stop:function(){i.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(r){t=r},setContext:function(r){i=r}}}function BV(i){const e=new WeakMap;function t(u,f){const c=u.array,d=u.usage,p=c.byteLength,m=i.createBuffer();i.bindBuffer(f,m),i.bufferData(f,c,d),u.onUploadCallback();let y;if(c instanceof Float32Array)y=i.FLOAT;else if(c instanceof Uint16Array)u.isFloat16BufferAttribute?y=i.HALF_FLOAT:y=i.UNSIGNED_SHORT;else if(c instanceof Int16Array)y=i.SHORT;else if(c instanceof Uint32Array)y=i.UNSIGNED_INT;else if(c instanceof Int32Array)y=i.INT;else if(c instanceof Int8Array)y=i.BYTE;else if(c instanceof Uint8Array)y=i.UNSIGNED_BYTE;else if(c instanceof Uint8ClampedArray)y=i.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+c);return{buffer:m,type:y,bytesPerElement:c.BYTES_PER_ELEMENT,version:u.version,size:p}}function n(u,f,c){const d=f.array,p=f.updateRanges;if(i.bindBuffer(c,u),p.length===0)i.bufferSubData(c,0,d);else{p.sort((y,E)=>y.start-E.start);let m=0;for(let y=1;y<p.length;y++){const E=p[m],A=p[y];A.start<=E.start+E.count+1?E.count=Math.max(E.count,A.start+A.count-E.start):(++m,p[m]=A)}p.length=m+1;for(let y=0,E=p.length;y<E;y++){const A=p[y];i.bufferSubData(c,A.start*d.BYTES_PER_ELEMENT,d,A.start,A.count)}f.clearUpdateRanges()}f.onUploadCallback()}function s(u){return u.isInterleavedBufferAttribute&&(u=u.data),e.get(u)}function r(u){u.isInterleavedBufferAttribute&&(u=u.data);const f=e.get(u);f&&(i.deleteBuffer(f.buffer),e.delete(u))}function a(u,f){if(u.isInterleavedBufferAttribute&&(u=u.data),u.isGLBufferAttribute){const d=e.get(u);(!d||d.version<u.version)&&e.set(u,{buffer:u.buffer,type:u.type,bytesPerElement:u.elementSize,version:u.version});return}const c=e.get(u);if(c===void 0)e.set(u,t(u,f));else if(c.version<u.version){if(c.size!==u.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");n(c.buffer,u,f),c.version=u.version}}return{get:s,remove:r,update:a}}var GV=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,VV=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,HV=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,zV=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,$V=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,qV=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,WV=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,KV=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,YV=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,XV=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,JV=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,QV=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,ZV=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,jV=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,eH=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,tH=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,nH=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,iH=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,sH=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,rH=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,oH=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,aH=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,lH=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,uH=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,cH=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,fH=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,dH=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,hH=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,pH=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,mH=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,gH="gl_FragColor = linearToOutputTexel( gl_FragColor );",vH=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,yH=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,_H=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,EH=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,SH=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,TH=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,xH=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,AH=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,RH=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,bH=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,MH=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,CH=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,IH=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,LH=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,DH=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,wH=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,PH=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,NH=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,UH=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,OH=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,FH=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,kH=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,BH=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,GH=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,VH=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,HH=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,zH=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,$H=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,qH=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,WH=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,KH=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,YH=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,XH=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,JH=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,QH=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,ZH=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,jH=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,e4=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,t4=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,n4=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,i4=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,s4=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,r4=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,o4=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,a4=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,l4=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,u4=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,c4=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,f4=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,d4=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,h4=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,p4=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,m4=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,g4=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,v4=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,y4=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,_4=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,E4=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,S4=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,T4=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,x4=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,A4=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,R4=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,b4=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,M4=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,C4=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,I4=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,L4=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,D4=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,w4=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,P4=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,N4=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,U4=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,O4=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,F4=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,k4=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const B4=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,G4=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,V4=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,H4=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,z4=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,$4=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,q4=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,W4=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,K4=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,Y4=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,X4=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,J4=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Q4=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Z4=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,j4=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,ez=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,tz=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,nz=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,iz=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,sz=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,rz=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,oz=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,az=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,lz=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,uz=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,cz=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,fz=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,dz=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,hz=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,pz=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,mz=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,gz=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,vz=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,yz=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,wt={alphahash_fragment:GV,alphahash_pars_fragment:VV,alphamap_fragment:HV,alphamap_pars_fragment:zV,alphatest_fragment:$V,alphatest_pars_fragment:qV,aomap_fragment:WV,aomap_pars_fragment:KV,batching_pars_vertex:YV,batching_vertex:XV,begin_vertex:JV,beginnormal_vertex:QV,bsdfs:ZV,iridescence_fragment:jV,bumpmap_pars_fragment:eH,clipping_planes_fragment:tH,clipping_planes_pars_fragment:nH,clipping_planes_pars_vertex:iH,clipping_planes_vertex:sH,color_fragment:rH,color_pars_fragment:oH,color_pars_vertex:aH,color_vertex:lH,common:uH,cube_uv_reflection_fragment:cH,defaultnormal_vertex:fH,displacementmap_pars_vertex:dH,displacementmap_vertex:hH,emissivemap_fragment:pH,emissivemap_pars_fragment:mH,colorspace_fragment:gH,colorspace_pars_fragment:vH,envmap_fragment:yH,envmap_common_pars_fragment:_H,envmap_pars_fragment:EH,envmap_pars_vertex:SH,envmap_physical_pars_fragment:wH,envmap_vertex:TH,fog_vertex:xH,fog_pars_vertex:AH,fog_fragment:RH,fog_pars_fragment:bH,gradientmap_pars_fragment:MH,lightmap_pars_fragment:CH,lights_lambert_fragment:IH,lights_lambert_pars_fragment:LH,lights_pars_begin:DH,lights_toon_fragment:PH,lights_toon_pars_fragment:NH,lights_phong_fragment:UH,lights_phong_pars_fragment:OH,lights_physical_fragment:FH,lights_physical_pars_fragment:kH,lights_fragment_begin:BH,lights_fragment_maps:GH,lights_fragment_end:VH,logdepthbuf_fragment:HH,logdepthbuf_pars_fragment:zH,logdepthbuf_pars_vertex:$H,logdepthbuf_vertex:qH,map_fragment:WH,map_pars_fragment:KH,map_particle_fragment:YH,map_particle_pars_fragment:XH,metalnessmap_fragment:JH,metalnessmap_pars_fragment:QH,morphinstance_vertex:ZH,morphcolor_vertex:jH,morphnormal_vertex:e4,morphtarget_pars_vertex:t4,morphtarget_vertex:n4,normal_fragment_begin:i4,normal_fragment_maps:s4,normal_pars_fragment:r4,normal_pars_vertex:o4,normal_vertex:a4,normalmap_pars_fragment:l4,clearcoat_normal_fragment_begin:u4,clearcoat_normal_fragment_maps:c4,clearcoat_pars_fragment:f4,iridescence_pars_fragment:d4,opaque_fragment:h4,packing:p4,premultiplied_alpha_fragment:m4,project_vertex:g4,dithering_fragment:v4,dithering_pars_fragment:y4,roughnessmap_fragment:_4,roughnessmap_pars_fragment:E4,shadowmap_pars_fragment:S4,shadowmap_pars_vertex:T4,shadowmap_vertex:x4,shadowmask_pars_fragment:A4,skinbase_vertex:R4,skinning_pars_vertex:b4,skinning_vertex:M4,skinnormal_vertex:C4,specularmap_fragment:I4,specularmap_pars_fragment:L4,tonemapping_fragment:D4,tonemapping_pars_fragment:w4,transmission_fragment:P4,transmission_pars_fragment:N4,uv_pars_fragment:U4,uv_pars_vertex:O4,uv_vertex:F4,worldpos_vertex:k4,background_vert:B4,background_frag:G4,backgroundCube_vert:V4,backgroundCube_frag:H4,cube_vert:z4,cube_frag:$4,depth_vert:q4,depth_frag:W4,distanceRGBA_vert:K4,distanceRGBA_frag:Y4,equirect_vert:X4,equirect_frag:J4,linedashed_vert:Q4,linedashed_frag:Z4,meshbasic_vert:j4,meshbasic_frag:ez,meshlambert_vert:tz,meshlambert_frag:nz,meshmatcap_vert:iz,meshmatcap_frag:sz,meshnormal_vert:rz,meshnormal_frag:oz,meshphong_vert:az,meshphong_frag:lz,meshphysical_vert:uz,meshphysical_frag:cz,meshtoon_vert:fz,meshtoon_frag:dz,points_vert:hz,points_frag:pz,shadow_vert:mz,shadow_frag:gz,sprite_vert:vz,sprite_frag:yz},We={common:{diffuse:{value:new hn(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Lt},alphaMap:{value:null},alphaMapTransform:{value:new Lt},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Lt}},envmap:{envMap:{value:null},envMapRotation:{value:new Lt},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Lt}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Lt}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Lt},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Lt},normalScale:{value:new _n(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Lt},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Lt}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Lt}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Lt}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new hn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new hn(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Lt},alphaTest:{value:0},uvTransform:{value:new Lt}},sprite:{diffuse:{value:new hn(16777215)},opacity:{value:1},center:{value:new _n(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Lt},alphaMap:{value:null},alphaMapTransform:{value:new Lt},alphaTest:{value:0}}},Bs={basic:{uniforms:Ei([We.common,We.specularmap,We.envmap,We.aomap,We.lightmap,We.fog]),vertexShader:wt.meshbasic_vert,fragmentShader:wt.meshbasic_frag},lambert:{uniforms:Ei([We.common,We.specularmap,We.envmap,We.aomap,We.lightmap,We.emissivemap,We.bumpmap,We.normalmap,We.displacementmap,We.fog,We.lights,{emissive:{value:new hn(0)}}]),vertexShader:wt.meshlambert_vert,fragmentShader:wt.meshlambert_frag},phong:{uniforms:Ei([We.common,We.specularmap,We.envmap,We.aomap,We.lightmap,We.emissivemap,We.bumpmap,We.normalmap,We.displacementmap,We.fog,We.lights,{emissive:{value:new hn(0)},specular:{value:new hn(1118481)},shininess:{value:30}}]),vertexShader:wt.meshphong_vert,fragmentShader:wt.meshphong_frag},standard:{uniforms:Ei([We.common,We.envmap,We.aomap,We.lightmap,We.emissivemap,We.bumpmap,We.normalmap,We.displacementmap,We.roughnessmap,We.metalnessmap,We.fog,We.lights,{emissive:{value:new hn(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:wt.meshphysical_vert,fragmentShader:wt.meshphysical_frag},toon:{uniforms:Ei([We.common,We.aomap,We.lightmap,We.emissivemap,We.bumpmap,We.normalmap,We.displacementmap,We.gradientmap,We.fog,We.lights,{emissive:{value:new hn(0)}}]),vertexShader:wt.meshtoon_vert,fragmentShader:wt.meshtoon_frag},matcap:{uniforms:Ei([We.common,We.bumpmap,We.normalmap,We.displacementmap,We.fog,{matcap:{value:null}}]),vertexShader:wt.meshmatcap_vert,fragmentShader:wt.meshmatcap_frag},points:{uniforms:Ei([We.points,We.fog]),vertexShader:wt.points_vert,fragmentShader:wt.points_frag},dashed:{uniforms:Ei([We.common,We.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:wt.linedashed_vert,fragmentShader:wt.linedashed_frag},depth:{uniforms:Ei([We.common,We.displacementmap]),vertexShader:wt.depth_vert,fragmentShader:wt.depth_frag},normal:{uniforms:Ei([We.common,We.bumpmap,We.normalmap,We.displacementmap,{opacity:{value:1}}]),vertexShader:wt.meshnormal_vert,fragmentShader:wt.meshnormal_frag},sprite:{uniforms:Ei([We.sprite,We.fog]),vertexShader:wt.sprite_vert,fragmentShader:wt.sprite_frag},background:{uniforms:{uvTransform:{value:new Lt},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:wt.background_vert,fragmentShader:wt.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Lt}},vertexShader:wt.backgroundCube_vert,fragmentShader:wt.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:wt.cube_vert,fragmentShader:wt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:wt.equirect_vert,fragmentShader:wt.equirect_frag},distanceRGBA:{uniforms:Ei([We.common,We.displacementmap,{referencePosition:{value:new xe},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:wt.distanceRGBA_vert,fragmentShader:wt.distanceRGBA_frag},shadow:{uniforms:Ei([We.lights,We.fog,{color:{value:new hn(0)},opacity:{value:1}}]),vertexShader:wt.shadow_vert,fragmentShader:wt.shadow_frag}};Bs.physical={uniforms:Ei([Bs.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Lt},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Lt},clearcoatNormalScale:{value:new _n(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Lt},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Lt},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Lt},sheen:{value:0},sheenColor:{value:new hn(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Lt},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Lt},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Lt},transmissionSamplerSize:{value:new _n},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Lt},attenuationDistance:{value:0},attenuationColor:{value:new hn(0)},specularColor:{value:new hn(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Lt},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Lt},anisotropyVector:{value:new _n},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Lt}}]),vertexShader:wt.meshphysical_vert,fragmentShader:wt.meshphysical_frag};const jf={r:0,b:0,g:0},Wo=new Cr,_z=new Hn;function Ez(i,e,t,n,s,r,a){const u=new hn(0);let f=r===!0?0:1,c,d,p=null,m=0,y=null;function E(b){let C=b.isScene===!0?b.background:null;return C&&C.isTexture&&(C=(b.backgroundBlurriness>0?t:e).get(C)),C}function A(b){let C=!1;const N=E(b);N===null?x(u,f):N&&N.isColor&&(x(N,1),C=!0);const U=i.xr.getEnvironmentBlendMode();U==="additive"?n.buffers.color.setClear(0,0,0,1,a):U==="alpha-blend"&&n.buffers.color.setClear(0,0,0,0,a),(i.autoClear||C)&&(n.buffers.depth.setTest(!0),n.buffers.depth.setMask(!0),n.buffers.color.setMask(!0),i.clear(i.autoClearColor,i.autoClearDepth,i.autoClearStencil))}function S(b,C){const N=E(C);N&&(N.isCubeTexture||N.mapping===Jd)?(d===void 0&&(d=new Hs(new nc(1,1,1),new _o({name:"BackgroundCubeMaterial",uniforms:Ll(Bs.backgroundCube.uniforms),vertexShader:Bs.backgroundCube.vertexShader,fragmentShader:Bs.backgroundCube.fragmentShader,side:Fi,depthTest:!1,depthWrite:!1,fog:!1})),d.geometry.deleteAttribute("normal"),d.geometry.deleteAttribute("uv"),d.onBeforeRender=function(U,w,O){this.matrixWorld.copyPosition(O.matrixWorld)},Object.defineProperty(d.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),s.update(d)),Wo.copy(C.backgroundRotation),Wo.x*=-1,Wo.y*=-1,Wo.z*=-1,N.isCubeTexture&&N.isRenderTargetTexture===!1&&(Wo.y*=-1,Wo.z*=-1),d.material.uniforms.envMap.value=N,d.material.uniforms.flipEnvMap.value=N.isCubeTexture&&N.isRenderTargetTexture===!1?-1:1,d.material.uniforms.backgroundBlurriness.value=C.backgroundBlurriness,d.material.uniforms.backgroundIntensity.value=C.backgroundIntensity,d.material.uniforms.backgroundRotation.value.setFromMatrix4(_z.makeRotationFromEuler(Wo)),d.material.toneMapped=Qt.getTransfer(N.colorSpace)!==dn,(p!==N||m!==N.version||y!==i.toneMapping)&&(d.material.needsUpdate=!0,p=N,m=N.version,y=i.toneMapping),d.layers.enableAll(),b.unshift(d,d.geometry,d.material,0,0,null)):N&&N.isTexture&&(c===void 0&&(c=new Hs(new Zd(2,2),new _o({name:"BackgroundMaterial",uniforms:Ll(Bs.background.uniforms),vertexShader:Bs.background.vertexShader,fragmentShader:Bs.background.fragmentShader,side:yo,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),s.update(c)),c.material.uniforms.t2D.value=N,c.material.uniforms.backgroundIntensity.value=C.backgroundIntensity,c.material.toneMapped=Qt.getTransfer(N.colorSpace)!==dn,N.matrixAutoUpdate===!0&&N.updateMatrix(),c.material.uniforms.uvTransform.value.copy(N.matrix),(p!==N||m!==N.version||y!==i.toneMapping)&&(c.material.needsUpdate=!0,p=N,m=N.version,y=i.toneMapping),c.layers.enableAll(),b.unshift(c,c.geometry,c.material,0,0,null))}function x(b,C){b.getRGB(jf,jM(i)),n.buffers.color.setClear(jf.r,jf.g,jf.b,C,a)}function M(){d!==void 0&&(d.geometry.dispose(),d.material.dispose(),d=void 0),c!==void 0&&(c.geometry.dispose(),c.material.dispose(),c=void 0)}return{getClearColor:function(){return u},setClearColor:function(b,C=1){u.set(b),f=C,x(u,f)},getClearAlpha:function(){return f},setClearAlpha:function(b){f=b,x(u,f)},render:A,addToRenderList:S,dispose:M}}function Sz(i,e){const t=i.getParameter(i.MAX_VERTEX_ATTRIBS),n={},s=m(null);let r=s,a=!1;function u(I,F,X,Y,ee){let ne=!1;const V=p(Y,X,F);r!==V&&(r=V,c(r.object)),ne=y(I,Y,X,ee),ne&&E(I,Y,X,ee),ee!==null&&e.update(ee,i.ELEMENT_ARRAY_BUFFER),(ne||a)&&(a=!1,C(I,F,X,Y),ee!==null&&i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e.get(ee).buffer))}function f(){return i.createVertexArray()}function c(I){return i.bindVertexArray(I)}function d(I){return i.deleteVertexArray(I)}function p(I,F,X){const Y=X.wireframe===!0;let ee=n[I.id];ee===void 0&&(ee={},n[I.id]=ee);let ne=ee[F.id];ne===void 0&&(ne={},ee[F.id]=ne);let V=ne[Y];return V===void 0&&(V=m(f()),ne[Y]=V),V}function m(I){const F=[],X=[],Y=[];for(let ee=0;ee<t;ee++)F[ee]=0,X[ee]=0,Y[ee]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:F,enabledAttributes:X,attributeDivisors:Y,object:I,attributes:{},index:null}}function y(I,F,X,Y){const ee=r.attributes,ne=F.attributes;let V=0;const W=X.getAttributes();for(const q in W)if(W[q].location>=0){const he=ee[q];let G=ne[q];if(G===void 0&&(q==="instanceMatrix"&&I.instanceMatrix&&(G=I.instanceMatrix),q==="instanceColor"&&I.instanceColor&&(G=I.instanceColor)),he===void 0||he.attribute!==G||G&&he.data!==G.data)return!0;V++}return r.attributesNum!==V||r.index!==Y}function E(I,F,X,Y){const ee={},ne=F.attributes;let V=0;const W=X.getAttributes();for(const q in W)if(W[q].location>=0){let he=ne[q];he===void 0&&(q==="instanceMatrix"&&I.instanceMatrix&&(he=I.instanceMatrix),q==="instanceColor"&&I.instanceColor&&(he=I.instanceColor));const G={};G.attribute=he,he&&he.data&&(G.data=he.data),ee[q]=G,V++}r.attributes=ee,r.attributesNum=V,r.index=Y}function A(){const I=r.newAttributes;for(let F=0,X=I.length;F<X;F++)I[F]=0}function S(I){x(I,0)}function x(I,F){const X=r.newAttributes,Y=r.enabledAttributes,ee=r.attributeDivisors;X[I]=1,Y[I]===0&&(i.enableVertexAttribArray(I),Y[I]=1),ee[I]!==F&&(i.vertexAttribDivisor(I,F),ee[I]=F)}function M(){const I=r.newAttributes,F=r.enabledAttributes;for(let X=0,Y=F.length;X<Y;X++)F[X]!==I[X]&&(i.disableVertexAttribArray(X),F[X]=0)}function b(I,F,X,Y,ee,ne,V){V===!0?i.vertexAttribIPointer(I,F,X,ee,ne):i.vertexAttribPointer(I,F,X,Y,ee,ne)}function C(I,F,X,Y){A();const ee=Y.attributes,ne=X.getAttributes(),V=F.defaultAttributeValues;for(const W in ne){const q=ne[W];if(q.location>=0){let oe=ee[W];if(oe===void 0&&(W==="instanceMatrix"&&I.instanceMatrix&&(oe=I.instanceMatrix),W==="instanceColor"&&I.instanceColor&&(oe=I.instanceColor)),oe!==void 0){const he=oe.normalized,G=oe.itemSize,K=e.get(oe);if(K===void 0)continue;const fe=K.buffer,Q=K.type,ue=K.bytesPerElement,ae=Q===i.INT||Q===i.UNSIGNED_INT||oe.gpuType===dv;if(oe.isInterleavedBufferAttribute){const Ee=oe.data,pe=Ee.stride,Ae=oe.offset;if(Ee.isInstancedInterleavedBuffer){for(let Ne=0;Ne<q.locationSize;Ne++)x(q.location+Ne,Ee.meshPerAttribute);I.isInstancedMesh!==!0&&Y._maxInstanceCount===void 0&&(Y._maxInstanceCount=Ee.meshPerAttribute*Ee.count)}else for(let Ne=0;Ne<q.locationSize;Ne++)S(q.location+Ne);i.bindBuffer(i.ARRAY_BUFFER,fe);for(let Ne=0;Ne<q.locationSize;Ne++)b(q.location+Ne,G/q.locationSize,Q,he,pe*ue,(Ae+G/q.locationSize*Ne)*ue,ae)}else{if(oe.isInstancedBufferAttribute){for(let Ee=0;Ee<q.locationSize;Ee++)x(q.location+Ee,oe.meshPerAttribute);I.isInstancedMesh!==!0&&Y._maxInstanceCount===void 0&&(Y._maxInstanceCount=oe.meshPerAttribute*oe.count)}else for(let Ee=0;Ee<q.locationSize;Ee++)S(q.location+Ee);i.bindBuffer(i.ARRAY_BUFFER,fe);for(let Ee=0;Ee<q.locationSize;Ee++)b(q.location+Ee,G/q.locationSize,Q,he,G*ue,G/q.locationSize*Ee*ue,ae)}}else if(V!==void 0){const he=V[W];if(he!==void 0)switch(he.length){case 2:i.vertexAttrib2fv(q.location,he);break;case 3:i.vertexAttrib3fv(q.location,he);break;case 4:i.vertexAttrib4fv(q.location,he);break;default:i.vertexAttrib1fv(q.location,he)}}}}M()}function N(){O();for(const I in n){const F=n[I];for(const X in F){const Y=F[X];for(const ee in Y)d(Y[ee].object),delete Y[ee];delete F[X]}delete n[I]}}function U(I){if(n[I.id]===void 0)return;const F=n[I.id];for(const X in F){const Y=F[X];for(const ee in Y)d(Y[ee].object),delete Y[ee];delete F[X]}delete n[I.id]}function w(I){for(const F in n){const X=n[F];if(X[I.id]===void 0)continue;const Y=X[I.id];for(const ee in Y)d(Y[ee].object),delete Y[ee];delete X[I.id]}}function O(){L(),a=!0,r!==s&&(r=s,c(r.object))}function L(){s.geometry=null,s.program=null,s.wireframe=!1}return{setup:u,reset:O,resetDefaultState:L,dispose:N,releaseStatesOfGeometry:U,releaseStatesOfProgram:w,initAttributes:A,enableAttribute:S,disableUnusedAttributes:M}}function Tz(i,e,t){let n;function s(c){n=c}function r(c,d){i.drawArrays(n,c,d),t.update(d,n,1)}function a(c,d,p){p!==0&&(i.drawArraysInstanced(n,c,d,p),t.update(d,n,p))}function u(c,d,p){if(p===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(n,c,0,d,0,p);let y=0;for(let E=0;E<p;E++)y+=d[E];t.update(y,n,1)}function f(c,d,p,m){if(p===0)return;const y=e.get("WEBGL_multi_draw");if(y===null)for(let E=0;E<c.length;E++)a(c[E],d[E],m[E]);else{y.multiDrawArraysInstancedWEBGL(n,c,0,d,0,m,0,p);let E=0;for(let A=0;A<p;A++)E+=d[A]*m[A];t.update(E,n,1)}}this.setMode=s,this.render=r,this.renderInstances=a,this.renderMultiDraw=u,this.renderMultiDrawInstances=f}function xz(i,e,t,n){let s;function r(){if(s!==void 0)return s;if(e.has("EXT_texture_filter_anisotropic")===!0){const w=e.get("EXT_texture_filter_anisotropic");s=i.getParameter(w.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else s=0;return s}function a(w){return!(w!==bs&&n.convert(w)!==i.getParameter(i.IMPLEMENTATION_COLOR_READ_FORMAT))}function u(w){const O=w===ju&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(w!==Mr&&n.convert(w)!==i.getParameter(i.IMPLEMENTATION_COLOR_READ_TYPE)&&w!==xr&&!O)}function f(w){if(w==="highp"){if(i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.HIGH_FLOAT).precision>0&&i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT).precision>0)return"highp";w="mediump"}return w==="mediump"&&i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.MEDIUM_FLOAT).precision>0&&i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let c=t.precision!==void 0?t.precision:"highp";const d=f(c);d!==c&&(console.warn("THREE.WebGLRenderer:",c,"not supported, using",d,"instead."),c=d);const p=t.logarithmicDepthBuffer===!0,m=t.reverseDepthBuffer===!0&&e.has("EXT_clip_control"),y=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),E=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS),A=i.getParameter(i.MAX_TEXTURE_SIZE),S=i.getParameter(i.MAX_CUBE_MAP_TEXTURE_SIZE),x=i.getParameter(i.MAX_VERTEX_ATTRIBS),M=i.getParameter(i.MAX_VERTEX_UNIFORM_VECTORS),b=i.getParameter(i.MAX_VARYING_VECTORS),C=i.getParameter(i.MAX_FRAGMENT_UNIFORM_VECTORS),N=E>0,U=i.getParameter(i.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:r,getMaxPrecision:f,textureFormatReadable:a,textureTypeReadable:u,precision:c,logarithmicDepthBuffer:p,reverseDepthBuffer:m,maxTextures:y,maxVertexTextures:E,maxTextureSize:A,maxCubemapSize:S,maxAttributes:x,maxVertexUniforms:M,maxVaryings:b,maxFragmentUniforms:C,vertexTextures:N,maxSamples:U}}function Az(i){const e=this;let t=null,n=0,s=!1,r=!1;const a=new Jo,u=new Lt,f={value:null,needsUpdate:!1};this.uniform=f,this.numPlanes=0,this.numIntersection=0,this.init=function(p,m){const y=p.length!==0||m||n!==0||s;return s=m,n=p.length,y},this.beginShadows=function(){r=!0,d(null)},this.endShadows=function(){r=!1},this.setGlobalState=function(p,m){t=d(p,m,0)},this.setState=function(p,m,y){const E=p.clippingPlanes,A=p.clipIntersection,S=p.clipShadows,x=i.get(p);if(!s||E===null||E.length===0||r&&!S)r?d(null):c();else{const M=r?0:n,b=M*4;let C=x.clippingState||null;f.value=C,C=d(E,m,b,y);for(let N=0;N!==b;++N)C[N]=t[N];x.clippingState=C,this.numIntersection=A?this.numPlanes:0,this.numPlanes+=M}};function c(){f.value!==t&&(f.value=t,f.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function d(p,m,y,E){const A=p!==null?p.length:0;let S=null;if(A!==0){if(S=f.value,E!==!0||S===null){const x=y+A*4,M=m.matrixWorldInverse;u.getNormalMatrix(M),(S===null||S.length<x)&&(S=new Float32Array(x));for(let b=0,C=y;b!==A;++b,C+=4)a.copy(p[b]).applyMatrix4(M,u),a.normal.toArray(S,C),S[C+3]=a.constant}f.value=S,f.needsUpdate=!0}return e.numPlanes=A,e.numIntersection=0,S}}function Rz(i){let e=new WeakMap;function t(a,u){return u===jg?a.mapping=Rl:u===e0&&(a.mapping=bl),a}function n(a){if(a&&a.isTexture){const u=a.mapping;if(u===jg||u===e0)if(e.has(a)){const f=e.get(a).texture;return t(f,a.mapping)}else{const f=a.image;if(f&&f.height>0){const c=new CV(f.height);return c.fromEquirectangularTexture(i,a),e.set(a,c),a.addEventListener("dispose",s),t(c.texture,a.mapping)}else return null}}return a}function s(a){const u=a.target;u.removeEventListener("dispose",s);const f=e.get(u);f!==void 0&&(e.delete(u),f.dispose())}function r(){e=new WeakMap}return{get:n,dispose:r}}const dl=4,OA=[.125,.215,.35,.446,.526,.582],jo=20,sg=new OV,FA=new hn;let rg=null,og=0,ag=0,lg=!1;const Qo=(1+Math.sqrt(5))/2,sl=1/Qo,kA=[new xe(-Qo,sl,0),new xe(Qo,sl,0),new xe(-sl,0,Qo),new xe(sl,0,Qo),new xe(0,Qo,-sl),new xe(0,Qo,sl),new xe(-1,1,-1),new xe(1,1,-1),new xe(-1,1,1),new xe(1,1,1)];class BA{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,s=100){rg=this._renderer.getRenderTarget(),og=this._renderer.getActiveCubeFace(),ag=this._renderer.getActiveMipmapLevel(),lg=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,n,s,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=HA(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=VA(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(rg,og,ag),this._renderer.xr.enabled=lg,e.scissorTest=!1,ed(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Rl||e.mapping===bl?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),rg=this._renderer.getRenderTarget(),og=this._renderer.getActiveCubeFace(),ag=this._renderer.getActiveMipmapLevel(),lg=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:Oi,minFilter:Oi,generateMipmaps:!1,type:ju,format:bs,colorSpace:Il,depthBuffer:!1},s=GA(e,t,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=GA(e,t,n);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=bz(r)),this._blurMaterial=Mz(r,e,t)}return s}_compileMaterial(e){const t=new Hs(this._lodPlanes[0],e);this._renderer.compile(t,sg)}_sceneToCubeUV(e,t,n,s){const u=new fs(90,1,t,n),f=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],d=this._renderer,p=d.autoClear,m=d.toneMapping;d.getClearColor(FA),d.toneMapping=mo,d.autoClear=!1;const y=new Ev({name:"PMREM.Background",side:Fi,depthWrite:!1,depthTest:!1}),E=new Hs(new nc,y);let A=!1;const S=e.background;S?S.isColor&&(y.color.copy(S),e.background=null,A=!0):(y.color.copy(FA),A=!0);for(let x=0;x<6;x++){const M=x%3;M===0?(u.up.set(0,f[x],0),u.lookAt(c[x],0,0)):M===1?(u.up.set(0,0,f[x]),u.lookAt(0,c[x],0)):(u.up.set(0,f[x],0),u.lookAt(0,0,c[x]));const b=this._cubeSize;ed(s,M*b,x>2?b:0,b,b),d.setRenderTarget(s),A&&d.render(E,u),d.render(e,u)}E.geometry.dispose(),E.material.dispose(),d.toneMapping=m,d.autoClear=p,e.background=S}_textureToCubeUV(e,t){const n=this._renderer,s=e.mapping===Rl||e.mapping===bl;s?(this._cubemapMaterial===null&&(this._cubemapMaterial=HA()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=VA());const r=s?this._cubemapMaterial:this._equirectMaterial,a=new Hs(this._lodPlanes[0],r),u=r.uniforms;u.envMap.value=e;const f=this._cubeSize;ed(t,0,0,3*f,2*f),n.setRenderTarget(t),n.render(a,sg)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const s=this._lodPlanes.length;for(let r=1;r<s;r++){const a=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),u=kA[(s-r-1)%kA.length];this._blur(e,r-1,r,a,u)}t.autoClear=n}_blur(e,t,n,s,r){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,n,s,"latitudinal",r),this._halfBlur(a,e,n,n,s,"longitudinal",r)}_halfBlur(e,t,n,s,r,a,u){const f=this._renderer,c=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const d=3,p=new Hs(this._lodPlanes[s],c),m=c.uniforms,y=this._sizeLods[n]-1,E=isFinite(r)?Math.PI/(2*y):2*Math.PI/(2*jo-1),A=r/E,S=isFinite(r)?1+Math.floor(d*A):jo;S>jo&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${S} samples when the maximum is set to ${jo}`);const x=[];let M=0;for(let w=0;w<jo;++w){const O=w/A,L=Math.exp(-O*O/2);x.push(L),w===0?M+=L:w<S&&(M+=2*L)}for(let w=0;w<x.length;w++)x[w]=x[w]/M;m.envMap.value=e.texture,m.samples.value=S,m.weights.value=x,m.latitudinal.value=a==="latitudinal",u&&(m.poleAxis.value=u);const{_lodMax:b}=this;m.dTheta.value=E,m.mipInt.value=b-n;const C=this._sizeLods[s],N=3*C*(s>b-dl?s-b+dl:0),U=4*(this._cubeSize-C);ed(t,N,U,3*C,2*C),f.setRenderTarget(t),f.render(p,sg)}}function bz(i){const e=[],t=[],n=[];let s=i;const r=i-dl+1+OA.length;for(let a=0;a<r;a++){const u=Math.pow(2,s);t.push(u);let f=1/u;a>i-dl?f=OA[a-i+dl-1]:a===0&&(f=0),n.push(f);const c=1/(u-2),d=-c,p=1+c,m=[d,d,p,d,p,p,d,d,p,p,d,p],y=6,E=6,A=3,S=2,x=1,M=new Float32Array(A*E*y),b=new Float32Array(S*E*y),C=new Float32Array(x*E*y);for(let U=0;U<y;U++){const w=U%3*2/3-1,O=U>2?0:-1,L=[w,O,0,w+2/3,O,0,w+2/3,O+1,0,w,O,0,w+2/3,O+1,0,w,O+1,0];M.set(L,A*E*U),b.set(m,S*E*U);const I=[U,U,U,U,U,U];C.set(I,x*E*U)}const N=new So;N.setAttribute("position",new zs(M,A)),N.setAttribute("uv",new zs(b,S)),N.setAttribute("faceIndex",new zs(C,x)),e.push(N),s>dl&&s--}return{lodPlanes:e,sizeLods:t,sigmas:n}}function GA(i,e,t){const n=new ra(i,e,t);return n.texture.mapping=Jd,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function ed(i,e,t,n,s){i.viewport.set(e,t,n,s),i.scissor.set(e,t,n,s)}function Mz(i,e,t){const n=new Float32Array(jo),s=new xe(0,1,0);return new _o({name:"SphericalGaussianBlur",defines:{n:jo,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${i}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:s}},vertexShader:Sv(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:po,depthTest:!1,depthWrite:!1})}function VA(){return new _o({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Sv(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:po,depthTest:!1,depthWrite:!1})}function HA(){return new _o({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Sv(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:po,depthTest:!1,depthWrite:!1})}function Sv(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function Cz(i){let e=new WeakMap,t=null;function n(u){if(u&&u.isTexture){const f=u.mapping,c=f===jg||f===e0,d=f===Rl||f===bl;if(c||d){let p=e.get(u);const m=p!==void 0?p.texture.pmremVersion:0;if(u.isRenderTargetTexture&&u.pmremVersion!==m)return t===null&&(t=new BA(i)),p=c?t.fromEquirectangular(u,p):t.fromCubemap(u,p),p.texture.pmremVersion=u.pmremVersion,e.set(u,p),p.texture;if(p!==void 0)return p.texture;{const y=u.image;return c&&y&&y.height>0||d&&y&&s(y)?(t===null&&(t=new BA(i)),p=c?t.fromEquirectangular(u):t.fromCubemap(u),p.texture.pmremVersion=u.pmremVersion,e.set(u,p),u.addEventListener("dispose",r),p.texture):null}}}return u}function s(u){let f=0;const c=6;for(let d=0;d<c;d++)u[d]!==void 0&&f++;return f===c}function r(u){const f=u.target;f.removeEventListener("dispose",r);const c=e.get(f);c!==void 0&&(e.delete(f),c.dispose())}function a(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:n,dispose:a}}function Iz(i){const e={};function t(n){if(e[n]!==void 0)return e[n];let s;switch(n){case"WEBGL_depth_texture":s=i.getExtension("WEBGL_depth_texture")||i.getExtension("MOZ_WEBGL_depth_texture")||i.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":s=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":s=i.getExtension("WEBGL_compressed_texture_s3tc")||i.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":s=i.getExtension("WEBGL_compressed_texture_pvrtc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:s=i.getExtension(n)}return e[n]=s,s}return{has:function(n){return t(n)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(n){const s=t(n);return s===null&&ll("THREE.WebGLRenderer: "+n+" extension not supported."),s}}}function Lz(i,e,t,n){const s={},r=new WeakMap;function a(p){const m=p.target;m.index!==null&&e.remove(m.index);for(const E in m.attributes)e.remove(m.attributes[E]);m.removeEventListener("dispose",a),delete s[m.id];const y=r.get(m);y&&(e.remove(y),r.delete(m)),n.releaseStatesOfGeometry(m),m.isInstancedBufferGeometry===!0&&delete m._maxInstanceCount,t.memory.geometries--}function u(p,m){return s[m.id]===!0||(m.addEventListener("dispose",a),s[m.id]=!0,t.memory.geometries++),m}function f(p){const m=p.attributes;for(const y in m)e.update(m[y],i.ARRAY_BUFFER)}function c(p){const m=[],y=p.index,E=p.attributes.position;let A=0;if(y!==null){const M=y.array;A=y.version;for(let b=0,C=M.length;b<C;b+=3){const N=M[b+0],U=M[b+1],w=M[b+2];m.push(N,U,U,w,w,N)}}else if(E!==void 0){const M=E.array;A=E.version;for(let b=0,C=M.length/3-1;b<C;b+=3){const N=b+0,U=b+1,w=b+2;m.push(N,U,U,w,w,N)}}else return;const S=new(WM(m)?ZM:QM)(m,1);S.version=A;const x=r.get(p);x&&e.remove(x),r.set(p,S)}function d(p){const m=r.get(p);if(m){const y=p.index;y!==null&&m.version<y.version&&c(p)}else c(p);return r.get(p)}return{get:u,update:f,getWireframeAttribute:d}}function Dz(i,e,t){let n;function s(m){n=m}let r,a;function u(m){r=m.type,a=m.bytesPerElement}function f(m,y){i.drawElements(n,y,r,m*a),t.update(y,n,1)}function c(m,y,E){E!==0&&(i.drawElementsInstanced(n,y,r,m*a,E),t.update(y,n,E))}function d(m,y,E){if(E===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(n,y,0,r,m,0,E);let S=0;for(let x=0;x<E;x++)S+=y[x];t.update(S,n,1)}function p(m,y,E,A){if(E===0)return;const S=e.get("WEBGL_multi_draw");if(S===null)for(let x=0;x<m.length;x++)c(m[x]/a,y[x],A[x]);else{S.multiDrawElementsInstancedWEBGL(n,y,0,r,m,0,A,0,E);let x=0;for(let M=0;M<E;M++)x+=y[M]*A[M];t.update(x,n,1)}}this.setMode=s,this.setIndex=u,this.render=f,this.renderInstances=c,this.renderMultiDraw=d,this.renderMultiDrawInstances=p}function wz(i){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(r,a,u){switch(t.calls++,a){case i.TRIANGLES:t.triangles+=u*(r/3);break;case i.LINES:t.lines+=u*(r/2);break;case i.LINE_STRIP:t.lines+=u*(r-1);break;case i.LINE_LOOP:t.lines+=u*r;break;case i.POINTS:t.points+=u*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function s(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:s,update:n}}function Pz(i,e,t){const n=new WeakMap,s=new Un;function r(a,u,f){const c=a.morphTargetInfluences,d=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,p=d!==void 0?d.length:0;let m=n.get(u);if(m===void 0||m.count!==p){let I=function(){O.dispose(),n.delete(u),u.removeEventListener("dispose",I)};var y=I;m!==void 0&&m.texture.dispose();const E=u.morphAttributes.position!==void 0,A=u.morphAttributes.normal!==void 0,S=u.morphAttributes.color!==void 0,x=u.morphAttributes.position||[],M=u.morphAttributes.normal||[],b=u.morphAttributes.color||[];let C=0;E===!0&&(C=1),A===!0&&(C=2),S===!0&&(C=3);let N=u.attributes.position.count*C,U=1;N>e.maxTextureSize&&(U=Math.ceil(N/e.maxTextureSize),N=e.maxTextureSize);const w=new Float32Array(N*U*4*p),O=new YM(w,N,U,p);O.type=xr,O.needsUpdate=!0;const L=C*4;for(let F=0;F<p;F++){const X=x[F],Y=M[F],ee=b[F],ne=N*U*4*F;for(let V=0;V<X.count;V++){const W=V*L;E===!0&&(s.fromBufferAttribute(X,V),w[ne+W+0]=s.x,w[ne+W+1]=s.y,w[ne+W+2]=s.z,w[ne+W+3]=0),A===!0&&(s.fromBufferAttribute(Y,V),w[ne+W+4]=s.x,w[ne+W+5]=s.y,w[ne+W+6]=s.z,w[ne+W+7]=0),S===!0&&(s.fromBufferAttribute(ee,V),w[ne+W+8]=s.x,w[ne+W+9]=s.y,w[ne+W+10]=s.z,w[ne+W+11]=ee.itemSize===4?s.w:1)}}m={count:p,texture:O,size:new _n(N,U)},n.set(u,m),u.addEventListener("dispose",I)}if(a.isInstancedMesh===!0&&a.morphTexture!==null)f.getUniforms().setValue(i,"morphTexture",a.morphTexture,t);else{let E=0;for(let S=0;S<c.length;S++)E+=c[S];const A=u.morphTargetsRelative?1:1-E;f.getUniforms().setValue(i,"morphTargetBaseInfluence",A),f.getUniforms().setValue(i,"morphTargetInfluences",c)}f.getUniforms().setValue(i,"morphTargetsTexture",m.texture,t),f.getUniforms().setValue(i,"morphTargetsTextureSize",m.size)}return{update:r}}function Nz(i,e,t,n){let s=new WeakMap;function r(f){const c=n.render.frame,d=f.geometry,p=e.get(f,d);if(s.get(p)!==c&&(e.update(p),s.set(p,c)),f.isInstancedMesh&&(f.hasEventListener("dispose",u)===!1&&f.addEventListener("dispose",u),s.get(f)!==c&&(t.update(f.instanceMatrix,i.ARRAY_BUFFER),f.instanceColor!==null&&t.update(f.instanceColor,i.ARRAY_BUFFER),s.set(f,c))),f.isSkinnedMesh){const m=f.skeleton;s.get(m)!==c&&(m.update(),s.set(m,c))}return p}function a(){s=new WeakMap}function u(f){const c=f.target;c.removeEventListener("dispose",u),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return{update:r,dispose:a}}const rC=new xi,zA=new iC(1,1),oC=new YM,aC=new cV,lC=new tC,$A=[],qA=[],WA=new Float32Array(16),KA=new Float32Array(9),YA=new Float32Array(4);function Ol(i,e,t){const n=i[0];if(n<=0||n>0)return i;const s=e*t;let r=$A[s];if(r===void 0&&(r=new Float32Array(s),$A[s]=r),e!==0){n.toArray(r,0);for(let a=1,u=0;a!==e;++a)u+=t,i[a].toArray(r,u)}return r}function Jn(i,e){if(i.length!==e.length)return!1;for(let t=0,n=i.length;t<n;t++)if(i[t]!==e[t])return!1;return!0}function Qn(i,e){for(let t=0,n=e.length;t<n;t++)i[t]=e[t]}function jd(i,e){let t=qA[e];t===void 0&&(t=new Int32Array(e),qA[e]=t);for(let n=0;n!==e;++n)t[n]=i.allocateTextureUnit();return t}function Uz(i,e){const t=this.cache;t[0]!==e&&(i.uniform1f(this.addr,e),t[0]=e)}function Oz(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Jn(t,e))return;i.uniform2fv(this.addr,e),Qn(t,e)}}function Fz(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(i.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Jn(t,e))return;i.uniform3fv(this.addr,e),Qn(t,e)}}function kz(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Jn(t,e))return;i.uniform4fv(this.addr,e),Qn(t,e)}}function Bz(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(Jn(t,e))return;i.uniformMatrix2fv(this.addr,!1,e),Qn(t,e)}else{if(Jn(t,n))return;YA.set(n),i.uniformMatrix2fv(this.addr,!1,YA),Qn(t,n)}}function Gz(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(Jn(t,e))return;i.uniformMatrix3fv(this.addr,!1,e),Qn(t,e)}else{if(Jn(t,n))return;KA.set(n),i.uniformMatrix3fv(this.addr,!1,KA),Qn(t,n)}}function Vz(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(Jn(t,e))return;i.uniformMatrix4fv(this.addr,!1,e),Qn(t,e)}else{if(Jn(t,n))return;WA.set(n),i.uniformMatrix4fv(this.addr,!1,WA),Qn(t,n)}}function Hz(i,e){const t=this.cache;t[0]!==e&&(i.uniform1i(this.addr,e),t[0]=e)}function zz(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Jn(t,e))return;i.uniform2iv(this.addr,e),Qn(t,e)}}function $z(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Jn(t,e))return;i.uniform3iv(this.addr,e),Qn(t,e)}}function qz(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Jn(t,e))return;i.uniform4iv(this.addr,e),Qn(t,e)}}function Wz(i,e){const t=this.cache;t[0]!==e&&(i.uniform1ui(this.addr,e),t[0]=e)}function Kz(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Jn(t,e))return;i.uniform2uiv(this.addr,e),Qn(t,e)}}function Yz(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Jn(t,e))return;i.uniform3uiv(this.addr,e),Qn(t,e)}}function Xz(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Jn(t,e))return;i.uniform4uiv(this.addr,e),Qn(t,e)}}function Jz(i,e,t){const n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s);let r;this.type===i.SAMPLER_2D_SHADOW?(zA.compareFunction=qM,r=zA):r=rC,t.setTexture2D(e||r,s)}function Qz(i,e,t){const n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s),t.setTexture3D(e||aC,s)}function Zz(i,e,t){const n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s),t.setTextureCube(e||lC,s)}function jz(i,e,t){const n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s),t.setTexture2DArray(e||oC,s)}function e5(i){switch(i){case 5126:return Uz;case 35664:return Oz;case 35665:return Fz;case 35666:return kz;case 35674:return Bz;case 35675:return Gz;case 35676:return Vz;case 5124:case 35670:return Hz;case 35667:case 35671:return zz;case 35668:case 35672:return $z;case 35669:case 35673:return qz;case 5125:return Wz;case 36294:return Kz;case 36295:return Yz;case 36296:return Xz;case 35678:case 36198:case 36298:case 36306:case 35682:return Jz;case 35679:case 36299:case 36307:return Qz;case 35680:case 36300:case 36308:case 36293:return Zz;case 36289:case 36303:case 36311:case 36292:return jz}}function t5(i,e){i.uniform1fv(this.addr,e)}function n5(i,e){const t=Ol(e,this.size,2);i.uniform2fv(this.addr,t)}function i5(i,e){const t=Ol(e,this.size,3);i.uniform3fv(this.addr,t)}function s5(i,e){const t=Ol(e,this.size,4);i.uniform4fv(this.addr,t)}function r5(i,e){const t=Ol(e,this.size,4);i.uniformMatrix2fv(this.addr,!1,t)}function o5(i,e){const t=Ol(e,this.size,9);i.uniformMatrix3fv(this.addr,!1,t)}function a5(i,e){const t=Ol(e,this.size,16);i.uniformMatrix4fv(this.addr,!1,t)}function l5(i,e){i.uniform1iv(this.addr,e)}function u5(i,e){i.uniform2iv(this.addr,e)}function c5(i,e){i.uniform3iv(this.addr,e)}function f5(i,e){i.uniform4iv(this.addr,e)}function d5(i,e){i.uniform1uiv(this.addr,e)}function h5(i,e){i.uniform2uiv(this.addr,e)}function p5(i,e){i.uniform3uiv(this.addr,e)}function m5(i,e){i.uniform4uiv(this.addr,e)}function g5(i,e,t){const n=this.cache,s=e.length,r=jd(t,s);Jn(n,r)||(i.uniform1iv(this.addr,r),Qn(n,r));for(let a=0;a!==s;++a)t.setTexture2D(e[a]||rC,r[a])}function v5(i,e,t){const n=this.cache,s=e.length,r=jd(t,s);Jn(n,r)||(i.uniform1iv(this.addr,r),Qn(n,r));for(let a=0;a!==s;++a)t.setTexture3D(e[a]||aC,r[a])}function y5(i,e,t){const n=this.cache,s=e.length,r=jd(t,s);Jn(n,r)||(i.uniform1iv(this.addr,r),Qn(n,r));for(let a=0;a!==s;++a)t.setTextureCube(e[a]||lC,r[a])}function _5(i,e,t){const n=this.cache,s=e.length,r=jd(t,s);Jn(n,r)||(i.uniform1iv(this.addr,r),Qn(n,r));for(let a=0;a!==s;++a)t.setTexture2DArray(e[a]||oC,r[a])}function E5(i){switch(i){case 5126:return t5;case 35664:return n5;case 35665:return i5;case 35666:return s5;case 35674:return r5;case 35675:return o5;case 35676:return a5;case 5124:case 35670:return l5;case 35667:case 35671:return u5;case 35668:case 35672:return c5;case 35669:case 35673:return f5;case 5125:return d5;case 36294:return h5;case 36295:return p5;case 36296:return m5;case 35678:case 36198:case 36298:case 36306:case 35682:return g5;case 35679:case 36299:case 36307:return v5;case 35680:case 36300:case 36308:case 36293:return y5;case 36289:case 36303:case 36311:case 36292:return _5}}class S5{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=e5(t.type)}}class T5{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=E5(t.type)}}class x5{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const s=this.seq;for(let r=0,a=s.length;r!==a;++r){const u=s[r];u.setValue(e,t[u.id],n)}}}const ug=/(\w+)(\])?(\[|\.)?/g;function XA(i,e){i.seq.push(e),i.map[e.id]=e}function A5(i,e,t){const n=i.name,s=n.length;for(ug.lastIndex=0;;){const r=ug.exec(n),a=ug.lastIndex;let u=r[1];const f=r[2]==="]",c=r[3];if(f&&(u=u|0),c===void 0||c==="["&&a+2===s){XA(t,c===void 0?new S5(u,i,e):new T5(u,i,e));break}else{let p=t.map[u];p===void 0&&(p=new x5(u),XA(t,p)),t=p}}}class yd{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let s=0;s<n;++s){const r=e.getActiveUniform(t,s),a=e.getUniformLocation(t,r.name);A5(r,a,this)}}setValue(e,t,n,s){const r=this.map[t];r!==void 0&&r.setValue(e,n,s)}setOptional(e,t,n){const s=t[n];s!==void 0&&this.setValue(e,n,s)}static upload(e,t,n,s){for(let r=0,a=t.length;r!==a;++r){const u=t[r],f=n[u.id];f.needsUpdate!==!1&&u.setValue(e,f.value,s)}}static seqWithValue(e,t){const n=[];for(let s=0,r=e.length;s!==r;++s){const a=e[s];a.id in t&&n.push(a)}return n}}function JA(i,e,t){const n=i.createShader(e);return i.shaderSource(n,t),i.compileShader(n),n}const R5=37297;let b5=0;function M5(i,e){const t=i.split(`
`),n=[],s=Math.max(e-6,0),r=Math.min(e+6,t.length);for(let a=s;a<r;a++){const u=a+1;n.push(`${u===e?">":" "} ${u}: ${t[a]}`)}return n.join(`
`)}const QA=new Lt;function C5(i){Qt._getMatrix(QA,Qt.workingColorSpace,i);const e=`mat3( ${QA.elements.map(t=>t.toFixed(4))} )`;switch(Qt.getTransfer(i)){case Od:return[e,"LinearTransferOETF"];case dn:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",i),[e,"LinearTransferOETF"]}}function ZA(i,e,t){const n=i.getShaderParameter(e,i.COMPILE_STATUS),s=i.getShaderInfoLog(e).trim();if(n&&s==="")return"";const r=/ERROR: 0:(\d+)/.exec(s);if(r){const a=parseInt(r[1]);return t.toUpperCase()+`

`+s+`

`+M5(i.getShaderSource(e),a)}else return s}function I5(i,e){const t=C5(e);return[`vec4 ${i}( vec4 value ) {`,`	return ${t[1]}( vec4( value.rgb * ${t[0]}, value.a ) );`,"}"].join(`
`)}function L5(i,e){let t;switch(e){case EG:t="Linear";break;case SG:t="Reinhard";break;case TG:t="Cineon";break;case xG:t="ACESFilmic";break;case RG:t="AgX";break;case bG:t="Neutral";break;case AG:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+i+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const td=new xe;function D5(){Qt.getLuminanceCoefficients(td);const i=td.x.toFixed(4),e=td.y.toFixed(4),t=td.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${i}, ${e}, ${t} );`,"	return dot( weights, rgb );","}"].join(`
`)}function w5(i){return[i.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",i.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(Ou).join(`
`)}function P5(i){const e=[];for(const t in i){const n=i[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join(`
`)}function N5(i,e){const t={},n=i.getProgramParameter(e,i.ACTIVE_ATTRIBUTES);for(let s=0;s<n;s++){const r=i.getActiveAttrib(e,s),a=r.name;let u=1;r.type===i.FLOAT_MAT2&&(u=2),r.type===i.FLOAT_MAT3&&(u=3),r.type===i.FLOAT_MAT4&&(u=4),t[a]={type:r.type,location:i.getAttribLocation(e,a),locationSize:u}}return t}function Ou(i){return i!==""}function jA(i,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return i.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function eR(i,e){return i.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const U5=/^[ \t]*#include +<([\w\d./]+)>/gm;function I0(i){return i.replace(U5,F5)}const O5=new Map;function F5(i,e){let t=wt[e];if(t===void 0){const n=O5.get(e);if(n!==void 0)t=wt[n],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,n);else throw new Error("Can not resolve #include <"+e+">")}return I0(t)}const k5=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function tR(i){return i.replace(k5,B5)}function B5(i,e,t,n){let s="";for(let r=parseInt(e);r<parseInt(t);r++)s+=n.replace(/\[\s*i\s*\]/g,"[ "+r+" ]").replace(/UNROLLED_LOOP_INDEX/g,r);return s}function nR(i){let e=`precision ${i.precision} float;
	precision ${i.precision} int;
	precision ${i.precision} sampler2D;
	precision ${i.precision} samplerCube;
	precision ${i.precision} sampler3D;
	precision ${i.precision} sampler2DArray;
	precision ${i.precision} sampler2DShadow;
	precision ${i.precision} samplerCubeShadow;
	precision ${i.precision} sampler2DArrayShadow;
	precision ${i.precision} isampler2D;
	precision ${i.precision} isampler3D;
	precision ${i.precision} isamplerCube;
	precision ${i.precision} isampler2DArray;
	precision ${i.precision} usampler2D;
	precision ${i.precision} usampler3D;
	precision ${i.precision} usamplerCube;
	precision ${i.precision} usampler2DArray;
	`;return i.precision==="highp"?e+=`
#define HIGH_PRECISION`:i.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:i.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function G5(i){let e="SHADOWMAP_TYPE_BASIC";return i.shadowMapType===wM?e="SHADOWMAP_TYPE_PCF":i.shadowMapType===j3?e="SHADOWMAP_TYPE_PCF_SOFT":i.shadowMapType===yr&&(e="SHADOWMAP_TYPE_VSM"),e}function V5(i){let e="ENVMAP_TYPE_CUBE";if(i.envMap)switch(i.envMapMode){case Rl:case bl:e="ENVMAP_TYPE_CUBE";break;case Jd:e="ENVMAP_TYPE_CUBE_UV";break}return e}function H5(i){let e="ENVMAP_MODE_REFLECTION";if(i.envMap)switch(i.envMapMode){case bl:e="ENVMAP_MODE_REFRACTION";break}return e}function z5(i){let e="ENVMAP_BLENDING_NONE";if(i.envMap)switch(i.combine){case PM:e="ENVMAP_BLENDING_MULTIPLY";break;case yG:e="ENVMAP_BLENDING_MIX";break;case _G:e="ENVMAP_BLENDING_ADD";break}return e}function $5(i){const e=i.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:n,maxMip:t}}function q5(i,e,t,n){const s=i.getContext(),r=t.defines;let a=t.vertexShader,u=t.fragmentShader;const f=G5(t),c=V5(t),d=H5(t),p=z5(t),m=$5(t),y=w5(t),E=P5(r),A=s.createProgram();let S,x,M=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(S=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,E].filter(Ou).join(`
`),S.length>0&&(S+=`
`),x=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,E].filter(Ou).join(`
`),x.length>0&&(x+=`
`)):(S=[nR(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,E,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+d:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+f:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Ou).join(`
`),x=[nR(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,E,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+d:"",t.envMap?"#define "+p:"",m?"#define CUBEUV_TEXEL_WIDTH "+m.texelWidth:"",m?"#define CUBEUV_TEXEL_HEIGHT "+m.texelHeight:"",m?"#define CUBEUV_MAX_MIP "+m.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+f:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==mo?"#define TONE_MAPPING":"",t.toneMapping!==mo?wt.tonemapping_pars_fragment:"",t.toneMapping!==mo?L5("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",wt.colorspace_pars_fragment,I5("linearToOutputTexel",t.outputColorSpace),D5(),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(Ou).join(`
`)),a=I0(a),a=jA(a,t),a=eR(a,t),u=I0(u),u=jA(u,t),u=eR(u,t),a=tR(a),u=tR(u),t.isRawShaderMaterial!==!0&&(M=`#version 300 es
`,S=[y,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+S,x=["#define varying in",t.glslVersion===mA?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===mA?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+x);const b=M+S+a,C=M+x+u,N=JA(s,s.VERTEX_SHADER,b),U=JA(s,s.FRAGMENT_SHADER,C);s.attachShader(A,N),s.attachShader(A,U),t.index0AttributeName!==void 0?s.bindAttribLocation(A,0,t.index0AttributeName):t.morphTargets===!0&&s.bindAttribLocation(A,0,"position"),s.linkProgram(A);function w(F){if(i.debug.checkShaderErrors){const X=s.getProgramInfoLog(A).trim(),Y=s.getShaderInfoLog(N).trim(),ee=s.getShaderInfoLog(U).trim();let ne=!0,V=!0;if(s.getProgramParameter(A,s.LINK_STATUS)===!1)if(ne=!1,typeof i.debug.onShaderError=="function")i.debug.onShaderError(s,A,N,U);else{const W=ZA(s,N,"vertex"),q=ZA(s,U,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(A,s.VALIDATE_STATUS)+`

Material Name: `+F.name+`
Material Type: `+F.type+`

Program Info Log: `+X+`
`+W+`
`+q)}else X!==""?console.warn("THREE.WebGLProgram: Program Info Log:",X):(Y===""||ee==="")&&(V=!1);V&&(F.diagnostics={runnable:ne,programLog:X,vertexShader:{log:Y,prefix:S},fragmentShader:{log:ee,prefix:x}})}s.deleteShader(N),s.deleteShader(U),O=new yd(s,A),L=N5(s,A)}let O;this.getUniforms=function(){return O===void 0&&w(this),O};let L;this.getAttributes=function(){return L===void 0&&w(this),L};let I=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return I===!1&&(I=s.getProgramParameter(A,R5)),I},this.destroy=function(){n.releaseStatesOfProgram(this),s.deleteProgram(A),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=b5++,this.cacheKey=e,this.usedTimes=1,this.program=A,this.vertexShader=N,this.fragmentShader=U,this}let W5=0;class K5{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,s=this._getShaderStage(t),r=this._getShaderStage(n),a=this._getShaderCacheForMaterial(e);return a.has(s)===!1&&(a.add(s),s.usedTimes++),a.has(r)===!1&&(a.add(r),r.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return n===void 0&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return n===void 0&&(n=new Y5(e),t.set(e,n)),n}}class Y5{constructor(e){this.id=W5++,this.code=e,this.usedTimes=0}}function X5(i,e,t,n,s,r,a){const u=new XM,f=new K5,c=new Set,d=[],p=s.logarithmicDepthBuffer,m=s.vertexTextures;let y=s.precision;const E={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function A(L){return c.add(L),L===0?"uv":`uv${L}`}function S(L,I,F,X,Y){const ee=X.fog,ne=Y.geometry,V=L.isMeshStandardMaterial?X.environment:null,W=(L.isMeshStandardMaterial?t:e).get(L.envMap||V),q=W&&W.mapping===Jd?W.image.height:null,oe=E[L.type];L.precision!==null&&(y=s.getMaxPrecision(L.precision),y!==L.precision&&console.warn("THREE.WebGLProgram.getParameters:",L.precision,"not supported, using",y,"instead."));const he=ne.morphAttributes.position||ne.morphAttributes.normal||ne.morphAttributes.color,G=he!==void 0?he.length:0;let K=0;ne.morphAttributes.position!==void 0&&(K=1),ne.morphAttributes.normal!==void 0&&(K=2),ne.morphAttributes.color!==void 0&&(K=3);let fe,Q,ue,ae;if(oe){const Ht=Bs[oe];fe=Ht.vertexShader,Q=Ht.fragmentShader}else fe=L.vertexShader,Q=L.fragmentShader,f.update(L),ue=f.getVertexShaderID(L),ae=f.getFragmentShaderID(L);const Ee=i.getRenderTarget(),pe=i.state.buffers.depth.getReversed(),Ae=Y.isInstancedMesh===!0,Ne=Y.isBatchedMesh===!0,je=!!L.map,Mt=!!L.matcap,rt=!!W,J=!!L.aoMap,On=!!L.lightMap,He=!!L.bumpMap,ut=!!L.normalMap,Qe=!!L.displacementMap,Dt=!!L.emissiveMap,$e=!!L.metalnessMap,$=!!L.roughnessMap,k=L.anisotropy>0,me=L.clearcoat>0,Re=L.dispersion>0,Pe=L.iridescence>0,be=L.sheen>0,nt=L.transmission>0,Be=k&&!!L.anisotropyMap,Fe=me&&!!L.clearcoatMap,Ct=me&&!!L.clearcoatNormalMap,Ue=me&&!!L.clearcoatRoughnessMap,tt=Pe&&!!L.iridescenceMap,st=Pe&&!!L.iridescenceThicknessMap,ot=be&&!!L.sheenColorMap,Ke=be&&!!L.sheenRoughnessMap,ht=!!L.specularMap,At=!!L.specularColorMap,jt=!!L.specularIntensityMap,ie=nt&&!!L.transmissionMap,Ge=nt&&!!L.thicknessMap,Te=!!L.gradientMap,Le=!!L.alphaMap,ze=L.alphaTest>0,Ve=!!L.alphaHash,pt=!!L.extensions;let En=mo;L.toneMapped&&(Ee===null||Ee.isXRRenderTarget===!0)&&(En=i.toneMapping);const Dn={shaderID:oe,shaderType:L.type,shaderName:L.name,vertexShader:fe,fragmentShader:Q,defines:L.defines,customVertexShaderID:ue,customFragmentShaderID:ae,isRawShaderMaterial:L.isRawShaderMaterial===!0,glslVersion:L.glslVersion,precision:y,batching:Ne,batchingColor:Ne&&Y._colorsTexture!==null,instancing:Ae,instancingColor:Ae&&Y.instanceColor!==null,instancingMorph:Ae&&Y.morphTexture!==null,supportsVertexTextures:m,outputColorSpace:Ee===null?i.outputColorSpace:Ee.isXRRenderTarget===!0?Ee.texture.colorSpace:Il,alphaToCoverage:!!L.alphaToCoverage,map:je,matcap:Mt,envMap:rt,envMapMode:rt&&W.mapping,envMapCubeUVHeight:q,aoMap:J,lightMap:On,bumpMap:He,normalMap:ut,displacementMap:m&&Qe,emissiveMap:Dt,normalMapObjectSpace:ut&&L.normalMapType===DG,normalMapTangentSpace:ut&&L.normalMapType===LG,metalnessMap:$e,roughnessMap:$,anisotropy:k,anisotropyMap:Be,clearcoat:me,clearcoatMap:Fe,clearcoatNormalMap:Ct,clearcoatRoughnessMap:Ue,dispersion:Re,iridescence:Pe,iridescenceMap:tt,iridescenceThicknessMap:st,sheen:be,sheenColorMap:ot,sheenRoughnessMap:Ke,specularMap:ht,specularColorMap:At,specularIntensityMap:jt,transmission:nt,transmissionMap:ie,thicknessMap:Ge,gradientMap:Te,opaque:L.transparent===!1&&L.blending===_l&&L.alphaToCoverage===!1,alphaMap:Le,alphaTest:ze,alphaHash:Ve,combine:L.combine,mapUv:je&&A(L.map.channel),aoMapUv:J&&A(L.aoMap.channel),lightMapUv:On&&A(L.lightMap.channel),bumpMapUv:He&&A(L.bumpMap.channel),normalMapUv:ut&&A(L.normalMap.channel),displacementMapUv:Qe&&A(L.displacementMap.channel),emissiveMapUv:Dt&&A(L.emissiveMap.channel),metalnessMapUv:$e&&A(L.metalnessMap.channel),roughnessMapUv:$&&A(L.roughnessMap.channel),anisotropyMapUv:Be&&A(L.anisotropyMap.channel),clearcoatMapUv:Fe&&A(L.clearcoatMap.channel),clearcoatNormalMapUv:Ct&&A(L.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Ue&&A(L.clearcoatRoughnessMap.channel),iridescenceMapUv:tt&&A(L.iridescenceMap.channel),iridescenceThicknessMapUv:st&&A(L.iridescenceThicknessMap.channel),sheenColorMapUv:ot&&A(L.sheenColorMap.channel),sheenRoughnessMapUv:Ke&&A(L.sheenRoughnessMap.channel),specularMapUv:ht&&A(L.specularMap.channel),specularColorMapUv:At&&A(L.specularColorMap.channel),specularIntensityMapUv:jt&&A(L.specularIntensityMap.channel),transmissionMapUv:ie&&A(L.transmissionMap.channel),thicknessMapUv:Ge&&A(L.thicknessMap.channel),alphaMapUv:Le&&A(L.alphaMap.channel),vertexTangents:!!ne.attributes.tangent&&(ut||k),vertexColors:L.vertexColors,vertexAlphas:L.vertexColors===!0&&!!ne.attributes.color&&ne.attributes.color.itemSize===4,pointsUvs:Y.isPoints===!0&&!!ne.attributes.uv&&(je||Le),fog:!!ee,useFog:L.fog===!0,fogExp2:!!ee&&ee.isFogExp2,flatShading:L.flatShading===!0,sizeAttenuation:L.sizeAttenuation===!0,logarithmicDepthBuffer:p,reverseDepthBuffer:pe,skinning:Y.isSkinnedMesh===!0,morphTargets:ne.morphAttributes.position!==void 0,morphNormals:ne.morphAttributes.normal!==void 0,morphColors:ne.morphAttributes.color!==void 0,morphTargetsCount:G,morphTextureStride:K,numDirLights:I.directional.length,numPointLights:I.point.length,numSpotLights:I.spot.length,numSpotLightMaps:I.spotLightMap.length,numRectAreaLights:I.rectArea.length,numHemiLights:I.hemi.length,numDirLightShadows:I.directionalShadowMap.length,numPointLightShadows:I.pointShadowMap.length,numSpotLightShadows:I.spotShadowMap.length,numSpotLightShadowsWithMaps:I.numSpotLightShadowsWithMaps,numLightProbes:I.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:L.dithering,shadowMapEnabled:i.shadowMap.enabled&&F.length>0,shadowMapType:i.shadowMap.type,toneMapping:En,decodeVideoTexture:je&&L.map.isVideoTexture===!0&&Qt.getTransfer(L.map.colorSpace)===dn,decodeVideoTextureEmissive:Dt&&L.emissiveMap.isVideoTexture===!0&&Qt.getTransfer(L.emissiveMap.colorSpace)===dn,premultipliedAlpha:L.premultipliedAlpha,doubleSided:L.side===Tr,flipSided:L.side===Fi,useDepthPacking:L.depthPacking>=0,depthPacking:L.depthPacking||0,index0AttributeName:L.index0AttributeName,extensionClipCullDistance:pt&&L.extensions.clipCullDistance===!0&&n.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(pt&&L.extensions.multiDraw===!0||Ne)&&n.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:n.has("KHR_parallel_shader_compile"),customProgramCacheKey:L.customProgramCacheKey()};return Dn.vertexUv1s=c.has(1),Dn.vertexUv2s=c.has(2),Dn.vertexUv3s=c.has(3),c.clear(),Dn}function x(L){const I=[];if(L.shaderID?I.push(L.shaderID):(I.push(L.customVertexShaderID),I.push(L.customFragmentShaderID)),L.defines!==void 0)for(const F in L.defines)I.push(F),I.push(L.defines[F]);return L.isRawShaderMaterial===!1&&(M(I,L),b(I,L),I.push(i.outputColorSpace)),I.push(L.customProgramCacheKey),I.join()}function M(L,I){L.push(I.precision),L.push(I.outputColorSpace),L.push(I.envMapMode),L.push(I.envMapCubeUVHeight),L.push(I.mapUv),L.push(I.alphaMapUv),L.push(I.lightMapUv),L.push(I.aoMapUv),L.push(I.bumpMapUv),L.push(I.normalMapUv),L.push(I.displacementMapUv),L.push(I.emissiveMapUv),L.push(I.metalnessMapUv),L.push(I.roughnessMapUv),L.push(I.anisotropyMapUv),L.push(I.clearcoatMapUv),L.push(I.clearcoatNormalMapUv),L.push(I.clearcoatRoughnessMapUv),L.push(I.iridescenceMapUv),L.push(I.iridescenceThicknessMapUv),L.push(I.sheenColorMapUv),L.push(I.sheenRoughnessMapUv),L.push(I.specularMapUv),L.push(I.specularColorMapUv),L.push(I.specularIntensityMapUv),L.push(I.transmissionMapUv),L.push(I.thicknessMapUv),L.push(I.combine),L.push(I.fogExp2),L.push(I.sizeAttenuation),L.push(I.morphTargetsCount),L.push(I.morphAttributeCount),L.push(I.numDirLights),L.push(I.numPointLights),L.push(I.numSpotLights),L.push(I.numSpotLightMaps),L.push(I.numHemiLights),L.push(I.numRectAreaLights),L.push(I.numDirLightShadows),L.push(I.numPointLightShadows),L.push(I.numSpotLightShadows),L.push(I.numSpotLightShadowsWithMaps),L.push(I.numLightProbes),L.push(I.shadowMapType),L.push(I.toneMapping),L.push(I.numClippingPlanes),L.push(I.numClipIntersection),L.push(I.depthPacking)}function b(L,I){u.disableAll(),I.supportsVertexTextures&&u.enable(0),I.instancing&&u.enable(1),I.instancingColor&&u.enable(2),I.instancingMorph&&u.enable(3),I.matcap&&u.enable(4),I.envMap&&u.enable(5),I.normalMapObjectSpace&&u.enable(6),I.normalMapTangentSpace&&u.enable(7),I.clearcoat&&u.enable(8),I.iridescence&&u.enable(9),I.alphaTest&&u.enable(10),I.vertexColors&&u.enable(11),I.vertexAlphas&&u.enable(12),I.vertexUv1s&&u.enable(13),I.vertexUv2s&&u.enable(14),I.vertexUv3s&&u.enable(15),I.vertexTangents&&u.enable(16),I.anisotropy&&u.enable(17),I.alphaHash&&u.enable(18),I.batching&&u.enable(19),I.dispersion&&u.enable(20),I.batchingColor&&u.enable(21),L.push(u.mask),u.disableAll(),I.fog&&u.enable(0),I.useFog&&u.enable(1),I.flatShading&&u.enable(2),I.logarithmicDepthBuffer&&u.enable(3),I.reverseDepthBuffer&&u.enable(4),I.skinning&&u.enable(5),I.morphTargets&&u.enable(6),I.morphNormals&&u.enable(7),I.morphColors&&u.enable(8),I.premultipliedAlpha&&u.enable(9),I.shadowMapEnabled&&u.enable(10),I.doubleSided&&u.enable(11),I.flipSided&&u.enable(12),I.useDepthPacking&&u.enable(13),I.dithering&&u.enable(14),I.transmission&&u.enable(15),I.sheen&&u.enable(16),I.opaque&&u.enable(17),I.pointsUvs&&u.enable(18),I.decodeVideoTexture&&u.enable(19),I.decodeVideoTextureEmissive&&u.enable(20),I.alphaToCoverage&&u.enable(21),L.push(u.mask)}function C(L){const I=E[L.type];let F;if(I){const X=Bs[I];F=AV.clone(X.uniforms)}else F=L.uniforms;return F}function N(L,I){let F;for(let X=0,Y=d.length;X<Y;X++){const ee=d[X];if(ee.cacheKey===I){F=ee,++F.usedTimes;break}}return F===void 0&&(F=new q5(i,I,L,r),d.push(F)),F}function U(L){if(--L.usedTimes===0){const I=d.indexOf(L);d[I]=d[d.length-1],d.pop(),L.destroy()}}function w(L){f.remove(L)}function O(){f.dispose()}return{getParameters:S,getProgramCacheKey:x,getUniforms:C,acquireProgram:N,releaseProgram:U,releaseShaderCache:w,programs:d,dispose:O}}function J5(){let i=new WeakMap;function e(a){return i.has(a)}function t(a){let u=i.get(a);return u===void 0&&(u={},i.set(a,u)),u}function n(a){i.delete(a)}function s(a,u,f){i.get(a)[u]=f}function r(){i=new WeakMap}return{has:e,get:t,remove:n,update:s,dispose:r}}function Q5(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.material.id!==e.material.id?i.material.id-e.material.id:i.z!==e.z?i.z-e.z:i.id-e.id}function iR(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.z!==e.z?e.z-i.z:i.id-e.id}function sR(){const i=[];let e=0;const t=[],n=[],s=[];function r(){e=0,t.length=0,n.length=0,s.length=0}function a(p,m,y,E,A,S){let x=i[e];return x===void 0?(x={id:p.id,object:p,geometry:m,material:y,groupOrder:E,renderOrder:p.renderOrder,z:A,group:S},i[e]=x):(x.id=p.id,x.object=p,x.geometry=m,x.material=y,x.groupOrder=E,x.renderOrder=p.renderOrder,x.z=A,x.group=S),e++,x}function u(p,m,y,E,A,S){const x=a(p,m,y,E,A,S);y.transmission>0?n.push(x):y.transparent===!0?s.push(x):t.push(x)}function f(p,m,y,E,A,S){const x=a(p,m,y,E,A,S);y.transmission>0?n.unshift(x):y.transparent===!0?s.unshift(x):t.unshift(x)}function c(p,m){t.length>1&&t.sort(p||Q5),n.length>1&&n.sort(m||iR),s.length>1&&s.sort(m||iR)}function d(){for(let p=e,m=i.length;p<m;p++){const y=i[p];if(y.id===null)break;y.id=null,y.object=null,y.geometry=null,y.material=null,y.group=null}}return{opaque:t,transmissive:n,transparent:s,init:r,push:u,unshift:f,finish:d,sort:c}}function Z5(){let i=new WeakMap;function e(n,s){const r=i.get(n);let a;return r===void 0?(a=new sR,i.set(n,[a])):s>=r.length?(a=new sR,r.push(a)):a=r[s],a}function t(){i=new WeakMap}return{get:e,dispose:t}}function j5(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new xe,color:new hn};break;case"SpotLight":t={position:new xe,direction:new xe,color:new hn,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new xe,color:new hn,distance:0,decay:0};break;case"HemisphereLight":t={direction:new xe,skyColor:new hn,groundColor:new hn};break;case"RectAreaLight":t={color:new hn,position:new xe,halfWidth:new xe,halfHeight:new xe};break}return i[e.id]=t,t}}}function e8(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new _n};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new _n};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new _n,shadowCameraNear:1,shadowCameraFar:1e3};break}return i[e.id]=t,t}}}let t8=0;function n8(i,e){return(e.castShadow?2:0)-(i.castShadow?2:0)+(e.map?1:0)-(i.map?1:0)}function i8(i){const e=new j5,t=e8(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let c=0;c<9;c++)n.probe.push(new xe);const s=new xe,r=new Hn,a=new Hn;function u(c){let d=0,p=0,m=0;for(let L=0;L<9;L++)n.probe[L].set(0,0,0);let y=0,E=0,A=0,S=0,x=0,M=0,b=0,C=0,N=0,U=0,w=0;c.sort(n8);for(let L=0,I=c.length;L<I;L++){const F=c[L],X=F.color,Y=F.intensity,ee=F.distance,ne=F.shadow&&F.shadow.map?F.shadow.map.texture:null;if(F.isAmbientLight)d+=X.r*Y,p+=X.g*Y,m+=X.b*Y;else if(F.isLightProbe){for(let V=0;V<9;V++)n.probe[V].addScaledVector(F.sh.coefficients[V],Y);w++}else if(F.isDirectionalLight){const V=e.get(F);if(V.color.copy(F.color).multiplyScalar(F.intensity),F.castShadow){const W=F.shadow,q=t.get(F);q.shadowIntensity=W.intensity,q.shadowBias=W.bias,q.shadowNormalBias=W.normalBias,q.shadowRadius=W.radius,q.shadowMapSize=W.mapSize,n.directionalShadow[y]=q,n.directionalShadowMap[y]=ne,n.directionalShadowMatrix[y]=F.shadow.matrix,M++}n.directional[y]=V,y++}else if(F.isSpotLight){const V=e.get(F);V.position.setFromMatrixPosition(F.matrixWorld),V.color.copy(X).multiplyScalar(Y),V.distance=ee,V.coneCos=Math.cos(F.angle),V.penumbraCos=Math.cos(F.angle*(1-F.penumbra)),V.decay=F.decay,n.spot[A]=V;const W=F.shadow;if(F.map&&(n.spotLightMap[N]=F.map,N++,W.updateMatrices(F),F.castShadow&&U++),n.spotLightMatrix[A]=W.matrix,F.castShadow){const q=t.get(F);q.shadowIntensity=W.intensity,q.shadowBias=W.bias,q.shadowNormalBias=W.normalBias,q.shadowRadius=W.radius,q.shadowMapSize=W.mapSize,n.spotShadow[A]=q,n.spotShadowMap[A]=ne,C++}A++}else if(F.isRectAreaLight){const V=e.get(F);V.color.copy(X).multiplyScalar(Y),V.halfWidth.set(F.width*.5,0,0),V.halfHeight.set(0,F.height*.5,0),n.rectArea[S]=V,S++}else if(F.isPointLight){const V=e.get(F);if(V.color.copy(F.color).multiplyScalar(F.intensity),V.distance=F.distance,V.decay=F.decay,F.castShadow){const W=F.shadow,q=t.get(F);q.shadowIntensity=W.intensity,q.shadowBias=W.bias,q.shadowNormalBias=W.normalBias,q.shadowRadius=W.radius,q.shadowMapSize=W.mapSize,q.shadowCameraNear=W.camera.near,q.shadowCameraFar=W.camera.far,n.pointShadow[E]=q,n.pointShadowMap[E]=ne,n.pointShadowMatrix[E]=F.shadow.matrix,b++}n.point[E]=V,E++}else if(F.isHemisphereLight){const V=e.get(F);V.skyColor.copy(F.color).multiplyScalar(Y),V.groundColor.copy(F.groundColor).multiplyScalar(Y),n.hemi[x]=V,x++}}S>0&&(i.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=We.LTC_FLOAT_1,n.rectAreaLTC2=We.LTC_FLOAT_2):(n.rectAreaLTC1=We.LTC_HALF_1,n.rectAreaLTC2=We.LTC_HALF_2)),n.ambient[0]=d,n.ambient[1]=p,n.ambient[2]=m;const O=n.hash;(O.directionalLength!==y||O.pointLength!==E||O.spotLength!==A||O.rectAreaLength!==S||O.hemiLength!==x||O.numDirectionalShadows!==M||O.numPointShadows!==b||O.numSpotShadows!==C||O.numSpotMaps!==N||O.numLightProbes!==w)&&(n.directional.length=y,n.spot.length=A,n.rectArea.length=S,n.point.length=E,n.hemi.length=x,n.directionalShadow.length=M,n.directionalShadowMap.length=M,n.pointShadow.length=b,n.pointShadowMap.length=b,n.spotShadow.length=C,n.spotShadowMap.length=C,n.directionalShadowMatrix.length=M,n.pointShadowMatrix.length=b,n.spotLightMatrix.length=C+N-U,n.spotLightMap.length=N,n.numSpotLightShadowsWithMaps=U,n.numLightProbes=w,O.directionalLength=y,O.pointLength=E,O.spotLength=A,O.rectAreaLength=S,O.hemiLength=x,O.numDirectionalShadows=M,O.numPointShadows=b,O.numSpotShadows=C,O.numSpotMaps=N,O.numLightProbes=w,n.version=t8++)}function f(c,d){let p=0,m=0,y=0,E=0,A=0;const S=d.matrixWorldInverse;for(let x=0,M=c.length;x<M;x++){const b=c[x];if(b.isDirectionalLight){const C=n.directional[p];C.direction.setFromMatrixPosition(b.matrixWorld),s.setFromMatrixPosition(b.target.matrixWorld),C.direction.sub(s),C.direction.transformDirection(S),p++}else if(b.isSpotLight){const C=n.spot[y];C.position.setFromMatrixPosition(b.matrixWorld),C.position.applyMatrix4(S),C.direction.setFromMatrixPosition(b.matrixWorld),s.setFromMatrixPosition(b.target.matrixWorld),C.direction.sub(s),C.direction.transformDirection(S),y++}else if(b.isRectAreaLight){const C=n.rectArea[E];C.position.setFromMatrixPosition(b.matrixWorld),C.position.applyMatrix4(S),a.identity(),r.copy(b.matrixWorld),r.premultiply(S),a.extractRotation(r),C.halfWidth.set(b.width*.5,0,0),C.halfHeight.set(0,b.height*.5,0),C.halfWidth.applyMatrix4(a),C.halfHeight.applyMatrix4(a),E++}else if(b.isPointLight){const C=n.point[m];C.position.setFromMatrixPosition(b.matrixWorld),C.position.applyMatrix4(S),m++}else if(b.isHemisphereLight){const C=n.hemi[A];C.direction.setFromMatrixPosition(b.matrixWorld),C.direction.transformDirection(S),A++}}}return{setup:u,setupView:f,state:n}}function rR(i){const e=new i8(i),t=[],n=[];function s(d){c.camera=d,t.length=0,n.length=0}function r(d){t.push(d)}function a(d){n.push(d)}function u(){e.setup(t)}function f(d){e.setupView(t,d)}const c={lightsArray:t,shadowsArray:n,camera:null,lights:e,transmissionRenderTarget:{}};return{init:s,state:c,setupLights:u,setupLightsView:f,pushLight:r,pushShadow:a}}function s8(i){let e=new WeakMap;function t(s,r=0){const a=e.get(s);let u;return a===void 0?(u=new rR(i),e.set(s,[u])):r>=a.length?(u=new rR(i),a.push(u)):u=a[r],u}function n(){e=new WeakMap}return{get:t,dispose:n}}const r8=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,o8=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function a8(i,e,t){let n=new nC;const s=new _n,r=new _n,a=new Un,u=new NV({depthPacking:IG}),f=new UV,c={},d=t.maxTextureSize,p={[yo]:Fi,[Fi]:yo,[Tr]:Tr},m=new _o({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new _n},radius:{value:4}},vertexShader:r8,fragmentShader:o8}),y=m.clone();y.defines.HORIZONTAL_PASS=1;const E=new So;E.setAttribute("position",new zs(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const A=new Hs(E,m),S=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=wM;let x=this.type;this.render=function(U,w,O){if(S.enabled===!1||S.autoUpdate===!1&&S.needsUpdate===!1||U.length===0)return;const L=i.getRenderTarget(),I=i.getActiveCubeFace(),F=i.getActiveMipmapLevel(),X=i.state;X.setBlending(po),X.buffers.color.setClear(1,1,1,1),X.buffers.depth.setTest(!0),X.setScissorTest(!1);const Y=x!==yr&&this.type===yr,ee=x===yr&&this.type!==yr;for(let ne=0,V=U.length;ne<V;ne++){const W=U[ne],q=W.shadow;if(q===void 0){console.warn("THREE.WebGLShadowMap:",W,"has no shadow.");continue}if(q.autoUpdate===!1&&q.needsUpdate===!1)continue;s.copy(q.mapSize);const oe=q.getFrameExtents();if(s.multiply(oe),r.copy(q.mapSize),(s.x>d||s.y>d)&&(s.x>d&&(r.x=Math.floor(d/oe.x),s.x=r.x*oe.x,q.mapSize.x=r.x),s.y>d&&(r.y=Math.floor(d/oe.y),s.y=r.y*oe.y,q.mapSize.y=r.y)),q.map===null||Y===!0||ee===!0){const G=this.type!==yr?{minFilter:Is,magFilter:Is}:{};q.map!==null&&q.map.dispose(),q.map=new ra(s.x,s.y,G),q.map.texture.name=W.name+".shadowMap",q.camera.updateProjectionMatrix()}i.setRenderTarget(q.map),i.clear();const he=q.getViewportCount();for(let G=0;G<he;G++){const K=q.getViewport(G);a.set(r.x*K.x,r.y*K.y,r.x*K.z,r.y*K.w),X.viewport(a),q.updateMatrices(W,G),n=q.getFrustum(),C(w,O,q.camera,W,this.type)}q.isPointLightShadow!==!0&&this.type===yr&&M(q,O),q.needsUpdate=!1}x=this.type,S.needsUpdate=!1,i.setRenderTarget(L,I,F)};function M(U,w){const O=e.update(A);m.defines.VSM_SAMPLES!==U.blurSamples&&(m.defines.VSM_SAMPLES=U.blurSamples,y.defines.VSM_SAMPLES=U.blurSamples,m.needsUpdate=!0,y.needsUpdate=!0),U.mapPass===null&&(U.mapPass=new ra(s.x,s.y)),m.uniforms.shadow_pass.value=U.map.texture,m.uniforms.resolution.value=U.mapSize,m.uniforms.radius.value=U.radius,i.setRenderTarget(U.mapPass),i.clear(),i.renderBufferDirect(w,null,O,m,A,null),y.uniforms.shadow_pass.value=U.mapPass.texture,y.uniforms.resolution.value=U.mapSize,y.uniforms.radius.value=U.radius,i.setRenderTarget(U.map),i.clear(),i.renderBufferDirect(w,null,O,y,A,null)}function b(U,w,O,L){let I=null;const F=O.isPointLight===!0?U.customDistanceMaterial:U.customDepthMaterial;if(F!==void 0)I=F;else if(I=O.isPointLight===!0?f:u,i.localClippingEnabled&&w.clipShadows===!0&&Array.isArray(w.clippingPlanes)&&w.clippingPlanes.length!==0||w.displacementMap&&w.displacementScale!==0||w.alphaMap&&w.alphaTest>0||w.map&&w.alphaTest>0){const X=I.uuid,Y=w.uuid;let ee=c[X];ee===void 0&&(ee={},c[X]=ee);let ne=ee[Y];ne===void 0&&(ne=I.clone(),ee[Y]=ne,w.addEventListener("dispose",N)),I=ne}if(I.visible=w.visible,I.wireframe=w.wireframe,L===yr?I.side=w.shadowSide!==null?w.shadowSide:w.side:I.side=w.shadowSide!==null?w.shadowSide:p[w.side],I.alphaMap=w.alphaMap,I.alphaTest=w.alphaTest,I.map=w.map,I.clipShadows=w.clipShadows,I.clippingPlanes=w.clippingPlanes,I.clipIntersection=w.clipIntersection,I.displacementMap=w.displacementMap,I.displacementScale=w.displacementScale,I.displacementBias=w.displacementBias,I.wireframeLinewidth=w.wireframeLinewidth,I.linewidth=w.linewidth,O.isPointLight===!0&&I.isMeshDistanceMaterial===!0){const X=i.properties.get(I);X.light=O}return I}function C(U,w,O,L,I){if(U.visible===!1)return;if(U.layers.test(w.layers)&&(U.isMesh||U.isLine||U.isPoints)&&(U.castShadow||U.receiveShadow&&I===yr)&&(!U.frustumCulled||n.intersectsObject(U))){U.modelViewMatrix.multiplyMatrices(O.matrixWorldInverse,U.matrixWorld);const Y=e.update(U),ee=U.material;if(Array.isArray(ee)){const ne=Y.groups;for(let V=0,W=ne.length;V<W;V++){const q=ne[V],oe=ee[q.materialIndex];if(oe&&oe.visible){const he=b(U,oe,L,I);U.onBeforeShadow(i,U,w,O,Y,he,q),i.renderBufferDirect(O,null,Y,he,U,q),U.onAfterShadow(i,U,w,O,Y,he,q)}}}else if(ee.visible){const ne=b(U,ee,L,I);U.onBeforeShadow(i,U,w,O,Y,ne,null),i.renderBufferDirect(O,null,Y,ne,U,null),U.onAfterShadow(i,U,w,O,Y,ne,null)}}const X=U.children;for(let Y=0,ee=X.length;Y<ee;Y++)C(X[Y],w,O,L,I)}function N(U){U.target.removeEventListener("dispose",N);for(const O in c){const L=c[O],I=U.target.uuid;I in L&&(L[I].dispose(),delete L[I])}}}const l8={[Wg]:Kg,[Yg]:Qg,[Xg]:Zg,[Al]:Jg,[Kg]:Wg,[Qg]:Yg,[Zg]:Xg,[Jg]:Al};function u8(i,e){function t(){let ie=!1;const Ge=new Un;let Te=null;const Le=new Un(0,0,0,0);return{setMask:function(ze){Te!==ze&&!ie&&(i.colorMask(ze,ze,ze,ze),Te=ze)},setLocked:function(ze){ie=ze},setClear:function(ze,Ve,pt,En,Dn){Dn===!0&&(ze*=En,Ve*=En,pt*=En),Ge.set(ze,Ve,pt,En),Le.equals(Ge)===!1&&(i.clearColor(ze,Ve,pt,En),Le.copy(Ge))},reset:function(){ie=!1,Te=null,Le.set(-1,0,0,0)}}}function n(){let ie=!1,Ge=!1,Te=null,Le=null,ze=null;return{setReversed:function(Ve){if(Ge!==Ve){const pt=e.get("EXT_clip_control");Ge?pt.clipControlEXT(pt.LOWER_LEFT_EXT,pt.ZERO_TO_ONE_EXT):pt.clipControlEXT(pt.LOWER_LEFT_EXT,pt.NEGATIVE_ONE_TO_ONE_EXT);const En=ze;ze=null,this.setClear(En)}Ge=Ve},getReversed:function(){return Ge},setTest:function(Ve){Ve?Ee(i.DEPTH_TEST):pe(i.DEPTH_TEST)},setMask:function(Ve){Te!==Ve&&!ie&&(i.depthMask(Ve),Te=Ve)},setFunc:function(Ve){if(Ge&&(Ve=l8[Ve]),Le!==Ve){switch(Ve){case Wg:i.depthFunc(i.NEVER);break;case Kg:i.depthFunc(i.ALWAYS);break;case Yg:i.depthFunc(i.LESS);break;case Al:i.depthFunc(i.LEQUAL);break;case Xg:i.depthFunc(i.EQUAL);break;case Jg:i.depthFunc(i.GEQUAL);break;case Qg:i.depthFunc(i.GREATER);break;case Zg:i.depthFunc(i.NOTEQUAL);break;default:i.depthFunc(i.LEQUAL)}Le=Ve}},setLocked:function(Ve){ie=Ve},setClear:function(Ve){ze!==Ve&&(Ge&&(Ve=1-Ve),i.clearDepth(Ve),ze=Ve)},reset:function(){ie=!1,Te=null,Le=null,ze=null,Ge=!1}}}function s(){let ie=!1,Ge=null,Te=null,Le=null,ze=null,Ve=null,pt=null,En=null,Dn=null;return{setTest:function(Ht){ie||(Ht?Ee(i.STENCIL_TEST):pe(i.STENCIL_TEST))},setMask:function(Ht){Ge!==Ht&&!ie&&(i.stencilMask(Ht),Ge=Ht)},setFunc:function(Ht,zn,ki){(Te!==Ht||Le!==zn||ze!==ki)&&(i.stencilFunc(Ht,zn,ki),Te=Ht,Le=zn,ze=ki)},setOp:function(Ht,zn,ki){(Ve!==Ht||pt!==zn||En!==ki)&&(i.stencilOp(Ht,zn,ki),Ve=Ht,pt=zn,En=ki)},setLocked:function(Ht){ie=Ht},setClear:function(Ht){Dn!==Ht&&(i.clearStencil(Ht),Dn=Ht)},reset:function(){ie=!1,Ge=null,Te=null,Le=null,ze=null,Ve=null,pt=null,En=null,Dn=null}}}const r=new t,a=new n,u=new s,f=new WeakMap,c=new WeakMap;let d={},p={},m=new WeakMap,y=[],E=null,A=!1,S=null,x=null,M=null,b=null,C=null,N=null,U=null,w=new hn(0,0,0),O=0,L=!1,I=null,F=null,X=null,Y=null,ee=null;const ne=i.getParameter(i.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let V=!1,W=0;const q=i.getParameter(i.VERSION);q.indexOf("WebGL")!==-1?(W=parseFloat(/^WebGL (\d)/.exec(q)[1]),V=W>=1):q.indexOf("OpenGL ES")!==-1&&(W=parseFloat(/^OpenGL ES (\d)/.exec(q)[1]),V=W>=2);let oe=null,he={};const G=i.getParameter(i.SCISSOR_BOX),K=i.getParameter(i.VIEWPORT),fe=new Un().fromArray(G),Q=new Un().fromArray(K);function ue(ie,Ge,Te,Le){const ze=new Uint8Array(4),Ve=i.createTexture();i.bindTexture(ie,Ve),i.texParameteri(ie,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(ie,i.TEXTURE_MAG_FILTER,i.NEAREST);for(let pt=0;pt<Te;pt++)ie===i.TEXTURE_3D||ie===i.TEXTURE_2D_ARRAY?i.texImage3D(Ge,0,i.RGBA,1,1,Le,0,i.RGBA,i.UNSIGNED_BYTE,ze):i.texImage2D(Ge+pt,0,i.RGBA,1,1,0,i.RGBA,i.UNSIGNED_BYTE,ze);return Ve}const ae={};ae[i.TEXTURE_2D]=ue(i.TEXTURE_2D,i.TEXTURE_2D,1),ae[i.TEXTURE_CUBE_MAP]=ue(i.TEXTURE_CUBE_MAP,i.TEXTURE_CUBE_MAP_POSITIVE_X,6),ae[i.TEXTURE_2D_ARRAY]=ue(i.TEXTURE_2D_ARRAY,i.TEXTURE_2D_ARRAY,1,1),ae[i.TEXTURE_3D]=ue(i.TEXTURE_3D,i.TEXTURE_3D,1,1),r.setClear(0,0,0,1),a.setClear(1),u.setClear(0),Ee(i.DEPTH_TEST),a.setFunc(Al),He(!1),ut(uA),Ee(i.CULL_FACE),J(po);function Ee(ie){d[ie]!==!0&&(i.enable(ie),d[ie]=!0)}function pe(ie){d[ie]!==!1&&(i.disable(ie),d[ie]=!1)}function Ae(ie,Ge){return p[ie]!==Ge?(i.bindFramebuffer(ie,Ge),p[ie]=Ge,ie===i.DRAW_FRAMEBUFFER&&(p[i.FRAMEBUFFER]=Ge),ie===i.FRAMEBUFFER&&(p[i.DRAW_FRAMEBUFFER]=Ge),!0):!1}function Ne(ie,Ge){let Te=y,Le=!1;if(ie){Te=m.get(Ge),Te===void 0&&(Te=[],m.set(Ge,Te));const ze=ie.textures;if(Te.length!==ze.length||Te[0]!==i.COLOR_ATTACHMENT0){for(let Ve=0,pt=ze.length;Ve<pt;Ve++)Te[Ve]=i.COLOR_ATTACHMENT0+Ve;Te.length=ze.length,Le=!0}}else Te[0]!==i.BACK&&(Te[0]=i.BACK,Le=!0);Le&&i.drawBuffers(Te)}function je(ie){return E!==ie?(i.useProgram(ie),E=ie,!0):!1}const Mt={[Zo]:i.FUNC_ADD,[tG]:i.FUNC_SUBTRACT,[nG]:i.FUNC_REVERSE_SUBTRACT};Mt[iG]=i.MIN,Mt[sG]=i.MAX;const rt={[rG]:i.ZERO,[oG]:i.ONE,[aG]:i.SRC_COLOR,[$g]:i.SRC_ALPHA,[hG]:i.SRC_ALPHA_SATURATE,[fG]:i.DST_COLOR,[uG]:i.DST_ALPHA,[lG]:i.ONE_MINUS_SRC_COLOR,[qg]:i.ONE_MINUS_SRC_ALPHA,[dG]:i.ONE_MINUS_DST_COLOR,[cG]:i.ONE_MINUS_DST_ALPHA,[pG]:i.CONSTANT_COLOR,[mG]:i.ONE_MINUS_CONSTANT_COLOR,[gG]:i.CONSTANT_ALPHA,[vG]:i.ONE_MINUS_CONSTANT_ALPHA};function J(ie,Ge,Te,Le,ze,Ve,pt,En,Dn,Ht){if(ie===po){A===!0&&(pe(i.BLEND),A=!1);return}if(A===!1&&(Ee(i.BLEND),A=!0),ie!==eG){if(ie!==S||Ht!==L){if((x!==Zo||C!==Zo)&&(i.blendEquation(i.FUNC_ADD),x=Zo,C=Zo),Ht)switch(ie){case _l:i.blendFuncSeparate(i.ONE,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case cA:i.blendFunc(i.ONE,i.ONE);break;case fA:i.blendFuncSeparate(i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ZERO,i.ONE);break;case dA:i.blendFuncSeparate(i.ZERO,i.SRC_COLOR,i.ZERO,i.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",ie);break}else switch(ie){case _l:i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case cA:i.blendFunc(i.SRC_ALPHA,i.ONE);break;case fA:i.blendFuncSeparate(i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ZERO,i.ONE);break;case dA:i.blendFunc(i.ZERO,i.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",ie);break}M=null,b=null,N=null,U=null,w.set(0,0,0),O=0,S=ie,L=Ht}return}ze=ze||Ge,Ve=Ve||Te,pt=pt||Le,(Ge!==x||ze!==C)&&(i.blendEquationSeparate(Mt[Ge],Mt[ze]),x=Ge,C=ze),(Te!==M||Le!==b||Ve!==N||pt!==U)&&(i.blendFuncSeparate(rt[Te],rt[Le],rt[Ve],rt[pt]),M=Te,b=Le,N=Ve,U=pt),(En.equals(w)===!1||Dn!==O)&&(i.blendColor(En.r,En.g,En.b,Dn),w.copy(En),O=Dn),S=ie,L=!1}function On(ie,Ge){ie.side===Tr?pe(i.CULL_FACE):Ee(i.CULL_FACE);let Te=ie.side===Fi;Ge&&(Te=!Te),He(Te),ie.blending===_l&&ie.transparent===!1?J(po):J(ie.blending,ie.blendEquation,ie.blendSrc,ie.blendDst,ie.blendEquationAlpha,ie.blendSrcAlpha,ie.blendDstAlpha,ie.blendColor,ie.blendAlpha,ie.premultipliedAlpha),a.setFunc(ie.depthFunc),a.setTest(ie.depthTest),a.setMask(ie.depthWrite),r.setMask(ie.colorWrite);const Le=ie.stencilWrite;u.setTest(Le),Le&&(u.setMask(ie.stencilWriteMask),u.setFunc(ie.stencilFunc,ie.stencilRef,ie.stencilFuncMask),u.setOp(ie.stencilFail,ie.stencilZFail,ie.stencilZPass)),Dt(ie.polygonOffset,ie.polygonOffsetFactor,ie.polygonOffsetUnits),ie.alphaToCoverage===!0?Ee(i.SAMPLE_ALPHA_TO_COVERAGE):pe(i.SAMPLE_ALPHA_TO_COVERAGE)}function He(ie){I!==ie&&(ie?i.frontFace(i.CW):i.frontFace(i.CCW),I=ie)}function ut(ie){ie!==Q3?(Ee(i.CULL_FACE),ie!==F&&(ie===uA?i.cullFace(i.BACK):ie===Z3?i.cullFace(i.FRONT):i.cullFace(i.FRONT_AND_BACK))):pe(i.CULL_FACE),F=ie}function Qe(ie){ie!==X&&(V&&i.lineWidth(ie),X=ie)}function Dt(ie,Ge,Te){ie?(Ee(i.POLYGON_OFFSET_FILL),(Y!==Ge||ee!==Te)&&(i.polygonOffset(Ge,Te),Y=Ge,ee=Te)):pe(i.POLYGON_OFFSET_FILL)}function $e(ie){ie?Ee(i.SCISSOR_TEST):pe(i.SCISSOR_TEST)}function $(ie){ie===void 0&&(ie=i.TEXTURE0+ne-1),oe!==ie&&(i.activeTexture(ie),oe=ie)}function k(ie,Ge,Te){Te===void 0&&(oe===null?Te=i.TEXTURE0+ne-1:Te=oe);let Le=he[Te];Le===void 0&&(Le={type:void 0,texture:void 0},he[Te]=Le),(Le.type!==ie||Le.texture!==Ge)&&(oe!==Te&&(i.activeTexture(Te),oe=Te),i.bindTexture(ie,Ge||ae[ie]),Le.type=ie,Le.texture=Ge)}function me(){const ie=he[oe];ie!==void 0&&ie.type!==void 0&&(i.bindTexture(ie.type,null),ie.type=void 0,ie.texture=void 0)}function Re(){try{i.compressedTexImage2D.apply(i,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function Pe(){try{i.compressedTexImage3D.apply(i,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function be(){try{i.texSubImage2D.apply(i,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function nt(){try{i.texSubImage3D.apply(i,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function Be(){try{i.compressedTexSubImage2D.apply(i,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function Fe(){try{i.compressedTexSubImage3D.apply(i,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function Ct(){try{i.texStorage2D.apply(i,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function Ue(){try{i.texStorage3D.apply(i,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function tt(){try{i.texImage2D.apply(i,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function st(){try{i.texImage3D.apply(i,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function ot(ie){fe.equals(ie)===!1&&(i.scissor(ie.x,ie.y,ie.z,ie.w),fe.copy(ie))}function Ke(ie){Q.equals(ie)===!1&&(i.viewport(ie.x,ie.y,ie.z,ie.w),Q.copy(ie))}function ht(ie,Ge){let Te=c.get(Ge);Te===void 0&&(Te=new WeakMap,c.set(Ge,Te));let Le=Te.get(ie);Le===void 0&&(Le=i.getUniformBlockIndex(Ge,ie.name),Te.set(ie,Le))}function At(ie,Ge){const Le=c.get(Ge).get(ie);f.get(Ge)!==Le&&(i.uniformBlockBinding(Ge,Le,ie.__bindingPointIndex),f.set(Ge,Le))}function jt(){i.disable(i.BLEND),i.disable(i.CULL_FACE),i.disable(i.DEPTH_TEST),i.disable(i.POLYGON_OFFSET_FILL),i.disable(i.SCISSOR_TEST),i.disable(i.STENCIL_TEST),i.disable(i.SAMPLE_ALPHA_TO_COVERAGE),i.blendEquation(i.FUNC_ADD),i.blendFunc(i.ONE,i.ZERO),i.blendFuncSeparate(i.ONE,i.ZERO,i.ONE,i.ZERO),i.blendColor(0,0,0,0),i.colorMask(!0,!0,!0,!0),i.clearColor(0,0,0,0),i.depthMask(!0),i.depthFunc(i.LESS),a.setReversed(!1),i.clearDepth(1),i.stencilMask(4294967295),i.stencilFunc(i.ALWAYS,0,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.KEEP),i.clearStencil(0),i.cullFace(i.BACK),i.frontFace(i.CCW),i.polygonOffset(0,0),i.activeTexture(i.TEXTURE0),i.bindFramebuffer(i.FRAMEBUFFER,null),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),i.bindFramebuffer(i.READ_FRAMEBUFFER,null),i.useProgram(null),i.lineWidth(1),i.scissor(0,0,i.canvas.width,i.canvas.height),i.viewport(0,0,i.canvas.width,i.canvas.height),d={},oe=null,he={},p={},m=new WeakMap,y=[],E=null,A=!1,S=null,x=null,M=null,b=null,C=null,N=null,U=null,w=new hn(0,0,0),O=0,L=!1,I=null,F=null,X=null,Y=null,ee=null,fe.set(0,0,i.canvas.width,i.canvas.height),Q.set(0,0,i.canvas.width,i.canvas.height),r.reset(),a.reset(),u.reset()}return{buffers:{color:r,depth:a,stencil:u},enable:Ee,disable:pe,bindFramebuffer:Ae,drawBuffers:Ne,useProgram:je,setBlending:J,setMaterial:On,setFlipSided:He,setCullFace:ut,setLineWidth:Qe,setPolygonOffset:Dt,setScissorTest:$e,activeTexture:$,bindTexture:k,unbindTexture:me,compressedTexImage2D:Re,compressedTexImage3D:Pe,texImage2D:tt,texImage3D:st,updateUBOMapping:ht,uniformBlockBinding:At,texStorage2D:Ct,texStorage3D:Ue,texSubImage2D:be,texSubImage3D:nt,compressedTexSubImage2D:Be,compressedTexSubImage3D:Fe,scissor:ot,viewport:Ke,reset:jt}}function c8(i,e,t,n,s,r,a){const u=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,f=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),c=new _n,d=new WeakMap;let p;const m=new WeakMap;let y=!1;try{y=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function E($,k){return y?new OffscreenCanvas($,k):kd("canvas")}function A($,k,me){let Re=1;const Pe=$e($);if((Pe.width>me||Pe.height>me)&&(Re=me/Math.max(Pe.width,Pe.height)),Re<1)if(typeof HTMLImageElement<"u"&&$ instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&$ instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&$ instanceof ImageBitmap||typeof VideoFrame<"u"&&$ instanceof VideoFrame){const be=Math.floor(Re*Pe.width),nt=Math.floor(Re*Pe.height);p===void 0&&(p=E(be,nt));const Be=k?E(be,nt):p;return Be.width=be,Be.height=nt,Be.getContext("2d").drawImage($,0,0,be,nt),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Pe.width+"x"+Pe.height+") to ("+be+"x"+nt+")."),Be}else return"data"in $&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Pe.width+"x"+Pe.height+")."),$;return $}function S($){return $.generateMipmaps}function x($){i.generateMipmap($)}function M($){return $.isWebGLCubeRenderTarget?i.TEXTURE_CUBE_MAP:$.isWebGL3DRenderTarget?i.TEXTURE_3D:$.isWebGLArrayRenderTarget||$.isCompressedArrayTexture?i.TEXTURE_2D_ARRAY:i.TEXTURE_2D}function b($,k,me,Re,Pe=!1){if($!==null){if(i[$]!==void 0)return i[$];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+$+"'")}let be=k;if(k===i.RED&&(me===i.FLOAT&&(be=i.R32F),me===i.HALF_FLOAT&&(be=i.R16F),me===i.UNSIGNED_BYTE&&(be=i.R8)),k===i.RED_INTEGER&&(me===i.UNSIGNED_BYTE&&(be=i.R8UI),me===i.UNSIGNED_SHORT&&(be=i.R16UI),me===i.UNSIGNED_INT&&(be=i.R32UI),me===i.BYTE&&(be=i.R8I),me===i.SHORT&&(be=i.R16I),me===i.INT&&(be=i.R32I)),k===i.RG&&(me===i.FLOAT&&(be=i.RG32F),me===i.HALF_FLOAT&&(be=i.RG16F),me===i.UNSIGNED_BYTE&&(be=i.RG8)),k===i.RG_INTEGER&&(me===i.UNSIGNED_BYTE&&(be=i.RG8UI),me===i.UNSIGNED_SHORT&&(be=i.RG16UI),me===i.UNSIGNED_INT&&(be=i.RG32UI),me===i.BYTE&&(be=i.RG8I),me===i.SHORT&&(be=i.RG16I),me===i.INT&&(be=i.RG32I)),k===i.RGB_INTEGER&&(me===i.UNSIGNED_BYTE&&(be=i.RGB8UI),me===i.UNSIGNED_SHORT&&(be=i.RGB16UI),me===i.UNSIGNED_INT&&(be=i.RGB32UI),me===i.BYTE&&(be=i.RGB8I),me===i.SHORT&&(be=i.RGB16I),me===i.INT&&(be=i.RGB32I)),k===i.RGBA_INTEGER&&(me===i.UNSIGNED_BYTE&&(be=i.RGBA8UI),me===i.UNSIGNED_SHORT&&(be=i.RGBA16UI),me===i.UNSIGNED_INT&&(be=i.RGBA32UI),me===i.BYTE&&(be=i.RGBA8I),me===i.SHORT&&(be=i.RGBA16I),me===i.INT&&(be=i.RGBA32I)),k===i.RGB&&me===i.UNSIGNED_INT_5_9_9_9_REV&&(be=i.RGB9_E5),k===i.RGBA){const nt=Pe?Od:Qt.getTransfer(Re);me===i.FLOAT&&(be=i.RGBA32F),me===i.HALF_FLOAT&&(be=i.RGBA16F),me===i.UNSIGNED_BYTE&&(be=nt===dn?i.SRGB8_ALPHA8:i.RGBA8),me===i.UNSIGNED_SHORT_4_4_4_4&&(be=i.RGBA4),me===i.UNSIGNED_SHORT_5_5_5_1&&(be=i.RGB5_A1)}return(be===i.R16F||be===i.R32F||be===i.RG16F||be===i.RG32F||be===i.RGBA16F||be===i.RGBA32F)&&e.get("EXT_color_buffer_float"),be}function C($,k){let me;return $?k===null||k===sa||k===Ml?me=i.DEPTH24_STENCIL8:k===xr?me=i.DEPTH32F_STENCIL8:k===Ju&&(me=i.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):k===null||k===sa||k===Ml?me=i.DEPTH_COMPONENT24:k===xr?me=i.DEPTH_COMPONENT32F:k===Ju&&(me=i.DEPTH_COMPONENT16),me}function N($,k){return S($)===!0||$.isFramebufferTexture&&$.minFilter!==Is&&$.minFilter!==Oi?Math.log2(Math.max(k.width,k.height))+1:$.mipmaps!==void 0&&$.mipmaps.length>0?$.mipmaps.length:$.isCompressedTexture&&Array.isArray($.image)?k.mipmaps.length:1}function U($){const k=$.target;k.removeEventListener("dispose",U),O(k),k.isVideoTexture&&d.delete(k)}function w($){const k=$.target;k.removeEventListener("dispose",w),I(k)}function O($){const k=n.get($);if(k.__webglInit===void 0)return;const me=$.source,Re=m.get(me);if(Re){const Pe=Re[k.__cacheKey];Pe.usedTimes--,Pe.usedTimes===0&&L($),Object.keys(Re).length===0&&m.delete(me)}n.remove($)}function L($){const k=n.get($);i.deleteTexture(k.__webglTexture);const me=$.source,Re=m.get(me);delete Re[k.__cacheKey],a.memory.textures--}function I($){const k=n.get($);if($.depthTexture&&($.depthTexture.dispose(),n.remove($.depthTexture)),$.isWebGLCubeRenderTarget)for(let Re=0;Re<6;Re++){if(Array.isArray(k.__webglFramebuffer[Re]))for(let Pe=0;Pe<k.__webglFramebuffer[Re].length;Pe++)i.deleteFramebuffer(k.__webglFramebuffer[Re][Pe]);else i.deleteFramebuffer(k.__webglFramebuffer[Re]);k.__webglDepthbuffer&&i.deleteRenderbuffer(k.__webglDepthbuffer[Re])}else{if(Array.isArray(k.__webglFramebuffer))for(let Re=0;Re<k.__webglFramebuffer.length;Re++)i.deleteFramebuffer(k.__webglFramebuffer[Re]);else i.deleteFramebuffer(k.__webglFramebuffer);if(k.__webglDepthbuffer&&i.deleteRenderbuffer(k.__webglDepthbuffer),k.__webglMultisampledFramebuffer&&i.deleteFramebuffer(k.__webglMultisampledFramebuffer),k.__webglColorRenderbuffer)for(let Re=0;Re<k.__webglColorRenderbuffer.length;Re++)k.__webglColorRenderbuffer[Re]&&i.deleteRenderbuffer(k.__webglColorRenderbuffer[Re]);k.__webglDepthRenderbuffer&&i.deleteRenderbuffer(k.__webglDepthRenderbuffer)}const me=$.textures;for(let Re=0,Pe=me.length;Re<Pe;Re++){const be=n.get(me[Re]);be.__webglTexture&&(i.deleteTexture(be.__webglTexture),a.memory.textures--),n.remove(me[Re])}n.remove($)}let F=0;function X(){F=0}function Y(){const $=F;return $>=s.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+$+" texture units while this GPU supports only "+s.maxTextures),F+=1,$}function ee($){const k=[];return k.push($.wrapS),k.push($.wrapT),k.push($.wrapR||0),k.push($.magFilter),k.push($.minFilter),k.push($.anisotropy),k.push($.internalFormat),k.push($.format),k.push($.type),k.push($.generateMipmaps),k.push($.premultiplyAlpha),k.push($.flipY),k.push($.unpackAlignment),k.push($.colorSpace),k.join()}function ne($,k){const me=n.get($);if($.isVideoTexture&&Qe($),$.isRenderTargetTexture===!1&&$.version>0&&me.__version!==$.version){const Re=$.image;if(Re===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Re.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Q(me,$,k);return}}t.bindTexture(i.TEXTURE_2D,me.__webglTexture,i.TEXTURE0+k)}function V($,k){const me=n.get($);if($.version>0&&me.__version!==$.version){Q(me,$,k);return}t.bindTexture(i.TEXTURE_2D_ARRAY,me.__webglTexture,i.TEXTURE0+k)}function W($,k){const me=n.get($);if($.version>0&&me.__version!==$.version){Q(me,$,k);return}t.bindTexture(i.TEXTURE_3D,me.__webglTexture,i.TEXTURE0+k)}function q($,k){const me=n.get($);if($.version>0&&me.__version!==$.version){ue(me,$,k);return}t.bindTexture(i.TEXTURE_CUBE_MAP,me.__webglTexture,i.TEXTURE0+k)}const oe={[t0]:i.REPEAT,[ea]:i.CLAMP_TO_EDGE,[n0]:i.MIRRORED_REPEAT},he={[Is]:i.NEAREST,[MG]:i.NEAREST_MIPMAP_NEAREST,[Nf]:i.NEAREST_MIPMAP_LINEAR,[Oi]:i.LINEAR,[Om]:i.LINEAR_MIPMAP_NEAREST,[ta]:i.LINEAR_MIPMAP_LINEAR},G={[wG]:i.NEVER,[kG]:i.ALWAYS,[PG]:i.LESS,[qM]:i.LEQUAL,[NG]:i.EQUAL,[FG]:i.GEQUAL,[UG]:i.GREATER,[OG]:i.NOTEQUAL};function K($,k){if(k.type===xr&&e.has("OES_texture_float_linear")===!1&&(k.magFilter===Oi||k.magFilter===Om||k.magFilter===Nf||k.magFilter===ta||k.minFilter===Oi||k.minFilter===Om||k.minFilter===Nf||k.minFilter===ta)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),i.texParameteri($,i.TEXTURE_WRAP_S,oe[k.wrapS]),i.texParameteri($,i.TEXTURE_WRAP_T,oe[k.wrapT]),($===i.TEXTURE_3D||$===i.TEXTURE_2D_ARRAY)&&i.texParameteri($,i.TEXTURE_WRAP_R,oe[k.wrapR]),i.texParameteri($,i.TEXTURE_MAG_FILTER,he[k.magFilter]),i.texParameteri($,i.TEXTURE_MIN_FILTER,he[k.minFilter]),k.compareFunction&&(i.texParameteri($,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE),i.texParameteri($,i.TEXTURE_COMPARE_FUNC,G[k.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(k.magFilter===Is||k.minFilter!==Nf&&k.minFilter!==ta||k.type===xr&&e.has("OES_texture_float_linear")===!1)return;if(k.anisotropy>1||n.get(k).__currentAnisotropy){const me=e.get("EXT_texture_filter_anisotropic");i.texParameterf($,me.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(k.anisotropy,s.getMaxAnisotropy())),n.get(k).__currentAnisotropy=k.anisotropy}}}function fe($,k){let me=!1;$.__webglInit===void 0&&($.__webglInit=!0,k.addEventListener("dispose",U));const Re=k.source;let Pe=m.get(Re);Pe===void 0&&(Pe={},m.set(Re,Pe));const be=ee(k);if(be!==$.__cacheKey){Pe[be]===void 0&&(Pe[be]={texture:i.createTexture(),usedTimes:0},a.memory.textures++,me=!0),Pe[be].usedTimes++;const nt=Pe[$.__cacheKey];nt!==void 0&&(Pe[$.__cacheKey].usedTimes--,nt.usedTimes===0&&L(k)),$.__cacheKey=be,$.__webglTexture=Pe[be].texture}return me}function Q($,k,me){let Re=i.TEXTURE_2D;(k.isDataArrayTexture||k.isCompressedArrayTexture)&&(Re=i.TEXTURE_2D_ARRAY),k.isData3DTexture&&(Re=i.TEXTURE_3D);const Pe=fe($,k),be=k.source;t.bindTexture(Re,$.__webglTexture,i.TEXTURE0+me);const nt=n.get(be);if(be.version!==nt.__version||Pe===!0){t.activeTexture(i.TEXTURE0+me);const Be=Qt.getPrimaries(Qt.workingColorSpace),Fe=k.colorSpace===fo?null:Qt.getPrimaries(k.colorSpace),Ct=k.colorSpace===fo||Be===Fe?i.NONE:i.BROWSER_DEFAULT_WEBGL;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,k.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,k.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,k.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,Ct);let Ue=A(k.image,!1,s.maxTextureSize);Ue=Dt(k,Ue);const tt=r.convert(k.format,k.colorSpace),st=r.convert(k.type);let ot=b(k.internalFormat,tt,st,k.colorSpace,k.isVideoTexture);K(Re,k);let Ke;const ht=k.mipmaps,At=k.isVideoTexture!==!0,jt=nt.__version===void 0||Pe===!0,ie=be.dataReady,Ge=N(k,Ue);if(k.isDepthTexture)ot=C(k.format===Cl,k.type),jt&&(At?t.texStorage2D(i.TEXTURE_2D,1,ot,Ue.width,Ue.height):t.texImage2D(i.TEXTURE_2D,0,ot,Ue.width,Ue.height,0,tt,st,null));else if(k.isDataTexture)if(ht.length>0){At&&jt&&t.texStorage2D(i.TEXTURE_2D,Ge,ot,ht[0].width,ht[0].height);for(let Te=0,Le=ht.length;Te<Le;Te++)Ke=ht[Te],At?ie&&t.texSubImage2D(i.TEXTURE_2D,Te,0,0,Ke.width,Ke.height,tt,st,Ke.data):t.texImage2D(i.TEXTURE_2D,Te,ot,Ke.width,Ke.height,0,tt,st,Ke.data);k.generateMipmaps=!1}else At?(jt&&t.texStorage2D(i.TEXTURE_2D,Ge,ot,Ue.width,Ue.height),ie&&t.texSubImage2D(i.TEXTURE_2D,0,0,0,Ue.width,Ue.height,tt,st,Ue.data)):t.texImage2D(i.TEXTURE_2D,0,ot,Ue.width,Ue.height,0,tt,st,Ue.data);else if(k.isCompressedTexture)if(k.isCompressedArrayTexture){At&&jt&&t.texStorage3D(i.TEXTURE_2D_ARRAY,Ge,ot,ht[0].width,ht[0].height,Ue.depth);for(let Te=0,Le=ht.length;Te<Le;Te++)if(Ke=ht[Te],k.format!==bs)if(tt!==null)if(At){if(ie)if(k.layerUpdates.size>0){const ze=UA(Ke.width,Ke.height,k.format,k.type);for(const Ve of k.layerUpdates){const pt=Ke.data.subarray(Ve*ze/Ke.data.BYTES_PER_ELEMENT,(Ve+1)*ze/Ke.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(i.TEXTURE_2D_ARRAY,Te,0,0,Ve,Ke.width,Ke.height,1,tt,pt)}k.clearLayerUpdates()}else t.compressedTexSubImage3D(i.TEXTURE_2D_ARRAY,Te,0,0,0,Ke.width,Ke.height,Ue.depth,tt,Ke.data)}else t.compressedTexImage3D(i.TEXTURE_2D_ARRAY,Te,ot,Ke.width,Ke.height,Ue.depth,0,Ke.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else At?ie&&t.texSubImage3D(i.TEXTURE_2D_ARRAY,Te,0,0,0,Ke.width,Ke.height,Ue.depth,tt,st,Ke.data):t.texImage3D(i.TEXTURE_2D_ARRAY,Te,ot,Ke.width,Ke.height,Ue.depth,0,tt,st,Ke.data)}else{At&&jt&&t.texStorage2D(i.TEXTURE_2D,Ge,ot,ht[0].width,ht[0].height);for(let Te=0,Le=ht.length;Te<Le;Te++)Ke=ht[Te],k.format!==bs?tt!==null?At?ie&&t.compressedTexSubImage2D(i.TEXTURE_2D,Te,0,0,Ke.width,Ke.height,tt,Ke.data):t.compressedTexImage2D(i.TEXTURE_2D,Te,ot,Ke.width,Ke.height,0,Ke.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):At?ie&&t.texSubImage2D(i.TEXTURE_2D,Te,0,0,Ke.width,Ke.height,tt,st,Ke.data):t.texImage2D(i.TEXTURE_2D,Te,ot,Ke.width,Ke.height,0,tt,st,Ke.data)}else if(k.isDataArrayTexture)if(At){if(jt&&t.texStorage3D(i.TEXTURE_2D_ARRAY,Ge,ot,Ue.width,Ue.height,Ue.depth),ie)if(k.layerUpdates.size>0){const Te=UA(Ue.width,Ue.height,k.format,k.type);for(const Le of k.layerUpdates){const ze=Ue.data.subarray(Le*Te/Ue.data.BYTES_PER_ELEMENT,(Le+1)*Te/Ue.data.BYTES_PER_ELEMENT);t.texSubImage3D(i.TEXTURE_2D_ARRAY,0,0,0,Le,Ue.width,Ue.height,1,tt,st,ze)}k.clearLayerUpdates()}else t.texSubImage3D(i.TEXTURE_2D_ARRAY,0,0,0,0,Ue.width,Ue.height,Ue.depth,tt,st,Ue.data)}else t.texImage3D(i.TEXTURE_2D_ARRAY,0,ot,Ue.width,Ue.height,Ue.depth,0,tt,st,Ue.data);else if(k.isData3DTexture)At?(jt&&t.texStorage3D(i.TEXTURE_3D,Ge,ot,Ue.width,Ue.height,Ue.depth),ie&&t.texSubImage3D(i.TEXTURE_3D,0,0,0,0,Ue.width,Ue.height,Ue.depth,tt,st,Ue.data)):t.texImage3D(i.TEXTURE_3D,0,ot,Ue.width,Ue.height,Ue.depth,0,tt,st,Ue.data);else if(k.isFramebufferTexture){if(jt)if(At)t.texStorage2D(i.TEXTURE_2D,Ge,ot,Ue.width,Ue.height);else{let Te=Ue.width,Le=Ue.height;for(let ze=0;ze<Ge;ze++)t.texImage2D(i.TEXTURE_2D,ze,ot,Te,Le,0,tt,st,null),Te>>=1,Le>>=1}}else if(ht.length>0){if(At&&jt){const Te=$e(ht[0]);t.texStorage2D(i.TEXTURE_2D,Ge,ot,Te.width,Te.height)}for(let Te=0,Le=ht.length;Te<Le;Te++)Ke=ht[Te],At?ie&&t.texSubImage2D(i.TEXTURE_2D,Te,0,0,tt,st,Ke):t.texImage2D(i.TEXTURE_2D,Te,ot,tt,st,Ke);k.generateMipmaps=!1}else if(At){if(jt){const Te=$e(Ue);t.texStorage2D(i.TEXTURE_2D,Ge,ot,Te.width,Te.height)}ie&&t.texSubImage2D(i.TEXTURE_2D,0,0,0,tt,st,Ue)}else t.texImage2D(i.TEXTURE_2D,0,ot,tt,st,Ue);S(k)&&x(Re),nt.__version=be.version,k.onUpdate&&k.onUpdate(k)}$.__version=k.version}function ue($,k,me){if(k.image.length!==6)return;const Re=fe($,k),Pe=k.source;t.bindTexture(i.TEXTURE_CUBE_MAP,$.__webglTexture,i.TEXTURE0+me);const be=n.get(Pe);if(Pe.version!==be.__version||Re===!0){t.activeTexture(i.TEXTURE0+me);const nt=Qt.getPrimaries(Qt.workingColorSpace),Be=k.colorSpace===fo?null:Qt.getPrimaries(k.colorSpace),Fe=k.colorSpace===fo||nt===Be?i.NONE:i.BROWSER_DEFAULT_WEBGL;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,k.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,k.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,k.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,Fe);const Ct=k.isCompressedTexture||k.image[0].isCompressedTexture,Ue=k.image[0]&&k.image[0].isDataTexture,tt=[];for(let Le=0;Le<6;Le++)!Ct&&!Ue?tt[Le]=A(k.image[Le],!0,s.maxCubemapSize):tt[Le]=Ue?k.image[Le].image:k.image[Le],tt[Le]=Dt(k,tt[Le]);const st=tt[0],ot=r.convert(k.format,k.colorSpace),Ke=r.convert(k.type),ht=b(k.internalFormat,ot,Ke,k.colorSpace),At=k.isVideoTexture!==!0,jt=be.__version===void 0||Re===!0,ie=Pe.dataReady;let Ge=N(k,st);K(i.TEXTURE_CUBE_MAP,k);let Te;if(Ct){At&&jt&&t.texStorage2D(i.TEXTURE_CUBE_MAP,Ge,ht,st.width,st.height);for(let Le=0;Le<6;Le++){Te=tt[Le].mipmaps;for(let ze=0;ze<Te.length;ze++){const Ve=Te[ze];k.format!==bs?ot!==null?At?ie&&t.compressedTexSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Le,ze,0,0,Ve.width,Ve.height,ot,Ve.data):t.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Le,ze,ht,Ve.width,Ve.height,0,Ve.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):At?ie&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Le,ze,0,0,Ve.width,Ve.height,ot,Ke,Ve.data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Le,ze,ht,Ve.width,Ve.height,0,ot,Ke,Ve.data)}}}else{if(Te=k.mipmaps,At&&jt){Te.length>0&&Ge++;const Le=$e(tt[0]);t.texStorage2D(i.TEXTURE_CUBE_MAP,Ge,ht,Le.width,Le.height)}for(let Le=0;Le<6;Le++)if(Ue){At?ie&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Le,0,0,0,tt[Le].width,tt[Le].height,ot,Ke,tt[Le].data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Le,0,ht,tt[Le].width,tt[Le].height,0,ot,Ke,tt[Le].data);for(let ze=0;ze<Te.length;ze++){const pt=Te[ze].image[Le].image;At?ie&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Le,ze+1,0,0,pt.width,pt.height,ot,Ke,pt.data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Le,ze+1,ht,pt.width,pt.height,0,ot,Ke,pt.data)}}else{At?ie&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Le,0,0,0,ot,Ke,tt[Le]):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Le,0,ht,ot,Ke,tt[Le]);for(let ze=0;ze<Te.length;ze++){const Ve=Te[ze];At?ie&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Le,ze+1,0,0,ot,Ke,Ve.image[Le]):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Le,ze+1,ht,ot,Ke,Ve.image[Le])}}}S(k)&&x(i.TEXTURE_CUBE_MAP),be.__version=Pe.version,k.onUpdate&&k.onUpdate(k)}$.__version=k.version}function ae($,k,me,Re,Pe,be){const nt=r.convert(me.format,me.colorSpace),Be=r.convert(me.type),Fe=b(me.internalFormat,nt,Be,me.colorSpace),Ct=n.get(k),Ue=n.get(me);if(Ue.__renderTarget=k,!Ct.__hasExternalTextures){const tt=Math.max(1,k.width>>be),st=Math.max(1,k.height>>be);Pe===i.TEXTURE_3D||Pe===i.TEXTURE_2D_ARRAY?t.texImage3D(Pe,be,Fe,tt,st,k.depth,0,nt,Be,null):t.texImage2D(Pe,be,Fe,tt,st,0,nt,Be,null)}t.bindFramebuffer(i.FRAMEBUFFER,$),ut(k)?u.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,Re,Pe,Ue.__webglTexture,0,He(k)):(Pe===i.TEXTURE_2D||Pe>=i.TEXTURE_CUBE_MAP_POSITIVE_X&&Pe<=i.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&i.framebufferTexture2D(i.FRAMEBUFFER,Re,Pe,Ue.__webglTexture,be),t.bindFramebuffer(i.FRAMEBUFFER,null)}function Ee($,k,me){if(i.bindRenderbuffer(i.RENDERBUFFER,$),k.depthBuffer){const Re=k.depthTexture,Pe=Re&&Re.isDepthTexture?Re.type:null,be=C(k.stencilBuffer,Pe),nt=k.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,Be=He(k);ut(k)?u.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,Be,be,k.width,k.height):me?i.renderbufferStorageMultisample(i.RENDERBUFFER,Be,be,k.width,k.height):i.renderbufferStorage(i.RENDERBUFFER,be,k.width,k.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,nt,i.RENDERBUFFER,$)}else{const Re=k.textures;for(let Pe=0;Pe<Re.length;Pe++){const be=Re[Pe],nt=r.convert(be.format,be.colorSpace),Be=r.convert(be.type),Fe=b(be.internalFormat,nt,Be,be.colorSpace),Ct=He(k);me&&ut(k)===!1?i.renderbufferStorageMultisample(i.RENDERBUFFER,Ct,Fe,k.width,k.height):ut(k)?u.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,Ct,Fe,k.width,k.height):i.renderbufferStorage(i.RENDERBUFFER,Fe,k.width,k.height)}}i.bindRenderbuffer(i.RENDERBUFFER,null)}function pe($,k){if(k&&k.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(i.FRAMEBUFFER,$),!(k.depthTexture&&k.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const Re=n.get(k.depthTexture);Re.__renderTarget=k,(!Re.__webglTexture||k.depthTexture.image.width!==k.width||k.depthTexture.image.height!==k.height)&&(k.depthTexture.image.width=k.width,k.depthTexture.image.height=k.height,k.depthTexture.needsUpdate=!0),ne(k.depthTexture,0);const Pe=Re.__webglTexture,be=He(k);if(k.depthTexture.format===El)ut(k)?u.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,Pe,0,be):i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,Pe,0);else if(k.depthTexture.format===Cl)ut(k)?u.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,Pe,0,be):i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,Pe,0);else throw new Error("Unknown depthTexture format")}function Ae($){const k=n.get($),me=$.isWebGLCubeRenderTarget===!0;if(k.__boundDepthTexture!==$.depthTexture){const Re=$.depthTexture;if(k.__depthDisposeCallback&&k.__depthDisposeCallback(),Re){const Pe=()=>{delete k.__boundDepthTexture,delete k.__depthDisposeCallback,Re.removeEventListener("dispose",Pe)};Re.addEventListener("dispose",Pe),k.__depthDisposeCallback=Pe}k.__boundDepthTexture=Re}if($.depthTexture&&!k.__autoAllocateDepthBuffer){if(me)throw new Error("target.depthTexture not supported in Cube render targets");pe(k.__webglFramebuffer,$)}else if(me){k.__webglDepthbuffer=[];for(let Re=0;Re<6;Re++)if(t.bindFramebuffer(i.FRAMEBUFFER,k.__webglFramebuffer[Re]),k.__webglDepthbuffer[Re]===void 0)k.__webglDepthbuffer[Re]=i.createRenderbuffer(),Ee(k.__webglDepthbuffer[Re],$,!1);else{const Pe=$.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,be=k.__webglDepthbuffer[Re];i.bindRenderbuffer(i.RENDERBUFFER,be),i.framebufferRenderbuffer(i.FRAMEBUFFER,Pe,i.RENDERBUFFER,be)}}else if(t.bindFramebuffer(i.FRAMEBUFFER,k.__webglFramebuffer),k.__webglDepthbuffer===void 0)k.__webglDepthbuffer=i.createRenderbuffer(),Ee(k.__webglDepthbuffer,$,!1);else{const Re=$.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,Pe=k.__webglDepthbuffer;i.bindRenderbuffer(i.RENDERBUFFER,Pe),i.framebufferRenderbuffer(i.FRAMEBUFFER,Re,i.RENDERBUFFER,Pe)}t.bindFramebuffer(i.FRAMEBUFFER,null)}function Ne($,k,me){const Re=n.get($);k!==void 0&&ae(Re.__webglFramebuffer,$,$.texture,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,0),me!==void 0&&Ae($)}function je($){const k=$.texture,me=n.get($),Re=n.get(k);$.addEventListener("dispose",w);const Pe=$.textures,be=$.isWebGLCubeRenderTarget===!0,nt=Pe.length>1;if(nt||(Re.__webglTexture===void 0&&(Re.__webglTexture=i.createTexture()),Re.__version=k.version,a.memory.textures++),be){me.__webglFramebuffer=[];for(let Be=0;Be<6;Be++)if(k.mipmaps&&k.mipmaps.length>0){me.__webglFramebuffer[Be]=[];for(let Fe=0;Fe<k.mipmaps.length;Fe++)me.__webglFramebuffer[Be][Fe]=i.createFramebuffer()}else me.__webglFramebuffer[Be]=i.createFramebuffer()}else{if(k.mipmaps&&k.mipmaps.length>0){me.__webglFramebuffer=[];for(let Be=0;Be<k.mipmaps.length;Be++)me.__webglFramebuffer[Be]=i.createFramebuffer()}else me.__webglFramebuffer=i.createFramebuffer();if(nt)for(let Be=0,Fe=Pe.length;Be<Fe;Be++){const Ct=n.get(Pe[Be]);Ct.__webglTexture===void 0&&(Ct.__webglTexture=i.createTexture(),a.memory.textures++)}if($.samples>0&&ut($)===!1){me.__webglMultisampledFramebuffer=i.createFramebuffer(),me.__webglColorRenderbuffer=[],t.bindFramebuffer(i.FRAMEBUFFER,me.__webglMultisampledFramebuffer);for(let Be=0;Be<Pe.length;Be++){const Fe=Pe[Be];me.__webglColorRenderbuffer[Be]=i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,me.__webglColorRenderbuffer[Be]);const Ct=r.convert(Fe.format,Fe.colorSpace),Ue=r.convert(Fe.type),tt=b(Fe.internalFormat,Ct,Ue,Fe.colorSpace,$.isXRRenderTarget===!0),st=He($);i.renderbufferStorageMultisample(i.RENDERBUFFER,st,tt,$.width,$.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+Be,i.RENDERBUFFER,me.__webglColorRenderbuffer[Be])}i.bindRenderbuffer(i.RENDERBUFFER,null),$.depthBuffer&&(me.__webglDepthRenderbuffer=i.createRenderbuffer(),Ee(me.__webglDepthRenderbuffer,$,!0)),t.bindFramebuffer(i.FRAMEBUFFER,null)}}if(be){t.bindTexture(i.TEXTURE_CUBE_MAP,Re.__webglTexture),K(i.TEXTURE_CUBE_MAP,k);for(let Be=0;Be<6;Be++)if(k.mipmaps&&k.mipmaps.length>0)for(let Fe=0;Fe<k.mipmaps.length;Fe++)ae(me.__webglFramebuffer[Be][Fe],$,k,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+Be,Fe);else ae(me.__webglFramebuffer[Be],$,k,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+Be,0);S(k)&&x(i.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(nt){for(let Be=0,Fe=Pe.length;Be<Fe;Be++){const Ct=Pe[Be],Ue=n.get(Ct);t.bindTexture(i.TEXTURE_2D,Ue.__webglTexture),K(i.TEXTURE_2D,Ct),ae(me.__webglFramebuffer,$,Ct,i.COLOR_ATTACHMENT0+Be,i.TEXTURE_2D,0),S(Ct)&&x(i.TEXTURE_2D)}t.unbindTexture()}else{let Be=i.TEXTURE_2D;if(($.isWebGL3DRenderTarget||$.isWebGLArrayRenderTarget)&&(Be=$.isWebGL3DRenderTarget?i.TEXTURE_3D:i.TEXTURE_2D_ARRAY),t.bindTexture(Be,Re.__webglTexture),K(Be,k),k.mipmaps&&k.mipmaps.length>0)for(let Fe=0;Fe<k.mipmaps.length;Fe++)ae(me.__webglFramebuffer[Fe],$,k,i.COLOR_ATTACHMENT0,Be,Fe);else ae(me.__webglFramebuffer,$,k,i.COLOR_ATTACHMENT0,Be,0);S(k)&&x(Be),t.unbindTexture()}$.depthBuffer&&Ae($)}function Mt($){const k=$.textures;for(let me=0,Re=k.length;me<Re;me++){const Pe=k[me];if(S(Pe)){const be=M($),nt=n.get(Pe).__webglTexture;t.bindTexture(be,nt),x(be),t.unbindTexture()}}}const rt=[],J=[];function On($){if($.samples>0){if(ut($)===!1){const k=$.textures,me=$.width,Re=$.height;let Pe=i.COLOR_BUFFER_BIT;const be=$.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,nt=n.get($),Be=k.length>1;if(Be)for(let Fe=0;Fe<k.length;Fe++)t.bindFramebuffer(i.FRAMEBUFFER,nt.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+Fe,i.RENDERBUFFER,null),t.bindFramebuffer(i.FRAMEBUFFER,nt.__webglFramebuffer),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0+Fe,i.TEXTURE_2D,null,0);t.bindFramebuffer(i.READ_FRAMEBUFFER,nt.__webglMultisampledFramebuffer),t.bindFramebuffer(i.DRAW_FRAMEBUFFER,nt.__webglFramebuffer);for(let Fe=0;Fe<k.length;Fe++){if($.resolveDepthBuffer&&($.depthBuffer&&(Pe|=i.DEPTH_BUFFER_BIT),$.stencilBuffer&&$.resolveStencilBuffer&&(Pe|=i.STENCIL_BUFFER_BIT)),Be){i.framebufferRenderbuffer(i.READ_FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,nt.__webglColorRenderbuffer[Fe]);const Ct=n.get(k[Fe]).__webglTexture;i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,Ct,0)}i.blitFramebuffer(0,0,me,Re,0,0,me,Re,Pe,i.NEAREST),f===!0&&(rt.length=0,J.length=0,rt.push(i.COLOR_ATTACHMENT0+Fe),$.depthBuffer&&$.resolveDepthBuffer===!1&&(rt.push(be),J.push(be),i.invalidateFramebuffer(i.DRAW_FRAMEBUFFER,J)),i.invalidateFramebuffer(i.READ_FRAMEBUFFER,rt))}if(t.bindFramebuffer(i.READ_FRAMEBUFFER,null),t.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),Be)for(let Fe=0;Fe<k.length;Fe++){t.bindFramebuffer(i.FRAMEBUFFER,nt.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+Fe,i.RENDERBUFFER,nt.__webglColorRenderbuffer[Fe]);const Ct=n.get(k[Fe]).__webglTexture;t.bindFramebuffer(i.FRAMEBUFFER,nt.__webglFramebuffer),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0+Fe,i.TEXTURE_2D,Ct,0)}t.bindFramebuffer(i.DRAW_FRAMEBUFFER,nt.__webglMultisampledFramebuffer)}else if($.depthBuffer&&$.resolveDepthBuffer===!1&&f){const k=$.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT;i.invalidateFramebuffer(i.DRAW_FRAMEBUFFER,[k])}}}function He($){return Math.min(s.maxSamples,$.samples)}function ut($){const k=n.get($);return $.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&k.__useRenderToTexture!==!1}function Qe($){const k=a.render.frame;d.get($)!==k&&(d.set($,k),$.update())}function Dt($,k){const me=$.colorSpace,Re=$.format,Pe=$.type;return $.isCompressedTexture===!0||$.isVideoTexture===!0||me!==Il&&me!==fo&&(Qt.getTransfer(me)===dn?(Re!==bs||Pe!==Mr)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",me)),k}function $e($){return typeof HTMLImageElement<"u"&&$ instanceof HTMLImageElement?(c.width=$.naturalWidth||$.width,c.height=$.naturalHeight||$.height):typeof VideoFrame<"u"&&$ instanceof VideoFrame?(c.width=$.displayWidth,c.height=$.displayHeight):(c.width=$.width,c.height=$.height),c}this.allocateTextureUnit=Y,this.resetTextureUnits=X,this.setTexture2D=ne,this.setTexture2DArray=V,this.setTexture3D=W,this.setTextureCube=q,this.rebindTextures=Ne,this.setupRenderTarget=je,this.updateRenderTargetMipmap=Mt,this.updateMultisampleRenderTarget=On,this.setupDepthRenderbuffer=Ae,this.setupFrameBufferTexture=ae,this.useMultisampledRTT=ut}function f8(i,e){function t(n,s=fo){let r;const a=Qt.getTransfer(s);if(n===Mr)return i.UNSIGNED_BYTE;if(n===hv)return i.UNSIGNED_SHORT_4_4_4_4;if(n===pv)return i.UNSIGNED_SHORT_5_5_5_1;if(n===FM)return i.UNSIGNED_INT_5_9_9_9_REV;if(n===UM)return i.BYTE;if(n===OM)return i.SHORT;if(n===Ju)return i.UNSIGNED_SHORT;if(n===dv)return i.INT;if(n===sa)return i.UNSIGNED_INT;if(n===xr)return i.FLOAT;if(n===ju)return i.HALF_FLOAT;if(n===kM)return i.ALPHA;if(n===BM)return i.RGB;if(n===bs)return i.RGBA;if(n===GM)return i.LUMINANCE;if(n===VM)return i.LUMINANCE_ALPHA;if(n===El)return i.DEPTH_COMPONENT;if(n===Cl)return i.DEPTH_STENCIL;if(n===HM)return i.RED;if(n===mv)return i.RED_INTEGER;if(n===zM)return i.RG;if(n===gv)return i.RG_INTEGER;if(n===vv)return i.RGBA_INTEGER;if(n===hd||n===pd||n===md||n===gd)if(a===dn)if(r=e.get("WEBGL_compressed_texture_s3tc_srgb"),r!==null){if(n===hd)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===pd)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===md)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===gd)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(r=e.get("WEBGL_compressed_texture_s3tc"),r!==null){if(n===hd)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===pd)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===md)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===gd)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(n===i0||n===s0||n===r0||n===o0)if(r=e.get("WEBGL_compressed_texture_pvrtc"),r!==null){if(n===i0)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===s0)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===r0)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===o0)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(n===a0||n===l0||n===u0)if(r=e.get("WEBGL_compressed_texture_etc"),r!==null){if(n===a0||n===l0)return a===dn?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(n===u0)return a===dn?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(n===c0||n===f0||n===d0||n===h0||n===p0||n===m0||n===g0||n===v0||n===y0||n===_0||n===E0||n===S0||n===T0||n===x0)if(r=e.get("WEBGL_compressed_texture_astc"),r!==null){if(n===c0)return a===dn?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===f0)return a===dn?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===d0)return a===dn?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===h0)return a===dn?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===p0)return a===dn?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===m0)return a===dn?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===g0)return a===dn?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===v0)return a===dn?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===y0)return a===dn?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===_0)return a===dn?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===E0)return a===dn?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===S0)return a===dn?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===T0)return a===dn?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===x0)return a===dn?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(n===vd||n===A0||n===R0)if(r=e.get("EXT_texture_compression_bptc"),r!==null){if(n===vd)return a===dn?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===A0)return r.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===R0)return r.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(n===$M||n===b0||n===M0||n===C0)if(r=e.get("EXT_texture_compression_rgtc"),r!==null){if(n===vd)return r.COMPRESSED_RED_RGTC1_EXT;if(n===b0)return r.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===M0)return r.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===C0)return r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return n===Ml?i.UNSIGNED_INT_24_8:i[n]!==void 0?i[n]:null}return{convert:t}}const d8=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,h8=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class p8{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,n){if(this.texture===null){const s=new xi,r=e.properties.get(s);r.__webglTexture=t.texture,(t.depthNear!==n.depthNear||t.depthFar!==n.depthFar)&&(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=s}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,n=new _o({vertexShader:d8,fragmentShader:h8,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new Hs(new Zd(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class m8 extends Nl{constructor(e,t){super();const n=this;let s=null,r=1,a=null,u="local-floor",f=1,c=null,d=null,p=null,m=null,y=null,E=null;const A=new p8,S=t.getContextAttributes();let x=null,M=null;const b=[],C=[],N=new _n;let U=null;const w=new fs;w.viewport=new Un;const O=new fs;O.viewport=new Un;const L=[w,O],I=new FV;let F=null,X=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(Q){let ue=b[Q];return ue===void 0&&(ue=new ng,b[Q]=ue),ue.getTargetRaySpace()},this.getControllerGrip=function(Q){let ue=b[Q];return ue===void 0&&(ue=new ng,b[Q]=ue),ue.getGripSpace()},this.getHand=function(Q){let ue=b[Q];return ue===void 0&&(ue=new ng,b[Q]=ue),ue.getHandSpace()};function Y(Q){const ue=C.indexOf(Q.inputSource);if(ue===-1)return;const ae=b[ue];ae!==void 0&&(ae.update(Q.inputSource,Q.frame,c||a),ae.dispatchEvent({type:Q.type,data:Q.inputSource}))}function ee(){s.removeEventListener("select",Y),s.removeEventListener("selectstart",Y),s.removeEventListener("selectend",Y),s.removeEventListener("squeeze",Y),s.removeEventListener("squeezestart",Y),s.removeEventListener("squeezeend",Y),s.removeEventListener("end",ee),s.removeEventListener("inputsourceschange",ne);for(let Q=0;Q<b.length;Q++){const ue=C[Q];ue!==null&&(C[Q]=null,b[Q].disconnect(ue))}F=null,X=null,A.reset(),e.setRenderTarget(x),y=null,m=null,p=null,s=null,M=null,fe.stop(),n.isPresenting=!1,e.setPixelRatio(U),e.setSize(N.width,N.height,!1),n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(Q){r=Q,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(Q){u=Q,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||a},this.setReferenceSpace=function(Q){c=Q},this.getBaseLayer=function(){return m!==null?m:y},this.getBinding=function(){return p},this.getFrame=function(){return E},this.getSession=function(){return s},this.setSession=async function(Q){if(s=Q,s!==null){if(x=e.getRenderTarget(),s.addEventListener("select",Y),s.addEventListener("selectstart",Y),s.addEventListener("selectend",Y),s.addEventListener("squeeze",Y),s.addEventListener("squeezestart",Y),s.addEventListener("squeezeend",Y),s.addEventListener("end",ee),s.addEventListener("inputsourceschange",ne),S.xrCompatible!==!0&&await t.makeXRCompatible(),U=e.getPixelRatio(),e.getSize(N),typeof XRWebGLBinding<"u"&&"createProjectionLayer"in XRWebGLBinding.prototype){let ae=null,Ee=null,pe=null;S.depth&&(pe=S.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,ae=S.stencil?Cl:El,Ee=S.stencil?Ml:sa);const Ae={colorFormat:t.RGBA8,depthFormat:pe,scaleFactor:r};p=new XRWebGLBinding(s,t),m=p.createProjectionLayer(Ae),s.updateRenderState({layers:[m]}),e.setPixelRatio(1),e.setSize(m.textureWidth,m.textureHeight,!1),M=new ra(m.textureWidth,m.textureHeight,{format:bs,type:Mr,depthTexture:new iC(m.textureWidth,m.textureHeight,Ee,void 0,void 0,void 0,void 0,void 0,void 0,ae),stencilBuffer:S.stencil,colorSpace:e.outputColorSpace,samples:S.antialias?4:0,resolveDepthBuffer:m.ignoreDepthValues===!1})}else{const ae={antialias:S.antialias,alpha:!0,depth:S.depth,stencil:S.stencil,framebufferScaleFactor:r};y=new XRWebGLLayer(s,t,ae),s.updateRenderState({baseLayer:y}),e.setPixelRatio(1),e.setSize(y.framebufferWidth,y.framebufferHeight,!1),M=new ra(y.framebufferWidth,y.framebufferHeight,{format:bs,type:Mr,colorSpace:e.outputColorSpace,stencilBuffer:S.stencil})}M.isXRRenderTarget=!0,this.setFoveation(f),c=null,a=await s.requestReferenceSpace(u),fe.setContext(s),fe.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(s!==null)return s.environmentBlendMode},this.getDepthTexture=function(){return A.getDepthTexture()};function ne(Q){for(let ue=0;ue<Q.removed.length;ue++){const ae=Q.removed[ue],Ee=C.indexOf(ae);Ee>=0&&(C[Ee]=null,b[Ee].disconnect(ae))}for(let ue=0;ue<Q.added.length;ue++){const ae=Q.added[ue];let Ee=C.indexOf(ae);if(Ee===-1){for(let Ae=0;Ae<b.length;Ae++)if(Ae>=C.length){C.push(ae),Ee=Ae;break}else if(C[Ae]===null){C[Ae]=ae,Ee=Ae;break}if(Ee===-1)break}const pe=b[Ee];pe&&pe.connect(ae)}}const V=new xe,W=new xe;function q(Q,ue,ae){V.setFromMatrixPosition(ue.matrixWorld),W.setFromMatrixPosition(ae.matrixWorld);const Ee=V.distanceTo(W),pe=ue.projectionMatrix.elements,Ae=ae.projectionMatrix.elements,Ne=pe[14]/(pe[10]-1),je=pe[14]/(pe[10]+1),Mt=(pe[9]+1)/pe[5],rt=(pe[9]-1)/pe[5],J=(pe[8]-1)/pe[0],On=(Ae[8]+1)/Ae[0],He=Ne*J,ut=Ne*On,Qe=Ee/(-J+On),Dt=Qe*-J;if(ue.matrixWorld.decompose(Q.position,Q.quaternion,Q.scale),Q.translateX(Dt),Q.translateZ(Qe),Q.matrixWorld.compose(Q.position,Q.quaternion,Q.scale),Q.matrixWorldInverse.copy(Q.matrixWorld).invert(),pe[10]===-1)Q.projectionMatrix.copy(ue.projectionMatrix),Q.projectionMatrixInverse.copy(ue.projectionMatrixInverse);else{const $e=Ne+Qe,$=je+Qe,k=He-Dt,me=ut+(Ee-Dt),Re=Mt*je/$*$e,Pe=rt*je/$*$e;Q.projectionMatrix.makePerspective(k,me,Re,Pe,$e,$),Q.projectionMatrixInverse.copy(Q.projectionMatrix).invert()}}function oe(Q,ue){ue===null?Q.matrixWorld.copy(Q.matrix):Q.matrixWorld.multiplyMatrices(ue.matrixWorld,Q.matrix),Q.matrixWorldInverse.copy(Q.matrixWorld).invert()}this.updateCamera=function(Q){if(s===null)return;let ue=Q.near,ae=Q.far;A.texture!==null&&(A.depthNear>0&&(ue=A.depthNear),A.depthFar>0&&(ae=A.depthFar)),I.near=O.near=w.near=ue,I.far=O.far=w.far=ae,(F!==I.near||X!==I.far)&&(s.updateRenderState({depthNear:I.near,depthFar:I.far}),F=I.near,X=I.far),w.layers.mask=Q.layers.mask|2,O.layers.mask=Q.layers.mask|4,I.layers.mask=w.layers.mask|O.layers.mask;const Ee=Q.parent,pe=I.cameras;oe(I,Ee);for(let Ae=0;Ae<pe.length;Ae++)oe(pe[Ae],Ee);pe.length===2?q(I,w,O):I.projectionMatrix.copy(w.projectionMatrix),he(Q,I,Ee)};function he(Q,ue,ae){ae===null?Q.matrix.copy(ue.matrixWorld):(Q.matrix.copy(ae.matrixWorld),Q.matrix.invert(),Q.matrix.multiply(ue.matrixWorld)),Q.matrix.decompose(Q.position,Q.quaternion,Q.scale),Q.updateMatrixWorld(!0),Q.projectionMatrix.copy(ue.projectionMatrix),Q.projectionMatrixInverse.copy(ue.projectionMatrixInverse),Q.isPerspectiveCamera&&(Q.fov=Qu*2*Math.atan(1/Q.projectionMatrix.elements[5]),Q.zoom=1)}this.getCamera=function(){return I},this.getFoveation=function(){if(!(m===null&&y===null))return f},this.setFoveation=function(Q){f=Q,m!==null&&(m.fixedFoveation=Q),y!==null&&y.fixedFoveation!==void 0&&(y.fixedFoveation=Q)},this.hasDepthSensing=function(){return A.texture!==null},this.getDepthSensingMesh=function(){return A.getMesh(I)};let G=null;function K(Q,ue){if(d=ue.getViewerPose(c||a),E=ue,d!==null){const ae=d.views;y!==null&&(e.setRenderTargetFramebuffer(M,y.framebuffer),e.setRenderTarget(M));let Ee=!1;ae.length!==I.cameras.length&&(I.cameras.length=0,Ee=!0);for(let Ne=0;Ne<ae.length;Ne++){const je=ae[Ne];let Mt=null;if(y!==null)Mt=y.getViewport(je);else{const J=p.getViewSubImage(m,je);Mt=J.viewport,Ne===0&&(e.setRenderTargetTextures(M,J.colorTexture,m.ignoreDepthValues?void 0:J.depthStencilTexture),e.setRenderTarget(M))}let rt=L[Ne];rt===void 0&&(rt=new fs,rt.layers.enable(Ne),rt.viewport=new Un,L[Ne]=rt),rt.matrix.fromArray(je.transform.matrix),rt.matrix.decompose(rt.position,rt.quaternion,rt.scale),rt.projectionMatrix.fromArray(je.projectionMatrix),rt.projectionMatrixInverse.copy(rt.projectionMatrix).invert(),rt.viewport.set(Mt.x,Mt.y,Mt.width,Mt.height),Ne===0&&(I.matrix.copy(rt.matrix),I.matrix.decompose(I.position,I.quaternion,I.scale)),Ee===!0&&I.cameras.push(rt)}const pe=s.enabledFeatures;if(pe&&pe.includes("depth-sensing")&&s.depthUsage=="gpu-optimized"&&p){const Ne=p.getDepthInformation(ae[0]);Ne&&Ne.isValid&&Ne.texture&&A.init(e,Ne,s.renderState)}}for(let ae=0;ae<b.length;ae++){const Ee=C[ae],pe=b[ae];Ee!==null&&pe!==void 0&&pe.update(Ee,ue,c||a)}G&&G(Q,ue),ue.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:ue}),E=null}const fe=new sC;fe.setAnimationLoop(K),this.setAnimationLoop=function(Q){G=Q},this.dispose=function(){}}}const Ko=new Cr,g8=new Hn;function v8(i,e){function t(S,x){S.matrixAutoUpdate===!0&&S.updateMatrix(),x.value.copy(S.matrix)}function n(S,x){x.color.getRGB(S.fogColor.value,jM(i)),x.isFog?(S.fogNear.value=x.near,S.fogFar.value=x.far):x.isFogExp2&&(S.fogDensity.value=x.density)}function s(S,x,M,b,C){x.isMeshBasicMaterial||x.isMeshLambertMaterial?r(S,x):x.isMeshToonMaterial?(r(S,x),p(S,x)):x.isMeshPhongMaterial?(r(S,x),d(S,x)):x.isMeshStandardMaterial?(r(S,x),m(S,x),x.isMeshPhysicalMaterial&&y(S,x,C)):x.isMeshMatcapMaterial?(r(S,x),E(S,x)):x.isMeshDepthMaterial?r(S,x):x.isMeshDistanceMaterial?(r(S,x),A(S,x)):x.isMeshNormalMaterial?r(S,x):x.isLineBasicMaterial?(a(S,x),x.isLineDashedMaterial&&u(S,x)):x.isPointsMaterial?f(S,x,M,b):x.isSpriteMaterial?c(S,x):x.isShadowMaterial?(S.color.value.copy(x.color),S.opacity.value=x.opacity):x.isShaderMaterial&&(x.uniformsNeedUpdate=!1)}function r(S,x){S.opacity.value=x.opacity,x.color&&S.diffuse.value.copy(x.color),x.emissive&&S.emissive.value.copy(x.emissive).multiplyScalar(x.emissiveIntensity),x.map&&(S.map.value=x.map,t(x.map,S.mapTransform)),x.alphaMap&&(S.alphaMap.value=x.alphaMap,t(x.alphaMap,S.alphaMapTransform)),x.bumpMap&&(S.bumpMap.value=x.bumpMap,t(x.bumpMap,S.bumpMapTransform),S.bumpScale.value=x.bumpScale,x.side===Fi&&(S.bumpScale.value*=-1)),x.normalMap&&(S.normalMap.value=x.normalMap,t(x.normalMap,S.normalMapTransform),S.normalScale.value.copy(x.normalScale),x.side===Fi&&S.normalScale.value.negate()),x.displacementMap&&(S.displacementMap.value=x.displacementMap,t(x.displacementMap,S.displacementMapTransform),S.displacementScale.value=x.displacementScale,S.displacementBias.value=x.displacementBias),x.emissiveMap&&(S.emissiveMap.value=x.emissiveMap,t(x.emissiveMap,S.emissiveMapTransform)),x.specularMap&&(S.specularMap.value=x.specularMap,t(x.specularMap,S.specularMapTransform)),x.alphaTest>0&&(S.alphaTest.value=x.alphaTest);const M=e.get(x),b=M.envMap,C=M.envMapRotation;b&&(S.envMap.value=b,Ko.copy(C),Ko.x*=-1,Ko.y*=-1,Ko.z*=-1,b.isCubeTexture&&b.isRenderTargetTexture===!1&&(Ko.y*=-1,Ko.z*=-1),S.envMapRotation.value.setFromMatrix4(g8.makeRotationFromEuler(Ko)),S.flipEnvMap.value=b.isCubeTexture&&b.isRenderTargetTexture===!1?-1:1,S.reflectivity.value=x.reflectivity,S.ior.value=x.ior,S.refractionRatio.value=x.refractionRatio),x.lightMap&&(S.lightMap.value=x.lightMap,S.lightMapIntensity.value=x.lightMapIntensity,t(x.lightMap,S.lightMapTransform)),x.aoMap&&(S.aoMap.value=x.aoMap,S.aoMapIntensity.value=x.aoMapIntensity,t(x.aoMap,S.aoMapTransform))}function a(S,x){S.diffuse.value.copy(x.color),S.opacity.value=x.opacity,x.map&&(S.map.value=x.map,t(x.map,S.mapTransform))}function u(S,x){S.dashSize.value=x.dashSize,S.totalSize.value=x.dashSize+x.gapSize,S.scale.value=x.scale}function f(S,x,M,b){S.diffuse.value.copy(x.color),S.opacity.value=x.opacity,S.size.value=x.size*M,S.scale.value=b*.5,x.map&&(S.map.value=x.map,t(x.map,S.uvTransform)),x.alphaMap&&(S.alphaMap.value=x.alphaMap,t(x.alphaMap,S.alphaMapTransform)),x.alphaTest>0&&(S.alphaTest.value=x.alphaTest)}function c(S,x){S.diffuse.value.copy(x.color),S.opacity.value=x.opacity,S.rotation.value=x.rotation,x.map&&(S.map.value=x.map,t(x.map,S.mapTransform)),x.alphaMap&&(S.alphaMap.value=x.alphaMap,t(x.alphaMap,S.alphaMapTransform)),x.alphaTest>0&&(S.alphaTest.value=x.alphaTest)}function d(S,x){S.specular.value.copy(x.specular),S.shininess.value=Math.max(x.shininess,1e-4)}function p(S,x){x.gradientMap&&(S.gradientMap.value=x.gradientMap)}function m(S,x){S.metalness.value=x.metalness,x.metalnessMap&&(S.metalnessMap.value=x.metalnessMap,t(x.metalnessMap,S.metalnessMapTransform)),S.roughness.value=x.roughness,x.roughnessMap&&(S.roughnessMap.value=x.roughnessMap,t(x.roughnessMap,S.roughnessMapTransform)),x.envMap&&(S.envMapIntensity.value=x.envMapIntensity)}function y(S,x,M){S.ior.value=x.ior,x.sheen>0&&(S.sheenColor.value.copy(x.sheenColor).multiplyScalar(x.sheen),S.sheenRoughness.value=x.sheenRoughness,x.sheenColorMap&&(S.sheenColorMap.value=x.sheenColorMap,t(x.sheenColorMap,S.sheenColorMapTransform)),x.sheenRoughnessMap&&(S.sheenRoughnessMap.value=x.sheenRoughnessMap,t(x.sheenRoughnessMap,S.sheenRoughnessMapTransform))),x.clearcoat>0&&(S.clearcoat.value=x.clearcoat,S.clearcoatRoughness.value=x.clearcoatRoughness,x.clearcoatMap&&(S.clearcoatMap.value=x.clearcoatMap,t(x.clearcoatMap,S.clearcoatMapTransform)),x.clearcoatRoughnessMap&&(S.clearcoatRoughnessMap.value=x.clearcoatRoughnessMap,t(x.clearcoatRoughnessMap,S.clearcoatRoughnessMapTransform)),x.clearcoatNormalMap&&(S.clearcoatNormalMap.value=x.clearcoatNormalMap,t(x.clearcoatNormalMap,S.clearcoatNormalMapTransform),S.clearcoatNormalScale.value.copy(x.clearcoatNormalScale),x.side===Fi&&S.clearcoatNormalScale.value.negate())),x.dispersion>0&&(S.dispersion.value=x.dispersion),x.iridescence>0&&(S.iridescence.value=x.iridescence,S.iridescenceIOR.value=x.iridescenceIOR,S.iridescenceThicknessMinimum.value=x.iridescenceThicknessRange[0],S.iridescenceThicknessMaximum.value=x.iridescenceThicknessRange[1],x.iridescenceMap&&(S.iridescenceMap.value=x.iridescenceMap,t(x.iridescenceMap,S.iridescenceMapTransform)),x.iridescenceThicknessMap&&(S.iridescenceThicknessMap.value=x.iridescenceThicknessMap,t(x.iridescenceThicknessMap,S.iridescenceThicknessMapTransform))),x.transmission>0&&(S.transmission.value=x.transmission,S.transmissionSamplerMap.value=M.texture,S.transmissionSamplerSize.value.set(M.width,M.height),x.transmissionMap&&(S.transmissionMap.value=x.transmissionMap,t(x.transmissionMap,S.transmissionMapTransform)),S.thickness.value=x.thickness,x.thicknessMap&&(S.thicknessMap.value=x.thicknessMap,t(x.thicknessMap,S.thicknessMapTransform)),S.attenuationDistance.value=x.attenuationDistance,S.attenuationColor.value.copy(x.attenuationColor)),x.anisotropy>0&&(S.anisotropyVector.value.set(x.anisotropy*Math.cos(x.anisotropyRotation),x.anisotropy*Math.sin(x.anisotropyRotation)),x.anisotropyMap&&(S.anisotropyMap.value=x.anisotropyMap,t(x.anisotropyMap,S.anisotropyMapTransform))),S.specularIntensity.value=x.specularIntensity,S.specularColor.value.copy(x.specularColor),x.specularColorMap&&(S.specularColorMap.value=x.specularColorMap,t(x.specularColorMap,S.specularColorMapTransform)),x.specularIntensityMap&&(S.specularIntensityMap.value=x.specularIntensityMap,t(x.specularIntensityMap,S.specularIntensityMapTransform))}function E(S,x){x.matcap&&(S.matcap.value=x.matcap)}function A(S,x){const M=e.get(x).light;S.referencePosition.value.setFromMatrixPosition(M.matrixWorld),S.nearDistance.value=M.shadow.camera.near,S.farDistance.value=M.shadow.camera.far}return{refreshFogUniforms:n,refreshMaterialUniforms:s}}function y8(i,e,t,n){let s={},r={},a=[];const u=i.getParameter(i.MAX_UNIFORM_BUFFER_BINDINGS);function f(M,b){const C=b.program;n.uniformBlockBinding(M,C)}function c(M,b){let C=s[M.id];C===void 0&&(E(M),C=d(M),s[M.id]=C,M.addEventListener("dispose",S));const N=b.program;n.updateUBOMapping(M,N);const U=e.render.frame;r[M.id]!==U&&(m(M),r[M.id]=U)}function d(M){const b=p();M.__bindingPointIndex=b;const C=i.createBuffer(),N=M.__size,U=M.usage;return i.bindBuffer(i.UNIFORM_BUFFER,C),i.bufferData(i.UNIFORM_BUFFER,N,U),i.bindBuffer(i.UNIFORM_BUFFER,null),i.bindBufferBase(i.UNIFORM_BUFFER,b,C),C}function p(){for(let M=0;M<u;M++)if(a.indexOf(M)===-1)return a.push(M),M;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function m(M){const b=s[M.id],C=M.uniforms,N=M.__cache;i.bindBuffer(i.UNIFORM_BUFFER,b);for(let U=0,w=C.length;U<w;U++){const O=Array.isArray(C[U])?C[U]:[C[U]];for(let L=0,I=O.length;L<I;L++){const F=O[L];if(y(F,U,L,N)===!0){const X=F.__offset,Y=Array.isArray(F.value)?F.value:[F.value];let ee=0;for(let ne=0;ne<Y.length;ne++){const V=Y[ne],W=A(V);typeof V=="number"||typeof V=="boolean"?(F.__data[0]=V,i.bufferSubData(i.UNIFORM_BUFFER,X+ee,F.__data)):V.isMatrix3?(F.__data[0]=V.elements[0],F.__data[1]=V.elements[1],F.__data[2]=V.elements[2],F.__data[3]=0,F.__data[4]=V.elements[3],F.__data[5]=V.elements[4],F.__data[6]=V.elements[5],F.__data[7]=0,F.__data[8]=V.elements[6],F.__data[9]=V.elements[7],F.__data[10]=V.elements[8],F.__data[11]=0):(V.toArray(F.__data,ee),ee+=W.storage/Float32Array.BYTES_PER_ELEMENT)}i.bufferSubData(i.UNIFORM_BUFFER,X,F.__data)}}}i.bindBuffer(i.UNIFORM_BUFFER,null)}function y(M,b,C,N){const U=M.value,w=b+"_"+C;if(N[w]===void 0)return typeof U=="number"||typeof U=="boolean"?N[w]=U:N[w]=U.clone(),!0;{const O=N[w];if(typeof U=="number"||typeof U=="boolean"){if(O!==U)return N[w]=U,!0}else if(O.equals(U)===!1)return O.copy(U),!0}return!1}function E(M){const b=M.uniforms;let C=0;const N=16;for(let w=0,O=b.length;w<O;w++){const L=Array.isArray(b[w])?b[w]:[b[w]];for(let I=0,F=L.length;I<F;I++){const X=L[I],Y=Array.isArray(X.value)?X.value:[X.value];for(let ee=0,ne=Y.length;ee<ne;ee++){const V=Y[ee],W=A(V),q=C%N,oe=q%W.boundary,he=q+oe;C+=oe,he!==0&&N-he<W.storage&&(C+=N-he),X.__data=new Float32Array(W.storage/Float32Array.BYTES_PER_ELEMENT),X.__offset=C,C+=W.storage}}}const U=C%N;return U>0&&(C+=N-U),M.__size=C,M.__cache={},this}function A(M){const b={boundary:0,storage:0};return typeof M=="number"||typeof M=="boolean"?(b.boundary=4,b.storage=4):M.isVector2?(b.boundary=8,b.storage=8):M.isVector3||M.isColor?(b.boundary=16,b.storage=12):M.isVector4?(b.boundary=16,b.storage=16):M.isMatrix3?(b.boundary=48,b.storage=48):M.isMatrix4?(b.boundary=64,b.storage=64):M.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",M),b}function S(M){const b=M.target;b.removeEventListener("dispose",S);const C=a.indexOf(b.__bindingPointIndex);a.splice(C,1),i.deleteBuffer(s[b.id]),delete s[b.id],delete r[b.id]}function x(){for(const M in s)i.deleteBuffer(s[M]);a=[],s={},r={}}return{bind:f,update:c,dispose:x}}class _8{constructor(e={}){const{canvas:t=tV(),context:n=null,depth:s=!0,stencil:r=!1,alpha:a=!1,antialias:u=!1,premultipliedAlpha:f=!0,preserveDrawingBuffer:c=!1,powerPreference:d="default",failIfMajorPerformanceCaveat:p=!1,reverseDepthBuffer:m=!1}=e;this.isWebGLRenderer=!0;let y;if(n!==null){if(typeof WebGLRenderingContext<"u"&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");y=n.getContextAttributes().alpha}else y=a;const E=new Uint32Array(4),A=new Int32Array(4);let S=null,x=null;const M=[],b=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Qi,this.toneMapping=mo,this.toneMappingExposure=1;const C=this;let N=!1,U=0,w=0,O=null,L=-1,I=null;const F=new Un,X=new Un;let Y=null;const ee=new hn(0);let ne=0,V=t.width,W=t.height,q=1,oe=null,he=null;const G=new Un(0,0,V,W),K=new Un(0,0,V,W);let fe=!1;const Q=new nC;let ue=!1,ae=!1;this.transmissionResolutionScale=1;const Ee=new Hn,pe=new Hn,Ae=new xe,Ne=new Un,je={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let Mt=!1;function rt(){return O===null?q:1}let J=n;function On(H,se){return t.getContext(H,se)}try{const H={alpha:!0,depth:s,stencil:r,antialias:u,premultipliedAlpha:f,preserveDrawingBuffer:c,powerPreference:d,failIfMajorPerformanceCaveat:p};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${fv}`),t.addEventListener("webglcontextlost",Le,!1),t.addEventListener("webglcontextrestored",ze,!1),t.addEventListener("webglcontextcreationerror",Ve,!1),J===null){const se="webgl2";if(J=On(se,H),J===null)throw On(se)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(H){throw console.error("THREE.WebGLRenderer: "+H.message),H}let He,ut,Qe,Dt,$e,$,k,me,Re,Pe,be,nt,Be,Fe,Ct,Ue,tt,st,ot,Ke,ht,At,jt,ie;function Ge(){He=new Iz(J),He.init(),At=new f8(J,He),ut=new xz(J,He,e,At),Qe=new u8(J,He),ut.reverseDepthBuffer&&m&&Qe.buffers.depth.setReversed(!0),Dt=new wz(J),$e=new J5,$=new c8(J,He,Qe,$e,ut,At,Dt),k=new Rz(C),me=new Cz(C),Re=new BV(J),jt=new Sz(J,Re),Pe=new Lz(J,Re,Dt,jt),be=new Nz(J,Pe,Re,Dt),ot=new Pz(J,ut,$),Ue=new Az($e),nt=new X5(C,k,me,He,ut,jt,Ue),Be=new v8(C,$e),Fe=new Z5,Ct=new s8(He),st=new Ez(C,k,me,Qe,be,y,f),tt=new a8(C,be,ut),ie=new y8(J,Dt,ut,Qe),Ke=new Tz(J,He,Dt),ht=new Dz(J,He,Dt),Dt.programs=nt.programs,C.capabilities=ut,C.extensions=He,C.properties=$e,C.renderLists=Fe,C.shadowMap=tt,C.state=Qe,C.info=Dt}Ge();const Te=new m8(C,J);this.xr=Te,this.getContext=function(){return J},this.getContextAttributes=function(){return J.getContextAttributes()},this.forceContextLoss=function(){const H=He.get("WEBGL_lose_context");H&&H.loseContext()},this.forceContextRestore=function(){const H=He.get("WEBGL_lose_context");H&&H.restoreContext()},this.getPixelRatio=function(){return q},this.setPixelRatio=function(H){H!==void 0&&(q=H,this.setSize(V,W,!1))},this.getSize=function(H){return H.set(V,W)},this.setSize=function(H,se,ye=!0){if(Te.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}V=H,W=se,t.width=Math.floor(H*q),t.height=Math.floor(se*q),ye===!0&&(t.style.width=H+"px",t.style.height=se+"px"),this.setViewport(0,0,H,se)},this.getDrawingBufferSize=function(H){return H.set(V*q,W*q).floor()},this.setDrawingBufferSize=function(H,se,ye){V=H,W=se,q=ye,t.width=Math.floor(H*ye),t.height=Math.floor(se*ye),this.setViewport(0,0,H,se)},this.getCurrentViewport=function(H){return H.copy(F)},this.getViewport=function(H){return H.copy(G)},this.setViewport=function(H,se,ye,_e){H.isVector4?G.set(H.x,H.y,H.z,H.w):G.set(H,se,ye,_e),Qe.viewport(F.copy(G).multiplyScalar(q).round())},this.getScissor=function(H){return H.copy(K)},this.setScissor=function(H,se,ye,_e){H.isVector4?K.set(H.x,H.y,H.z,H.w):K.set(H,se,ye,_e),Qe.scissor(X.copy(K).multiplyScalar(q).round())},this.getScissorTest=function(){return fe},this.setScissorTest=function(H){Qe.setScissorTest(fe=H)},this.setOpaqueSort=function(H){oe=H},this.setTransparentSort=function(H){he=H},this.getClearColor=function(H){return H.copy(st.getClearColor())},this.setClearColor=function(){st.setClearColor.apply(st,arguments)},this.getClearAlpha=function(){return st.getClearAlpha()},this.setClearAlpha=function(){st.setClearAlpha.apply(st,arguments)},this.clear=function(H=!0,se=!0,ye=!0){let _e=0;if(H){let te=!1;if(O!==null){const Oe=O.texture.format;te=Oe===vv||Oe===gv||Oe===mv}if(te){const Oe=O.texture.type,qe=Oe===Mr||Oe===sa||Oe===Ju||Oe===Ml||Oe===hv||Oe===pv,Xe=st.getClearColor(),Ze=st.getClearAlpha(),yt=Xe.r,_t=Xe.g,ct=Xe.b;qe?(E[0]=yt,E[1]=_t,E[2]=ct,E[3]=Ze,J.clearBufferuiv(J.COLOR,0,E)):(A[0]=yt,A[1]=_t,A[2]=ct,A[3]=Ze,J.clearBufferiv(J.COLOR,0,A))}else _e|=J.COLOR_BUFFER_BIT}se&&(_e|=J.DEPTH_BUFFER_BIT),ye&&(_e|=J.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),J.clear(_e)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Le,!1),t.removeEventListener("webglcontextrestored",ze,!1),t.removeEventListener("webglcontextcreationerror",Ve,!1),st.dispose(),Fe.dispose(),Ct.dispose(),$e.dispose(),k.dispose(),me.dispose(),be.dispose(),jt.dispose(),ie.dispose(),nt.dispose(),Te.dispose(),Te.removeEventListener("sessionstart",Dr),Te.removeEventListener("sessionend",To),Ri.stop()};function Le(H){H.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),N=!0}function ze(){console.log("THREE.WebGLRenderer: Context Restored."),N=!1;const H=Dt.autoReset,se=tt.enabled,ye=tt.autoUpdate,_e=tt.needsUpdate,te=tt.type;Ge(),Dt.autoReset=H,tt.enabled=se,tt.autoUpdate=ye,tt.needsUpdate=_e,tt.type=te}function Ve(H){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",H.statusMessage)}function pt(H){const se=H.target;se.removeEventListener("dispose",pt),En(se)}function En(H){Dn(H),$e.remove(H)}function Dn(H){const se=$e.get(H).programs;se!==void 0&&(se.forEach(function(ye){nt.releaseProgram(ye)}),H.isShaderMaterial&&nt.releaseShaderCache(H))}this.renderBufferDirect=function(H,se,ye,_e,te,Oe){se===null&&(se=je);const qe=te.isMesh&&te.matrixWorld.determinant()<0,Xe=mn(H,se,ye,_e,te);Qe.setMaterial(_e,qe);let Ze=ye.index,yt=1;if(_e.wireframe===!0){if(Ze=Pe.getWireframeAttribute(ye),Ze===void 0)return;yt=2}const _t=ye.drawRange,ct=ye.attributes.position;let zt=_t.start*yt,$t=(_t.start+_t.count)*yt;Oe!==null&&(zt=Math.max(zt,Oe.start*yt),$t=Math.min($t,(Oe.start+Oe.count)*yt)),Ze!==null?(zt=Math.max(zt,0),$t=Math.min($t,Ze.count)):ct!=null&&(zt=Math.max(zt,0),$t=Math.min($t,ct.count));const Sn=$t-zt;if(Sn<0||Sn===1/0)return;jt.setup(te,_e,Xe,ye,Ze);let Yt,St=Ke;if(Ze!==null&&(Yt=Re.get(Ze),St=ht,St.setIndex(Yt)),te.isMesh)_e.wireframe===!0?(Qe.setLineWidth(_e.wireframeLinewidth*rt()),St.setMode(J.LINES)):St.setMode(J.TRIANGLES);else if(te.isLine){let dt=_e.linewidth;dt===void 0&&(dt=1),Qe.setLineWidth(dt*rt()),te.isLineSegments?St.setMode(J.LINES):te.isLineLoop?St.setMode(J.LINE_LOOP):St.setMode(J.LINE_STRIP)}else te.isPoints?St.setMode(J.POINTS):te.isSprite&&St.setMode(J.TRIANGLES);if(te.isBatchedMesh)if(te._multiDrawInstances!==null)St.renderMultiDrawInstances(te._multiDrawStarts,te._multiDrawCounts,te._multiDrawCount,te._multiDrawInstances);else if(He.get("WEBGL_multi_draw"))St.renderMultiDraw(te._multiDrawStarts,te._multiDrawCounts,te._multiDrawCount);else{const dt=te._multiDrawStarts,qn=te._multiDrawCounts,Wt=te._multiDrawCount,bi=Ze?Re.get(Ze).bytesPerElement:1,gs=$e.get(_e).currentProgram.getUniforms();for(let gi=0;gi<Wt;gi++)gs.setValue(J,"_gl_DrawID",gi),St.render(dt[gi]/bi,qn[gi])}else if(te.isInstancedMesh)St.renderInstances(zt,Sn,te.count);else if(ye.isInstancedBufferGeometry){const dt=ye._maxInstanceCount!==void 0?ye._maxInstanceCount:1/0,qn=Math.min(ye.instanceCount,dt);St.renderInstances(zt,Sn,qn)}else St.render(zt,Sn)};function Ht(H,se,ye){H.transparent===!0&&H.side===Tr&&H.forceSinglePass===!1?(H.side=Fi,H.needsUpdate=!0,kt(H,se,ye),H.side=yo,H.needsUpdate=!0,kt(H,se,ye),H.side=Tr):kt(H,se,ye)}this.compile=function(H,se,ye=null){ye===null&&(ye=H),x=Ct.get(ye),x.init(se),b.push(x),ye.traverseVisible(function(te){te.isLight&&te.layers.test(se.layers)&&(x.pushLight(te),te.castShadow&&x.pushShadow(te))}),H!==ye&&H.traverseVisible(function(te){te.isLight&&te.layers.test(se.layers)&&(x.pushLight(te),te.castShadow&&x.pushShadow(te))}),x.setupLights();const _e=new Set;return H.traverse(function(te){if(!(te.isMesh||te.isPoints||te.isLine||te.isSprite))return;const Oe=te.material;if(Oe)if(Array.isArray(Oe))for(let qe=0;qe<Oe.length;qe++){const Xe=Oe[qe];Ht(Xe,ye,te),_e.add(Xe)}else Ht(Oe,ye,te),_e.add(Oe)}),b.pop(),x=null,_e},this.compileAsync=function(H,se,ye=null){const _e=this.compile(H,se,ye);return new Promise(te=>{function Oe(){if(_e.forEach(function(qe){$e.get(qe).currentProgram.isReady()&&_e.delete(qe)}),_e.size===0){te(H);return}setTimeout(Oe,10)}He.get("KHR_parallel_shader_compile")!==null?Oe():setTimeout(Oe,10)})};let zn=null;function ki(H){zn&&zn(H)}function Dr(){Ri.stop()}function To(){Ri.start()}const Ri=new sC;Ri.setAnimationLoop(ki),typeof self<"u"&&Ri.setContext(self),this.setAnimationLoop=function(H){zn=H,Te.setAnimationLoop(H),H===null?Ri.stop():Ri.start()},Te.addEventListener("sessionstart",Dr),Te.addEventListener("sessionend",To),this.render=function(H,se){if(se!==void 0&&se.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(N===!0)return;if(H.matrixWorldAutoUpdate===!0&&H.updateMatrixWorld(),se.parent===null&&se.matrixWorldAutoUpdate===!0&&se.updateMatrixWorld(),Te.enabled===!0&&Te.isPresenting===!0&&(Te.cameraAutoUpdate===!0&&Te.updateCamera(se),se=Te.getCamera()),H.isScene===!0&&H.onBeforeRender(C,H,se,O),x=Ct.get(H,b.length),x.init(se),b.push(x),pe.multiplyMatrices(se.projectionMatrix,se.matrixWorldInverse),Q.setFromProjectionMatrix(pe),ae=this.localClippingEnabled,ue=Ue.init(this.clippingPlanes,ae),S=Fe.get(H,M.length),S.init(),M.push(S),Te.enabled===!0&&Te.isPresenting===!0){const Oe=C.xr.getDepthSensingMesh();Oe!==null&&Ks(Oe,se,-1/0,C.sortObjects)}Ks(H,se,0,C.sortObjects),S.finish(),C.sortObjects===!0&&S.sort(oe,he),Mt=Te.enabled===!1||Te.isPresenting===!1||Te.hasDepthSensing()===!1,Mt&&st.addToRenderList(S,H),this.info.render.frame++,ue===!0&&Ue.beginShadows();const ye=x.state.shadowsArray;tt.render(ye,H,se),ue===!0&&Ue.endShadows(),this.info.autoReset===!0&&this.info.reset();const _e=S.opaque,te=S.transmissive;if(x.setupLights(),se.isArrayCamera){const Oe=se.cameras;if(te.length>0)for(let qe=0,Xe=Oe.length;qe<Xe;qe++){const Ze=Oe[qe];vt(_e,te,H,Ze)}Mt&&st.render(H);for(let qe=0,Xe=Oe.length;qe<Xe;qe++){const Ze=Oe[qe];we(S,H,Ze,Ze.viewport)}}else te.length>0&&vt(_e,te,H,se),Mt&&st.render(H),we(S,H,se);O!==null&&w===0&&($.updateMultisampleRenderTarget(O),$.updateRenderTargetMipmap(O)),H.isScene===!0&&H.onAfterRender(C,H,se),jt.resetDefaultState(),L=-1,I=null,b.pop(),b.length>0?(x=b[b.length-1],ue===!0&&Ue.setGlobalState(C.clippingPlanes,x.state.camera)):x=null,M.pop(),M.length>0?S=M[M.length-1]:S=null};function Ks(H,se,ye,_e){if(H.visible===!1)return;if(H.layers.test(se.layers)){if(H.isGroup)ye=H.renderOrder;else if(H.isLOD)H.autoUpdate===!0&&H.update(se);else if(H.isLight)x.pushLight(H),H.castShadow&&x.pushShadow(H);else if(H.isSprite){if(!H.frustumCulled||Q.intersectsSprite(H)){_e&&Ne.setFromMatrixPosition(H.matrixWorld).applyMatrix4(pe);const qe=be.update(H),Xe=H.material;Xe.visible&&S.push(H,qe,Xe,ye,Ne.z,null)}}else if((H.isMesh||H.isLine||H.isPoints)&&(!H.frustumCulled||Q.intersectsObject(H))){const qe=be.update(H),Xe=H.material;if(_e&&(H.boundingSphere!==void 0?(H.boundingSphere===null&&H.computeBoundingSphere(),Ne.copy(H.boundingSphere.center)):(qe.boundingSphere===null&&qe.computeBoundingSphere(),Ne.copy(qe.boundingSphere.center)),Ne.applyMatrix4(H.matrixWorld).applyMatrix4(pe)),Array.isArray(Xe)){const Ze=qe.groups;for(let yt=0,_t=Ze.length;yt<_t;yt++){const ct=Ze[yt],zt=Xe[ct.materialIndex];zt&&zt.visible&&S.push(H,qe,zt,ye,Ne.z,ct)}}else Xe.visible&&S.push(H,qe,Xe,ye,Ne.z,null)}}const Oe=H.children;for(let qe=0,Xe=Oe.length;qe<Xe;qe++)Ks(Oe[qe],se,ye,_e)}function we(H,se,ye,_e){const te=H.opaque,Oe=H.transmissive,qe=H.transparent;x.setupLightsView(ye),ue===!0&&Ue.setGlobalState(C.clippingPlanes,ye),_e&&Qe.viewport(F.copy(_e)),te.length>0&&gt(te,se,ye),Oe.length>0&&gt(Oe,se,ye),qe.length>0&&gt(qe,se,ye),Qe.buffers.depth.setTest(!0),Qe.buffers.depth.setMask(!0),Qe.buffers.color.setMask(!0),Qe.setPolygonOffset(!1)}function vt(H,se,ye,_e){if((ye.isScene===!0?ye.overrideMaterial:null)!==null)return;x.state.transmissionRenderTarget[_e.id]===void 0&&(x.state.transmissionRenderTarget[_e.id]=new ra(1,1,{generateMipmaps:!0,type:He.has("EXT_color_buffer_half_float")||He.has("EXT_color_buffer_float")?ju:Mr,minFilter:ta,samples:4,stencilBuffer:r,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:Qt.workingColorSpace}));const Oe=x.state.transmissionRenderTarget[_e.id],qe=_e.viewport||F;Oe.setSize(qe.z*C.transmissionResolutionScale,qe.w*C.transmissionResolutionScale);const Xe=C.getRenderTarget();C.setRenderTarget(Oe),C.getClearColor(ee),ne=C.getClearAlpha(),ne<1&&C.setClearColor(16777215,.5),C.clear(),Mt&&st.render(ye);const Ze=C.toneMapping;C.toneMapping=mo;const yt=_e.viewport;if(_e.viewport!==void 0&&(_e.viewport=void 0),x.setupLightsView(_e),ue===!0&&Ue.setGlobalState(C.clippingPlanes,_e),gt(H,ye,_e),$.updateMultisampleRenderTarget(Oe),$.updateRenderTargetMipmap(Oe),He.has("WEBGL_multisampled_render_to_texture")===!1){let _t=!1;for(let ct=0,zt=se.length;ct<zt;ct++){const $t=se[ct],Sn=$t.object,Yt=$t.geometry,St=$t.material,dt=$t.group;if(St.side===Tr&&Sn.layers.test(_e.layers)){const qn=St.side;St.side=Fi,St.needsUpdate=!0,Ut(Sn,ye,_e,Yt,St,dt),St.side=qn,St.needsUpdate=!0,_t=!0}}_t===!0&&($.updateMultisampleRenderTarget(Oe),$.updateRenderTargetMipmap(Oe))}C.setRenderTarget(Xe),C.setClearColor(ee,ne),yt!==void 0&&(_e.viewport=yt),C.toneMapping=Ze}function gt(H,se,ye){const _e=se.isScene===!0?se.overrideMaterial:null;for(let te=0,Oe=H.length;te<Oe;te++){const qe=H[te],Xe=qe.object,Ze=qe.geometry,yt=_e===null?qe.material:_e,_t=qe.group;Xe.layers.test(ye.layers)&&Ut(Xe,se,ye,Ze,yt,_t)}}function Ut(H,se,ye,_e,te,Oe){H.onBeforeRender(C,se,ye,_e,te,Oe),H.modelViewMatrix.multiplyMatrices(ye.matrixWorldInverse,H.matrixWorld),H.normalMatrix.getNormalMatrix(H.modelViewMatrix),te.onBeforeRender(C,se,ye,_e,H,Oe),te.transparent===!0&&te.side===Tr&&te.forceSinglePass===!1?(te.side=Fi,te.needsUpdate=!0,C.renderBufferDirect(ye,se,_e,te,H,Oe),te.side=yo,te.needsUpdate=!0,C.renderBufferDirect(ye,se,_e,te,H,Oe),te.side=Tr):C.renderBufferDirect(ye,se,_e,te,H,Oe),H.onAfterRender(C,se,ye,_e,te,Oe)}function kt(H,se,ye){se.isScene!==!0&&(se=je);const _e=$e.get(H),te=x.state.lights,Oe=x.state.shadowsArray,qe=te.state.version,Xe=nt.getParameters(H,te.state,Oe,se,ye),Ze=nt.getProgramCacheKey(Xe);let yt=_e.programs;_e.environment=H.isMeshStandardMaterial?se.environment:null,_e.fog=se.fog,_e.envMap=(H.isMeshStandardMaterial?me:k).get(H.envMap||_e.environment),_e.envMapRotation=_e.environment!==null&&H.envMap===null?se.environmentRotation:H.envMapRotation,yt===void 0&&(H.addEventListener("dispose",pt),yt=new Map,_e.programs=yt);let _t=yt.get(Ze);if(_t!==void 0){if(_e.currentProgram===_t&&_e.lightsStateVersion===qe)return Kt(H,Xe),_t}else Xe.uniforms=nt.getUniforms(H),H.onBeforeCompile(Xe,C),_t=nt.acquireProgram(Xe,Ze),yt.set(Ze,_t),_e.uniforms=Xe.uniforms;const ct=_e.uniforms;return(!H.isShaderMaterial&&!H.isRawShaderMaterial||H.clipping===!0)&&(ct.clippingPlanes=Ue.uniform),Kt(H,Xe),_e.needsLights=aa(H),_e.lightsStateVersion=qe,_e.needsLights&&(ct.ambientLightColor.value=te.state.ambient,ct.lightProbe.value=te.state.probe,ct.directionalLights.value=te.state.directional,ct.directionalLightShadows.value=te.state.directionalShadow,ct.spotLights.value=te.state.spot,ct.spotLightShadows.value=te.state.spotShadow,ct.rectAreaLights.value=te.state.rectArea,ct.ltc_1.value=te.state.rectAreaLTC1,ct.ltc_2.value=te.state.rectAreaLTC2,ct.pointLights.value=te.state.point,ct.pointLightShadows.value=te.state.pointShadow,ct.hemisphereLights.value=te.state.hemi,ct.directionalShadowMap.value=te.state.directionalShadowMap,ct.directionalShadowMatrix.value=te.state.directionalShadowMatrix,ct.spotShadowMap.value=te.state.spotShadowMap,ct.spotLightMatrix.value=te.state.spotLightMatrix,ct.spotLightMap.value=te.state.spotLightMap,ct.pointShadowMap.value=te.state.pointShadowMap,ct.pointShadowMatrix.value=te.state.pointShadowMatrix),_e.currentProgram=_t,_e.uniformsList=null,_t}function nn(H){if(H.uniformsList===null){const se=H.currentProgram.getUniforms();H.uniformsList=yd.seqWithValue(se.seq,H.uniforms)}return H.uniformsList}function Kt(H,se){const ye=$e.get(H);ye.outputColorSpace=se.outputColorSpace,ye.batching=se.batching,ye.batchingColor=se.batchingColor,ye.instancing=se.instancing,ye.instancingColor=se.instancingColor,ye.instancingMorph=se.instancingMorph,ye.skinning=se.skinning,ye.morphTargets=se.morphTargets,ye.morphNormals=se.morphNormals,ye.morphColors=se.morphColors,ye.morphTargetsCount=se.morphTargetsCount,ye.numClippingPlanes=se.numClippingPlanes,ye.numIntersection=se.numClipIntersection,ye.vertexAlphas=se.vertexAlphas,ye.vertexTangents=se.vertexTangents,ye.toneMapping=se.toneMapping}function mn(H,se,ye,_e,te){se.isScene!==!0&&(se=je),$.resetTextureUnits();const Oe=se.fog,qe=_e.isMeshStandardMaterial?se.environment:null,Xe=O===null?C.outputColorSpace:O.isXRRenderTarget===!0?O.texture.colorSpace:Il,Ze=(_e.isMeshStandardMaterial?me:k).get(_e.envMap||qe),yt=_e.vertexColors===!0&&!!ye.attributes.color&&ye.attributes.color.itemSize===4,_t=!!ye.attributes.tangent&&(!!_e.normalMap||_e.anisotropy>0),ct=!!ye.morphAttributes.position,zt=!!ye.morphAttributes.normal,$t=!!ye.morphAttributes.color;let Sn=mo;_e.toneMapped&&(O===null||O.isXRRenderTarget===!0)&&(Sn=C.toneMapping);const Yt=ye.morphAttributes.position||ye.morphAttributes.normal||ye.morphAttributes.color,St=Yt!==void 0?Yt.length:0,dt=$e.get(_e),qn=x.state.lights;if(ue===!0&&(ae===!0||H!==I)){const Mn=H===I&&_e.id===L;Ue.setState(_e,H,Mn)}let Wt=!1;_e.version===dt.__version?(dt.needsLights&&dt.lightsStateVersion!==qn.state.version||dt.outputColorSpace!==Xe||te.isBatchedMesh&&dt.batching===!1||!te.isBatchedMesh&&dt.batching===!0||te.isBatchedMesh&&dt.batchingColor===!0&&te.colorTexture===null||te.isBatchedMesh&&dt.batchingColor===!1&&te.colorTexture!==null||te.isInstancedMesh&&dt.instancing===!1||!te.isInstancedMesh&&dt.instancing===!0||te.isSkinnedMesh&&dt.skinning===!1||!te.isSkinnedMesh&&dt.skinning===!0||te.isInstancedMesh&&dt.instancingColor===!0&&te.instanceColor===null||te.isInstancedMesh&&dt.instancingColor===!1&&te.instanceColor!==null||te.isInstancedMesh&&dt.instancingMorph===!0&&te.morphTexture===null||te.isInstancedMesh&&dt.instancingMorph===!1&&te.morphTexture!==null||dt.envMap!==Ze||_e.fog===!0&&dt.fog!==Oe||dt.numClippingPlanes!==void 0&&(dt.numClippingPlanes!==Ue.numPlanes||dt.numIntersection!==Ue.numIntersection)||dt.vertexAlphas!==yt||dt.vertexTangents!==_t||dt.morphTargets!==ct||dt.morphNormals!==zt||dt.morphColors!==$t||dt.toneMapping!==Sn||dt.morphTargetsCount!==St)&&(Wt=!0):(Wt=!0,dt.__version=_e.version);let bi=dt.currentProgram;Wt===!0&&(bi=kt(_e,se,te));let gs=!1,gi=!1,Zn=!1;const ln=bi.getUniforms(),vi=dt.uniforms;if(Qe.useProgram(bi.program)&&(gs=!0,gi=!0,Zn=!0),_e.id!==L&&(L=_e.id,gi=!0),gs||I!==H){Qe.buffers.depth.getReversed()?(Ee.copy(H.projectionMatrix),iV(Ee),sV(Ee),ln.setValue(J,"projectionMatrix",Ee)):ln.setValue(J,"projectionMatrix",H.projectionMatrix),ln.setValue(J,"viewMatrix",H.matrixWorldInverse);const ii=ln.map.cameraPosition;ii!==void 0&&ii.setValue(J,Ae.setFromMatrixPosition(H.matrixWorld)),ut.logarithmicDepthBuffer&&ln.setValue(J,"logDepthBufFC",2/(Math.log(H.far+1)/Math.LN2)),(_e.isMeshPhongMaterial||_e.isMeshToonMaterial||_e.isMeshLambertMaterial||_e.isMeshBasicMaterial||_e.isMeshStandardMaterial||_e.isShaderMaterial)&&ln.setValue(J,"isOrthographic",H.isOrthographicCamera===!0),I!==H&&(I=H,gi=!0,Zn=!0)}if(te.isSkinnedMesh){ln.setOptional(J,te,"bindMatrix"),ln.setOptional(J,te,"bindMatrixInverse");const Mn=te.skeleton;Mn&&(Mn.boneTexture===null&&Mn.computeBoneTexture(),ln.setValue(J,"boneTexture",Mn.boneTexture,$))}te.isBatchedMesh&&(ln.setOptional(J,te,"batchingTexture"),ln.setValue(J,"batchingTexture",te._matricesTexture,$),ln.setOptional(J,te,"batchingIdTexture"),ln.setValue(J,"batchingIdTexture",te._indirectTexture,$),ln.setOptional(J,te,"batchingColorTexture"),te._colorsTexture!==null&&ln.setValue(J,"batchingColorTexture",te._colorsTexture,$));const fi=ye.morphAttributes;if((fi.position!==void 0||fi.normal!==void 0||fi.color!==void 0)&&ot.update(te,ye,bi),(gi||dt.receiveShadow!==te.receiveShadow)&&(dt.receiveShadow=te.receiveShadow,ln.setValue(J,"receiveShadow",te.receiveShadow)),_e.isMeshGouraudMaterial&&_e.envMap!==null&&(vi.envMap.value=Ze,vi.flipEnvMap.value=Ze.isCubeTexture&&Ze.isRenderTargetTexture===!1?-1:1),_e.isMeshStandardMaterial&&_e.envMap===null&&se.environment!==null&&(vi.envMapIntensity.value=se.environmentIntensity),gi&&(ln.setValue(J,"toneMappingExposure",C.toneMappingExposure),dt.needsLights&&$n(vi,Zn),Oe&&_e.fog===!0&&Be.refreshFogUniforms(vi,Oe),Be.refreshMaterialUniforms(vi,_e,q,W,x.state.transmissionRenderTarget[H.id]),yd.upload(J,nn(dt),vi,$)),_e.isShaderMaterial&&_e.uniformsNeedUpdate===!0&&(yd.upload(J,nn(dt),vi,$),_e.uniformsNeedUpdate=!1),_e.isSpriteMaterial&&ln.setValue(J,"center",te.center),ln.setValue(J,"modelViewMatrix",te.modelViewMatrix),ln.setValue(J,"normalMatrix",te.normalMatrix),ln.setValue(J,"modelMatrix",te.matrixWorld),_e.isShaderMaterial||_e.isRawShaderMaterial){const Mn=_e.uniformsGroups;for(let ii=0,la=Mn.length;ii<la;ii++){const Mi=Mn[ii];ie.update(Mi,bi),ie.bind(Mi,bi)}}return bi}function $n(H,se){H.ambientLightColor.needsUpdate=se,H.lightProbe.needsUpdate=se,H.directionalLights.needsUpdate=se,H.directionalLightShadows.needsUpdate=se,H.pointLights.needsUpdate=se,H.pointLightShadows.needsUpdate=se,H.spotLights.needsUpdate=se,H.spotLightShadows.needsUpdate=se,H.rectAreaLights.needsUpdate=se,H.hemisphereLights.needsUpdate=se}function aa(H){return H.isMeshLambertMaterial||H.isMeshToonMaterial||H.isMeshPhongMaterial||H.isMeshStandardMaterial||H.isShadowMaterial||H.isShaderMaterial&&H.lights===!0}this.getActiveCubeFace=function(){return U},this.getActiveMipmapLevel=function(){return w},this.getRenderTarget=function(){return O},this.setRenderTargetTextures=function(H,se,ye){$e.get(H.texture).__webglTexture=se,$e.get(H.depthTexture).__webglTexture=ye;const _e=$e.get(H);_e.__hasExternalTextures=!0,_e.__autoAllocateDepthBuffer=ye===void 0,_e.__autoAllocateDepthBuffer||He.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),_e.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(H,se){const ye=$e.get(H);ye.__webglFramebuffer=se,ye.__useDefaultFramebuffer=se===void 0};const ic=J.createFramebuffer();this.setRenderTarget=function(H,se=0,ye=0){O=H,U=se,w=ye;let _e=!0,te=null,Oe=!1,qe=!1;if(H){const Ze=$e.get(H);if(Ze.__useDefaultFramebuffer!==void 0)Qe.bindFramebuffer(J.FRAMEBUFFER,null),_e=!1;else if(Ze.__webglFramebuffer===void 0)$.setupRenderTarget(H);else if(Ze.__hasExternalTextures)$.rebindTextures(H,$e.get(H.texture).__webglTexture,$e.get(H.depthTexture).__webglTexture);else if(H.depthBuffer){const ct=H.depthTexture;if(Ze.__boundDepthTexture!==ct){if(ct!==null&&$e.has(ct)&&(H.width!==ct.image.width||H.height!==ct.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");$.setupDepthRenderbuffer(H)}}const yt=H.texture;(yt.isData3DTexture||yt.isDataArrayTexture||yt.isCompressedArrayTexture)&&(qe=!0);const _t=$e.get(H).__webglFramebuffer;H.isWebGLCubeRenderTarget?(Array.isArray(_t[se])?te=_t[se][ye]:te=_t[se],Oe=!0):H.samples>0&&$.useMultisampledRTT(H)===!1?te=$e.get(H).__webglMultisampledFramebuffer:Array.isArray(_t)?te=_t[ye]:te=_t,F.copy(H.viewport),X.copy(H.scissor),Y=H.scissorTest}else F.copy(G).multiplyScalar(q).floor(),X.copy(K).multiplyScalar(q).floor(),Y=fe;if(ye!==0&&(te=ic),Qe.bindFramebuffer(J.FRAMEBUFFER,te)&&_e&&Qe.drawBuffers(H,te),Qe.viewport(F),Qe.scissor(X),Qe.setScissorTest(Y),Oe){const Ze=$e.get(H.texture);J.framebufferTexture2D(J.FRAMEBUFFER,J.COLOR_ATTACHMENT0,J.TEXTURE_CUBE_MAP_POSITIVE_X+se,Ze.__webglTexture,ye)}else if(qe){const Ze=$e.get(H.texture),yt=se;J.framebufferTextureLayer(J.FRAMEBUFFER,J.COLOR_ATTACHMENT0,Ze.__webglTexture,ye,yt)}else if(H!==null&&ye!==0){const Ze=$e.get(H.texture);J.framebufferTexture2D(J.FRAMEBUFFER,J.COLOR_ATTACHMENT0,J.TEXTURE_2D,Ze.__webglTexture,ye)}L=-1},this.readRenderTargetPixels=function(H,se,ye,_e,te,Oe,qe){if(!(H&&H.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Xe=$e.get(H).__webglFramebuffer;if(H.isWebGLCubeRenderTarget&&qe!==void 0&&(Xe=Xe[qe]),Xe){Qe.bindFramebuffer(J.FRAMEBUFFER,Xe);try{const Ze=H.texture,yt=Ze.format,_t=Ze.type;if(!ut.textureFormatReadable(yt)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!ut.textureTypeReadable(_t)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}se>=0&&se<=H.width-_e&&ye>=0&&ye<=H.height-te&&J.readPixels(se,ye,_e,te,At.convert(yt),At.convert(_t),Oe)}finally{const Ze=O!==null?$e.get(O).__webglFramebuffer:null;Qe.bindFramebuffer(J.FRAMEBUFFER,Ze)}}},this.readRenderTargetPixelsAsync=async function(H,se,ye,_e,te,Oe,qe){if(!(H&&H.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Xe=$e.get(H).__webglFramebuffer;if(H.isWebGLCubeRenderTarget&&qe!==void 0&&(Xe=Xe[qe]),Xe){const Ze=H.texture,yt=Ze.format,_t=Ze.type;if(!ut.textureFormatReadable(yt))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!ut.textureTypeReadable(_t))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(se>=0&&se<=H.width-_e&&ye>=0&&ye<=H.height-te){Qe.bindFramebuffer(J.FRAMEBUFFER,Xe);const ct=J.createBuffer();J.bindBuffer(J.PIXEL_PACK_BUFFER,ct),J.bufferData(J.PIXEL_PACK_BUFFER,Oe.byteLength,J.STREAM_READ),J.readPixels(se,ye,_e,te,At.convert(yt),At.convert(_t),0);const zt=O!==null?$e.get(O).__webglFramebuffer:null;Qe.bindFramebuffer(J.FRAMEBUFFER,zt);const $t=J.fenceSync(J.SYNC_GPU_COMMANDS_COMPLETE,0);return J.flush(),await nV(J,$t,4),J.bindBuffer(J.PIXEL_PACK_BUFFER,ct),J.getBufferSubData(J.PIXEL_PACK_BUFFER,0,Oe),J.deleteBuffer(ct),J.deleteSync($t),Oe}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(H,se=null,ye=0){H.isTexture!==!0&&(ll("WebGLRenderer: copyFramebufferToTexture function signature has changed."),se=arguments[0]||null,H=arguments[1]);const _e=Math.pow(2,-ye),te=Math.floor(H.image.width*_e),Oe=Math.floor(H.image.height*_e),qe=se!==null?se.x:0,Xe=se!==null?se.y:0;$.setTexture2D(H,0),J.copyTexSubImage2D(J.TEXTURE_2D,ye,0,0,qe,Xe,te,Oe),Qe.unbindTexture()};const xo=J.createFramebuffer(),Fl=J.createFramebuffer();this.copyTextureToTexture=function(H,se,ye=null,_e=null,te=0,Oe=null){H.isTexture!==!0&&(ll("WebGLRenderer: copyTextureToTexture function signature has changed."),_e=arguments[0]||null,H=arguments[1],se=arguments[2],Oe=arguments[3]||0,ye=null),Oe===null&&(te!==0?(ll("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),Oe=te,te=0):Oe=0);let qe,Xe,Ze,yt,_t,ct,zt,$t,Sn;const Yt=H.isCompressedTexture?H.mipmaps[Oe]:H.image;if(ye!==null)qe=ye.max.x-ye.min.x,Xe=ye.max.y-ye.min.y,Ze=ye.isBox3?ye.max.z-ye.min.z:1,yt=ye.min.x,_t=ye.min.y,ct=ye.isBox3?ye.min.z:0;else{const fi=Math.pow(2,-te);qe=Math.floor(Yt.width*fi),Xe=Math.floor(Yt.height*fi),H.isDataArrayTexture?Ze=Yt.depth:H.isData3DTexture?Ze=Math.floor(Yt.depth*fi):Ze=1,yt=0,_t=0,ct=0}_e!==null?(zt=_e.x,$t=_e.y,Sn=_e.z):(zt=0,$t=0,Sn=0);const St=At.convert(se.format),dt=At.convert(se.type);let qn;se.isData3DTexture?($.setTexture3D(se,0),qn=J.TEXTURE_3D):se.isDataArrayTexture||se.isCompressedArrayTexture?($.setTexture2DArray(se,0),qn=J.TEXTURE_2D_ARRAY):($.setTexture2D(se,0),qn=J.TEXTURE_2D),J.pixelStorei(J.UNPACK_FLIP_Y_WEBGL,se.flipY),J.pixelStorei(J.UNPACK_PREMULTIPLY_ALPHA_WEBGL,se.premultiplyAlpha),J.pixelStorei(J.UNPACK_ALIGNMENT,se.unpackAlignment);const Wt=J.getParameter(J.UNPACK_ROW_LENGTH),bi=J.getParameter(J.UNPACK_IMAGE_HEIGHT),gs=J.getParameter(J.UNPACK_SKIP_PIXELS),gi=J.getParameter(J.UNPACK_SKIP_ROWS),Zn=J.getParameter(J.UNPACK_SKIP_IMAGES);J.pixelStorei(J.UNPACK_ROW_LENGTH,Yt.width),J.pixelStorei(J.UNPACK_IMAGE_HEIGHT,Yt.height),J.pixelStorei(J.UNPACK_SKIP_PIXELS,yt),J.pixelStorei(J.UNPACK_SKIP_ROWS,_t),J.pixelStorei(J.UNPACK_SKIP_IMAGES,ct);const ln=H.isDataArrayTexture||H.isData3DTexture,vi=se.isDataArrayTexture||se.isData3DTexture;if(H.isDepthTexture){const fi=$e.get(H),Mn=$e.get(se),ii=$e.get(fi.__renderTarget),la=$e.get(Mn.__renderTarget);Qe.bindFramebuffer(J.READ_FRAMEBUFFER,ii.__webglFramebuffer),Qe.bindFramebuffer(J.DRAW_FRAMEBUFFER,la.__webglFramebuffer);for(let Mi=0;Mi<Ze;Mi++)ln&&(J.framebufferTextureLayer(J.READ_FRAMEBUFFER,J.COLOR_ATTACHMENT0,$e.get(H).__webglTexture,te,ct+Mi),J.framebufferTextureLayer(J.DRAW_FRAMEBUFFER,J.COLOR_ATTACHMENT0,$e.get(se).__webglTexture,Oe,Sn+Mi)),J.blitFramebuffer(yt,_t,qe,Xe,zt,$t,qe,Xe,J.DEPTH_BUFFER_BIT,J.NEAREST);Qe.bindFramebuffer(J.READ_FRAMEBUFFER,null),Qe.bindFramebuffer(J.DRAW_FRAMEBUFFER,null)}else if(te!==0||H.isRenderTargetTexture||$e.has(H)){const fi=$e.get(H),Mn=$e.get(se);Qe.bindFramebuffer(J.READ_FRAMEBUFFER,xo),Qe.bindFramebuffer(J.DRAW_FRAMEBUFFER,Fl);for(let ii=0;ii<Ze;ii++)ln?J.framebufferTextureLayer(J.READ_FRAMEBUFFER,J.COLOR_ATTACHMENT0,fi.__webglTexture,te,ct+ii):J.framebufferTexture2D(J.READ_FRAMEBUFFER,J.COLOR_ATTACHMENT0,J.TEXTURE_2D,fi.__webglTexture,te),vi?J.framebufferTextureLayer(J.DRAW_FRAMEBUFFER,J.COLOR_ATTACHMENT0,Mn.__webglTexture,Oe,Sn+ii):J.framebufferTexture2D(J.DRAW_FRAMEBUFFER,J.COLOR_ATTACHMENT0,J.TEXTURE_2D,Mn.__webglTexture,Oe),te!==0?J.blitFramebuffer(yt,_t,qe,Xe,zt,$t,qe,Xe,J.COLOR_BUFFER_BIT,J.NEAREST):vi?J.copyTexSubImage3D(qn,Oe,zt,$t,Sn+ii,yt,_t,qe,Xe):J.copyTexSubImage2D(qn,Oe,zt,$t,yt,_t,qe,Xe);Qe.bindFramebuffer(J.READ_FRAMEBUFFER,null),Qe.bindFramebuffer(J.DRAW_FRAMEBUFFER,null)}else vi?H.isDataTexture||H.isData3DTexture?J.texSubImage3D(qn,Oe,zt,$t,Sn,qe,Xe,Ze,St,dt,Yt.data):se.isCompressedArrayTexture?J.compressedTexSubImage3D(qn,Oe,zt,$t,Sn,qe,Xe,Ze,St,Yt.data):J.texSubImage3D(qn,Oe,zt,$t,Sn,qe,Xe,Ze,St,dt,Yt):H.isDataTexture?J.texSubImage2D(J.TEXTURE_2D,Oe,zt,$t,qe,Xe,St,dt,Yt.data):H.isCompressedTexture?J.compressedTexSubImage2D(J.TEXTURE_2D,Oe,zt,$t,Yt.width,Yt.height,St,Yt.data):J.texSubImage2D(J.TEXTURE_2D,Oe,zt,$t,qe,Xe,St,dt,Yt);J.pixelStorei(J.UNPACK_ROW_LENGTH,Wt),J.pixelStorei(J.UNPACK_IMAGE_HEIGHT,bi),J.pixelStorei(J.UNPACK_SKIP_PIXELS,gs),J.pixelStorei(J.UNPACK_SKIP_ROWS,gi),J.pixelStorei(J.UNPACK_SKIP_IMAGES,Zn),Oe===0&&se.generateMipmaps&&J.generateMipmap(qn),Qe.unbindTexture()},this.copyTextureToTexture3D=function(H,se,ye=null,_e=null,te=0){return H.isTexture!==!0&&(ll("WebGLRenderer: copyTextureToTexture3D function signature has changed."),ye=arguments[0]||null,_e=arguments[1]||null,H=arguments[2],se=arguments[3],te=arguments[4]||0),ll('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(H,se,ye,_e,te)},this.initRenderTarget=function(H){$e.get(H).__webglFramebuffer===void 0&&$.setupRenderTarget(H)},this.initTexture=function(H){H.isCubeTexture?$.setTextureCube(H,0):H.isData3DTexture?$.setTexture3D(H,0):H.isDataArrayTexture||H.isCompressedArrayTexture?$.setTexture2DArray(H,0):$.setTexture2D(H,0),Qe.unbindTexture()},this.resetState=function(){U=0,w=0,O=null,Qe.reset(),jt.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Ar}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorspace=Qt._getDrawingBufferColorSpace(e),t.unpackColorSpace=Qt._getUnpackColorSpace()}}const E8=({videoElement:i,format:e,eye:t,headRotation:n})=>{const s=ke.useRef(null),r=ke.useRef(null),a=ke.useRef(null),u=ke.useRef(null),f=ke.useRef(null),c=ke.useRef(null);return ke.useEffect(()=>{if(!s.current||!i)return;const d=new LV,p=new fs(75,s.current.clientWidth/s.current.clientHeight,.1,1e3);p.rotation.order="YXZ";const m=new _8({antialias:!0,alpha:!1});m.setSize(s.current.clientWidth,s.current.clientHeight),s.current.appendChild(m.domElement);const y=e.includes("180"),E=500;let A;y?A=new Bd(E,60,40,0,Math.PI,0,Math.PI):A=new Bd(E,60,40),A.scale(-1,1,1);const S=new PV(i);S.minFilter=Oi,S.magFilter=Oi,S.colorSpace=Qi;const x=e.includes("SBS"),M=e.includes("TB"),b=x||M;let C=1,N=1,U=0,w=0;b&&(t==="left"?(x&&(C=.5,U=0),M&&(N=.5,w=.5)):t==="right"?(x&&(C=.5,U=.5),M&&(N=.5,w=0)):(x&&(C=.5,U=0),M&&(N=.5,w=.5))),S.repeat.set(C,N),S.offset.set(U,w);const O=new Ev({map:S}),L=new Hs(A,O);y&&(L.rotation.y=-Math.PI/2),d.add(L),r.current=m,a.current=d,u.current=p,f.current=L,c.current=S;let I=0;const F=()=>{r.current&&a.current&&u.current&&r.current.render(a.current,u.current),I=requestAnimationFrame(F)};F();const X=()=>{s.current&&u.current&&r.current&&(u.current.aspect=s.current.clientWidth/s.current.clientHeight,u.current.updateProjectionMatrix(),r.current.setSize(s.current.clientWidth,s.current.clientHeight))};return window.addEventListener("resize",X),()=>{var Y;window.removeEventListener("resize",X),cancelAnimationFrame(I),r.current&&(r.current.dispose(),(Y=s.current)==null||Y.removeChild(r.current.domElement)),A.dispose(),O.dispose(),S.dispose()}},[i,e,t]),ke.useEffect(()=>{if(u.current){const d=vA.degToRad(n.y),p=vA.degToRad(n.x);u.current.rotation.y=d,u.current.rotation.x=p}},[n]),z.jsx("div",{ref:s,className:"absolute inset-0 z-0 pointer-events-none"})},oR=({eye:i,vrMode:e,screenType:t,videoFormat:n,profile:s,item:r,videoRef:a,currentCue:u,definition:f,isTranslating:c,hoveredWord:d,dwellProgress:p,headRotation:m,isPlaying:y,duration:E,currentTime:A,isCalibrationMode:S,onCloseDefinition:x,onExit:M,language:b,isGameMode:C,gameStats:N,cues:U,hitObjectsRef:w,zoomScale:O})=>{const L=Zu[b],I=ke.useRef(null),F=a||I,X=n.startsWith("VR");ke.useEffect(()=>{const K=i==="right"?"video-right":i==="left"?"video-left":"video-single",fe=document.getElementById(K)||F.current;if(!(!fe||!r.url))if(r.type==="video"){let Q=null;return Sr.isSupported()&&r.url.includes(".m3u8")?(Q=new Sr,Q.loadSource(r.url),Q.attachMedia(fe)):(fe.canPlayType("application/vnd.apple.mpegurl")&&r.url.includes(".m3u8"),fe.src=r.url),()=>{Q&&Q.destroy()}}else fe.src=r.url},[r.url,i,r.type,F]);const ee=(t===Hu.IMAX?1.5:1)*s.scale*O,ne={transform:`rotateX(${-m.x}deg) rotateY(${-m.y}deg)`,transition:"transform 0.05s linear",transformStyle:"preserve-3d"},V=C?-900:t===Hu.IMAX?-400:-800,W=i==="left"?-s.ipdOffset:i==="right"?s.ipdOffset:0,q=s.verticalOffset,oe={transform:`translate3d(${W}px, ${q}px, ${V}px) scale(${ee})`,transformStyle:"preserve-3d"};let he={width:"100%",height:"100%",objectFit:"contain",maxWidth:"none"};if(r.type==="video"&&!X&&n!==Kn.MONO_2D){const K=n===Kn.STEREO_SBS,fe=i==="right";he={position:"absolute",maxWidth:"none",objectFit:"fill"},K?(he.width="200%",he.height="100%",he.top=0,he.left=fe?"-100%":"0%"):(he.width="100%",he.height="200%",he.left=0,he.top=fe?"-100%":"0%")}const G=e===tn.STEREO;return z.jsxs("div",{className:`relative h-full ${i==="single"?"w-full":"w-1/2"} ${i==="left"?"border-r border-gray-900/50":""} overflow-hidden bg-black`,children:[X&&z.jsx(E8,{videoElement:document.getElementById(i==="right"?"video-right":i==="left"?"video-left":"video-single"),format:n,eye:i,headRotation:m}),z.jsx("div",{className:"w-full h-full flex items-center justify-center absolute inset-0 pointer-events-none",style:{perspective:"800px",overflow:"hidden"},children:z.jsx("div",{className:"w-full h-full absolute inset-0 flex items-center justify-center",style:ne,children:z.jsxs("div",{className:"relative transform-gpu backface-hidden",style:oe,children:[z.jsx("div",{className:`rounded-lg shadow-2xl overflow-hidden flex items-center justify-center relative ${X?"bg-transparent shadow-none w-0 h-0":"bg-black"} ${C?"opacity-40":""} ${r.type==="video"?X?"":"aspect-video":"h-[300px] w-[800px] bg-slate-900/50"}`,style:{width:X?"0px":"800px"},children:r.type==="video"?z.jsx("video",{id:i==="right"?"video-right":i==="left"?"video-left":"video-single",className:"max-w-none",style:X?{opacity:0,position:"absolute",width:1,height:1}:he,ref:a,muted:i==="right",playsInline:!0,loop:!0,crossOrigin:"anonymous"}):z.jsxs("div",{className:"flex flex-col items-center justify-center w-full h-full relative",children:[z.jsx("audio",{id:i==="right"?"video-right":i==="left"?"video-left":"video-single",ref:a,muted:i==="right",loop:!0,crossOrigin:"anonymous"}),z.jsx("div",{className:"absolute inset-0 opacity-20 flex items-end justify-between px-10 gap-2",children:[...Array(20)].map((K,fe)=>z.jsx("div",{className:"flex-1 bg-emerald-500 transition-all duration-75 ease-out rounded-t",style:{height:y?`${Math.random()*80+10}%`:"5%"}},fe))}),z.jsxs("div",{className:"z-10 text-center",children:[z.jsx("i",{className:"fas fa-music text-6xl text-emerald-400 mb-4 drop-shadow-[0_0_15px_rgba(52,211,153,0.5)]"}),z.jsx("h3",{className:"text-xl text-white font-bold tracking-widest uppercase",children:L.audioVisualizer})]})]})}),C&&z.jsx(Y3,{mediaRef:F,isPlaying:y,hitObjectsRef:w}),z.jsxs("div",{className:`absolute inset-0 flex flex-col justify-end pb-16 transform translate-z-10 w-[800px] pointer-events-none ${X?"-mt-[300px]":""}`,children:[z.jsx(V3,{currentCue:u,eyePrefix:i}),z.jsx(X3,{definition:f,isLoading:c,language:b})]}),C&&z.jsxs("div",{className:"absolute top-[-350px] left-0 right-0 flex justify-between items-start px-8 transform translate-z-10 w-[800px]",children:[z.jsxs("div",{className:"bg-slate-900/80 border border-indigo-500 rounded-xl p-4 backdrop-blur-md shadow-[0_0_30px_rgba(79,70,229,0.3)]",children:[z.jsx("div",{className:"text-indigo-400 text-sm font-bold uppercase tracking-wider",children:L.score}),z.jsx("div",{className:"text-4xl font-black text-white font-mono",children:N.score.toLocaleString()})]}),N.combo>1&&z.jsxs("div",{className:"text-center animate-bounce",children:[z.jsxs("div",{className:"text-6xl font-black text-transparent bg-clip-text bg-gradient-to-b from-yellow-300 to-yellow-600 drop-shadow-[0_0_10px_rgba(250,204,21,0.8)]",style:{WebkitTextStroke:"2px white"},children:[N.combo,"x"]}),z.jsx("div",{className:"text-yellow-200 text-sm font-bold uppercase tracking-widest",children:L.combo})]})]}),e===tn.STEREO&&z.jsx("div",{className:"absolute -bottom-48 left-0 right-0 flex flex-col items-center justify-center transform translate-z-10 pointer-events-auto",children:z.jsxs("div",{className:"bg-slate-800/80 border border-slate-600 rounded-full px-6 py-3 flex items-center gap-3 backdrop-blur-md transition-colors hover:bg-emerald-600/80 group cursor-crosshair","data-action":"recenter",children:[z.jsx("i",{className:"fas fa-sync-alt text-white text-xl group-hover:rotate-180 transition-transform duration-500"}),z.jsx("span",{className:"text-white font-bold text-lg",children:L.recenter})]})}),f&&z.jsx("div",{className:"absolute top-0 right-0 p-4 transform translate-z-20 pointer-events-auto",children:z.jsx("button",{onClick:x,className:"bg-white/10 p-3 rounded-full hover:bg-red-500/50 transition-colors border border-white/20","data-word":"close-btn","aria-label":L.close,children:z.jsx("i",{className:"fas fa-times text-white text-xl"})})})]})})}),S&&z.jsx("div",{className:"absolute inset-0 z-[60] flex items-center justify-center bg-black/60 backdrop-blur-sm animate-in fade-in",children:z.jsxs("div",{className:"bg-slate-900 border-2 border-emerald-500 p-8 rounded-2xl text-center max-w-sm mx-4 shadow-2xl shadow-emerald-900/50",children:[z.jsx("i",{className:"fas fa-crosshairs text-5xl text-emerald-400 mb-4 animate-pulse"}),z.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:L.calibrationMode}),z.jsx("p",{className:"text-slate-300 mb-4",children:L.calibrationInstruct}),z.jsx("div",{className:"text-xs text-white border-t border-slate-700 pt-2",children:L.controlsHelp})]})}),!S&&G&&z.jsx(J3,{isHovering:!!d,progress:p}),!y&&!f&&!S&&e===tn.STEREO&&z.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none z-40",children:z.jsx("i",{className:`fas ${y?"fa-pause":"fa-play"} text-white/40 text-6xl drop-shadow-xl`})})]})},S8=async i=>new Promise(e=>{const t=document.createElement("video");t.crossOrigin="anonymous",t.muted=!0,t.preload="metadata";const n=i instanceof File?URL.createObjectURL(i):i;t.src=n;const s=setTimeout(()=>{e(null)},5e3);t.onloadeddata=()=>{t.currentTime=.5},t.onseeked=()=>{try{const r=document.createElement("canvas");r.width=t.videoWidth,r.height=t.videoHeight;const a=r.getContext("2d");if(a){a.drawImage(t,0,0,r.width,r.height);const u=r.toDataURL("image/jpeg",.7);e(u)}else e(null)}catch(r){console.warn("Could not generate thumbnail (CORS?):",r),e(null)}finally{clearTimeout(s),i instanceof File&&URL.revokeObjectURL(n)}},t.onerror=()=>{clearTimeout(s),e(null)}}),T8=({items:i,setItems:e,onPlay:t,onOpenSettings:n,language:s,currentProfile:r})=>{const a=Zu[s],[u]=ke.useState(tn.MAGIC_WINDOW),[f]=ke.useState(Hu.CINEMA),[c,d]=ke.useState(!1),[p,m]=ke.useState(null),[y,E]=ke.useState(""),[A,S]=ke.useState(""),[x,M]=ke.useState(void 0),[b,C]=ke.useState(!1),[N,U]=ke.useState("180"),[w,O]=ke.useState("MONO"),[L,I]=ke.useState("TOUCH"),[F,X]=ke.useState(tn.MAGIC_WINDOW),Y=()=>{m(null),E(""),S(""),M(void 0),I("TOUCH"),X(tn.MAGIC_WINDOW),d(!0)},ee=(pe,Ae)=>{pe.stopPropagation(),m(Ae),E(Ae.title),S(Ae.url),M(Ae.thumbnail);const Ne=Ae.format||Kn.MONO_2D;C(Ne.startsWith("VR")),U(Ne.includes("360")?"360":"180"),Ne.includes("SBS")?O("SBS"):Ne.includes("TB")?O("TB"):O("MONO"),I(Ae.defaultControlMode||"TOUCH"),X(Ae.defaultVrMode||tn.MAGIC_WINDOW),d(!0)},ne=pe=>{const Ae=pe.toLowerCase();return Ae.includes("180")?Ae.includes("sbs")||Ae.includes("3d")?Kn.VR180_SBS:Ae.includes("tb")||Ae.includes("ou")?Kn.VR180_TB:Kn.VR180_MONO:Ae.includes("360")?Ae.includes("sbs")||Ae.includes("3d")?Kn.VR360_SBS:Ae.includes("tb")||Ae.includes("ou")?Kn.VR360_TB:Kn.VR360_MONO:Ae.includes("sbs")||Ae.includes("3d")||Ae.includes("hsbs")?Kn.STEREO_SBS:Ae.includes("tb")||Ae.includes("ou")||Ae.includes("top-bottom")?Kn.STEREO_TB:Kn.MONO_2D},V=()=>{let pe;if(!b)w==="SBS"?pe=Kn.STEREO_SBS:w==="TB"?pe=Kn.STEREO_TB:pe=Kn.MONO_2D;else{const Ae=N==="180"?"VR180":"VR360";w==="SBS"?pe=`${Ae}_SBS`:w==="TB"?pe=`${Ae}_TB`:pe=`${Ae}_MONO`}return pe},W=async pe=>{var Ne;const Ae=(Ne=pe.target.files)==null?void 0:Ne[0];if(Ae){let je;if(Ae.type.startsWith("video/")){const Mt=await S8(Ae);Mt&&(je=Mt)}if(p){const Mt=URL.createObjectURL(Ae);S(Mt),je&&M(je);const rt=ne(Ae.name);C(rt.startsWith("VR")),U(rt.includes("360")?"360":"180"),rt.includes("SBS")?O("SBS"):rt.includes("TB")?O("TB"):O("MONO")}else{const Mt=Ae.type.startsWith("audio/"),rt=ne(Ae.name),J={id:Date.now().toString(),title:Ae.name.replace(/\.[^/.]+$/,""),url:URL.createObjectURL(Ae),type:Mt?"audio":"video",source:"LOCAL",format:rt,thumbnail:je,isConfigured:!1,defaultControlMode:"TOUCH",defaultVrMode:tn.MAGIC_WINDOW};m(J),E(J.title),S(J.url),M(je),C(rt.startsWith("VR")),U(rt.includes("360")?"360":"180"),rt.includes("SBS")?O("SBS"):rt.includes("TB")?O("TB"):O("MONO"),I("TOUCH"),X(tn.MAGIC_WINDOW),d(!0)}}},q=pe=>{var Ne;const Ae=(Ne=pe.target.files)==null?void 0:Ne[0];if(Ae){const je=URL.createObjectURL(Ae);M(je)}},oe=()=>{if(x){const pe=document.createElement("a");pe.href=x,pe.download=`thumbnail-${p?p.title:"cover"}.jpg`,pe.click()}},he=()=>{if(p){const pe=i.some(Ne=>Ne.id===p.id),Ae=V();if(pe)e(Ne=>Ne.map(je=>je.id===p.id?{...je,title:y,url:A,format:Ae,thumbnail:x,isConfigured:!0,defaultControlMode:L,defaultVrMode:F}:je));else{const Ne={...p,title:y,format:Ae,thumbnail:x,isConfigured:!0,defaultControlMode:L,defaultVrMode:F};e(je=>[Ne,...je])}d(!1),m(null)}else if(A){const pe=A.endsWith(".mp3")||A.endsWith(".wav"),Ae={id:Date.now().toString(),title:y||"Web Stream",url:A,type:pe?"audio":"video",source:"NETWORK",thumbnail:x||"https://placehold.co/600x400/0f172a/10b981?text=WEB",format:V(),isConfigured:!1,defaultControlMode:L,defaultVrMode:F};e(Ne=>[Ae,...Ne]),d(!1)}},G=(pe,Ae)=>{var je;const Ne=(je=pe.target.files)==null?void 0:je[0];if(Ne){const Mt=URL.createObjectURL(Ne);e(rt=>rt.map(J=>J.id===Ae?{...J,subtitleUrl:Mt}:J))}},K=(pe,Ae)=>{pe.stopPropagation(),e(Ne=>Ne.filter(je=>je.id!==Ae))},fe=pe=>{const Ae=pe.defaultVrMode||u,Ne=pe.defaultControlMode||"TOUCH";t(pe,{mode:Ae,screenType:f,videoFormat:pe.format||Kn.MONO_2D,profile:r,isGameMode:!1,controlMode:Ne,dragAxis:"FREE"})},[Q,ue]=ke.useState("GRID"),ae=({active:pe,onClick:Ae,children:Ne})=>z.jsx("button",{onClick:Ae,className:`flex-1 py-2 px-2 text-xs font-medium rounded-lg transition-all border ${pe?"bg-emerald-600 border-emerald-500 text-white shadow-lg shadow-emerald-900/20":"bg-slate-800 border-slate-700 text-slate-400 hover:border-slate-600 hover:text-slate-200"}`,children:Ne}),Ee=()=>z.jsxs("div",{className:"space-y-4 pt-2 border-t border-slate-800/50",children:[z.jsxs("div",{className:"flex justify-between items-center",children:[z.jsx("h4",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest",children:a.videoFormat}),z.jsx("div",{className:"text-[10px] bg-slate-800 text-slate-300 px-2 py-0.5 rounded font-mono",children:V()})]}),z.jsxs("div",{className:"space-y-2",children:[z.jsx("label",{className:"text-xs text-slate-400 block",children:a.viewMode}),z.jsxs("div",{className:"flex gap-2",children:[z.jsx(ae,{active:!b,onClick:()=>C(!1),children:a.viewNormal}),z.jsx(ae,{active:b,onClick:()=>C(!0),children:a.viewVR})]})]}),b&&z.jsxs("div",{className:"space-y-2 animate-in fade-in slide-in-from-left-2",children:[z.jsx("label",{className:"text-xs text-slate-400 block",children:a.fov}),z.jsxs("div",{className:"flex gap-2",children:[z.jsx(ae,{active:N==="180",onClick:()=>U("180"),children:"180"}),z.jsx(ae,{active:N==="360",onClick:()=>U("360"),children:"360"})]})]}),z.jsxs("div",{className:"space-y-2",children:[z.jsx("label",{className:"text-xs text-slate-400 block",children:a.stereoMode}),z.jsxs("div",{className:"flex gap-2",children:[z.jsx(ae,{active:w==="MONO",onClick:()=>O("MONO"),children:a.stereoNone}),z.jsx(ae,{active:w==="SBS",onClick:()=>O("SBS"),children:a.stereoSBS}),z.jsx(ae,{active:w==="TB",onClick:()=>O("TB"),children:a.stereoTB})]})]}),z.jsxs("div",{className:"pt-4 border-t border-slate-800/50 space-y-4",children:[z.jsxs("div",{className:"space-y-2",children:[z.jsxs("label",{className:"text-xs text-slate-400 block",children:[a.displayMode," (Default)"]}),z.jsxs("div",{className:"flex gap-2",children:[z.jsxs(ae,{active:F===tn.MAGIC_WINDOW,onClick:()=>X(tn.MAGIC_WINDOW),children:[z.jsx("i",{className:"fas fa-mobile-alt mr-1"})," Non-VR"]}),z.jsxs(ae,{active:F===tn.STEREO,onClick:()=>X(tn.STEREO),children:[z.jsx("i",{className:"fas fa-vr-cardboard mr-1"})," VR Glasses"]})]})]}),z.jsxs("div",{className:"space-y-2",children:[z.jsxs("label",{className:"text-xs text-slate-400 block",children:[a.controlMode," (Default)"]}),z.jsxs("div",{className:"flex gap-2",children:[z.jsxs(ae,{active:L==="TOUCH",onClick:()=>I("TOUCH"),children:[z.jsx("i",{className:"fas fa-fingerprint mr-1"})," Touch"]}),z.jsxs(ae,{active:L==="SENSOR",onClick:()=>I("SENSOR"),children:[z.jsx("i",{className:"fas fa-compass mr-1"})," Gyroscope"]})]})]})]})]});return z.jsxs("div",{className:"min-h-[100dvh] bg-slate-950 text-white font-sans selection:bg-emerald-500/30",children:[z.jsxs("header",{className:"sticky top-0 z-30 bg-slate-950/80 backdrop-blur-xl border-b border-white/5 px-6 py-4 flex flex-row justify-between items-center gap-4 shadow-lg shadow-black/20",children:[z.jsx("div",{className:"flex items-center gap-3",children:z.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-lg flex items-center justify-center shadow-lg shadow-emerald-900/50",children:z.jsx("i",{className:"fas fa-vr-cardboard text-xl text-white"})})}),z.jsxs("div",{className:"flex justify-end gap-3 w-auto flex-1",children:[z.jsx("button",{onClick:()=>ue(pe=>pe==="GRID"?"LIST":"GRID"),className:"h-10 w-10 rounded-lg bg-slate-800 hover:bg-slate-700 text-slate-300 border border-slate-700 transition-all flex items-center justify-center",title:a.libraryView,children:z.jsx("i",{className:`fas ${Q==="GRID"?"fa-list":"fa-th-large"}`})}),z.jsx("button",{onClick:Y,className:"h-10 w-10 rounded-lg bg-slate-800 hover:bg-slate-700 text-slate-200 border border-slate-700 hover:border-slate-600 transition-all flex items-center justify-center",title:a.addLink,children:z.jsx("i",{className:"fas fa-link text-emerald-500"})}),z.jsxs("label",{className:"h-10 w-10 rounded-lg bg-emerald-600 hover:bg-emerald-500 text-white border border-transparent transition-all flex items-center justify-center cursor-pointer shadow-lg shadow-emerald-900/30",title:a.addVideo,children:[z.jsx("i",{className:"fas fa-plus"}),z.jsx("input",{type:"file",accept:"video/*,audio/*",className:"hidden",onChange:W})]}),z.jsx("button",{onClick:n,className:"h-10 w-10 rounded-lg bg-slate-800 hover:bg-slate-700 text-slate-300 border border-slate-700 transition-all flex items-center justify-center","aria-label":a.settings,children:z.jsx("i",{className:"fas fa-cog text-lg"})})]})]}),z.jsxs("main",{className:"p-4 md:p-8 max-w-7xl mx-auto pb-24",children:[c&&z.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-in fade-in duration-200",children:z.jsxs("div",{className:"bg-slate-900 p-6 rounded-2xl w-full max-w-md border border-slate-800 shadow-2xl max-h-[90vh] overflow-y-auto",children:[z.jsxs("h3",{className:"text-lg font-bold mb-4 flex items-center gap-2",children:[z.jsx("i",{className:`fas ${p?"fa-edit":"fa-link"} text-emerald-500`}),p?a.editItem:a.addLink]}),z.jsxs("div",{className:"space-y-4 mb-6",children:[z.jsxs("div",{children:[z.jsx("label",{className:"text-xs text-slate-400 block mb-1",children:a.linkTitle}),z.jsx("input",{type:"text",className:"w-full bg-slate-950 border border-slate-800 rounded-lg px-4 py-3 text-white focus:border-emerald-500 outline-none transition-colors",value:y,onChange:pe=>E(pe.target.value)})]}),(p||!p)&&z.jsxs("div",{className:"flex gap-4 items-end",children:[z.jsx("div",{className:"w-20 h-14 bg-black rounded overflow-hidden border border-slate-700 shrink-0",children:x&&z.jsx("img",{src:x,className:"w-full h-full object-cover"})}),z.jsxs("div",{className:"flex gap-2",children:[z.jsxs("label",{className:"text-xs bg-slate-800 hover:bg-slate-700 text-white px-3 py-2 rounded cursor-pointer border border-slate-700",children:[a.uploadCover,z.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:q})]}),z.jsx("button",{onClick:oe,className:"text-xs bg-slate-800 hover:bg-slate-700 text-white px-3 py-2 rounded border border-slate-700",children:a.downloadCover})]})]}),(p==null?void 0:p.source)==="LOCAL"?z.jsxs("div",{children:[z.jsx("label",{className:"text-xs text-slate-400 block mb-1",children:a.sourceLocal}),z.jsxs("label",{className:"flex items-center justify-center w-full bg-slate-800 hover:bg-slate-700 border border-slate-700 border-dashed rounded-lg px-4 py-3 cursor-pointer transition-colors text-sm text-slate-300 gap-2",children:[z.jsx("i",{className:"fas fa-file-video"})," ",a.replaceFile,z.jsx("input",{type:"file",accept:"video/*,audio/*",className:"hidden",onChange:W})]})]}):z.jsxs("div",{children:[z.jsx("label",{className:"text-xs text-slate-400 block mb-1",children:a.sourceNetwork}),z.jsx("input",{type:"text",placeholder:a.urlPlaceholder,className:"w-full bg-slate-950 border border-slate-800 rounded-lg px-4 py-3 text-white focus:border-emerald-500 outline-none transition-colors font-mono text-sm",value:A,onChange:pe=>S(pe.target.value)})]}),z.jsx("div",{className:"bg-slate-950/50 p-4 rounded-lg border border-slate-800",children:z.jsx(Ee,{})})]}),z.jsxs("div",{className:"flex gap-3",children:[z.jsx("button",{onClick:()=>d(!1),className:"flex-1 py-2.5 bg-slate-800 hover:bg-slate-700 rounded-lg transition-colors font-medium text-slate-300",children:a.cancel}),z.jsx("button",{onClick:he,className:"flex-1 py-2.5 bg-emerald-600 hover:bg-emerald-500 rounded-lg font-bold text-white shadow-lg shadow-emerald-900/20",children:a.save})]})]})}),z.jsx("div",{className:Q==="GRID"?"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6":"flex flex-col gap-3",children:i.map(pe=>{var Ae,Ne;return z.jsxs("div",{className:`group bg-slate-900 rounded-xl overflow-hidden border border-slate-800 hover:border-emerald-500/50 transition-all duration-300 hover:shadow-2xl hover:shadow-emerald-900/10 relative ${Q==="LIST"?"flex flex-row h-24 items-center":"hover:-translate-y-1"}`,children:[z.jsxs("div",{className:`${Q==="GRID"?"aspect-video w-full":"h-full aspect-video"} bg-black relative overflow-hidden flex items-center justify-center bg-slate-900 pattern-grid-lg shrink-0 cursor-pointer`,onClick:()=>fe(pe),children:[pe.thumbnail?z.jsx("img",{src:pe.thumbnail,alt:pe.title,className:"w-full h-full object-cover opacity-80 group-hover:opacity-100 transition-all duration-500 group-hover:scale-105"}):z.jsxs("div",{className:`flex flex-col items-center justify-center ${pe.type==="audio"?"text-pink-500":"text-slate-500"}`,children:[z.jsx("i",{className:`fas ${pe.type==="audio"?"fa-music":"fa-film"} ${Q==="GRID"?"text-4xl":"text-2xl"} opacity-70`}),Q==="GRID"&&pe.type==="audio"&&z.jsx("span",{className:"text-xs mt-2 font-mono uppercase tracking-widest",children:a.typeAudio})]}),z.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-slate-900 via-transparent to-transparent opacity-80"}),z.jsxs("div",{className:"absolute top-2 left-2 flex flex-col gap-1 items-start",children:[z.jsx("span",{className:`text-[9px] font-bold px-1.5 py-0.5 rounded border backdrop-blur-md ${pe.source==="LOCAL"?"bg-amber-500/20 border-amber-500/50 text-amber-200":"bg-blue-500/20 border-blue-500/50 text-blue-200"}`,children:pe.source==="LOCAL"?a.sourceLocal:a.sourceNetwork}),pe.format!==Kn.MONO_2D&&z.jsx("div",{className:"bg-indigo-500/90 text-white text-[10px] font-bold px-1.5 py-0.5 rounded border border-indigo-400/50 shadow-sm backdrop-blur-sm",children:(Ae=pe.format)!=null&&Ae.includes("VR180")?"VR180":(Ne=pe.format)!=null&&Ne.includes("VR360")?"VR360":"3D"})]}),z.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all duration-300 transform scale-90 group-hover:scale-100 z-10",children:z.jsx("div",{className:"bg-white/10 backdrop-blur-md border border-white/20 text-white rounded-full w-14 h-14 flex items-center justify-center hover:bg-emerald-500 hover:border-emerald-500 transition-all shadow-xl",children:z.jsx("i",{className:"fas fa-play text-xl pl-1"})})}),Q==="GRID"&&z.jsx("div",{className:"absolute bottom-2 right-2 z-20",onClick:je=>je.stopPropagation(),children:z.jsxs("label",{className:`text-[10px] font-bold px-2 py-1 rounded backdrop-blur-md border cursor-pointer transition-colors flex items-center gap-1.5 shadow-sm ${pe.subtitleUrl?"bg-emerald-500/90 border-emerald-400 text-white":"bg-black/40 border-white/10 text-slate-300 hover:bg-black/60"}`,children:[z.jsx("i",{className:"fas fa-closed-captioning"}),z.jsx("span",{className:"max-w-[60px] truncate",children:pe.subtitleUrl?"CC":"+CC"}),z.jsx("input",{type:"file",accept:".srt,.vtt",className:"hidden",onChange:je=>G(je,pe.id)})]})})]}),z.jsxs("div",{className:`p-4 flex-1 flex flex-col justify-center ${Q==="LIST"?"relative":""}`,children:[z.jsx("h3",{className:"font-bold text-sm md:text-base truncate text-slate-100 mb-1 cursor-pointer hover:text-emerald-400",onClick:()=>fe(pe),title:pe.title,children:pe.title}),z.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500",children:[z.jsx("i",{className:`fas ${pe.type==="audio"?"fa-music":"fa-video"}`})," ",z.jsx("span",{children:pe.type==="audio"?a.typeAudio:a.typeVideo})]}),Q==="LIST"&&z.jsx("div",{className:"mt-2",children:z.jsxs("label",{className:`inline-flex text-[10px] font-bold px-2 py-1 rounded border cursor-pointer transition-colors items-center gap-1.5 ${pe.subtitleUrl?"bg-emerald-500/20 border-emerald-500/50 text-emerald-300":"bg-slate-800 border-slate-700 text-slate-400 hover:border-slate-500"}`,children:[z.jsx("i",{className:"fas fa-closed-captioning"}),z.jsx("span",{children:pe.subtitleUrl?a.ccLoaded:a.addCC}),z.jsx("input",{type:"file",accept:".srt,.vtt",className:"hidden",onChange:je=>G(je,pe.id)})]})}),z.jsxs("div",{className:`absolute top-2 right-2 flex gap-1 z-20 ${Q==="LIST"?"opacity-100":"opacity-100 md:opacity-0 group-hover:opacity-100 transition-opacity"}`,children:[z.jsx("button",{onClick:je=>ee(je,pe),className:"bg-black/40 hover:bg-white/20 text-slate-300 hover:text-white rounded p-1.5 transition-colors backdrop-blur-md border border-white/10",title:a.edit,children:z.jsx("i",{className:"fas fa-edit text-xs"})}),z.jsx("button",{onClick:je=>K(je,pe.id),className:"bg-black/40 hover:bg-red-500/80 text-slate-300 hover:text-white rounded p-1.5 transition-colors backdrop-blur-md border border-white/10",title:a.delete,children:z.jsx("i",{className:"fas fa-trash text-xs"})})]})]})]},pe.id)})})]})]})},nd=({title:i,children:e,defaultOpen:t=!1})=>z.jsxs("details",{className:"group border-b border-white/5",open:t,children:[z.jsxs("summary",{className:"flex items-center justify-between py-4 cursor-pointer hover:bg-white/5 px-2 -mx-2 rounded-lg transition-colors list-none select-none",children:[z.jsx("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest group-hover:text-slate-300 transition-colors",children:i}),z.jsx("i",{className:"fas fa-chevron-down text-slate-600 text-xs transition-transform duration-200 group-open:rotate-180"})]}),z.jsx("div",{className:"pb-6 pt-2 space-y-4 animate-in slide-in-from-top-1 duration-200",children:e})]}),x8=({isOpen:i,onClose:e,language:t,onLanguageChange:n,activeProfile:s,onProfileChange:r,PRESETS:a,gamepadMapping:u,onUpdateMapping:f,onResetMapping:c,onImportData:d,onClearData:p,currentDataExport:m})=>{var C;const y=Zu[t],[E,A]=ke.useState(null);ke.useEffect(()=>{if(!E)return;let N;const U=()=>{const w=navigator.getGamepads()[0];if(w){const O=w.buttons.findIndex(L=>L.pressed);if(O!==-1){f(E,O),A(null);return}}N=requestAnimationFrame(U)};return N=requestAnimationFrame(U),()=>cancelAnimationFrame(N)},[E,f]);const S={CLICK:y.actionClick,RECENTER:y.actionRecenter,PLAY_PAUSE:y.actionPlayPause,SEEK_BACK:y.actionSeekBack,SEEK_FWD:y.actionSeekFwd,MOVE_LEFT:y.actionMoveLeft,MOVE_RIGHT:y.actionMoveRight,MOVE_UP:y.actionMoveUp,MOVE_DOWN:y.actionMoveDown,VOL_UP:y.actionVolUp,VOL_DOWN:y.actionVolDown},x=()=>{const N=JSON.stringify(m,null,2),U=new Blob([N],{type:"application/json"}),w=URL.createObjectURL(U),O=document.createElement("a");O.href=w,O.download=`vr-linguaglance-config-${Date.now()}.json`,O.click(),URL.revokeObjectURL(w)},M=N=>{var O;const U=(O=N.target.files)==null?void 0:O[0];if(!U)return;const w=new FileReader;w.onload=L=>{var I;try{const F=JSON.parse((I=L.target)==null?void 0:I.result);d(F),alert(y.dataImported)}catch{alert(y.error)}},w.readAsText(U)},b=()=>{confirm("Are you sure you want to clear all local data?")&&(p(),alert(y.dataCleared))};return z.jsxs(z.Fragment,{children:[i&&z.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[60] transition-opacity duration-300",onClick:e}),z.jsx("div",{className:`fixed top-0 right-0 h-[100dvh] w-80 bg-slate-950/95 backdrop-blur-xl border-l border-white/5 shadow-2xl z-[70] transform transition-transform duration-300 ease-out overflow-y-auto ${i?"translate-x-0":"translate-x-full"}`,children:z.jsxs("div",{className:"p-6 h-full flex flex-col",children:[z.jsxs("div",{className:"flex justify-between items-center mb-4 pb-4 border-b border-white/5",children:[z.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[z.jsx("i",{className:"fas fa-sliders-h text-emerald-500"})," ",y.settings]}),z.jsx("button",{onClick:e,className:"w-8 h-8 rounded-full bg-slate-800 flex items-center justify-center text-slate-400 hover:text-white transition-colors",children:z.jsx("i",{className:"fas fa-times"})})]}),z.jsxs("div",{className:"flex-1 overflow-y-auto",children:[z.jsx(nd,{title:y.language,defaultOpen:!1,children:z.jsxs("div",{className:"grid grid-cols-2 gap-2 bg-slate-900 p-1.5 rounded-xl border border-white/5",children:[z.jsx("button",{onClick:()=>n("zh"),className:`py-2 rounded-lg text-sm font-medium transition-all ${t==="zh"?"bg-slate-700 text-white shadow-sm":"text-slate-400 hover:text-white"}`,children:""}),z.jsx("button",{onClick:()=>n("en"),className:`py-2 rounded-lg text-sm font-medium transition-all ${t==="en"?"bg-slate-700 text-white shadow-sm":"text-slate-400 hover:text-white"}`,children:"English"})]})}),z.jsxs(nd,{title:y.gamepadSettings,defaultOpen:!1,children:[z.jsxs("div",{className:"flex justify-between items-end mb-3",children:[z.jsx("span",{className:"text-[10px] text-slate-500",children:y.controlsHelp}),z.jsx("button",{onClick:c,className:"text-[10px] text-emerald-500 hover:text-emerald-400 underline",children:y.resetDefaults})]}),z.jsx("div",{className:"bg-slate-900 rounded-xl border border-white/5 divide-y divide-white/5",children:Object.keys(u).map(N=>z.jsxs("div",{className:"p-3 flex items-center justify-between",children:[z.jsx("span",{className:"text-sm text-slate-300",children:S[N]}),z.jsx("button",{onClick:()=>A(N),disabled:E!==null,className:`px-3 py-1.5 rounded text-xs font-mono font-bold min-w-[60px] transition-all ${E===N?"bg-emerald-500 text-white animate-pulse":"bg-slate-800 text-slate-400 hover:text-white border border-slate-700"}`,children:E===N?y.waitingForInput:`${y.button} ${u[N]}`})]},N))}),E&&z.jsx("div",{className:"text-center text-emerald-500 text-xs mt-2 animate-pulse",children:y.pressButton})]}),z.jsx(nd,{title:y.vrCalibration,defaultOpen:!1,children:z.jsxs("div",{className:"space-y-6",children:[z.jsxs("div",{children:[z.jsx("label",{className:"block text-slate-400 text-xs mb-2",children:y.profile}),z.jsxs("div",{className:"relative",children:[z.jsxs("select",{className:"w-full bg-slate-900 border border-slate-800 text-white rounded-xl px-4 py-3 text-sm outline-none focus:border-emerald-500 appearance-none",onChange:N=>{const U=a.find(w=>w.id===N.target.value);U&&r(U)},value:((C=a.find(N=>N.name===s.name))==null?void 0:C.id)||"custom",children:[a.map(N=>z.jsx("option",{value:N.id,children:N.name},N.id)),z.jsx("option",{value:"custom",children:y.custom})]}),z.jsx("div",{className:"absolute right-4 top-3.5 text-slate-500 pointer-events-none",children:z.jsx("i",{className:"fas fa-chevron-down text-xs"})})]})]}),z.jsx("div",{className:"space-y-5",children:[{label:y.ipd,val:s.ipdOffset,min:-50,max:50,step:1,unit:"px",key:"ipdOffset"},{label:y.vertical,val:s.verticalOffset,min:-50,max:50,step:1,unit:"px",key:"verticalOffset"},{label:y.scale,val:s.scale,min:.5,max:1.5,step:.05,unit:"x",key:"scale"}].map(N=>z.jsxs("div",{children:[z.jsxs("div",{className:"flex justify-between mb-2",children:[z.jsx("label",{className:"text-slate-400 text-xs",children:N.label}),z.jsxs("span",{className:"text-emerald-400 text-xs font-mono bg-emerald-500/10 px-1.5 py-0.5 rounded",children:[typeof N.val=="number"?N.val.toFixed(N.key==="scale"?2:0):N.val,N.unit]})]}),z.jsx("input",{type:"range",min:N.min,max:N.max,step:N.step,value:N.val,onChange:U=>r({...s,[N.key]:parseFloat(U.target.value)}),className:"w-full h-1.5 bg-slate-800 rounded-lg appearance-none cursor-pointer accent-emerald-500 hover:accent-emerald-400"})]},N.key))})]})}),z.jsx(nd,{title:y.dataManagement,defaultOpen:!1,children:z.jsxs("div",{className:"space-y-3",children:[z.jsxs("button",{onClick:x,className:"w-full py-2 bg-slate-800 hover:bg-slate-700 rounded-lg text-sm text-white border border-slate-700 transition-colors flex items-center justify-center gap-2",children:[z.jsx("i",{className:"fas fa-file-export"})," ",y.exportData]}),z.jsxs("label",{className:"w-full py-2 bg-slate-800 hover:bg-slate-700 rounded-lg text-sm text-white border border-slate-700 transition-colors flex items-center justify-center gap-2 cursor-pointer",children:[z.jsx("i",{className:"fas fa-file-import"})," ",y.importData,z.jsx("input",{type:"file",accept:".json",onChange:M,className:"hidden"})]}),z.jsxs("button",{onClick:b,className:"w-full py-2 bg-red-900/50 hover:bg-red-900/80 rounded-lg text-sm text-red-200 border border-red-900 transition-colors flex items-center justify-center gap-2",children:[z.jsx("i",{className:"fas fa-trash-alt"})," ",y.clearData]})]})})]}),z.jsx("div",{className:"pt-6 border-t border-white/5 mt-auto",children:z.jsx("p",{className:"text-[10px] text-slate-600 text-center uppercase tracking-widest font-bold",children:"VR LinguaGlance"})})]})})]})},A8=1200,R8=100,cg=[{id:"default",name:"Default (Balanced)",ipdOffset:0,verticalOffset:0,scale:1},{id:"cardboard-v1",name:"Cardboard V1 (Small)",ipdOffset:-10,verticalOffset:0,scale:.9},{id:"cardboard-v2",name:"Cardboard V2 (Large)",ipdOffset:0,verticalOffset:0,scale:1.1},{id:"box-large",name:"Large VR Box / Max Phones",ipdOffset:20,verticalOffset:0,scale:1},{id:"box-small",name:"Small VR Box / Mini Phones",ipdOffset:-20,verticalOffset:0,scale:.85}],aR={CLICK:0,RECENTER:1,PLAY_PAUSE:2,SEEK_BACK:14,SEEK_FWD:15,MOVE_LEFT:14,MOVE_RIGHT:15,MOVE_UP:12,MOVE_DOWN:13,VOL_UP:4,VOL_DOWN:5},b8=()=>{const[i,e]=ke.useState("zh"),[t,n]=ke.useState(!1),[s,r]=ke.useState({...cg[0]}),[a,u]=ke.useState(aR),[f,c]=ke.useState("library"),[d,p]=ke.useState(null),[m,y]=ke.useState([]),[E,A]=ke.useState({mode:tn.MAGIC_WINDOW,screenType:Hu.CINEMA,videoFormat:Kn.MONO_2D,profile:s,isGameMode:!1,controlMode:"SENSOR",dragAxis:"FREE"}),[S,x]=ke.useState({score:0,combo:0,maxCombo:0}),M=ke.useRef(new Set),[b,C]=ke.useState(!1),[N,U]=ke.useState(!0),w=ke.useRef(null),[O,L]=ke.useState(1),I=ke.useRef(null),[F,X]=ke.useState(!1),Y=ke.useRef(null),[ee,ne]=ke.useState(!1),[V,W]=ke.useState(1);ke.useEffect(()=>{A(we=>({...we,profile:s}))},[s]);const[q,oe]=ke.useState([]),[he,G]=ke.useState(null),[K,fe]=ke.useState(0),[Q,ue]=ke.useState(0),ae=ke.useRef(null),Ee=ke.useRef(null),[pe,Ae]=ke.useState(!1),[Ne,je]=ke.useState(null),[Mt,rt]=ke.useState(0),[J,On]=ke.useState(!1),[He,ut]=ke.useState(null),[Qe,Dt]=ke.useState({x:0,y:0}),[$e,$]=ke.useState(!1),[k,me]=ke.useState({x:0,y:0}),Re=ke.useRef(!1),Pe=ke.useRef({x:0,y:0}),be=ke.useRef(null),nt=ke.useRef(null),Be=ke.useRef(0),Fe=Zu[i],Ct=we=>{we.libraryItems&&y(we.libraryItems),we.activeProfile&&r(we.activeProfile),we.gamepadMapping&&u(we.gamepadMapping)},Ue=()=>{y([]),r(cg[0])},tt={libraryItems:m,activeProfile:s,gamepadMapping:a},st=ke.useCallback(()=>{if(b||F||ee){U(!0),w.current&&clearTimeout(w.current);return}U(!0),w.current&&clearTimeout(w.current),pe&&E.mode===tn.MAGIC_WINDOW&&(w.current=window.setTimeout(()=>{U(!1)},3e3))},[pe,E.mode,b,F,ee]);ke.useEffect(()=>(st(),()=>{w.current&&clearTimeout(w.current)}),[pe,st,b,F,ee]);const ot=we=>{if(!(b||ee||F)&&E.mode===tn.MAGIC_WINDOW){if(we.target.closest("button")||we.target.closest(".overlay-ui"))return;N?(U(!1),w.current&&clearTimeout(w.current)):st()}},Ke=(we,vt)=>{p(we),A({...vt,profile:s}),oe([]),G(null),ut(null),Ae(!1),be.current=null,Dt({x:0,y:0}),me({x:0,y:0}),fe(0),ue(0),$(!1),x({score:0,combo:0,maxCombo:0}),M.current.clear(),L(1),X(!1),ne(!1),we.isConfigured?C(!1):(C(!0),y(gt=>gt.map(Ut=>Ut.id===we.id?{...Ut,isConfigured:!0}:Ut))),we.subtitleUrl&&fetch(we.subtitleUrl).then(gt=>gt.text()).then(gt=>{oe(FO(gt))}).catch(gt=>console.error(gt)),c("player"),vt.controlMode==="SENSOR"&&typeof DeviceOrientationEvent<"u"&&DeviceOrientationEvent.requestPermission&&DeviceOrientationEvent.requestPermission().catch(console.error),vt.mode===tn.STEREO&&jt(vt.controlMode)},ht=()=>{ae.current&&ae.current.pause(),Ee.current&&Ee.current.pause(),document.exitFullscreen&&document.exitFullscreen().catch(()=>Object),screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),c("library")},At=()=>{document.fullscreenElement?document.exitFullscreen().catch(()=>{}):document.documentElement.requestFullscreen().catch(()=>{})},jt=we=>{document.documentElement.requestFullscreen&&document.documentElement.requestFullscreen().catch(()=>{}),A(vt=>({...vt,mode:tn.STEREO,controlMode:we||"SENSOR"})),be.current=null,screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape").catch(()=>console.log("Orient lock failed (iOS expected)"))},ie=()=>{A(we=>({...we,mode:tn.MAGIC_WINDOW})),be.current=null,document.exitFullscreen&&document.exitFullscreen().catch(()=>Object),screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock()},Ge=ke.useCallback(()=>{E.controlMode==="SENSOR"&&nt.current?be.current={...nt.current}:E.controlMode==="TOUCH"&&me({x:0,y:0}),$(!1)},[E.controlMode]),Te=ke.useCallback(()=>{st(),ae.current&&(ae.current.paused?(ae.current.play(),Ee.current&&Ee.current.play(),Ae(!0)):(ae.current.pause(),Ee.current&&Ee.current.pause(),Ae(!1)))},[st]),Le=ke.useCallback(we=>{st(),ae.current&&(ae.current.currentTime+=we,Ee.current&&(Ee.current.currentTime=ae.current.currentTime))},[st]),ze=ke.useCallback(we=>{if(ae.current){const vt=Math.min(1,Math.max(0,we));ae.current.volume=vt,Ee.current&&(Ee.current.volume=vt),W(vt)}},[]),Ve=ke.useCallback(async(we,vt)=>{On(!0),ae.current&&ae.current.pause(),Ee.current&&Ee.current.pause(),Ae(!1);const gt=await OO(we,vt);ut(gt),On(!1)},[]),pt=()=>{ut(null),rt(0),je(null),Be.current=Date.now(),ae.current&&(ae.current.play(),Ee.current&&Ee.current.play(),Ae(!0))},En=we=>{if(f==="player"&&(Re.current=!1,Pe.current={x:we.clientX,y:we.clientY},we.target.closest(".progress-bar-container"))){const vt=we.target.closest(".progress-bar-container");if(vt){X(!0);const gt=vt.getBoundingClientRect(),Ut=Math.max(0,Math.min(1,(we.clientX-gt.left)/gt.width));ae.current&&(ae.current.currentTime=Ut*K,Ee.current&&(Ee.current.currentTime=ae.current.currentTime))}we.stopPropagation()}},Dn=we=>{if(we.touches.length===2){const vt=Math.hypot(we.touches[0].clientX-we.touches[1].clientX,we.touches[0].clientY-we.touches[1].clientY);I.current=vt}},Ht=we=>{if(f==="player"&&we.touches.length===2&&I.current){const vt=Math.hypot(we.touches[0].clientX-we.touches[1].clientX,we.touches[0].clientY-we.touches[1].clientY),gt=vt-I.current;E.mode===tn.MAGIC_WINDOW&&L(Ut=>Math.min(3,Math.max(.5,Ut+gt*.01))),I.current=vt;return}},zn=()=>{I.current=null},ki=we=>{if(f!=="player")return;if(F&&Y.current){const Ut=Y.current.getBoundingClientRect(),kt=Math.max(0,Math.min(1,(we.clientX-Ut.left)/Ut.width));ae.current&&(ae.current.currentTime=kt*K,Ee.current&&(Ee.current.currentTime=ae.current.currentTime));return}if(I.current)return;const vt=we.clientX-Pe.current.x,gt=we.clientY-Pe.current.y;(Math.abs(vt)>5||Math.abs(gt)>5)&&(Re.current=!0),E.controlMode==="TOUCH"&&we.buttons>0&&!F&&me(kt=>{let nn=kt.y+vt*.2,Kt=kt.x;return E.dragAxis==="FREE"&&(Kt=kt.x+gt*.2,Kt=Math.max(-85,Math.min(85,Kt))),{x:Kt,y:nn}}),Pe.current={x:we.clientX,y:we.clientY}},Dr=we=>{if(f==="player"){if(F){X(!1);return}!Re.current&&!I.current&&To(we),Re.current=!1}},To=ke.useCallback(we=>{if(!b&&!ee&&ot(we),$e){Ge();return}let vt,gt;E.mode===tn.STEREO?(vt=window.innerWidth*.25,gt=window.innerHeight/2):(vt=window.innerWidth/2,gt=window.innerHeight/2);const Ut=document.elementFromPoint(vt,gt);if(!Ut){E.mode===tn.STEREO&&Te();return}const kt=Ut.closest("[data-action]"),nn=Ut.closest("[data-word]"),Kt=Ut.closest("[data-game-note]");if(kt){const mn=kt.dataset.action;mn==="recenter"?$(!0):mn==="toggle-play"&&Te();return}if(Kt){const mn=Kt.dataset.noteId;mn&&!M.current.has(mn)&&(M.current.add(mn),x($n=>({score:$n.score+100+$n.combo*10,combo:$n.combo+1,maxCombo:Math.max($n.maxCombo,$n.combo+1)})));return}if(nn){const mn=nn.dataset.word||"";if(mn==="close-btn"){pt();return}const $n=nn.dataset.sentence||"";!J&&!He&&!E.isGameMode&&Ve(mn,$n);return}E.mode===tn.STEREO&&Te()},[$e,E.mode,E.isGameMode,J,He,Ge,Te,Ve,N,b,ee]);ke.useEffect(()=>{if(f!=="player"||$e||b)return;const vt=setInterval(()=>{let gt=window.innerWidth/2,Ut=window.innerHeight/2;E.mode===tn.STEREO&&(gt=window.innerWidth*.25);const kt=document.elementFromPoint(gt,Ut);if(!kt){je(null),rt(0),Be.current=0;return}if(E.isGameMode){const Kt=kt.closest("[data-game-note]");if(Kt){const mn=Kt.dataset.noteId;mn&&!M.current.has(mn)&&(M.current.add(mn),x($n=>({score:$n.score+100+$n.combo*10,combo:$n.combo+1,maxCombo:Math.max($n.maxCombo,$n.combo+1)})))}}const nn=kt.closest("[data-word]");if(nn){const Kt=nn.dataset.word,mn=nn.dataset.sentence||"";if(Kt){if(Ne!==Kt)je(Kt),Be.current=Date.now(),rt(0);else if(Be.current>0){const $n=Date.now()-Be.current,aa=Math.min(1,$n/A8);rt(aa),aa>=1&&!J&&(!He||He.word!==Kt)&&(Ve(Kt,mn),Be.current=0,rt(0))}}}else Ne&&(je(null),rt(0),Be.current=0)},R8);return()=>clearInterval(vt)},[f,E.mode,E.isGameMode,$e,b,Ne,J,He,Ve]),ke.useEffect(()=>{if(f!=="player")return;const we=vt=>{switch(st(),vt.key){case" ":case"Enter":vt.preventDefault(),Te();break;case"ArrowLeft":Le(-5);break;case"ArrowRight":Le(5);break;case"r":case"R":$(gt=>!gt);break;case"Escape":ht();break}};return window.addEventListener("keydown",we),()=>window.removeEventListener("keydown",we)},[f,$e,Te,Ge,Le]),ke.useEffect(()=>{const we=()=>{be.current=null};if(window.addEventListener("resize",we),f!=="player"||E.controlMode!=="SENSOR")return()=>window.removeEventListener("resize",we);const vt=gt=>{if(gt.alpha===null)return;nt.current={alpha:gt.alpha||0,beta:gt.beta||0,gamma:gt.gamma||0},be.current||(be.current={alpha:gt.alpha||0,beta:gt.beta||0,gamma:gt.gamma||0});const Ut=be.current,nn=window.innerWidth>window.innerHeight||E.mode===tn.STEREO;let Kt=(gt.alpha||0)-Ut.alpha;Kt>180&&(Kt-=360),Kt<-180&&(Kt+=360);let mn=0;nn?mn=-((gt.gamma||0)-Ut.gamma):mn=(gt.beta||0)-Ut.beta,mn=Math.max(-80,Math.min(80,mn)),Dt({x:mn,y:Kt})};return window.addEventListener("deviceorientation",vt),()=>{window.removeEventListener("deviceorientation",vt),window.removeEventListener("resize",we)}},[f,E.controlMode,E.mode]),ke.useEffect(()=>{if(f!=="player")return;const we=ae.current;if(!we)return;const vt=()=>{ue(we.currentTime),fe(we.duration||0);const gt=q.find(Ut=>we.currentTime>=Ut.startTime&&we.currentTime<=Ut.endTime);G(gt||null)};return we.addEventListener("timeupdate",vt),()=>we.removeEventListener("timeupdate",vt)},[q,f]);const Ri=E.controlMode==="SENSOR"?Qe:k,Ks={transform:`rotate(${-Ri.y}deg)`};return z.jsxs(z.Fragment,{children:[z.jsx(x8,{isOpen:t,onClose:()=>n(!1),language:i,onLanguageChange:e,activeProfile:s,onProfileChange:r,PRESETS:cg,gamepadMapping:a,onUpdateMapping:(we,vt)=>u(gt=>({...gt,[we]:vt})),onResetMapping:()=>u(aR),onImportData:Ct,onClearData:Ue,currentDataExport:tt}),f==="library"?z.jsx(T8,{items:m,setItems:y,onPlay:Ke,onOpenSettings:()=>n(!0),language:i,currentProfile:s}):z.jsxs("div",{className:"bg-black font-sans select-none overflow-hidden touch-none",style:E.mode===tn.STEREO&&window.innerHeight>window.innerWidth?{position:"fixed",width:"100vh",height:"100vw",left:"100%",top:"0",transformOrigin:"0 0",transform:"rotate(90deg)"}:{position:"fixed",inset:0},onPointerDown:En,onPointerMove:ki,onPointerUp:Dr,onPointerCancel:Dr,onTouchStart:Dn,onTouchMove:Ht,onTouchEnd:zn,onContextMenu:we=>we.preventDefault(),children:[E.mode===tn.STEREO&&z.jsx("div",{className:"absolute top-4 right-4 z-[100] pointer-events-auto",children:z.jsx("button",{onClick:()=>ie(),className:"w-12 h-12 rounded-full bg-red-600/80 text-white flex items-center justify-center border-2 border-white/20 shadow-xl backdrop-blur-md","aria-label":Fe.close,children:z.jsx("i",{className:"fas fa-times text-xl"})})}),E.mode!==tn.STEREO&&z.jsxs("div",{className:`absolute inset-0 z-50 pointer-events-none flex flex-col justify-between p-4 overlay-ui transition-opacity duration-300 ${N?"opacity-100":"opacity-0"}`,children:[z.jsxs("div",{className:"flex justify-between items-start pointer-events-auto",children:[z.jsx("button",{onClick:ht,className:"bg-black/40 backdrop-blur text-white p-3 rounded-full hover:bg-white/20 transition-all border border-white/10","aria-label":Fe.cancel,children:z.jsx("i",{className:"fas fa-arrow-left text-xl"})}),z.jsxs("div",{className:"relative w-16 h-16 bg-black/40 backdrop-blur rounded-full border-2 border-white/20 flex items-center justify-center",children:[z.jsx("div",{className:"absolute top-1 left-1/2 transform -translate-x-1/2 w-1 h-2 bg-red-500 rounded-full z-10"}),z.jsx("div",{className:"w-full h-full flex items-center justify-center transition-transform duration-75 ease-linear",style:Ks,children:z.jsx("div",{className:"w-0 h-0 border-l-[6px] border-l-transparent border-r-[6px] border-r-transparent border-b-[20px] border-b-emerald-500/80 -mt-6"})})]})]}),z.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:z.jsx("button",{onClick:we=>{we.stopPropagation(),Te()},className:"pointer-events-auto w-20 h-20 bg-black/50 backdrop-blur rounded-full flex items-center justify-center text-white/90 hover:bg-black/70 hover:scale-110 transition-all border-2 border-white/20 shadow-2xl","aria-label":pe?Fe.pause:Fe.play,children:z.jsx("i",{className:`fas ${pe?"fa-pause":"fa-play"} text-3xl ml-1`})})}),b&&z.jsxs("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-slate-900/95 backdrop-blur border border-white/10 p-6 rounded-2xl pointer-events-auto min-w-[300px] z-50 max-h-[80vh] overflow-y-auto",children:[z.jsxs("div",{className:"flex justify-between items-center mb-4",children:[z.jsx("h3",{className:"font-bold text-white",children:Fe.settings}),z.jsx("button",{onClick:()=>C(!1),"aria-label":Fe.close,children:z.jsx("i",{className:"fas fa-times text-slate-400"})})]}),z.jsxs("div",{className:"space-y-4",children:[z.jsxs("div",{children:[z.jsx("label",{className:"text-xs text-slate-400 block mb-2",children:Fe.dragAxis}),z.jsxs("div",{className:"flex bg-slate-800 rounded p-1",children:[z.jsx("button",{onClick:()=>A(we=>({...we,dragAxis:"FREE"})),className:`flex-1 py-2 text-xs rounded ${E.dragAxis==="FREE"?"bg-indigo-600 text-white":"text-slate-400"}`,children:Fe.dragFree}),z.jsx("button",{onClick:()=>A(we=>({...we,dragAxis:"HORIZONTAL"})),className:`flex-1 py-2 text-xs rounded ${E.dragAxis==="HORIZONTAL"?"bg-indigo-600 text-white":"text-slate-400"}`,children:Fe.dragHorizontal})]})]}),z.jsxs("div",{children:[z.jsx("label",{className:"text-xs text-slate-400 block mb-2",children:Fe.controlMode}),z.jsxs("div",{className:"flex bg-slate-800 p-1 rounded",children:[z.jsx("button",{onClick:()=>A(we=>({...we,controlMode:"SENSOR"})),className:`flex-1 py-2 text-xs rounded ${E.controlMode==="SENSOR"?"bg-emerald-600 text-white":"text-slate-400"}`,children:Fe.controlSensor}),z.jsx("button",{onClick:()=>A(we=>({...we,controlMode:"TOUCH"})),className:`flex-1 py-2 text-xs rounded ${E.controlMode==="TOUCH"?"bg-emerald-600 text-white":"text-slate-400"}`,children:Fe.controlTouch})]})]}),z.jsxs("div",{className:"border-t border-white/5 pt-4",children:[z.jsx("h4",{className:"text-xs font-bold text-emerald-400 mb-3 uppercase",children:Fe.vrCalibration}),z.jsx("div",{className:"space-y-3",children:[{label:Fe.ipd,val:s.ipdOffset,min:-50,max:50,step:1,unit:"px",key:"ipdOffset"},{label:Fe.vertical,val:s.verticalOffset,min:-50,max:50,step:1,unit:"px",key:"verticalOffset"},{label:Fe.scale,val:s.scale,min:.5,max:1.5,step:.05,unit:"x",key:"scale"}].map(we=>z.jsxs("div",{children:[z.jsxs("div",{className:"flex justify-between mb-1",children:[z.jsx("label",{className:"text-slate-400 text-[10px]",children:we.label}),z.jsxs("span",{className:"text-white text-[10px] font-mono",children:[typeof we.val=="number"?we.val.toFixed(we.key==="scale"?2:0):we.val,we.unit]})]}),z.jsx("input",{type:"range",min:we.min,max:we.max,step:we.step,value:we.val,onChange:vt=>r({...s,[we.key]:parseFloat(vt.target.value)}),className:"w-full h-1 bg-slate-800 rounded-lg appearance-none cursor-pointer accent-emerald-500"})]},we.key))})]})]})]}),z.jsx("div",{className:"w-full pointer-events-auto",children:z.jsxs("div",{className:"bg-transparent p-2 px-4 flex items-center gap-3 relative",children:[z.jsx("button",{onClick:()=>C(!b),className:"w-8 h-8 rounded-full text-slate-300 hover:text-white hover:bg-white/10 flex items-center justify-center","aria-label":Fe.settings,children:z.jsx("i",{className:"fas fa-cog"})}),z.jsxs("div",{className:"relative",children:[ee&&z.jsxs(z.Fragment,{children:[z.jsx("div",{className:"fixed inset-0 z-0",onClick:()=>ne(!1)}),z.jsx("div",{className:"absolute bottom-10 left-1/2 transform -translate-x-1/2 bg-transparent h-32 flex items-center justify-center z-10",children:z.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:V,onChange:we=>ze(parseFloat(we.target.value)),className:"w-24 h-1.5 bg-slate-600 rounded-lg appearance-none cursor-pointer accent-emerald-500 -rotate-90"})})]}),z.jsx("button",{onClick:()=>ne(!ee),className:`w-8 h-8 rounded-full flex items-center justify-center transition-colors ${ee?"text-white bg-white/10":"text-slate-300 hover:text-white hover:bg-white/10"}`,"aria-label":"Volume Control",children:z.jsx("i",{className:`fas ${V===0?"fa-volume-mute":V<.5?"fa-volume-down":"fa-volume-up"} text-xs`})})]}),z.jsx("button",{onClick:()=>Le(-5),className:"w-8 h-8 rounded-full text-slate-300 hover:text-white hover:bg-white/10 flex items-center justify-center","aria-label":Fe.actionSeekBack,children:z.jsx("i",{className:"fas fa-undo-alt text-xs"})}),z.jsxs("div",{className:"flex-1 flex items-center gap-2",children:[z.jsxs("span",{className:"text-[10px] font-mono text-white w-8 text-right",children:[Math.floor(Q/60),":",Math.floor(Q%60).toString().padStart(2,"0")]}),z.jsxs("div",{className:"flex-1 h-8 relative flex items-center group cursor-pointer progress-bar-container",ref:Y,children:[z.jsx("div",{className:"absolute w-full h-1 bg-slate-700 rounded-full overflow-hidden pointer-events-none",children:z.jsx("div",{className:"h-full bg-emerald-500",style:{width:`${Q/K*100}%`}})}),z.jsx("div",{className:"absolute w-3 h-3 bg-white rounded-full shadow transition-all scale-0 group-hover:scale-100 pointer-events-none",style:{left:`${Q/K*100}%`,transform:"translateX(-50%)"}})]}),z.jsxs("span",{className:"text-[10px] font-mono text-white w-8",children:[Math.floor(K/60),":",Math.floor(K%60).toString().padStart(2,"0")]})]}),z.jsx("button",{onClick:()=>Le(5),className:"w-8 h-8 rounded-full text-slate-300 hover:text-white hover:bg-white/10 flex items-center justify-center","aria-label":Fe.actionSeekFwd,children:z.jsx("i",{className:"fas fa-redo-alt text-xs"})}),z.jsx("button",{onClick:()=>jt(),className:"w-10 h-8 rounded-full bg-emerald-600/20 text-emerald-400 hover:bg-emerald-600 hover:text-white flex items-center justify-center transition-all border border-emerald-500/30","aria-label":Fe.enterVR,children:z.jsx("i",{className:"fas fa-vr-cardboard"})}),z.jsx("button",{onClick:At,className:"w-8 h-8 rounded-full text-slate-300 hover:text-white hover:bg-white/10 flex items-center justify-center","aria-label":Fe.fullscreen,children:z.jsx("i",{className:"fas fa-expand"})})]})})]}),z.jsxs("div",{className:"w-full h-full flex relative z-10",children:[z.jsx(oR,{eye:E.mode===tn.MAGIC_WINDOW?"single":"left",vrMode:E.mode,screenType:E.screenType,videoFormat:E.videoFormat,profile:E.profile,item:d,videoRef:ae,currentCue:he,definition:He,isTranslating:J,hoveredWord:Ne,dwellProgress:Mt,headRotation:Ri,isPlaying:pe,duration:K,currentTime:Q,isCalibrationMode:$e,onCloseDefinition:pt,onExit:ht,language:i,isGameMode:E.isGameMode,gameStats:S,cues:q,hitObjectsRef:M,zoomScale:O}),E.mode===tn.STEREO&&z.jsx(oR,{eye:"right",vrMode:E.mode,screenType:E.screenType,videoFormat:E.videoFormat,profile:E.profile,item:d,videoRef:Ee,currentCue:he,definition:He,isTranslating:J,hoveredWord:Ne,dwellProgress:Mt,headRotation:Ri,isPlaying:pe,duration:K,currentTime:Q,isCalibrationMode:$e,onCloseDefinition:pt,onExit:ht,language:i,isGameMode:E.isGameMode,gameStats:S,cues:q,hitObjectsRef:M,zoomScale:O})]})]})]})},lR=document.getElementById("root");lR&&xL.createRoot(lR).render(z.jsx(b8,{}));
